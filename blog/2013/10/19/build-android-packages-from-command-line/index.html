
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Build Android Packages From Command Line - 技术小黑屋</title>
  <meta name="author" content="androidyue">
  
  <meta name="keywords" content="Java,Ruby,Android,Linux,日语" />
  <meta name="ujianVerification" content="13e7551f5af04296bb891d33b010bf6b" />
  
  <meta name="description" content="Build Android Packages From Command Line Oct 19th, 2013 A few months ago,I dealed with a task:To build a large amount of apk files. The trick I came &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="http://7jpolu.com1.z0.glb.clouddn.com/touch_icon.png"/>
  
  <link rel="canonical" href="http://droidyue.com/blog/2013/10/19/build-android-packages-from-command-line">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="技术小黑屋" type="application/atom+xml">
  <script src="http://droidyue.b0.upaiyun.com/js/blog/modernizr-2.0.js"></script>
  <script src="http://droidyue.b0.upaiyun.com/js/jquery.min.js"></script>
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/blogutils.js" charset="utf-8"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="http://droidyue.b0.upaiyun.com/js/blog/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://7xld7n.com1.z0.glb.clouddn.com/pt_serif.css" rel="stylesheet" type="text/css">
<link href="http://7xld7n.com1.z0.glb.clouddn.com/PT_Sans.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droid_ref/remote_head.js" charset="utf-8"></script>
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/best_posts_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/trackurl_maker.js" charset="utf-8"></script>
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">技术小黑屋</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:droidyue.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">博客</a></li>
  <li><a href="/ninki">干货文章</a></li>
  <li><a href="/blog/archives">存档</a></li>
  <li><a href="/about/">关于</a></li>
  <li><a href="/subscribe/">订阅</a></li>
  <li><a href="/jijizhazha/">叽叽喳喳</a></li>
  <li><a href="/donate/">Donate</a></li>
  <li><a href="/jobs/">Jobs</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Build Android Packages From Command Line</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-19T09:11:00+08:00" pubdate data-updated="true">Oct 19<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A few months ago,I dealed with a task:To build a large amount of apk files.  The trick I came up with is to build apk file from the command so that I could use Python to glue all the works.  Eventually I made it.And so this post is to make some description about the trick.</p>

<h2>Requirements</h2>

<ul>
<li> Setup JDK</li>
<li> Setup Android SDK

<h2>Steps</h2></li>
<li>Generate R class file</li>
<li>Compile Java codes(.java files) into classes(.class) files</li>
<li>Convert .class files into .dex files</li>
<li>Package Resouces</li>
<li>Build Unsigned APK File</li>
<li>Sign Apk with Jarsigner</li>
<li>The Extra One:Use zipalign for optimization</li>
</ul>


<h3>Generate R class File</h3>

<p>In Android,We use R class to refer resources instead of hard-coding the resouces.<br/>
For a better understanding,pleae have a look at <a href="http://www.satyakomatineni.com/akc/display?url=displaynoteimpurl&amp;ownerUserId=satya&amp;reportId=2883">http://www.satyakomatineni.com/akc/display?url=displaynoteimpurl&amp;ownerUserId=satya&amp;reportId=2883</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aapt package -f -m -J /home/androidyue/temp/ubuntu/workspace/MxDataProvider/gen/ -S /home/androidyue/temp/ubuntu/workspace/MxDataProvider/res/ -I /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -M /home/androidyue/temp/ubuntu/workspace/MxDataProvider/AndroidManifest.xml
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -f  force overwrite of existing files</li>
<li> -m  make package directories under location specified by -J</li>
<li> -J  specify where to output R.java resource constant definitions</li>
<li> -S  directory in which to find resources.  Multiple directories will be scanned and the first match found (left to right) will take precedence.</li>
<li> -I  add an existing package to base include set</li>
<li> -M  specify full path to AndroidManifest.xml to include in zip</li>
</ul>


<h3>Comiple .java into .class files</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>javac -encoding UTF-8 -source 1.6 -target 1.6 -bootclasspath /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -d /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin/ /home/androidyue/temp/ubuntu/workspace/MxDataProvider/src//coop/channel/provider/*.java /home/androidyue/temp/ubuntu/workspace/MxDataProvider/gen//coop/channel/provider/R.java
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -encoding encoding  Set the source file encoding name, such as EUC-JP and UTF-8. If -encoding is not specified, the platform default converter is used.</li>
<li> -source release   Specifies the version of source code accepted, Please Do NOT use Java 7(1.7)</li>
<li> -target version  Generate  class files that target a specified version of the VM. Class files will run on the specified target and on later versions, but not on earlier versions of the VM. Valid targets are 1.1, 1.2, 1.3, 1.4, 1.5 (also 5), 1.6(also 6), and 1.7 (also 7).</li>
<li> -bootclasspath bootclasspath Cross-compile against the specified set of boot classes. As with the user class path, boot class path entries are separated by colons (:) and can be directories, JAR archives, or ZIP archives.</li>
<li> -d directory  Set the destination directory for class files. The directory must already exist; javac will not create it.
As I have suffered a lot using Java 7, It&rsquo;s recomended to use Java 6</li>
</ul>


<h3>Convert .class into .dex files</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/home/androidyue/dev_tools/android-sdk-linux_86_backup/build-tools/17.0.0/dx --dex --output<span class="o">=</span>/home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//class.dex /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin/
</span></code></pre></td></tr></table></div></figure>


<p>To dive into Dalvik, please visit <a href="http://source.android.com/devices/tech/dalvik/index.html">http://source.android.com/devices/tech/dalvik/index.html</a></p>

<h3>Package Resouces</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aapt package -f -M /home/androidyue/temp/ubuntu/workspace/MxDataProvider/AndroidManifest.xml -S /home/androidyue/temp/ubuntu/workspace/MxDataProvider/res/ -A /home/androidyue/temp/ubuntu/workspace/MxDataProvider//assets/ -I /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -F /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//resources.ap_
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -F  specify the apk file to output</li>
<li> -A  additional directory in which to find raw asset files</li>
</ul>


<h3>Build Unsigned APK File</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/home/androidyue/temp/ubuntu/dev_tools/adt-bundle-linux_backup/sdk/tools/apkbuilder /tmp/unsignedApkFile.apk -v -u -z /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//resources.ap_ -f /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//class.dex -rf /home/androidyue/temp/ubuntu/workspace/MxDataProvider/src/
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -u      Creates an unsigned package.</li>
<li> -z      Followed by the path to a zip archive. Adds the content of the application package.</li>
<li> -f      Followed by the path to a file. Adds the file to the application package.</li>
<li> -rf     Followed by the path to a source folder. Adds the java resources found in that folder to the application package, while keeping their path relative to the source folder.</li>
</ul>


<h3>Sign Apk with Jarsigner</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jarsigner -keystore /home/androidyue/temp/ubuntu/myKeystore -storepass storepassValue -keypass keypassValue -signedjar /home/androidyue/Desktop/output/max1111111.apk /tmp/unsignedApkFile.apk maxthon -digestalg SHA1 -sigalg MD5withRSA
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> [-keystore <url>]           keystore location</li>
<li> [-storepass <password>]     password for keystore integrity</li>
<li> [-keypass <password>]       password for private key (if different)</li>
<li> [-signedjar <file>]         name of signed JAR file</li>
<li> [-digestalg <algorithm>]    name of digest algorithm</li>
<li> [-sigalg <algorithm>]       name of signature algorithm</li>
</ul>


<h3>Use Zipalign for optimization</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zipalign -f -v 4 /home/androidyue/Desktop/output/max1111111.apk /home/androidyue/Desktop/output/max222222.apk
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> The <alignment> is an integer that defines the byte-alignment boundaries. This must always be 4 (which provides 32-bit alignment) or else it effectively does nothing.</li>
<li> For more details, please visit <a href="http://developer.android.com/tools/help/zipalign.html">http://developer.android.com/tools/help/zipalign.html</a></li>
</ul>


<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.com/gp/product/1250032156/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1250032156&linkCode=as2&tag=droidyueblog-20&linkId=US32QO6KTI7UYC7U">How to Build an Android: The True Story of Philip K. Dick&rsquo;s Robotic Resurrection</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=droidyueblog-20&l=as2&o=1&a=1250032156" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

</div>


  <script type="text/javascript" src="http://toolite.sinaapp.com/html/vote_tips.js" charset="utf-8"></script>
  <html>
	<link href="http://1.toolite.sinaapp.com/css/new_donate.css"  rel="stylesheet" type="text/css">
	<script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/donate_data.js" charset="utf-8"></script>
	
	<div class="donate_widget">
		<br/>
		<div style="text-align: center;font-size:20px;"><script type="text/javascript">document.write(getDonateTips());</script></div></br>
		<input class="donate_item" id="donate_item_first" type="button"  value="5.12元">
		<input class="donate_item" id="donate_item_second" type="button"  value="10.24元">
		<input class="donate_item" id="donate_item_third" type="button"  value="20.48元">
		<input class="donate_item" id="donate_item_fourth" type="button"  value="随意金额">
		<div id="donate_dialog" class="donate_dialog">
			<img src="http://7xnq3g.com1.z0.glb.clouddn.com/wechat_any.png" id="donate_img" height="200px" width="200px"/>
			<p style="text-align: center;">打开微信，扫一扫即可</p>
		</div>
	</div>


	<script type="text/javascript" src="http://1.toolite.sinaapp.com/donate/donate_widget.js" charset="utf-8"></script>
</html>

  <script type="text/javascript" src="http://toolite.sinaapp.com/droidyue_com/post_bannder.js"></script>
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/furi_netou.js" charset="utf-8"></script>
      
<script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/blog_ads_data_source.js" charset="utf-8"></script>
    
<script type="text/javascript">
    	displaySection(shouldDisplayBlogAds() && onlyForDesktop(), isBlogAdsInDebug(), makeBlogAdsDataSource(), makeBlogAdsPrefix(), makeBlogAdsSuffix(), sDroidBlogAdClass);
</script>

  
  <link rel="stylesheet" type="text/css" href="http://droidyue.b0.upaiyun.com/book_recommend/book_recommend_pro.css">
<script type="text/javascript" src="http://1.toolite.sinaapp.com/book_recommend/book_recommend.js" charset="utf-8"></script>


  
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/random_recommend.js" charset="utf-8"></script>
<script type="text/javascript">
    var randomRecommendPosts = makeRecommendPost(makeBestPostsDataSource());
    displaySection(showDisplayRandomRecommend(), isRandomRecommendInDebug(), randomRecommendPosts, makeRandomRecommendPrefix(), makeRandomRecommendSuffix(), sDroidRandomRecommendClass);
</script>

  
  <script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/weixin_gongzhonghao.js" charset="utf-8"></script>
  
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">androidyue</span></span>

      








  


<time datetime="2013-10-19T09:11:00+08:00" pubdate data-updated="true">Oct 19<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>
  
</span>


    </p>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/10/start-android-app-by-adb/" title="Previous Post: Start An Android App by ADB">&laquo; Start An Android App by ADB</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/25/how-to-share-git-tag/" title="Next Post: How To Share Git Tag">How To Share Git Tag &raquo;</a>
        
    </p>
  </footer>
  </article>

  <section>
   <!--高速版-->
<div id="SOHUCS" sid="/blog/2013/10/19/build-android-packages-from-command-line"></div>
<script charset="utf-8" type="text/javascript" src="http://changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
    window.changyan.api.config({
        appid: 'cyrU6w9cI',
        conf: 'prod_0d366f76b04261efa2b407c3b62edd9f'
    });
</script>        

  </section>

</div>

<aside class="sidebar">
  
    <script type="text/javascript">
	var bestPosts = makeBestPostsDataSource();
	bestPosts = makeBatchUrlTrackable(bestPosts, "ninki_posts");
	if (getRandomBoolean()) {
		bestPosts = shuffleJsonObject(bestPosts);
	}
	
	if (shouldLimitBestPosts()) {
		var limit = getBestPostsLimitSize();
		bestPosts = splitJSONObject(bestPosts, limit);
	}
	displaySection(shouldDisplayBestPosts(), isBestPostsInDebug(), bestPosts, makeBestPostsPrefix(), makeBestPostsSuffix(), sDroidBestPostsClass);
</script>
<script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/blogroll_data_source.js" charset="utf-8"></script>
<script type="text/javascript" >
	displaySection(shouldDisplayBlogRoll() && onlyForDesktop(), isBlogRollInDebug(), makeBlogRollDataSource(), makeBlogRollPrefix(), makeBlogRollSuffix(), sDroidBlogRollClass);
</script>
<script type="text/javascript" src="http://toolite.sinaapp.com/droidyue_com/common_book_data_source.js" charset="utf-8"></script>
<script type="text/javascript">
	displaySection(shouldDisplayCommonBook() && onlyForDesktop(), isCommonBookInDebug(), makeCommonBookDataSource(), makeCommonBookPrefix(), makeCommonBookSuffix(), sDroidCommonBookClass);
</script>
<script type="text/javascript" src="http://1.toolite.sinaapp.com/droidyue_com/program_book_data_source.js" charset="utf-8"></script>
        
<script type="text/javascript">
displaySection(shouldDisplayProgramBook() && onlyForDesktop(), isPrgoramBookInDebug(), makeProgramBookDataSource(), makeProgramBookPrefix(), makeProgramBookSuffix(), sDroidProgramBookClass);
</script>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/10/17/funny-programmer-season-three/">程序员的逗比瞬间(第三季)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/11/great-reading-articles-today/">今日值得读，悄悄上线了</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/26/android-tuning-tool-strictmode/">Android性能调优利器StrictMode</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/17/android-process-and-thread-schedule-cgroups/">Android进程线程调度之cgroups</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/12/is-your-java-code-jit-friendly/">你的Java代码对JIT编译友好么？</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/05/android-process-and-thread-schedule-nice/">剖析Android中进程与线程调度之nice</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/29/funny-programmer-season-two/">程序员的逗比瞬间（第二季）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/22/where-has-the-java-permgen-gone/">Java永久代去哪儿了</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/16/dive-into-android-activity-launchmode/">深入讲解Android中Activity launchMode</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/08/funny-programmer-season-one/">程序员的逗比瞬间（第一季）</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/01/dive-into-android-large-heap/">探究android:largeHeap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/25/use-android-lint-to-find-higher-api-usage/">使用Android lint发现并解决高版本API问题</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/18/anr-in-android/">说说Android中的ANR</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/11/start-proxy-server-on-mac/">在Mac上为其他设备开启代理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/06/wei-shi-yao-gao-duan-ren-cai-hui-shi-yong-pai-mai-xuan-gong-zuo/">为什么高端人才会使用拍卖选工作</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - androidyue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> 云存储提供方： <a href="https://www.upyun.com/"><img src="http://upfiles.b0.upaiyun.com/logo/90x45.png" alt="UPYUN"></a></span>
</p>

<div id="includedContentRefEnd"></div>
<script type="text/javascript" src="http://1.toolite.sinaapp.com/droid_ref/baidu_analytics.js" charset="utf-8"> </script> 
</footer>
  











  <script type="text/javascript" src="http://7jpncc.com1.z0.glb.clouddn.com/arrow38.js"></script>
<noscript>Not seeing a <a href="http://www.scrolltotop.com/">Scroll to Top Button</a>? Go to our FAQ page for more info.</noscript>


</body>
</html>
