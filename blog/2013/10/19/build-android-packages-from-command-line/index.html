
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Build Android Packages From Command Line - 技术小黑屋</title>
  <meta name="author" content="androidyue">

  
  <meta name="description" content="A few months ago,I dealed with a task:To build a large amount of apk files. The trick I came up with is to build apk file from the command so that I &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://androidyue.github.io/blog/2013/10/19/build-android-packages-from-command-line">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="技术小黑屋" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43841039-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">技术小黑屋</a></h1>
  
    <h2>Better Than Before</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:androidyue.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Build Android Packages From Command Line</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-19T09:11:00+08:00" pubdate data-updated="true">Oct 19<span>th</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>A few months ago,I dealed with a task:To build a large amount of apk files.  The trick I came up with is to build apk file from the command so that I could use Python to glue all the works.  Eventually I made it.And so this post is to make some description about the trick.</p>

<h2>Requirements</h2>

<ul>
<li> Setup JDK</li>
<li> Setup Android SDK

<h2>Steps</h2></li>
<li>Generate R class file</li>
<li>Compile Java codes(.java files) into classes(.class) files</li>
<li>Convert .class files into .dex files</li>
<li>Package Resouces</li>
<li>Build Unsigned APK File</li>
<li>Sign Apk with Jarsigner</li>
<li>The Extra One:Use zipalign for optimization</li>
</ul>


<h3>Generate R class File</h3>

<p>In Android,We use R class to refer resources instead of hard-coding the resouces.<br/>
For a better understanding,pleae have a look at <a href="http://www.satyakomatineni.com/akc/display?url=displaynoteimpurl&amp;ownerUserId=satya&amp;reportId=2883">http://www.satyakomatineni.com/akc/display?url=displaynoteimpurl&amp;ownerUserId=satya&amp;reportId=2883</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aapt package -f -m -J /home/androidyue/temp/ubuntu/workspace/MxDataProvider/gen/ -S /home/androidyue/temp/ubuntu/workspace/MxDataProvider/res/ -I /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -M /home/androidyue/temp/ubuntu/workspace/MxDataProvider/AndroidManifest.xml
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -f  force overwrite of existing files</li>
<li> -m  make package directories under location specified by -J</li>
<li> -J  specify where to output R.java resource constant definitions</li>
<li> -S  directory in which to find resources.  Multiple directories will be scanned and the first match found (left to right) will take precedence.</li>
<li> -I  add an existing package to base include set</li>
<li> -M  specify full path to AndroidManifest.xml to include in zip</li>
</ul>


<h3>Comiple .java into .class files</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>javac -encoding UTF-8 -source 1.6 -target 1.6 -bootclasspath /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -d /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin/ /home/androidyue/temp/ubuntu/workspace/MxDataProvider/src//coop/channel/provider/*.java /home/androidyue/temp/ubuntu/workspace/MxDataProvider/gen//coop/channel/provider/R.java
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -encoding encoding  Set the source file encoding name, such as EUC-JP and UTF-8. If -encoding is not specified, the platform default converter is used.</li>
<li> -source release   Specifies the version of source code accepted, Please Do NOT use Java 7(1.7)</li>
<li> -target version  Generate  class files that target a specified version of the VM. Class files will run on the specified target and on later versions, but not on earlier versions of the VM. Valid targets are 1.1, 1.2, 1.3, 1.4, 1.5 (also 5), 1.6(also 6), and 1.7 (also 7).</li>
<li> -bootclasspath bootclasspath Cross-compile against the specified set of boot classes. As with the user class path, boot class path entries are separated by colons (:) and can be directories, JAR archives, or ZIP archives.</li>
<li> -d directory  Set the destination directory for class files. The directory must already exist; javac will not create it.
As I have suffered a lot using Java 7, It&rsquo;s recomended to use Java 6</li>
</ul>


<h3>Convert .class into .dex files</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/home/androidyue/dev_tools/android-sdk-linux_86_backup/build-tools/17.0.0/dx --dex --output<span class="o">=</span>/home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//class.dex /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin/
</span></code></pre></td></tr></table></div></figure>


<p>To dive into Dalvik, please visit <a href="http://source.android.com/devices/tech/dalvik/index.html">http://source.android.com/devices/tech/dalvik/index.html</a></p>

<h3>Package Resouces</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>aapt package -f -M /home/androidyue/temp/ubuntu/workspace/MxDataProvider/AndroidManifest.xml -S /home/androidyue/temp/ubuntu/workspace/MxDataProvider/res/ -A /home/androidyue/temp/ubuntu/workspace/MxDataProvider//assets/ -I /home/androidyue/dev_tools/android-sdk-linux_86_backup/platforms/android-17/android.jar -F /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//resources.ap_
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -F  specify the apk file to output</li>
<li> -A  additional directory in which to find raw asset files</li>
</ul>


<h3>Build Unsigned APK File</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/home/androidyue/temp/ubuntu/dev_tools/adt-bundle-linux_backup/sdk/tools/apkbuilder /tmp/unsignedApkFile.apk -v -u -z /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//resources.ap_ -f /home/androidyue/temp/ubuntu/workspace/MxDataProvider/bin//class.dex -rf /home/androidyue/temp/ubuntu/workspace/MxDataProvider/src/
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> -u      Creates an unsigned package.</li>
<li> -z      Followed by the path to a zip archive. Adds the content of the application package.</li>
<li> -f      Followed by the path to a file. Adds the file to the application package.</li>
<li> -rf     Followed by the path to a source folder. Adds the java resources found in that folder to the application package, while keeping their path relative to the source folder.</li>
</ul>


<h3>Sign Apk with Jarsigner</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>jarsigner -keystore /home/androidyue/temp/ubuntu/myKeystore -storepass storepassValue -keypass keypassValue -signedjar /home/androidyue/Desktop/output/max1111111.apk /tmp/unsignedApkFile.apk maxthon -digestalg SHA1 -sigalg MD5withRSA
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> [-keystore <url>]           keystore location</li>
<li> [-storepass <password>]     password for keystore integrity</li>
<li> [-keypass <password>]       password for private key (if different)</li>
<li> [-signedjar <file>]         name of signed JAR file</li>
<li> [-digestalg <algorithm>]    name of digest algorithm</li>
<li> [-sigalg <algorithm>]       name of signature algorithm</li>
</ul>


<h3>Use Zipalign for optimization</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zipalign -f -v 4 /home/androidyue/Desktop/output/max1111111.apk /home/androidyue/Desktop/output/max222222.apk
</span></code></pre></td></tr></table></div></figure>


<h4>Some descriptions</h4>

<ul>
<li> The <alignment> is an integer that defines the byte-alignment boundaries. This must always be 4 (which provides 32-bit alignment) or else it effectively does nothing.</li>
<li> For more details, please visit <a href="http://developer.android.com/tools/help/zipalign.html">http://developer.android.com/tools/help/zipalign.html</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">androidyue</span></span>

      








  


<time datetime="2013-10-19T09:11:00+08:00" pubdate data-updated="true">Oct 19<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://androidyue.github.io/blog/2013/10/19/build-android-packages-from-command-line/" data-via="" data-counturl="http://androidyue.github.io/blog/2013/10/19/build-android-packages-from-command-line/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/10/start-android-app-by-adb/" title="Previous Post: Start An Android App by ADB">&laquo; Start An Android App by ADB</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/25/how-to-share-git-tag/" title="Next Post: How To Share Git Tag">How To Share Git Tag &raquo;</a>
      
    </p>
  </footer>
  </article>

  <section>
  <h1>Comments</h1>
   <!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1728662"></script>
<!-- UY END -->

  </section>

</div>

<aside class="sidebar">
  
    <a href="http://stackoverflow.com/users/749727/androidyue">
<img src="http://stackoverflow.com/users/flair/749727.png" width="270" height="58" alt="profile for androidyue at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for androidyue at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
</a>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/06/14/check-camera-in-android/">检查Android是否具有摄像头</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/05/qu-chu-mysqllian-jie-shi-de-bao-jing-yin/">去除mysql连接时的报警音</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/27/load-url-with-extra-http-headers-using-webview-in-android/">Load URL With Extra HTTP Headers Using WebView in Android</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/21/check-if-a-thread-is-main-thread-in-android/">Check if a Thread Is Main Thread in Android</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/15/quickly-find-content-in-files/">Quickly Find Content in Files</a>
      </li>
    
  </ul>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/105362551238192049560?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript" src="http://s.sharethis.com/loader.js"></script>

<script type="text/javascript">stLight.options({publisher: "c4f362f5-c619-4481-a7ab-bc73e42dc601", doNotHash: false, doNotCopy: false, hashAddressBar: true});</script>
<script>
    var options={ "publisher": "c4f362f5-c619-4481-a7ab-bc73e42dc601", "position": "right", "ad": { "visible": false, "openDelay": 5, "closeDelay": 0 }, "chicklets": { "items": ["googleplus", "sina", "facebook", "twitter", "linkedin", "pinterest", "tumblr", "email", "sharethis"] } };
    var st_hover_widget = new sharethis.widgets.hoverbuttons(options);
</script>
<section>
<h1>Blogrolls</h1>
<ul>
    <li><a href="http://www.pcyoyo.com/" target="__blank">Pcyoyo</a></li>
</ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - androidyue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'androidyue';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://androidyue.github.io/blog/2013/10/19/build-android-packages-from-command-line/';
        var disqus_url = 'http://androidyue.github.io/blog/2013/10/19/build-android-packages-from-command-line/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
