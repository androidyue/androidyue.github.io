
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Check If A Thread Is Main Thread In Android - 技术小黑屋</title>
  <meta name="author" content="androidyue">
  
  <meta name="keywords" content="Java,Android,Linux,Python,内存泄露，性能优化，最键实践" />
  <meta name="ujianVerification" content="13e7551f5af04296bb891d33b010bf6b" />
  
  <meta name="description" content="Check if a Thread Is Main Thread in Android May 21st, 2014 How to check a certain thread is the main one or not in Android? You may say it could be &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="/images/touch_icon.png"/>
  
  <link rel="canonical" href="https://droidyue.com/blog/2014/05/21/check-if-a-thread-is-main-thread-in-android">
  <link href="/images/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="技术小黑屋" type="application/atom+xml">
  <script src="/javascripts/ad.js"></script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/jquery.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      function setCookie(name,value,days) {
          if (days) {
              var date = new Date();
              date.setTime(date.getTime()+(days*24*60*60*1000));
              var expires = "; expires="+date.toGMTString();
          }
          else var expires = "";
          document.cookie = name+"="+value+expires+"; path=/";
      }

      function eraseCookie(name) {
          setCookie(name,"",-1);
      }


      function readCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for(var i=0;i < ca.length;i++) {
              var c = ca[i];
              while (c.charAt(0)==' ') c = c.substring(1,c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
          }
          return null;
      }

      function loadJsNormally(jsUrl) {
          document.write('<script type="text/javascript" charset="utf-8" src="'+ jsUrl +'"></scr'+'ipt>');
      }

      function loadJsWithoutCache(jsUrl) {
          jsUrl = jsUrl + '?v=' + +Math.random();
          loadJsNormally(jsUrl);
      }

      
      var droidyueNoCacheLoading = 'droidyue.no-cache';

      function isNoCacheLoadingEnabled() {
          return readCookie(droidyueNoCacheLoading) != null;
      }

      var noCacheLoading = isNoCacheLoadingEnabled();

      function enableNoCacheLoading() {
          setCookie(droidyueNoCacheLoading, 1, 365);
      }

      function disableNoCacheLoading() {
          eraseCookie(droidyueNoCacheLoading);
      }


      function loadJs(jsUrl) {
          if (noCacheLoading) {
              loadJsWithoutCache(jsUrl);
          } else {
              loadJsNormally(jsUrl);
          }
      }
  </script>
  <script type="text/javascript" charset="utf-8" src="/javascripts/blogutils.js"></script>
  <script type="text/javascript">
    loadJsWithoutCache("https://asset.droidyue.com/javascript/geektime_qr_images.js");
  </script>

  <script type="text/javascript"  charset="utf-8" src="/javascripts/book_rec_base.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="/stylesheets/pt_serif.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/PT_Sans.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="/javascripts/trackurl_maker.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/remote_head.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://asset.droidyue.com/javascript/best_posts_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/common_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/program_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/android_book_data.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/java_book_data.js" charset="utf-8"></script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6762344977202446",
    enable_page_level_ads: true
  });
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?a30bba1172841d3a4e162df23a9c5e0c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<!-- GrowingIO Analytics code version 2.1 -->
<!-- Copyright 2015-2018 GrowingIO, Inc. More info available at http://www.growingio.com -->

<script type='text/javascript'>
!function(e,t,n,g,i){e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},n=t.createElement("script"),tag=t.getElementsByTagName("script")[0],n.async=1,n.src=('https:'==document.location.protocol?'https://':'http://')+g,tag.parentNode.insertBefore(n,tag)}(window,document,"script","assets.giocdn.com/2.1/gio.js","gio");
  gio('init','a9815ce3665ad534', {});

//custom page code begin here

//custom page code end here

gio('send');

</script>

<!-- End GrowingIO Analytics code version: 2.1 -->


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">技术小黑屋</a></h1>
  
</hgroup>

</header>
  <nav role="navigation">
<form action="https://google.com/search" method="get"  target="_blank">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:droidyue.com" />
    <input class="search" type="text" name="q" results="0" placeholder="搜索" />
    <input type=hidden name=domains value="droidyue.com">
    <input type=hidden name=sitesearch value="droidyue.com">
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/ninki/">干货铺子</a></li>
  <li><a href="/blog/archives/">存档</a></li>
  <li><a href="/reading/">读书</a></li>
  <li><a href="/about/">关于</a></li>
  <li><a href="/cooperate/">合作</a></li>
  <li><a href="/donate/">捐赠</a></li>
  <li><a href="/subscribe/">订阅</a></li>
  <li><a href="/gfriends/">好基友</a></li>
  <li><a href="/neitui/">内推</a></li>
  <li><a href="/fuli/index.html">福利</a></li>
  <li><a href="/links/">友链</a></li>
</ul>

</nav>
  <div id="main">
    <a href="https://gio.ren/w/AovVWjoz" target="_blank" title="https://gio.ren/w/AovVWjoz">

	<img src="https://asset.droidyue.com/image/201908/kaikeba.png" class="no_boarder_class kaikeba" style="max-Width:100%">
</a>

    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Check if a Thread Is Main Thread in Android</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-21T21:42:00+08:00" pubdate data-updated="true">May 21<span>st</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>How to check a certain thread is the main one or not in Android? You may say it could be determined by checking the name. Yes, It may resolve the problem. However I think it&rsquo;s not reliable.</p>

<!-- more -->


<p>This is the most reliable workaround.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isInMainThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">()</span> <span class="o">==</span> <span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Actually the above code could already resolve your problem. If you want to know more details, please go on reading this post.<br/>
Now Let&rsquo;s do some tests to check the reliability of this method.
This the method with additional debug log</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isInMainThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Looper</span> <span class="n">myLooper</span> <span class="o">=</span> <span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Looper</span> <span class="n">mainLooper</span> <span class="o">=</span> <span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;isInMainThread myLooper=&quot;</span> <span class="o">+</span> <span class="n">myLooper</span>
</span><span class='line'>      <span class="o">+</span> <span class="s">&quot;;mainLooper=&quot;</span> <span class="o">+</span> <span class="n">mainLooper</span><span class="o">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">myLooper</span> <span class="o">==</span> <span class="n">mainLooper</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Now we run this test case. Of course we assume that the following code is running in the main thread.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testInMainThread inMainThread=&quot;</span> <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>Look at the output log. It works well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>;<span class="nv">mainLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testInMainThread <span class="nv">inMainThread</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we are going to check the method running in a non-main thread without a message loop.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testIn NOT in MainThread isMainThread=&quot;</span>
</span><span class='line'>          <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>As we can see from the below output. the main looper has been assigned. However the looper associated with the current thread is Null. That&rsquo;s because <code>Threads by default do not have a message loop associated with them. Of course, the method works</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>null;mainLooper<span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testIn NOT in MainThread <span class="nv">isMainThread</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, Now we create a thread with a message loop. And let&rsquo;s have a check. According to Android Developer Docs, This is a typical example of the implementation of a Looper thread, using the separation of prepare() and loop() to create an initial Handler to communicate with the Looper.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="c1">// process incoming messages here</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">};</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testInNonMainLooperThread isMainThread=&quot;</span>
</span><span class='line'>            <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span><span class='line'>      <span class="n">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'><span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now both the looper bound to the current thread and the main looper has been assigned. However the are different. That&rsquo;s right; and the method still works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d72c58<span class="o">}</span>;<span class="nv">mainLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testInNonMainLooperThread <span class="nv">isMainThread</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>But why? And what &rsquo;s inside?
Let&rsquo;s see the code what&rsquo;s is inside the  Looper.class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// sThreadLocal.get() will return null unless you&#39;ve called prepare().</span>
</span><span class='line'><span class="kd">static</span> <span class="kd">final</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Looper</span><span class="o">&gt;</span> <span class="n">sThreadLocal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Looper</span><span class="o">&gt;();</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="n">sMainLooper</span><span class="o">;</span>  <span class="c1">// guarded by Looper.class</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Initialize the current thread as a looper, marking it as an</span>
</span><span class='line'><span class="cm"> * application&#39;s main looper. The main looper for your application</span>
</span><span class='line'><span class="cm"> * is created by the Android environment, so you should never need</span>
</span><span class='line'><span class="cm"> * to call this function yourself.  See also: {@link #prepare()}</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepareMainLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">prepare</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">sMainLooper</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">&quot;The main Looper has already been prepared.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">sMainLooper</span> <span class="o">=</span> <span class="n">myLooper</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;Only one Looper may be created per thread&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Looper</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Return the Looper object associated with the current thread.  </span>
</span><span class='line'><span class="cm"> * Returns null if the calling thread is not associated with a Looper.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="nf">myLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'> <span class="cm">/** Returns the application&#39;s main looper, which lives in the main thread of the application.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="nf">getMainLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">sMainLooper</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For the main thread, the prepareMainLooper method will be called by the Android Environment not by developers. In this way, the looper associated with the main thread is created and passed the reference to the sMainLooper; thus this could guarantee the two looper equals, actually the are the same one.</p>

<p>For non-main thread without a message loop, the looper bound to the current thread is null, because you never call the prepare by yourself. Of course the two looper are different.</p>

<p>For non-main thread with a message loop, Before calling the Lopper.prepare method, the main looper is already assigned. And by calling this method, a looper bound to the current thread is created. And Of course, it is not the main looper.</p>

<p>The above code makes sense.</p>

<p>References:</p>

<ul>
<li> <a href="http://developer.android.com/reference/android/os/Looper.html">http://developer.android.com/reference/android/os/Looper.html</a></li>
<li> <a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.4.2_r1/android/os/Looper.java/">http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.4.2_r1/android/os/Looper.java/</a></li>
</ul>


<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.com/gp/product/1783286873/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1783286873&linkCode=as2&tag=droidyueblog-20&linkId=GA4SWV3DJHSTDG7A">Asynchronous Android</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=droidyueblog-20&l=as2&o=1&a=1783286873" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

</div>


  <script type="text/javascript"  charset="utf-8" src="/javascripts/vote_tips.js"></script>
  
  <br/>
  <script type="text/javascript">
		var geekTimeLinkImageStr = "<a href='http://gk.link/a/104bk'><img src='https://asset.droidyue.com/image/geektime/jikeshijian.jpeg' class='no_boarder_class' style='max-Width:100%'></a><br/>"
		// document.write(geekTimeLinkImageStr)
</script>
  <div id="post_rec"></div>
  <br/>
  
  <!-- 
<script type="text/javascript"  charset="utf-8" src="/javascripts/random_recommend.js">
</script>
<script type="text/javascript" charset="utf-8">
    var randomRecommendPosts = makeRecommendPost(makeBestPostsDataSource());
    displaySection(showDisplayRandomRecommend(), isRandomRecommendInDebug(), randomRecommendPosts, makeRandomRecommendPrefix(), makeRandomRecommendSuffix(), sDroidRandomRecommendClass);
</script>
 -->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="4907659907"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script> 
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">androidyue</span></span>

      








  


<time datetime="2014-05-21T21:42:00+08:00" pubdate data-updated="true">May 21<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>android</a>, <a class='category' href='/blog/categories/handler/'>handler</a>, <a class='category' href='/blog/categories/looper/'>looper</a>, <a class='category' href='/blog/categories/thread/'>thread</a>
  
</span>


    </p>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/05/15/quickly-find-content-in-files/" title="Previous Post: Quickly Find Content in Files">&laquo; Quickly Find Content in Files</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/05/27/load-url-with-extra-http-headers-using-webview-in-android/" title="Next Post: Load URL With Extra HTTP Headers Using WebView In Android">Load URL With Extra HTTP Headers Using WebView In Android &raquo;</a>
        
    </p>
    



	<!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


  </footer>
  </article>

<br/>

  <section>
   <link rel="stylesheet" href="https://asset.droidyue.com/gitalk/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
	var gitalk = new Gitalk({
  		clientID: 'c6dab5d2becf02e6568f',
  		clientSecret: '9541ee96975f1661eab6f69811d0730d348c6546',
  		repo: 'comments_droidyuecom',
  		owner: 'droidyuecom',
  		admin: ['droidyuecom'],
  		// Ensure uniqueness and length less than 50
  		id: location.pathname.replace("/blog/", "").substring(0,50),      
  		distractionFreeMode: false  // Facebook-like distraction free mode
})

gitalk.render('gitalk-container')
</script>
<!--adsense ads after the comments-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- after_comments -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="9009226797"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  </section>


<link href="/stylesheets/remote.css"  rel="stylesheet" type="text/css">
	
<script type="text/javascript">var jd_union_unid="331185104",jd_ad_ids="506:6",jd_union_pid="COfejf6ILhDQ9/WdARoAIILhuskHKgA=";var jd_width=0;var jd_height=0;var jd_union_euid="";var p="AhIDUx5dFgsUDmVEH0hfIlgRRgYlXVZaCCsfSlpMWGVEH0hfIk8lcwNFZltsNRIPD14MfhVbM31%2BRWdZF2sVAhYBURhZFAYaN1cZWxULFgdUHmslXVZaCCsQewMiWBFGBiUCFg5WE18dChICXBxaJQMiN2U%3D";</script><script type="text/javascript" charset="utf-8" src="//u-x.jd.com/static/js/auto.js"></script>

<style type="text/css">
#pdd_ul {
    margin-left:5rem
}
</style>

<ul id="pdd_ul">
    <li><a href="https://mobile.yangkeduo.com/app.html?use_reload=1&launch_url=duo_collection.html%3F__page%3Ddis%26pid%3D9961975_132254737%26cpsSign%3DCIP_200321_9961975_132254737_20320d0ca126c41d3271832bbdc626aa%26duoduo_type%3D2&campaign=ddjb&cid=launch_">【内购专供，请勿外传】拼多多员工内购清单，数量不多，先到先得~</a>
    </li>

    <li><a href="https://mobile.yangkeduo.com/app.html?use_reload=1&launch_url=duo_today_burst.html%3Fpid%3D9961975_132254737%26cpsSign%3DCM_200321_9961975_132254737_f35fadb1aa89577bdf2dca07bd134b81%26duoduo_type%3D2&campaign=ddjb&cid=launch_">今日爆款数量有限，更有超多大额优惠券发放中，一键立抢</a>
    </li>

    <li><a href="https://mobile.yangkeduo.com/app.html?use_reload=1&launch_url=duo_nine_nine.html%3Fpid%3D9961975_132254737%26cpsSign%3DCM_200321_9961975_132254737_4c99e1639d377c286bc5cd2fd170b63d%26duoduo_type%3D2&campaign=ddjb&cid=launch_">全场9块9低价包邮，更有超多大额优惠券发放中，一键立抢>></a>
        </li>

        <li><a href="https://mobile.yangkeduo.com/app.html?use_reload=1&launch_url=duo_transfer_channel.html%3FresourceType%3D4%26pid%3D9961975_132254737%26cpsSign%3DCE_200321_9961975_132254737_c8ecf0fc451398f478eeda6dc4132ebd%26duoduo_type%3D2&campaign=ddjb&cid=launch_transfer_channel_">限时秒杀，底价狂欢，精选好货即将售罄，一键立抢>></a></li>

        <li><a href="https://mobile.yangkeduo.com/app.html?use_reload=1&launch_url=duo_transfer_channel.html%3FresourceType%3D39996%26pid%3D9961975_132254737%26_pdd_fs%3D1%26_pdd_tc%3Dffffff%26_pdd_sbs%3D1%26cpsSign%3DCE_200321_9961975_132254737_a2b695b301c6c92323a9fce5eabc6bb8%26duoduo_type%3D2&campaign=ddjb&cid=launch_transfer_channel_">官方百亿补贴，全场品质保障，全网最低，一键立抢>></a></li>
</ul>

	
</div>

<aside class="sidebar">
  
    
<script type="text/javascript">
	loadJs('/javascripts/right_image_rec.js');
</script>
<script type="text/javascript" src="/javascripts/notice.js" charset="utf-8"></script>
<script type="text/javascript">
	displaySection(shouldDisplayNotice(), isNoticeInDebug(), makeNoticeDataSource(), makeNoticePrefix(), makeNoticeSuffix(), 'notice');
</script>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/29/auto-on-after-power-failure-nuc/">Nuc 设置断电后自动开机</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/29/kotlintips-as-type/">KotlinTips asType 快捷转换</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/29/kotlin-tips-elvis-return/">KotlinTips Elvis 快速返回</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/22/kotlin-tips-get-value-safely/">KotlinTips: getValueSafely 安全取值</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/22/wechat-payment-server-jobs/">微信支付 核心业务应用工程师(深圳/广州) 招聘内推</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/03/21/contribute-to-droidyue-dot-com/">技术小黑屋投稿开放了</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/02/29/set-proxy-for-wget/">Linux 下 Wget 设置代理</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/02/23/install-jdk-on-raspberry-pi/">树莓派安装jdk 8</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/02/23/fix-lc-ctype-lc-all-cannot-set-lc-ctype-to-default-locale-no-such-file-or-directory-issue/">修复 LC_CTYPE LC_ALL 设置问题</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/02/09/play-audio-or-video-background-in-webview-app-android/">Android Webview 后台播放音视频实现</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/01/28/a-script-to-change-dns-on-mac-os/">Mac下实现超快捷切换DNS</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/01/12/fix-checkstyle-file-name-issue/">解决Checkstyle File Name 异常的问题</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2020/01/05/kotlin-flag-extension-methods/">Kotlin 处理位操作Flag 快捷方法</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/29/create-a-linux-service-with-systemd/">创建Linux服务，轻松管理（自启动，恢复）进程</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/28/rxhttp-an-awesome-library-mixed-with-rxjava-and-okhttp/">RxHttp 一款让你眼前一亮的 Http 请求框架</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/22/kotlin-annotation-jvmfiled-and-jvmstatic-and-object/">Kotlin 注解 第三篇 @JvmField 与 @JvmStatic</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/15/translate-words-in-terminal/">终端依赖者福利：终端也能实现翻译功能了</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/08/display-img-in-ternimal/">Mac 下在终端直接查看图片</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/12/01/android-uid-process-name/">在 Android 中如何确定 App(Activity) 的启动者</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/11/24/smart-log-in-android-slash-kotlin/">这可能是最好的 Android/Kotlin日志输出方法</a>
      </li>
    
  </ul>
</section>
<script type="text/javascript" charset="utf-8">
	loadJs("https://asset.droidyue.com/javascript/blogroll_data_source.js");
</script>
<script type="text/javascript" >
	displaySection(shouldDisplayBlogRoll() && onlyForDesktop(), isBlogRollInDebug(), makeBlogRollDataSource(), makeBlogRollPrefix(), makeBlogRollSuffix(), sDroidBlogRollClass);
</script>
<script type="text/javascript">
	displaySection(shouldDisplayCommonBook() && onlyForDesktop(), isCommonBookInDebug(), makeCommonBookDataSource(), makeCommonBookPrefix(), makeCommonBookSuffix(), sDroidCommonBookClass);
</script>
<script type="text/javascript">
displaySection(shouldDisplayProgramBook() && onlyForDesktop(), isPrgoramBookInDebug(), makeProgramBookDataSource(), makeProgramBookPrefix(), makeProgramBookSuffix(), sDroidProgramBookClass);
</script>
<script type="text/javascript" charset="utf-8">
	displayJavaBook();
	displayAndroidBook();
</script>
<script type="text/javascript">
	var bestPosts = makeBestPostsDataSource();
	
	if (getRandomBoolean()) {
		bestPosts = shuffleJsonObject(bestPosts);
	}
	
	if (shouldLimitBestPosts()) {
		var limit = getBestPostsLimitSize();
		bestPosts = splitJSONObject(bestPosts, limit);
	}
	displaySection(shouldDisplayBestPosts(), isBestPostsInDebug(), bestPosts, makeBestPostsPrefix(), makeBestPostsSuffix(), sDroidBestPostsClass);
</script>
<center><h3>扫一扫关注小黑屋公众号(droidyue_com)</h3></center> 
<center><img class="no_boarder_class"  style="max-Width:100%" src="https://asset.droidyue.com/image/wechat_gongzhonghao_droidyue.com.jpg"></center><html>
	<!-- <script type="text/javascript">
		for (var i = 0; i < 3 ; i++) {
			document.write("<img class='no_boarder_class' style='max-Width:100%' src='" + geekTimeQrImages[i] + "'>");
		};
	</script>
	
	<br/> -->
	
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- post_right_0 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="2412800998"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

	
</html>

  
</aside>




    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - androidyue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> ；优质服务品牌： 
	  <a href="https://onedrive.live.com/?invref=6b59396564b1963a&invscr=90">OneDrive</a>
	  <a href="https://www.vultr.com/?ref=7819525-4F">Vultr VPS</a>
	  <a href="https://m.do.co/c/3c4ff5a7ed39">Digital Ocean</a>
      <a href="https://billing.virmach.com/aff.php?aff=9882">Virmach(真实可用,1.25$/月)</a>
	  <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=tagltim6">阿里云</a>
  </span>
</p>

<div id="includedContentRefEnd"></div>

<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>

<script type="text/javascript" src="/javascripts/toastr.min.js"></script>
<link href="/stylesheets/toastr.min_v1.css" rel="stylesheet"/>
<div id="toast"></div>
<script type="text/javascript">
	loadJsWithoutCache("https://asset.droidyue.com/javascript/rec_dialog_new.js");
</script>

<script type="text/javascript">
/* 	var url = "http://onionos.com:8080/report_visitor?landUrl=" + window.btoa(document.location.href) + "&refer=" + window.btoa(document.referrer) + "&ua=" + window.btoa(navigator.userAgent);
	loadJsNormally(url);*/
</script>
</footer>
  











  <script type="text/javascript" src="/javascripts/arrow38.js"></script>
<noscript>Not seeing a <a href="http://www.scrolltotop.com/">Scroll to Top Button</a>? Go to our FAQ page for more info.</noscript>


  </div>
</body>
</html>
