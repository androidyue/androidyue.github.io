
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>细话Java："失效"的private修饰符 - 技术小黑屋</title>
  <meta name="author" content="androidyue">
  
  <meta name="keywords" content="Java,Android,Linux,Python,内存泄露，性能优化，最键实践" />
  <meta name="ujianVerification" content="13e7551f5af04296bb891d33b010bf6b" />
  
  <meta name="description" content="细话Java："失效"的private修饰符 Oct 2nd, 2014 在Java编程中，使用private关键字修饰了某个成员，只有这个成员所在的类和这个类的方法可以使用，其他的类都无法访问到这个private成员。 上面描述了private修饰符的基本职能， &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="/images/touch_icon.png"/>
  
  <link rel="canonical" href="https://droidyue.com/blog/2014/10/02/the-private-modifier-in-java">
  <link href="/images/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="技术小黑屋" type="application/atom+xml">
  <script src="/javascripts/ad.js"></script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/jquery.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      function setCookie(name,value,days) {
          if (days) {
              var date = new Date();
              date.setTime(date.getTime()+(days*24*60*60*1000));
              var expires = "; expires="+date.toGMTString();
          }
          else var expires = "";
          document.cookie = name+"="+value+expires+"; path=/";
      }

      function eraseCookie(name) {
          setCookie(name,"",-1);
      }


      function readCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for(var i=0;i < ca.length;i++) {
              var c = ca[i];
              while (c.charAt(0)==' ') c = c.substring(1,c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
          }
          return null;
      }

      function loadJsNormally(jsUrl) {
          document.write('<script type="text/javascript" charset="utf-8" src="'+ jsUrl +'"></scr'+'ipt>');
      }

      function loadJsWithoutCache(jsUrl) {
          jsUrl = jsUrl + '?v=' + +Math.random();
          loadJsNormally(jsUrl);
      }

      
      var droidyueNoCacheLoading = 'droidyue.no-cache';

      function isNoCacheLoadingEnabled() {
          return readCookie(droidyueNoCacheLoading) != null;
      }

      var noCacheLoading = isNoCacheLoadingEnabled();

      function enableNoCacheLoading() {
          setCookie(droidyueNoCacheLoading, 1, 365);
      }

      function disableNoCacheLoading() {
          eraseCookie(droidyueNoCacheLoading);
      }


      function loadJs(jsUrl) {
          if (noCacheLoading) {
              loadJsWithoutCache(jsUrl);
          } else {
              loadJsNormally(jsUrl);
          }
      }
  </script>
  <script type="text/javascript" charset="utf-8" src="/javascripts/blogutils.js"></script>
  <script type="text/javascript">
    loadJsWithoutCache("https://asset.droidyue.com/javascript/geektime_qr_images.js");
  </script>

  <script type="text/javascript"  charset="utf-8" src="/javascripts/book_rec_base.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="/stylesheets/pt_serif.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/PT_Sans.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="/javascripts/trackurl_maker.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/remote_head.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://asset.droidyue.com/javascript/best_posts_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/common_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/program_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/android_book_data.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/java_book_data.js" charset="utf-8"></script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6762344977202446",
    enable_page_level_ads: true
  });
</script>



</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">技术小黑屋</a></h1>
  
</hgroup>

</header>
  <nav role="navigation">
<form action="https://google.com/search" method="get"  target="_blank">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:droidyue.com" />
    <input class="search" type="text" name="q" results="0" placeholder="搜索" />
    <input type=hidden name=domains value="droidyue.com">
    <input type=hidden name=sitesearch value="droidyue.com">
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/ninki/">干货铺子</a></li>
  <li><a href="/blog/archives/">存档</a></li>
  <li><a href="/reading/">读书</a></li>
  <li><a href="/blog/categories/zheng-ban-ruan-jian/">低价正版</a></li>
  <li><a href="/about/">关于</a></li>
  <li><a href="/cooperate/">合作</a></li>
  <li><a href="/donate/">捐赠</a></li>
  <li><a href="/subscribe/">订阅</a></li>
  <li><a href="/gfriends/">好基友</a></li>
  <li><a href="/neitui/">内推</a></li>
  <li><a href="/fuli/index.html">福利</a></li>
  <li><a href="/links/">友链</a></li>
</ul>

</nav>
  <div id="main">
    
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">细话Java："失效"的private修饰符</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-02T17:24:00+08:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>在Java编程中，使用private关键字修饰了某个成员，只有这个成员所在的类和这个类的方法可以使用，其他的类都无法访问到这个private成员。</p>

<p>上面描述了private修饰符的基本职能，今天来研究一下private功能失效的情况。</p>

<!--more-->


<h2>Java内部类</h2>

<p>在Java中相信很多人都用过内部类，Java允许在一个类里面定义另一个类，类里面的类就是内部类，也叫做嵌套类。一个简单的内部类实现可以如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">OuterClass</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">class</span> <span class="nc">InnerClass</span><span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>今天的问题和Java内部类相关，只涉及到部分和本文研究相关的内部类知识，具体关于Java内部类后续的文章会介绍。</p>

<h2>第一次失效?</h2>

<p>一个我们在编程中经常用到的场景，就是在一个内部类里面访问外部类的private成员变量或者方法，这是可以的。如下面的代码实现。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OuterClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="s">&quot;en&quot;</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">region</span> <span class="o">=</span> <span class="s">&quot;US&quot;</span><span class="o">;</span>
</span><span class='line'>  
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printOuterClassPrivateFields</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">String</span> <span class="n">fields</span> <span class="o">=</span> <span class="s">&quot;language=&quot;</span> <span class="o">+</span> <span class="n">language</span> <span class="o">+</span> <span class="s">&quot;;region=&quot;</span> <span class="o">+</span> <span class="n">region</span><span class="o">;</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fields</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">OuterClass</span> <span class="n">outer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OuterClass</span><span class="o">();</span>
</span><span class='line'>      <span class="n">OuterClass</span><span class="o">.</span><span class="na">InnerClass</span> <span class="n">inner</span> <span class="o">=</span> <span class="n">outer</span><span class="o">.</span><span class="na">new</span> <span class="n">InnerClass</span><span class="o">();</span>
</span><span class='line'>      <span class="n">inner</span><span class="o">.</span><span class="na">printOuterClassPrivateFields</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这是为什么呢，不是private修饰的成员只能被成员所述的类才能访问么？难道private真的失效了么？</p>

<h3>编译器在捣鬼？</h3>

<p>我们使用javap命令查看一下生成的两个class文件</p>

<p> OuterClass的反编译结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">15</span><span class="o">:</span><span class="mi">30</span> <span class="n">$</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span>  <span class="n">OuterClass</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;OuterClass.java&quot;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OuterClass</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">{</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">OuterClass</span><span class="o">();</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">11</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">5</span><span class="o">:</span>  <span class="n">ldc</span>  <span class="err">#</span><span class="mi">13</span><span class="o">;</span> <span class="c1">//String en</span>
</span><span class='line'>   <span class="mi">7</span><span class="o">:</span>  <span class="n">putfield</span> <span class="err">#</span><span class="mi">15</span><span class="o">;</span> <span class="c1">//Field language:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">10</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">11</span><span class="o">:</span> <span class="n">ldc</span>  <span class="err">#</span><span class="mi">17</span><span class="o">;</span> <span class="c1">//String US</span>
</span><span class='line'>   <span class="mi">13</span><span class="o">:</span> <span class="n">putfield</span> <span class="err">#</span><span class="mi">19</span><span class="o">;</span> <span class="c1">//Field region:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">16</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="k">new</span>  <span class="err">#</span><span class="mi">1</span><span class="o">;</span> <span class="c1">//class OuterClass</span>
</span><span class='line'>   <span class="mi">3</span><span class="o">:</span>  <span class="n">dup</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">27</span><span class="o">;</span> <span class="c1">//Method &quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">7</span><span class="o">:</span>  <span class="n">astore_1</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>  <span class="k">new</span>  <span class="err">#</span><span class="mi">28</span><span class="o">;</span> <span class="c1">//class OuterClass$InnerClass</span>
</span><span class='line'>   <span class="mi">11</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>   <span class="mi">12</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">13</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>   <span class="mi">14</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">30</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.getClass:()Ljava/lang/Class;</span>
</span><span class='line'>   <span class="mi">17</span><span class="o">:</span> <span class="n">pop</span>
</span><span class='line'>   <span class="mi">18</span><span class="o">:</span> <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">34</span><span class="o">;</span> <span class="c1">//Method OuterClass$InnerClass.&quot;&lt;init&gt;&quot;:(LOuterClass;)V</span>
</span><span class='line'>   <span class="mi">21</span><span class="o">:</span> <span class="n">astore_2</span>
</span><span class='line'>   <span class="mi">22</span><span class="o">:</span> <span class="n">aload_2</span>
</span><span class='line'>   <span class="mi">23</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">37</span><span class="o">;</span> <span class="c1">//Method OuterClass$InnerClass.printOuterClassPrivateFields:()V</span>
</span><span class='line'>   <span class="mi">26</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">access$0</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">getfield</span> <span class="err">#</span><span class="mi">15</span><span class="o">;</span> <span class="c1">//Field language:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">areturn</span>
</span><span class='line'>
</span><span class='line'><span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">access$1</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">getfield</span> <span class="err">#</span><span class="mi">19</span><span class="o">;</span> <span class="c1">//Field region:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">areturn</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>咦？不对，在OuterClass中我们并没有定义这两个方法</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">access$0</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">getfield</span> <span class="err">#</span><span class="mi">15</span><span class="o">;</span> <span class="c1">//Field language:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">areturn</span>
</span><span class='line'>
</span><span class='line'><span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">access$1</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">getfield</span> <span class="err">#</span><span class="mi">19</span><span class="o">;</span> <span class="c1">//Field region:Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">areturn</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>从给出来的注释来看，access$0返回outerClass的language属性；access$1返回outerClass的region属性。并且这两个方法都接受OuterClass的实例作为参数。这两个方法为什么生成呢，有什么作用呢？我们看一下内部类的反编译结果就知道了。</p>

<p><strong>OuterClass$InnerClass的反编译结果</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">15</span><span class="o">:</span><span class="mi">37</span> <span class="n">$</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span> <span class="n">OuterClass</span><span class="err">\</span><span class="n">$InnerClass</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;OuterClass.java&quot;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OuterClass</span><span class="n">$InnerClass</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">{</span>
</span><span class='line'><span class="kd">final</span> <span class="n">OuterClass</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="n">OuterClass$InnerClass</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">2</span><span class="o">:</span>  <span class="n">putfield</span> <span class="err">#</span><span class="mi">10</span><span class="o">;</span> <span class="c1">//Field this$0:LOuterClass;</span>
</span><span class='line'>   <span class="mi">5</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">6</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">12</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">9</span><span class="o">:</span>  <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">printOuterClassPrivateFields</span><span class="o">();</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="k">new</span>  <span class="err">#</span><span class="mi">20</span><span class="o">;</span> <span class="c1">//class java/lang/StringBuilder</span>
</span><span class='line'>   <span class="mi">3</span><span class="o">:</span>  <span class="n">dup</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">ldc</span>  <span class="err">#</span><span class="mi">22</span><span class="o">;</span> <span class="c1">//String language=</span>
</span><span class='line'>   <span class="mi">6</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">24</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span>
</span><span class='line'>   <span class="mi">9</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">10</span><span class="o">:</span> <span class="n">getfield</span> <span class="err">#</span><span class="mi">10</span><span class="o">;</span> <span class="c1">//Field this$0:LOuterClass;</span>
</span><span class='line'>   <span class="mi">13</span><span class="o">:</span> <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">27</span><span class="o">;</span> <span class="c1">//Method OuterClass.access$0:(LOuterClass;)Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">16</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">33</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
</span><span class='line'>   <span class="mi">19</span><span class="o">:</span> <span class="n">ldc</span>  <span class="err">#</span><span class="mi">37</span><span class="o">;</span> <span class="c1">//String ;region=</span>
</span><span class='line'>   <span class="mi">21</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">33</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
</span><span class='line'>   <span class="mi">24</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">25</span><span class="o">:</span> <span class="n">getfield</span> <span class="err">#</span><span class="mi">10</span><span class="o">;</span> <span class="c1">//Field this$0:LOuterClass;</span>
</span><span class='line'>   <span class="mi">28</span><span class="o">:</span> <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">39</span><span class="o">;</span> <span class="c1">//Method OuterClass.access$1:(LOuterClass;)Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">31</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">33</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span>
</span><span class='line'>   <span class="mi">34</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">42</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">37</span><span class="o">:</span> <span class="n">astore_1</span>
</span><span class='line'>   <span class="mi">38</span><span class="o">:</span> <span class="n">getstatic</span>    <span class="err">#</span><span class="mi">46</span><span class="o">;</span> <span class="c1">//Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>   <span class="mi">41</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">42</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">52</span><span class="o">;</span> <span class="c1">//Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>   <span class="mi">45</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面代码调用access$0的代码,其目的是得到OuterClass的language 私有属性。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">13</span><span class="o">:</span>   <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">27</span><span class="o">;</span> <span class="c1">//Method OuterClass.access$0:(LOuterClass;)Ljava/lang/String;</span>
</span></code></pre></td></tr></table></div></figure>


<p>下面代码调用了access$1的代码，其目的是得到OutherClass的region 私有属性。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">28</span><span class="o">:</span>   <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">39</span><span class="o">;</span> <span class="c1">//Method OuterClass.access$1:(LOuterClass;)Ljava/lang/String;</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意：在内部类构造的时候，会将外部类的引用传递进来，并且作为内部类的一个属性，所以内部类会持有一个其外部类的引用。</strong><br/>
this$0就是内部类持有的外部类引用，通过构造方法传递引用并赋值。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="n">OuterClass</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="n">OuterClass$InnerClass</span><span class="o">(</span><span class="n">OuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">2</span><span class="o">:</span>  <span class="n">putfield</span> <span class="err">#</span><span class="mi">10</span><span class="o">;</span> <span class="c1">//Field this$0:LOuterClass;</span>
</span><span class='line'>   <span class="mi">5</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">6</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">12</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">9</span><span class="o">:</span>  <span class="k">return</span>
</span></code></pre></td></tr></table></div></figure>


<h3>小结</h3>

<p>这部分private看上去失效可，实际上并没有失效，因为当内部类调用外部类的私有属性时，其真正的执行是调用了编译器生成的属性的静态方法（即acess$0,access$1等）来获取这些属性值。这一切都是编译器的特殊处理。</p>

<h2>这次也失效？</h2>

<p>如果说上面的写法很常用，那么这样的写法是不是很少接触，但是却可以运行。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherOuterClass</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">InnerClass</span> <span class="n">inner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnotherOuterClass</span><span class="o">().</span><span class="na">new</span> <span class="n">InnerClass</span><span class="o">();</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;InnerClass Filed = &quot;</span> <span class="o">+</span> <span class="n">inner</span><span class="o">.</span><span class="na">x</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">class</span> <span class="nc">InnerClass</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>和上面一样，使用javap反编译看一下。不过这次我们先看一下InnerClass的结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">16</span><span class="o">:</span><span class="mi">03</span> <span class="n">$</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span> <span class="n">AnotherOuterClass</span><span class="err">\</span><span class="n">$InnerClass</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;AnotherOuterClass.java&quot;</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">AnotherOuterClass</span><span class="n">$InnerClass</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">{</span>
</span><span class='line'><span class="kd">final</span> <span class="n">AnotherOuterClass</span> <span class="k">this</span><span class="n">$0</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AnotherOuterClass$InnerClass</span><span class="o">(</span><span class="n">AnotherOuterClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">2</span><span class="o">:</span>  <span class="n">putfield</span> <span class="err">#</span><span class="mi">12</span><span class="o">;</span> <span class="c1">//Field this$0:LAnotherOuterClass;</span>
</span><span class='line'>   <span class="mi">5</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">6</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">14</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">9</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">10</span><span class="o">:</span> <span class="n">bipush</span>   <span class="mi">10</span>
</span><span class='line'>   <span class="mi">12</span><span class="o">:</span> <span class="n">putfield</span> <span class="err">#</span><span class="mi">17</span><span class="o">;</span> <span class="c1">//Field x:I</span>
</span><span class='line'>   <span class="mi">15</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="kd">static</span> <span class="kt">int</span> <span class="n">access$0</span><span class="o">(</span><span class="n">AnotherOuterClass$InnerClass</span><span class="o">);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">getfield</span> <span class="err">#</span><span class="mi">17</span><span class="o">;</span> <span class="c1">//Field x:I</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="n">ireturn</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>又出现了，编译器又自动生成了一个获取私有属性的后门方法access$0一次来获取x的值。</p>

<p>AnotherOuterClass.class的反编译结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">16</span><span class="o">:</span><span class="mi">08</span> <span class="n">$</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span> <span class="n">AnotherOuterClass</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;AnotherOuterClass.java&quot;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherOuterClass</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">{</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">AnotherOuterClass</span><span class="o">();</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="n">aload_0</span>
</span><span class='line'>   <span class="mi">1</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">8</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
</span><span class='line'>  <span class="nl">Code:</span>
</span><span class='line'>   <span class="mi">0</span><span class="o">:</span>  <span class="k">new</span>  <span class="err">#</span><span class="mi">16</span><span class="o">;</span> <span class="c1">//class AnotherOuterClass$InnerClass</span>
</span><span class='line'>   <span class="mi">3</span><span class="o">:</span>  <span class="n">dup</span>
</span><span class='line'>   <span class="mi">4</span><span class="o">:</span>  <span class="k">new</span>  <span class="err">#</span><span class="mi">1</span><span class="o">;</span> <span class="c1">//class AnotherOuterClass</span>
</span><span class='line'>   <span class="mi">7</span><span class="o">:</span>  <span class="n">dup</span>
</span><span class='line'>   <span class="mi">8</span><span class="o">:</span>  <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">18</span><span class="o">;</span> <span class="c1">//Method &quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>   <span class="mi">11</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>   <span class="mi">12</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">19</span><span class="o">;</span> <span class="c1">//Method java/lang/Object.getClass:()Ljava/lang/Class;</span>
</span><span class='line'>   <span class="mi">15</span><span class="o">:</span> <span class="n">pop</span>
</span><span class='line'>   <span class="mi">16</span><span class="o">:</span> <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">23</span><span class="o">;</span> <span class="c1">//Method AnotherOuterClass$InnerClass.&quot;&lt;init&gt;&quot;:(LAnotherOuterClass;)V</span>
</span><span class='line'>   <span class="mi">19</span><span class="o">:</span> <span class="n">astore_1</span>
</span><span class='line'>   <span class="mi">20</span><span class="o">:</span> <span class="n">getstatic</span>    <span class="err">#</span><span class="mi">26</span><span class="o">;</span> <span class="c1">//Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>   <span class="mi">23</span><span class="o">:</span> <span class="k">new</span>  <span class="err">#</span><span class="mi">32</span><span class="o">;</span> <span class="c1">//class java/lang/StringBuilder</span>
</span><span class='line'>   <span class="mi">26</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>   <span class="mi">27</span><span class="o">:</span> <span class="n">ldc</span>  <span class="err">#</span><span class="mi">34</span><span class="o">;</span> <span class="c1">//String InnerClass Filed =</span>
</span><span class='line'>   <span class="mi">29</span><span class="o">:</span> <span class="n">invokespecial</span>    <span class="err">#</span><span class="mi">36</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:(Ljava/lang/String;)V</span>
</span><span class='line'>   <span class="mi">32</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>   <span class="mi">33</span><span class="o">:</span> <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">39</span><span class="o">;</span> <span class="c1">//Method AnotherOuterClass$InnerClass.access$0:(LAnotherOuterClass$InnerClass;)I</span>
</span><span class='line'>   <span class="mi">36</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">43</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;</span>
</span><span class='line'>   <span class="mi">39</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">47</span><span class="o">;</span> <span class="c1">//Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span>
</span><span class='line'>   <span class="mi">42</span><span class="o">:</span> <span class="n">invokevirtual</span>    <span class="err">#</span><span class="mi">51</span><span class="o">;</span> <span class="c1">//Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>   <span class="mi">45</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中这句调用就是外部类通过内部类的实例获取私有属性x的操作</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">33</span><span class="o">:</span>   <span class="n">invokestatic</span> <span class="err">#</span><span class="mi">39</span><span class="o">;</span> <span class="c1">//Method AnotherOuterClass$InnerClass.access$0:(LAnotherOuterClass$InnerClass;)I</span>
</span></code></pre></td></tr></table></div></figure>


<h3>再来个总结</h3>

<p>其中<a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-6.html#jls-6.6.1">java官方文档</a> 有这样一句话</p>

<blockquote><p>if the member or constructor is declared private, then access is permitted if and only if it occurs within the body of the top level class (§7.6) that encloses the declaration of the member or constructor.</p></blockquote>

<p>意思是 如果（内部类的）成员和构造方法设定成了私有修饰符，当且仅当其外部类访问时是允许的。</p>

<h2>如何让内部类私有成员不被外部访问</h2>

<p>相信看完上面两部分，你会觉得，内部类的私有成员想不被外部类访问都很困难吧，谁让编译器“爱管闲事”呢，其实也是可以做到的。那就是使用匿名内部类。</p>

<p>由于mRunnable对象的类型为Runnable，而不是匿名内部类的类型（我们无法正常拿到），而Runanble中没有x这个属性，所以mRunnable.x是不被允许的。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrivateToOuter</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Runnable</span> <span class="n">mRunnable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>      <span class="kd">private</span> <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="mi">10</span><span class="o">;</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
</span><span class='line'>      <span class="n">PrivateToOuter</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrivateToOuter</span><span class="o">();</span>
</span><span class='line'>      <span class="c1">//System.out.println(&quot;anonymous class private filed= &quot;+ p.mRunnable.x); //not allowed</span>
</span><span class='line'>      <span class="n">p</span><span class="o">.</span><span class="na">mRunnable</span><span class="o">.</span><span class="na">run</span><span class="o">();</span> <span class="c1">// allowed</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>最后总结</h2>

<ul>
<li>在本文中，private表面上看上去失效了，但实际上是没有的，而是在调用时通过间接的方法来获取私有的属性。</li>
<li>Java的内部类构造时持有对外部类的应用，C++不会，这一点和C++不一样。</li>
</ul>


<h3>深入Java细节的书籍</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B0011F7WU4/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B0011F7WU4&linkCode=as2&tag=droidyue-23">Java编程思想</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B0011F7WU4" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B001PTGR52/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B001PTGR52&linkCode=as2&tag=droidyue-23">Sun 公司核心技术丛书:Effective Java中文版</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B001PTGR52" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00D2ID4PK/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00D2ID4PK&linkCode=as2&tag=droidyue-23">深入理解Java虚拟机:JVM高级特性与最佳实践</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00D2ID4PK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>


<br/><img src="https://asset.droidyue.com/image/2020_05/droidyue_gzh_green_png.png"  class="no_boarder_class" style="max-Width:100%" /><br/>
</div>


  <script type="text/javascript"  charset="utf-8" src="/javascripts/vote_tips.js"></script>
  
  <br/>
  <div id="post_rec"></div>
  <br/>
<a href="https://droidyue.com/blog/categories/zheng-ban-ruan-jian/">低价正版软件，限时优惠，Office 365,Typora等海量优惠</a><br/>


  <!-- 
<script type="text/javascript"  charset="utf-8" src="/javascripts/random_recommend.js">
</script>
<script type="text/javascript" charset="utf-8">
    var randomRecommendPosts = makeRecommendPost(makeBestPostsDataSource());
    displaySection(showDisplayRandomRecommend(), isRandomRecommendInDebug(), randomRecommendPosts, makeRandomRecommendPrefix(), makeRandomRecommendSuffix(), sDroidRandomRecommendClass);
</script>
 -->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="4907659907"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script> 
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">androidyue</span></span>

      








  


<time datetime="2014-10-02T17:24:00+08:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>Java</a>, <a class='category' href='/blog/categories/xi-shuo-java/'>细说Java</a>
  
</span>


    </p>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/10/01/handle-geolocation-request-in-webview/" title="Previous Post: WebView处理网页位置请求">&laquo; WebView处理网页位置请求</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/10/03/handle-image-data-in-android/" title="Next Post: Android处理图像数据全记录">Android处理图像数据全记录 &raquo;</a>
        
    </p>
    



	<!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


  </footer>
  </article>

<br/>
<script type="text/javascript">
		var geekTimeLinkImageStr = "<a href='http://gk.link/a/104bk'><img src='https://asset.droidyue.com/image/geektime/jikeshijian.jpeg' class='no_boarder_class' style='max-Width:100%'></a><br/>"
		// document.write(geekTimeLinkImageStr)
</script>



  <section>
   <link rel="stylesheet" href="https://asset.droidyue.com/gitalk/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
	var gitalk = new Gitalk({
  		clientID: 'c6dab5d2becf02e6568f',
  		clientSecret: '9541ee96975f1661eab6f69811d0730d348c6546',
  		repo: 'comments_droidyuecom',
  		owner: 'droidyuecom',
  		admin: ['droidyuecom'],
  		// Ensure uniqueness and length less than 50
  		id: location.pathname.replace("/blog/", "").substring(0,50),      
  		distractionFreeMode: false  // Facebook-like distraction free mode
})

gitalk.render('gitalk-container')
</script>
<!--adsense ads after the comments-->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- after_comments -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="9009226797"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

  </section>


<link href="/stylesheets/remote.css"  rel="stylesheet" type="text/css">
	

	
</div>

<aside class="sidebar">
  
    
<script type="text/javascript">
	loadJs('/javascripts/right_image_rec.js');
</script>
<script type="text/javascript" src="/javascripts/notice.js" charset="utf-8"></script>
<script type="text/javascript">
	displaySection(shouldDisplayNotice(), isNoticeInDebug(), makeNoticeDataSource(), makeNoticePrefix(), makeNoticeSuffix(), 'notice');
</script>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/09/12/fix-flutter-3-warnings-quickly/">Flutter 3 迁移后编译 Warnings 一键修复</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/09/12/lizhi-new-product-2022-09/">正版软件优惠，近期新品软件推荐</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/09/04/speed-up-about-cloning-git-repos-and-updating-them/">关于仓库的批量处理脚本，效率提升 500%</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/09/04/jetbrains-big-sale/">JetBrains 系列即将涨价，抓紧最后的好价入手！</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/08/16/multiple-step-into-one-for-unpub-publish/">Unpub 发布原子化处理</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/08/09/proxy-setting-in-terminal/">Linux/Mac 终端代理设置，取消与排除名单</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/07/31/flutter-attach-process/">使用 Flutter Attach 实现代码与应用进程关联</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/07/17/handle-back-button-click-with-overlay-in-flutter/">Flutter 处理 Overlay 返回事件</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/07/12/nexus-503-issues/">Nexus Repo 503 错误解决</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/07/12/flutter-webview-handle-self-goback-first/">Flutter Webview 处理回退历史</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/26/fix-grep-is-directory-issue-linux-mac/">Linux 下解决 Grep Is Directory 问题</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/19/waiting-for-another-flutter-command-to-release-the-startup-lock/">Waiting for Another Flutter Command to Release the Startup Lock 问题解决</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/17/siyuan-note-618-sale/">碎片知识整理速成绝招，思源笔记真的太强了！限时优惠还能叠券折上折</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/17/xmind-big-sale-discount/">限时买一年送半年，618 国民级思维导图工具 XMind 2022 来袭！</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/13/a-little-git-log-case-can-do-big-help/">谁动了我的奶酪，通过 Git 找出内容变更历史</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/06/06/git-diff-show-filename-only/">终端下 Git Diff 只展示文件名</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/05/31/2022-618-lizhi-dot-io-apps-with-discounts-android-windows-mac-ios/">给「荔」一夏 618 正版软件大促，秒杀 + 折扣 + 满减一起来袭！</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/05/30/generate-qrcode-in-terminal-on-mac-or-linux/">Mac 下 终端也能生成二维码了</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/05/23/disable-debugprint-and-print-in-flutter-dart-release-mode/">Flutter/Dart Release 模式下屏蔽 debugPrint 与 Print 输出</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2022/05/15/how-to-find-duplicated-file-via-one-script/">一个脚本，快速发现项目中的重复文件</a>
      </li>
    
  </ul>
</section>
<script type="text/javascript" charset="utf-8">
	loadJs("https://asset.droidyue.com/javascript/blogroll_data_source.js");
</script>
<script type="text/javascript" >
	displaySection(shouldDisplayBlogRoll() && onlyForDesktop(), isBlogRollInDebug(), makeBlogRollDataSource(), makeBlogRollPrefix(), makeBlogRollSuffix(), sDroidBlogRollClass);
</script>
<script type="text/javascript">
	displaySection(shouldDisplayCommonBook() && onlyForDesktop(), isCommonBookInDebug(), makeCommonBookDataSource(), makeCommonBookPrefix(), makeCommonBookSuffix(), sDroidCommonBookClass);
</script>
<script type="text/javascript">
displaySection(shouldDisplayProgramBook() && onlyForDesktop(), isPrgoramBookInDebug(), makeProgramBookDataSource(), makeProgramBookPrefix(), makeProgramBookSuffix(), sDroidProgramBookClass);
</script>
<script type="text/javascript" charset="utf-8">
	displayJavaBook();
	displayAndroidBook();
</script>
<script type="text/javascript">
	var bestPosts = makeBestPostsDataSource();
	
	if (getRandomBoolean()) {
		bestPosts = shuffleJsonObject(bestPosts);
	}
	
	if (shouldLimitBestPosts()) {
		var limit = getBestPostsLimitSize();
		bestPosts = splitJSONObject(bestPosts, limit);
	}
	displaySection(shouldDisplayBestPosts(), isBestPostsInDebug(), bestPosts, makeBestPostsPrefix(), makeBestPostsSuffix(), sDroidBestPostsClass);
</script>
<!--<center><h3>扫一扫关注小黑屋公众号(droidyue_com)</h3></center> 
<center><img class="no_boarder_class"  style="max-Width:100%" src="https://asset.droidyue.com/image/wechat_gongzhonghao_droidyue.com.jpg"></center>
-->
<html>
	<!-- <script type="text/javascript">
		for (var i = 0; i < 3 ; i++) {
			document.write("<img class='no_boarder_class' style='max-Width:100%' src='" + geekTimeQrImages[i] + "'>");
		};
	</script>
	
	<br/> -->
	
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- post_right_0 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="2412800998"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

	



</html>

  
</aside>




    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2022 - androidyue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> ；优质服务品牌： 
	  <a href="https://onedrive.live.com/?invref=6b59396564b1963a&invscr=90">OneDrive</a>
	  <a href="https://www.vultr.com/?ref=7819525-4F">Vultr VPS</a>
	  <a href="https://m.do.co/c/3c4ff5a7ed39">Digital Ocean</a>
      <a href="https://billing.virmach.com/aff.php?aff=9882">Virmach(真实可用,1.25$/月)</a>
	  <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=tagltim6">阿里云</a>
  </span>
</p>

<div id="includedContentRefEnd"></div>

<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>

<script type="text/javascript" src="/javascripts/toastr.min.js"></script>
<link href="/stylesheets/toastr.min_v1.css" rel="stylesheet"/>
<div id="toast"></div>
<script type="text/javascript">
	loadJsWithoutCache("https://asset.droidyue.com/javascript/rec_dialog_new.js");
</script>

<script type="text/javascript">
/* 	var url = "http://onionos.com:8080/report_visitor?landUrl=" + window.btoa(document.location.href) + "&refer=" + window.btoa(document.referrer) + "&ua=" + window.btoa(navigator.userAgent);
	loadJsNormally(url);*/
</script>
</footer>
  











  <script type="text/javascript" src="/javascripts/arrow38.js"></script>
<noscript>Not seeing a <a href="http://www.scrolltotop.com/">Scroll to Top Button</a>? Go to our FAQ page for more info.</noscript>


  </div>
</body>
</html>
