<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 七牛 | 技术小黑屋]]></title>
  <link href="http://droidyue.com/blog/categories/qi-niu/atom.xml" rel="self"/>
  <link href="http://droidyue.com/"/>
  <updated>2016-03-06T14:41:03+08:00</updated>
  <id>http://droidyue.com/</id>
  <author>
    <name><![CDATA[androidyue]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[一个简易小工具，七牛Uploader for Octopress]]></title>
    <link href="http://droidyue.com/blog/2016/02/28/an-easy-tool-to-upload-file-to-qiniu-especially-for-octopress/"/>
    <updated>2016-02-28T17:15:00+08:00</updated>
    <id>http://droidyue.com/blog/2016/02/28/an-easy-tool-to-upload-file-to-qiniu-especially-for-octopress</id>
    <content type="html"><![CDATA[<p>春节假期，带着电脑回家，蹭着邻居的网，除夕晚上用ruby写了一个简单的工具。安利一下，广而告之。</p>

<!--more-->


<h2>为什么写这个应用</h2>

<h3>为什么用七牛</h3>

<p>七牛是我比较看好的一个云存储，其国内国外有很多cdn，如果我把我的网站放到七牛上，打开速度应该会显著提升。</p>

<h3>为什么还自己写</h3>

<ul>
<li>七牛官方的qrsync不支持例外目录，会上传.git文件夹下的内容</li>
<li>七牛的qrsync更新策略不符合我的需求</li>
<li>自己有时间和能力</li>
</ul>


<h2>功能描述</h2>

<ul>
<li>暂时只支持对文件的上传和更新，不含删除和下载功能</li>
<li>尤其适合于Octopress网站</li>
</ul>


<h2>使用</h2>

<h3>创建授权信息文件</h3>

<p>从七牛后台 账号&mdash;>秘钥 中获取AccessKey和SecretKey分别填入下面
<code>
[auth]
access_key = ""
secret_key = ""
</code>
将上述内容保存成文件<code>.qiniu.ini</code> 放在同步脚本的祖先目录上即可，也可以放在家目录。</p>

<p>举个例子，比如你的同步脚本放在<code>~/tools/notes/sync_dir/</code>下，你的配置文件，可以放在<code>~/</code>,<code>~/tools/</code>以及<code>~/tools/notes/</code>。</p>

<p>注意，不要将上述文件放同步脚本目录，以免信息泄露。</p>

<h3>同步</h3>

<p>使用方法如下，很简单，需要传入同步文件夹路径和bucket名称</p>

<p><code>java
ruby push2Qiniu.rb dir_to_sync bucket
</code></p>

<h2>实现原理</h2>

<p>实现原理很简单，基本如下</p>

<ul>
<li>新文件 直接上传</li>
<li>已存在的文件，如果lastModified没有变化，不上传</li>
<li>已存在的文件，如果lastModified有变化，检测文件内容md5，如果和上一次不同，则上传，否则不上传。</li>
</ul>


<h2>和Octopress集成</h2>

<p>修改Octopress的Rakefile文件
```ruby
desc &ldquo;Default deploy task&rdquo;
task :deploy do
  # Check if preview posts exist, which should not be published
  if File.exists?(&ldquo;.preview-mode&rdquo;)</p>

<pre><code>puts "## Found posts in preview mode, regenerating files ..."
File.delete(".preview-mode")
Rake::Task[:generate].execute
</code></pre>

<p>  end</p>

<p>  Rake::Task[:copydot].invoke(source_dir, public_dir)
  atom2rssDir = &lsquo;~/osc_git/php_works/&rsquo;
  Rake::Task[&ldquo;#{deploy_default}&rdquo;].execute
  //在这里加入同步脚本执行
end
```</p>

<h2>源码</h2>

<ul>
<li><a href="https://github.com/androidyue/Qiniu_Uploader">Qiniu_Uploader</a></li>
</ul>


<h2>使用七牛</h2>

<p>下面的是七牛的一位员工的QQ二维码，想要使用七牛（每月免费10G流量）并得到更多优惠，请联系她，注明来自技术小黑屋。</p>

<p><img src="http://7jpolu.com1.z0.glb.clouddn.com/qiniu_tina.jpg" alt="http://7jpolu.com1.z0.glb.clouddn.com/qiniu_tina.jpg" /></p>
]]></content>
  </entry>
  
</feed>
