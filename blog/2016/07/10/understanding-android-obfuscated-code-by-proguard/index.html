
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>读懂 Android 中的代码混淆 - 技术小黑屋</title>
  <meta name="author" content="androidyue">
  
  <meta name="keywords" content="Java,Android,Linux,Python,内存泄露，性能优化，最键实践" />
  <meta name="ujianVerification" content="13e7551f5af04296bb891d33b010bf6b" />
  
  <meta name="description" content="读懂 Android 中的代码混淆 Jul 10th, 2016 在Android开发工作中，我们都或多或少接触过代码混淆。比如我们想要集成某个SDK，往往需要做一些排除混淆的操作。 本文为本人的一些实践总结，介绍一些混淆的知识和注意事项。希望可以帮助大家更好的学习和使用代码混淆。 什么是混淆 &hellip;">
  
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" href="/images/touch_icon.png"/>
  
  <link rel="canonical" href="https://droidyue.com/blog/2016/07/10/understanding-android-obfuscated-code-by-proguard">
  <link href="/images/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="技术小黑屋" type="application/atom+xml">
  <script src="/javascripts/ad.js"></script>
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/jquery.min.js"></script>
  <script type="text/javascript" charset="utf-8">
      function setCookie(name,value,days) {
          if (days) {
              var date = new Date();
              date.setTime(date.getTime()+(days*24*60*60*1000));
              var expires = "; expires="+date.toGMTString();
          }
          else var expires = "";
          document.cookie = name+"="+value+expires+"; path=/";
      }

      function eraseCookie(name) {
          setCookie(name,"",-1);
      }


      function readCookie(name) {
          var nameEQ = name + "=";
          var ca = document.cookie.split(';');
          for(var i=0;i < ca.length;i++) {
              var c = ca[i];
              while (c.charAt(0)==' ') c = c.substring(1,c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
          }
          return null;
      }

      function loadJsNormally(jsUrl) {
          document.write('<script type="text/javascript" charset="utf-8" src="'+ jsUrl +'"></scr'+'ipt>');
      }

      function loadJsWithoutCache(jsUrl) {
          jsUrl = jsUrl + '?v=' + +Math.random();
          loadJsNormally(jsUrl);
      }

      
      var droidyueNoCacheLoading = 'droidyue.no-cache';

      function isNoCacheLoadingEnabled() {
          return readCookie(droidyueNoCacheLoading) != null;
      }

      var noCacheLoading = isNoCacheLoadingEnabled();

      function enableNoCacheLoading() {
          setCookie(droidyueNoCacheLoading, 1, 365);
      }

      function disableNoCacheLoading() {
          eraseCookie(droidyueNoCacheLoading);
      }


      function loadJs(jsUrl) {
          if (noCacheLoading) {
              loadJsWithoutCache(jsUrl);
          } else {
              loadJsNormally(jsUrl);
          }
      }
  </script>
  <script type="text/javascript" charset="utf-8" src="/javascripts/blogutils.js"></script>
  <script src="//asset.droidyue.com/javascript/geektime_qr_images.js"></script>

  <script type="text/javascript"  charset="utf-8" src="/javascripts/book_rec_base.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="/stylesheets/pt_serif.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/PT_Sans.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="/javascripts/trackurl_maker.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/remote_head.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://asset.droidyue.com/javascript/best_posts_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/common_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/program_book_data_source.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/android_book_data.js" charset="utf-8"></script>
  <script type="text/javascript" src="/javascripts/java_book_data.js" charset="utf-8"></script>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-6762344977202446",
    enable_page_level_ads: true
  });
</script>
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">技术小黑屋</a></h1>
  
</hgroup>

</header>
  <nav role="navigation">
<form action="https://google.com/search" method="get"  target="_blank">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:droidyue.com" />
    <input class="search" type="text" name="q" results="0" placeholder="搜索" />
    <input type=hidden name=domains value="droidyue.com">
    <input type=hidden name=sitesearch value="droidyue.com">
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/ninki/">干货铺子</a></li>
  <li><a href="/blog/archives/">存档</a></li>
  <li><a href="/reading/">读书</a></li>
  <li><a href="/about/">关于</a></li>
  <li><a href="/cooperate/">合作</a></li>
  <li><a href="/donate/">捐赠</a></li>
  <li><a href="/subscribe/">订阅</a></li>
  <li><a href="/gfriends/">好基友</a></li>
  <li><a href="/neitui/">内推</a></li>
  <li><a href="/fuli/index.html">福利</a></li>
  <li><a href="/links/">友链</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">读懂 Android 中的代码混淆</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-07-10T20:19:00+08:00" pubdate data-updated="true">Jul 10<span>th</span>, 2016</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>在Android开发工作中，我们都或多或少接触过代码混淆。比如我们想要集成某个SDK，往往需要做一些排除混淆的操作。</p>

<p>本文为本人的一些实践总结，介绍一些混淆的知识和注意事项。希望可以帮助大家更好的学习和使用代码混淆。</p>

<!--more-->


<h2>什么是混淆</h2>

<p>关于混淆维基百科上该词条的解释为</p>

<blockquote><p>代码混淆（Obfuscated code）亦称花指令，是将计算机程序的代码，转换成一种功能上等价，但是难于阅读和理解的形式的行为。</p></blockquote>

<p>代码混淆影响到的元素有</p>

<ul>
<li>类名</li>
<li>变量名</li>
<li>方法名</li>
<li>包名</li>
<li>其他元素</li>
</ul>


<h2>混淆的目的</h2>

<p>混淆的目的是为了<strong>加大反编译的成本</strong>,但是并不能彻底防止反编译.</p>

<h2>如何开启混淆</h2>

<ul>
<li>通常我们需要找到项目路径下app目录下的build.gradle文件</li>
<li>找到minifyEnabled这个配置,然后设置为true即可.</li>
</ul>


<p>一个简单的示例如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">buildTypes</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">release</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">minifyEnabled</span> <span class="kc">true</span>
</span><span class='line'>            <span class="n">proguardFiles</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="err">&#39;</span><span class="n">proguard</span><span class="o">-</span><span class="n">android</span><span class="o">.</span><span class="na">txt</span><span class="err">&#39;</span><span class="o">),</span> <span class="err">&#39;</span><span class="n">proguard</span><span class="o">-</span><span class="n">rules</span><span class="o">.</span><span class="na">pro</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>proguard是什么</h2>

<p>Java官网对Proguard的定义</p>

<blockquote><p>ProGuard is a free Java class file shrinker, optimizer, obfuscator, and preverifier. It detects and removes unused classes, fields, methods, and attributes. It optimizes bytecode and removes unused instructions. It renames the remaining classes, fields, and methods using short meaningless names. Finally, it preverifies the processed code for Java 6 or higher, or for Java Micro Edition.</p></blockquote>

<ul>
<li>Proguard是一个集文件压缩,优化,混淆和校验等功能的工具</li>
<li>它检测并删除无用的类,变量,方法和属性</li>
<li>它优化字节码并删除无用的指令.</li>
<li>它通过将类名,变量名和方法名重命名为无意义的名称实现混淆效果.</li>
<li>最后它还校验处理后的代码</li>
</ul>


<h2>混淆的常见配置</h2>

<h3>-keep</h3>

<p>Keep用来保留Java的元素不进行混淆. keep有很多变种,他们一般都是</p>

<ul>
<li>-keep</li>
<li>-keepclassmembers</li>
<li>-keepclasseswithmembers</li>
</ul>


<h4>一些例子</h4>

<p>保留某个包下面的类以及子包</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">-</span><span class="n">keep</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">droidyue</span><span class="o">.</span><span class="na">com</span><span class="o">.</span><span class="na">widget</span><span class="o">.**</span>
</span></code></pre></td></tr></table></div></figure>


<p>保留所有类中使用otto的public方法</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="err">#</span> <span class="n">Otto</span>
</span><span class='line'><span class="o">-</span><span class="n">keepclassmembers</span> <span class="kd">class</span> <span class="err">** {</span>
</span><span class='line'>    <span class="nd">@com.squareup.otto.Subscribe</span> <span class="kd">public</span> <span class="o">*;</span>
</span><span class='line'>    <span class="nd">@com.squareup.otto.Produce</span> <span class="kd">public</span> <span class="o">*;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>保留Contants类的BOOK_NAME属性</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">-</span><span class="n">keepclassmembers</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Constants</span> <span class="o">{</span>
</span><span class='line'>     <span class="kd">public</span> <span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">BOOK_NAME</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>更多关于Proguard keep使用,可以参考<a href="http://proguard.sourceforge.net/">官方文档</a></p>

<h3>-dontwarn</h3>

<p>dontwarn是一个和keep可以说是形影不离,尤其是处理引入的library时.</p>

<p>引入的library可能存在一些无法找到的引用和其他问题,在build时可能会发出警告,如果我们不进行处理,通常会导致build中止.因此为了保证build继续,我们需要使用dontwarn处理这些我们无法解决的library的警告.</p>

<p>比如关闭Twitter sdk的警告,我们可以这样做</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">-</span><span class="n">dontwarn</span> <span class="n">com</span><span class="o">.</span><span class="na">twitter</span><span class="o">.</span><span class="na">sdk</span><span class="o">.**</span>
</span></code></pre></td></tr></table></div></figure>


<p>其他混淆相关的介绍,都可以通过访问官方文档获取.</p>

<h2>哪些不应该混淆</h2>

<h3>反射中使用的元素</h3>

<p>如果一些被混淆使用的元素(属性,方法,类,包名等)进行了混淆,可能会出现问题,如NoSuchFiledException或者NoSuchMethodException等.</p>

<p>比如下面的示例源码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//Constants.java</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Constants</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span>  <span class="n">String</span> <span class="n">BOOK_NAME</span> <span class="o">=</span> <span class="s">&quot;book_name&quot;</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//MainActivity.java</span>
</span><span class='line'><span class="n">Field</span> <span class="n">bookNameField</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">fieldName</span> <span class="o">=</span> <span class="s">&quot;BOOK_NAME&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="n">bookNameField</span> <span class="o">=</span> <span class="n">Constants</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getField</span><span class="o">(</span><span class="n">fieldName</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;bookNameField=&quot;</span> <span class="o">+</span> <span class="n">bookNameField</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果上面的Constants类进行了混淆,那么上面的语句就可能抛出<code>NoSuchFieldException</code>.</p>

<p>想要验证,我们需要看一看混淆的映射文件,文件名为<code>mapping.txt</code>,该文件保存着混淆前后的映射关系.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Constants</span> <span class="o">-&gt;</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">a</span><span class="o">:</span>
</span><span class='line'>    <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="n">BOOK_NAME</span> <span class="o">-&gt;</span> <span class="n">a</span>
</span><span class='line'>    <span class="kt">void</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;()</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="kt">void</span> <span class="o">&lt;</span><span class="n">clinit</span><span class="o">&gt;()</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="n">clinit</span><span class="o">&gt;</span>
</span><span class='line'><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span> <span class="o">-&gt;</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">:</span>
</span><span class='line'>    <span class="kt">void</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;()</span> <span class="o">-&gt;</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Bundle</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">onCreate</span>
</span></code></pre></td></tr></table></div></figure>


<p>从映射文件中,我们可以看到</p>

<ul>
<li><code>Constants</code>类被重命名为<code>a</code>.</li>
<li>Constants类的<code>BOOK_NAME</code>重命名了<code>a</code></li>
</ul>


<p>然后,我们对APK文件进行反编译一探究竟.推荐一下这个在线反编译工具 <a href="http://www.javadecompilers.com/apk">http://www.javadecompilers.com/apk</a></p>

<p>注意,使用jadx decompiler后,会重新命名,正如下面注释<code>/* renamed from: com.example.admin.proguardsample.a */</code>所示.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* renamed from: com.example.admin.proguardsample.a */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">C0314a</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">f1712a</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">f1712a</span> <span class="o">=</span> <span class="s">&quot;book_name&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>而MainActivity的翻译后的对应的源码为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;bookNameField=&quot;</span> <span class="o">+</span> <span class="n">C0314a</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getField</span><span class="o">(</span><span class="s">&quot;BOOK_NAME&quot;</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>MainActivity中反射获取的属性名称依然是<code>BOOK_NAME</code>,而对应的类已经没有了这个属性名,所以会抛出NoSuchFieldException.</p>

<p><strong>注意</strong>，如果上面的filedName使用字面量或者字符串常量，即使混淆也不会出现NoSuchFieldException异常。因为这两种情况下，混淆可以感知外界对filed的引用，已经在调用出替换成了混淆后的名称。</p>

<h3>GSON的序列化与反序列化</h3>

<p>GSON是一个很好的工具,使用它我们可以轻松的实现序列化和反序列化.但是当它一旦遇到混淆,就需要我们注意了.</p>

<p>一个简单的类Item,用来处理序列化和反序列化</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>序列化的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Item</span> <span class="n">toSerializeItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">();</span>
</span><span class='line'><span class="n">toSerializeItem</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'><span class="n">toSerializeItem</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;Apple&quot;</span><span class="o">;</span>
</span><span class='line'><span class="n">String</span> <span class="n">serializedText</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">toSerializeItem</span><span class="o">);</span>
</span><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testGson serializedText=&quot;</span> <span class="o">+</span> <span class="n">serializedText</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>开启混淆之后的日志输出结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">I</span><span class="o">/</span><span class="nl">MainActivity:</span> <span class="n">testGson</span> <span class="n">serializedText</span><span class="o">={</span><span class="s">&quot;a&quot;</span><span class="o">:</span><span class="s">&quot;Apple&quot;</span><span class="o">,</span><span class="s">&quot;b&quot;</span><span class="o">:</span><span class="mi">2</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>属性名已经改变了,变成了没有意思的名称,对我们后续的某些处理是很麻烦的.</p>

<p>反序列化的代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span><span class='line'><span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="s">&quot;{\&quot;id\&quot;:1, \&quot;name\&quot;:\&quot;Orange\&quot;}&quot;</span><span class="o">,</span> <span class="n">Item</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testGson item.id=&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">id</span> <span class="o">+</span> <span class="s">&quot;;item.name=&quot;</span> <span class="o">+</span> <span class="n">item</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>对应的日志结果是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">I</span><span class="o">/</span><span class="nl">MainActivity:</span> <span class="n">testGson</span> <span class="n">item</span><span class="o">.</span><span class="na">id</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">item</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="kc">null</span>
</span></code></pre></td></tr></table></div></figure>


<p>可见,混淆之后,反序列化的属性值设置都失败了.</p>

<h4>为什么呢?</h4>

<ul>
<li>因为反序列化创建对象本质还是利用反射,会根据json字符串的key作为属性名称,value则对应属性值.</li>
</ul>


<h4>如何解决</h4>

<ul>
<li>将序列化和反序列化的类排除混淆</li>
<li>使用<code>@SerializedName</code>注解字段</li>
</ul>


<p>@SerializedName(parameter)通过注解属性实现了</p>

<ul>
<li>序列化的结果中,指定该属性key为parameter的值.</li>
<li>反序列化生成的对象中,用来匹配key与parameter并赋予属性值.</li>
</ul>


<p>一个简单的用法为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>枚举也不要混淆</h3>

<p>枚举是Java 5 中引入的一个很便利的特性,可以很好的替代之前的常量形式.</p>

<p>枚举使用起来很简单,如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Day</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">MONDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">TUESDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">WEDNESDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">THURSDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">FRIDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">SATURDAY</span><span class="o">,</span>
</span><span class='line'>    <span class="n">SUNDAY</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里我们这样使用枚举</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Day</span> <span class="n">day</span> <span class="o">=</span> <span class="n">Day</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="s">&quot;monday&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testEnum day=&quot;</span> <span class="o">+</span> <span class="n">day</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行上面的的代码,通常情况下是没有问题的,是否说明枚举就可以混淆呢?</p>

<p><strong>其实不是</strong>.</p>

<p>为什么没有问题呢,因为默认的<a href="https://android.googlesource.com/platform/sdk/+/android-4.1.2_r2/files/proguard-android.txt">Proguard配置</a>已经处理了枚举相关的keep操作.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="err">#</span> <span class="n">For</span> <span class="n">enumeration</span> <span class="n">classes</span><span class="o">,</span> <span class="n">see</span> <span class="nl">http:</span><span class="c1">//proguard.sourceforge.net/manual/examples.html#enumerations</span>
</span><span class='line'><span class="o">-</span><span class="n">keepclassmembers</span> <span class="kd">enum</span> <span class="o">*</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="o">**[]</span> <span class="n">values</span><span class="o">();</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="o">**</span> <span class="n">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果我们手动去掉这条keep配置,再次运行,一个这样的异常会从天而降.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span> <span class="nl">Process:</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">,</span> <span class="nl">PID:</span> <span class="mi">17246</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">AssertionError</span><span class="o">:</span> <span class="n">impossible</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="n">$1</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">Enum</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">45</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="n">$1</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">Enum</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">36</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">libcore</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">BasicLruCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">BasicLruCache</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">54</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">.</span><span class="na">getSharedConstants</span><span class="o">(</span><span class="n">Enum</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">211</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Enum</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">191</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">.</span><span class="na">j</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">Unknown</span> <span class="n">Source</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Activity</span><span class="o">.</span><span class="na">performCreate</span><span class="o">(</span><span class="n">Activity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">6237</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Instrumentation</span><span class="o">.</span><span class="na">callActivityOnCreate</span><span class="o">(</span><span class="n">Instrumentation</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1107</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">performLaunchActivity</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">2369</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">handleLaunchActivity</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">2476</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.-</span><span class="n">wrap11</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="n">$H</span><span class="o">.</span><span class="na">handleMessage</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1344</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Handler</span><span class="o">.</span><span class="na">dispatchMessage</span><span class="o">(</span><span class="n">Handler</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">102</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">148</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">5417</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">Native</span> <span class="n">Method</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">ZygoteInit</span><span class="n">$MethodAndArgsCaller</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">ZygoteInit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">726</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">ZygoteInit</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">ZygoteInit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">616</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span> <span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NoSuchMethodException</span><span class="o">:</span> <span class="n">values</span> <span class="o">[]</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getMethod</span><span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">624</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">586</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="n">$1</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">Enum</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">41</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span> <span class="nl">AndroidRuntime:</span>  <span class="o">...</span> <span class="mi">19</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>好玩的事情来了,我们看一看为什么会抛出这个异常</p>

<p>1.首先,一个枚举类会生成一个对应的类文件,这里是Day.class.
这里类里面包含什么呢,看一下反编译的结果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="err">➜</span>  <span class="n">proguardsample</span> <span class="n">javap</span>  <span class="n">Day</span>
</span><span class='line'><span class="nl">Warning:</span> <span class="n">Binary</span> <span class="n">file</span> <span class="n">Day</span> <span class="n">contains</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;Day.java&quot;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="kd">extends</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Enum</span><span class="o">&lt;</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">MONDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">TUESDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">WEDNESDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">THURSDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">FRIDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">SATURDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="n">SUNDAY</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span><span class="o">[]</span> <span class="nf">values</span><span class="o">();</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{};</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>枚举实际是创建了一个继承自java.lang.Enum的类</li>
<li>java代码中的枚举类型最后转换成类中的static final属性</li>
<li>多出了两个方法,values()和valueOf().</li>
<li>values方法返回定义的枚举类型的数组集合,即从MONDAY到SUNDAY这7个类型.</li>
</ul>


<p>2.找寻崩溃轨迹
其中Day.valueOf(String)内部会调用Enum.valueOf(Class,String)方法</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Day</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">);</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// class com/example/admin/proguardsample/Day</span>
</span><span class='line'>       <span class="mi">2</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/Enum.valueOf:(Ljava/lang/Class;Ljava/lang/String;)Ljava/lang/Enum;</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="mi">4</span>                  <span class="c1">// class com/example/admin/proguardsample/Day</span>
</span><span class='line'>       <span class="mi">9</span><span class="o">:</span> <span class="n">areturn</span>
</span></code></pre></td></tr></table></div></figure>


<p>而Enum的valueOf方法会间接调用Day.values()方法,具体步骤是</p>

<ul>
<li>Enum.value调用Class.enumConstantDirectory方法获取String到枚举的映射</li>
<li>Class.enumConstantDirectory方法调用Class.getEnumConstantsShared获取当前的枚举类型</li>
<li>Class.getEnumConstantsShared方法使用反射调用values来获取枚举类型的集合.</li>
</ul>


<p>混淆之后,values被重新命名,所以会发生<code>NoSuchMethodException</code>.</p>

<p>关于调用轨迹,感兴趣的可以自己研究一下源码,不难.</p>

<h3>四大组件不建议混淆</h3>

<p>Android中四大组件我们都很常用,这些组件不能被混淆的原因为</p>

<ul>
<li> 四大组件声明必须在manifest中注册,如果混淆后类名更改,而混淆后的类名没有在manifest注册,是不符合Android组件注册机制的.</li>
<li> 外部程序可能使用组件的字符串类名,如果类名混淆,可能导致出现异常</li>
</ul>


<h3>注解不能混淆</h3>

<p>注解在Android平台中使用的越来越多,常用的有ButterKnife和Otto.很多场景下注解被用作在运行时反射确定一些元素的特征.</p>

<p>为了保证注解正常工作,我们不应该对注解进行混淆.Android工程默认的混淆配置已经包含了下面保留注解的配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">-</span><span class="n">keepattributes</span> <span class="o">*</span><span class="n">Annotation</span><span class="o">*</span>
</span></code></pre></td></tr></table></div></figure>


<p>关于注解,可以阅读这篇文章了解.<a href="http://droidyue.com/blog/2016/04/24/look-into-java-annotation/">详解Java中的注解</a></p>

<h2>其他不该混淆的</h2>

<ul>
<li>jni调用的java方法</li>
<li>java的native方法</li>
<li>js调用java的方法</li>
<li>第三方库不建议混淆</li>
<li>其他和反射相关的一些情况</li>
</ul>


<h2>stacktrace的恢复</h2>

<p>Proguard混淆带来了很多好处,但是也会导致我们收集到的崩溃的stacktrace变得更加难以读懂,好在有补救的措施,这里就介绍一个工具,retrace,用来将混淆后的stacktrace还原成混淆之前的信息.</p>

<h3>retrace脚本</h3>

<p>Android 开发环境默认带着retrace脚本,一般情况下路径为<code>./tools/proguard/bin/retrace.sh</code></p>

<h3>mapping映射表</h3>

<p>Proguard进行混淆之后,会生成一个映射表,文件名为mapping.txt,我们可以使用find工具在Project下查找</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="n">mapping</span><span class="o">.</span><span class="na">txt</span>
</span><span class='line'><span class="o">./</span><span class="n">app</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">outputs</span><span class="o">/</span><span class="n">mapping</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">mapping</span><span class="o">.</span><span class="na">txt</span>
</span></code></pre></td></tr></table></div></figure>


<h3>一个崩溃stacktrace信息</h3>

<p>一个原始的崩溃信息是这样的.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span> <span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span><span class="o">:</span> <span class="n">Attempt</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">virtual</span> <span class="n">method</span> <span class="err">&#39;</span><span class="kt">int</span> <span class="n">android</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">Bitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span><span class="err">&#39;</span> <span class="n">on</span> <span class="n">a</span> <span class="kc">null</span> <span class="n">object</span> <span class="n">reference</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">10</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">22</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Activity</span><span class="o">.</span><span class="na">performCreate</span><span class="o">(</span><span class="n">Activity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">6106</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Instrumentation</span><span class="o">.</span><span class="na">callActivityOnCreate</span><span class="o">(</span><span class="n">Instrumentation</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1123</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">performLaunchActivity</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">2566</span><span class="o">)</span>
</span><span class='line'><span class="n">E</span><span class="o">/</span><span class="n">AndroidRuntime</span><span class="o">(</span><span class="mi">24006</span><span class="o">):</span>    <span class="o">...</span> <span class="mi">10</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>对上面的信息处理,去掉<code>E/AndroidRuntime(24006):</code>这些字符串retrace才能正常工作.得到的字符串是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span><span class="o">:</span> <span class="n">Attempt</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">virtual</span> <span class="n">method</span> <span class="err">&#39;</span><span class="kt">int</span> <span class="n">android</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">Bitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span><span class="err">&#39;</span> <span class="n">on</span> <span class="n">a</span> <span class="kc">null</span> <span class="n">object</span> <span class="n">reference</span>
</span><span class='line'><span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">10</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">22</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Activity</span><span class="o">.</span><span class="na">performCreate</span><span class="o">(</span><span class="n">Activity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">6106</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Instrumentation</span><span class="o">.</span><span class="na">callActivityOnCreate</span><span class="o">(</span><span class="n">Instrumentation</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1123</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">performLaunchActivity</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">2566</span><span class="o">)</span>
</span><span class='line'><span class="o">...</span> <span class="mi">10</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>将上面的stacktrace保存成一个文本文件,比如名称为<code>npe_stacktrace.txt</code>.</p>

<p>开搞</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">./</span><span class="n">tools</span><span class="o">/</span><span class="n">proguard</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">retrace</span><span class="o">.</span><span class="na">sh</span>   <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">admin</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">ProguardSample</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">outputs</span><span class="o">/</span><span class="n">mapping</span><span class="o">/</span><span class="n">release</span><span class="o">/</span><span class="n">mapping</span><span class="o">.</span><span class="na">txt</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">npe_stacktrace</span><span class="o">.</span><span class="na">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>得到的易读的stacktrace是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span><span class="o">:</span> <span class="n">Attempt</span> <span class="n">to</span> <span class="n">invoke</span> <span class="n">virtual</span> <span class="n">method</span> <span class="err">&#39;</span><span class="kt">int</span> <span class="n">android</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">Bitmap</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span><span class="err">&#39;</span> <span class="n">on</span> <span class="n">a</span> <span class="kc">null</span> <span class="n">object</span> <span class="n">reference</span>
</span><span class='line'><span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">Utils</span><span class="o">.</span><span class="na">int</span> <span class="nf">getBitmapWidth</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">Bitmap</span><span class="o">)(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">10</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">admin</span><span class="o">.</span><span class="na">proguardsample</span><span class="o">.</span><span class="na">MainActivity</span><span class="o">.</span><span class="na">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Bundle</span><span class="o">)(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">22</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Activity</span><span class="o">.</span><span class="na">performCreate</span><span class="o">(</span><span class="n">Activity</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">6106</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">Instrumentation</span><span class="o">.</span><span class="na">callActivityOnCreate</span><span class="o">(</span><span class="n">Instrumentation</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1123</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">performLaunchActivity</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">2566</span><span class="o">)</span>
</span><span class='line'><span class="o">...</span> <span class="mi">10</span> <span class="n">more</span>
</span></code></pre></td></tr></table></div></figure>


<p>注意:为了更加容易和高效分析stacktrace,建议保留SourceFile和LineNumber属性</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">-</span><span class="n">keepattributes</span> <span class="n">SourceFile</span><span class="o">,</span><span class="n">LineNumberTable</span>
</span></code></pre></td></tr></table></div></figure>


<p>关于混淆,我的一些个人经验总结就是这些.希望可以对大家有所帮助.</p>
</div>


  <script type="text/javascript"  charset="utf-8" src="/javascripts/vote_tips.js"></script>
  
  <br/>
  <script type="text/javascript">
		var geekTimeLinkImageStr = "<a href='http://gk.link/a/104bk'><img src='https://asset.droidyue.com/image/geektime/jikeshijian.jpeg' class='no_boarder_class' style='max-Width:100%'></a><br/>"
		document.write(geekTimeLinkImageStr)
</script>
  <div id="post_rec"></div>
  <br/>
  
  <!-- 
<script type="text/javascript"  charset="utf-8" src="/javascripts/random_recommend.js">
</script>
<script type="text/javascript" charset="utf-8">
    var randomRecommendPosts = makeRecommendPost(makeBestPostsDataSource());
    displaySection(showDisplayRandomRecommend(), isRandomRecommendInDebug(), randomRecommendPosts, makeRandomRecommendPrefix(), makeRandomRecommendSuffix(), sDroidRandomRecommendClass);
</script>
 -->

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="4907659907"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">androidyue</span></span>

      








  


<time datetime="2016-07-10T20:19:00+08:00" pubdate data-updated="true">Jul 10<span>th</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/android/'>Android</a>, <a class='category' href='/blog/categories/proguard/'>Proguard</a>
  
</span>


    </p>
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/06/19/how-to-write-an-awesome-post/" title="Previous Post: 程序员怎样才能写出一篇好的技术文章">&laquo; 程序员怎样才能写出一篇好的技术文章</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/08/01/avoid-creating-unnecesssary-objects-in-android/" title="Next Post: 如何在Android中避免创建不必要的对象">如何在Android中避免创建不必要的对象 &raquo;</a>
        
    </p>
    



	<!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


  </footer>
  </article>


  <section>
   <link rel="stylesheet" href="https://asset.droidyue.com/gitalk/gitalk.css">
<script src="https://asset.droidyue.com/gitalk/gitalk.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
	var gitalk = new Gitalk({
  		clientID: 'c6dab5d2becf02e6568f',
  		clientSecret: '9541ee96975f1661eab6f69811d0730d348c6546',
  		repo: 'comments_droidyuecom',
  		owner: 'droidyuecom',
  		admin: ['droidyuecom'],
  		// Ensure uniqueness and length less than 50
  		id: location.pathname.replace("/blog/", "").substring(0,50),      
  		distractionFreeMode: false  // Facebook-like distraction free mode
})

gitalk.render('gitalk-container')
</script>

  </section>


<link href="/stylesheets/remote.css"  rel="stylesheet" type="text/css">
	
	
</div>

<aside class="sidebar">
  
    <script type="text/javascript">
	loadJs('/javascripts/right_image_rec.js');
</script>
<script type="text/javascript" src="/javascripts/notice.js" charset="utf-8"></script>
<script type="text/javascript">
	displaySection(shouldDisplayNotice(), isNoticeInDebug(), makeNoticeDataSource(), makeNoticePrefix(), makeNoticeSuffix(), 'notice');
</script>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/07/21/configure-kotlin-compiler-options/">为 Kotlin 项目设置编译选项</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/07/14/search-bytecode-script-to-study-kotlin-better/">一个查找字节码更好研究Kotlin的脚本</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/06/30/fix-app-store-show-previous-apple-id/">修复应用无法通过App Store升级的问题</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/06/09/will-unclosed-stream-objects-cause-memory-leaks/">未关闭的文件流会引起内存泄露么？</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/06/02/file-descriptor-explained/">解读文件描述符</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/05/26/abbreviation-do-not-make-me-think/">浅谈编码中的缩写</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/05/20/books-gifts/">送书啦，Kotlin，Android、Flutter都有！</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/05/19/do-and-dont-in-kotlin/">编写地道的 Kotlin 代码</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/05/12/kotlin-vs-flutter/">Kotlin 和 Flutter 对于开发者究竟意味着什么？</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/05/04/git-pre-push-hook/">防手抖开源之 Git 钩子</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/04/27/lambda-inline-noinline-crossinline/">Kotlin 中的 Lambda 与 Inline</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/03/24/cargo-cults-programming/">货物崇拜编程</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/03/17/slap-single-level-of-abstraction-principle/">聊一聊SLAP:单一抽象层级原则</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/03/10/retrofit-json-convetor-error/">处理Retrofit MalformedJsonException报错</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/02/24/decompile-class-file-command-line/">终端反编译字节码利器 CFR</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/01/27/webview-javascript-scrolling-issue/">处理 WebView 与 ViewPager 滑动冲突</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/01/21/thread-process-and-uncaught-exceptions/">聊一聊未捕获异常与进程退出的关联</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/01/13/resolve-charles-unknow-indicator-on-android-phones/">解决Android手机连接Charles Unknown问题</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions/">JVM 如何处理未捕获异常</a>
      </li>
    
      <li class="post">
        <a class="recent_post" href="https://droidyue.com/blog/2018/12/16/daemon-thread-in-java/">JVM 中的守护线程</a>
      </li>
    
  </ul>
</section>
<script type="text/javascript" charset="utf-8">
	loadJs("https://asset.droidyue.com/javascript/blogroll_data_source.js");
</script>
<script type="text/javascript" >
	displaySection(shouldDisplayBlogRoll() && onlyForDesktop(), isBlogRollInDebug(), makeBlogRollDataSource(), makeBlogRollPrefix(), makeBlogRollSuffix(), sDroidBlogRollClass);
</script>
<script type="text/javascript">
	displaySection(shouldDisplayCommonBook() && onlyForDesktop(), isCommonBookInDebug(), makeCommonBookDataSource(), makeCommonBookPrefix(), makeCommonBookSuffix(), sDroidCommonBookClass);
</script>
<script type="text/javascript">
displaySection(shouldDisplayProgramBook() && onlyForDesktop(), isPrgoramBookInDebug(), makeProgramBookDataSource(), makeProgramBookPrefix(), makeProgramBookSuffix(), sDroidProgramBookClass);
</script>
<script type="text/javascript" charset="utf-8">
	displayJavaBook();
	displayAndroidBook();
</script>
<script type="text/javascript">
	var bestPosts = makeBestPostsDataSource();
	
	if (getRandomBoolean()) {
		bestPosts = shuffleJsonObject(bestPosts);
	}
	
	if (shouldLimitBestPosts()) {
		var limit = getBestPostsLimitSize();
		bestPosts = splitJSONObject(bestPosts, limit);
	}
	displaySection(shouldDisplayBestPosts(), isBestPostsInDebug(), bestPosts, makeBestPostsPrefix(), makeBestPostsSuffix(), sDroidBestPostsClass);
</script>
<center><h3>扫一扫关注小黑屋公众号(droidyue_com)</h3></center> 
<center><img class="no_boarder_class"  style="max-Width:100%" src="https://asset.droidyue.com/image/wechat_gongzhonghao_droidyue.com.jpg"></center><html>
	<!--ikbc keyboard-->
	<script type="text/javascript">var jd_union_pid="1729339876";var jd_union_euid="";</script><script type="text/javascript" src="//ads-union.jd.com/static/js/union.js"></script>
	<br/>

	<script type="text/javascript">
		for (var i = 0; i < 3 ; i++) {
			document.write("<img class='no_boarder_class' style='max-Width:100%' src='" + geekTimeQrImages[i] + "'>");
		};
	</script>
	
	<br/>
	
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- post_right_0 -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-6762344977202446"
     data-ad-slot="2412800998"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

	
</html>

  
</aside>




    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - androidyue -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> ；优质服务品牌： 
	  <a href="https://onedrive.live.com/?invref=6b59396564b1963a&invscr=90">OneDrive</a>
	  <a href="https://www.vultr.com/?ref=7819525-4F">Vultr VPS</a>
	  <a href="https://m.do.co/c/3c4ff5a7ed39">Digital Ocean</a>
	  <a href="https://promotion.aliyun.com/ntms/yunparter/invite.html?userCode=tagltim6">阿里云</a>
  </span>
</p>

<div id="includedContentRefEnd"></div>
<script type="text/javascript" charset="utf-8" src="/javascripts//baidu_analytics.js">
</script> 

<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>

<script type="text/javascript" src="/javascripts/toastr.min.js"></script>
<link href="/stylesheets/toastr.min_v1.css" rel="stylesheet"/>
<div id="toast"></div>
<script type="text/javascript">
	loadJsWithoutCache("https://asset.droidyue.com/javascript/rec_dialog_new.js");
</script>

<script type="text/javascript">
/* 	var url = "http://onionos.com:8080/report_visitor?landUrl=" + window.btoa(document.location.href) + "&refer=" + window.btoa(document.referrer) + "&ua=" + window.btoa(navigator.userAgent);
	loadJsNormally(url);*/
</script></footer>
  











  <script type="text/javascript" src="/javascripts/arrow38.js"></script>
<noscript>Not seeing a <a href="http://www.scrolltotop.com/">Scroll to Top Button</a>? Go to our FAQ page for more info.</noscript>


  </div>
</body>
</html>
