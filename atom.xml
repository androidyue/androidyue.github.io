<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[技术小黑屋]]></title>
  <link href="http://droidyue.com/atom.xml" rel="self"/>
  <link href="http://droidyue.com/"/>
  <updated>2014-07-13T21:32:19+08:00</updated>
  <id>http://droidyue.com/</id>
  <author>
    <name><![CDATA[androidyue]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[解决Mac终端退出时的不爽]]></title>
    <link href="http://droidyue.com/blog/2014/07/13/mac-terminal-exit-troubleshoot/"/>
    <updated>2014-07-13T14:28:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/13/mac-terminal-exit-troubleshoot</id>
    <content type="html"><![CDATA[<h2>问题</h2>

<p>从Fedora切换到Linux下,有很多不适应,与其说不适应不如说不爽,其中一个就是今天要说的终端输入exit的问题.在Linux发行版中,输入exit会推出当前窗口,而Mac居然不是,弄出来一个特别脑残的Process Completed,中文版提示大概是提示进程已完成. 然后什么也不能做,只能关闭.真心有点搞不懂这么设计的用意是什么.</p>

<!--more-->


<p><img src="http://droidyueimg.qiniudn.com/terminal_process_finished.png" title="Mac Terminal Process Completed" ></p>

<h2>解决</h2>

<p>当然遇到问题,解决是很必要的,其实简单修改就可以解决问题.
设置Settings&mdash;Shell&mdash;When the shell exits 选择close the window 或如图.
<img src="http://droidyueimg.qiniudn.com/terminal_set_close_exit.png" title="Mac Terminal Set Close Window When Exists" ></p>

<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00A11060M/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00A11060M&linkCode=as2&tag=droidyue-23">Mac功夫:OSX的300多个技巧和小窍门</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00A11060M" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00H1OF8ZA/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00H1OF8ZA&linkCode=as2&tag=droidyue-23">苹果Mac OS X 10.9 Mavericks高手真经</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00H1OF8ZA" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解密:Android设置默认程序]]></title>
    <link href="http://droidyue.com/blog/2014/07/13/set-preferred-application-in-android-chinese-edition/"/>
    <updated>2014-07-13T12:09:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/13/set-preferred-application-in-android-chinese-edition</id>
    <content type="html"><![CDATA[<p>Android作为一个伟大的系统,自然提供了设置默认打开程序的实现.在这篇文章中,我会介绍如何在Android系统中设置默认的程序. 在设置默认程序之前,无非有两种情况,一种是已经有默认的程序,另一种则是没有任何默认程序.</p>

<!--more-->


<h2>检测是否有默认的程序</h2>

<p>检查是必须的,因为结果关乎着我们下一步该怎么做.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetDefaultActivity</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">PackageManager</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">mContext</span><span class="o">.</span><span class="na">getPackageManager</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_VIEW</span><span class="o">);</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;http://www.google.com&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">ResolveInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">MATCH_DEFAULT_ONLY</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">VIEW_LOG_TAG</span><span class="o">,</span> <span class="s">&quot;getDefaultActivity info = &quot;</span> <span class="o">+</span> <span class="n">info</span> <span class="o">+</span> <span class="s">&quot;;pkgName = &quot;</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="na">activityInfo</span><span class="o">.</span><span class="na">packageName</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其对应的日志输出如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">View</span>    <span class="o">(</span> <span class="mi">1145</span> <span class="o">):</span> <span class="n">View</span> <span class="n">getDefaultActivity</span> <span class="n">info</span> <span class="o">=</span> <span class="n">ResolveInfo</span><span class="o">{</span><span class="mi">410</span><span class="n">e4868</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ResolverActivity</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span> <span class="n">m</span><span class="o">=</span><span class="mh">0x0</span><span class="o">};</span><span class="n">pkgName</span> <span class="o">=</span> <span class="n">android</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果没有默认的程序,那么就会显示出默认的就会显示com.android.internal.app.ResolverActivity,那么这个ResolverActivity是什么呢,其实它就是一个选择打开程序的对话框,其庐山真面目应该是这样
<img src="http://droidyueimg.qiniudn.com/resolveactivity.png" title="Android ResolverActivity" ></p>

<p>如果我们设置了傲游浏览器作为我们的默认浏览器,那么默认的程序就应该显示关于傲游浏览器相关的信息. 如下.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">View</span>    <span class="o">(</span> <span class="mi">1145</span> <span class="o">):</span> <span class="n">View</span> <span class="n">getDefaultActivity</span> <span class="n">info</span> <span class="o">=</span> <span class="n">ResolveInfo</span><span class="o">{</span><span class="mi">410</span><span class="n">ae1e8</span> <span class="n">com</span><span class="o">.</span><span class="na">mx</span><span class="o">.</span><span class="na">browser</span><span class="o">.</span><span class="na">MxBrowserActivity</span> <span class="n">p</span><span class="o">=</span><span class="mi">0</span> <span class="n">o</span><span class="o">=</span><span class="mi">0</span> <span class="n">m</span><span class="o">=</span><span class="mh">0x208000</span><span class="o">};</span><span class="n">pkgName</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="na">mx</span><span class="o">.</span><span class="na">browser</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么如何判断是否设置了默认的程序呢,上面的方法默认的ResolveInfo,如果info.activityInfo.packageName为android,则没有设置,否则,有默认的程序.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">hasPreferredApplication</span><span class="o">(</span><span class="kd">final</span> <span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">PackageManager</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getPackageManager</span><span class="o">();</span>
</span><span class='line'>    <span class="n">ResolveInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="na">resolveActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="n">PackageManager</span><span class="o">.</span><span class="na">MATCH_DEFAULT_ONLY</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">!</span><span class="s">&quot;android&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">info</span><span class="o">.</span><span class="na">activityInfo</span><span class="o">.</span><span class="na">packageName</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>如果有默认程序</h2>

<p>我们需要做的是将现在的默认的程序的默认设置清除.</p>

<p>我们能通过代码直接将默认设置改写成我们的么,实际上是不行的,因为权限的问题. 原因是这样的Android因为基于Linux 内核,Linux有着很棒的用户概念,而Android中每个应用就是一个在Linux内核中的用户.两个级别相同的用户无法删除对方.</p>

<p>所以,我们只能交给用户手动做.当然这也是绝大多数程序的做法.你需要做的就是将使用者带到程序详情页,通过这段代码可以跳转到应用详情页.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStartAppDetails</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">//Use the destination package name</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">provider</span><span class="o">.</span><span class="na">Settings</span><span class="o">.</span><span class="na">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="o">,</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;package:com.mx.browser&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">getActivity</span><span class="o">().</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>当跳转到已安装的应用详情页之后,你应该提示用处点击Clear Default 按钮.
<img src="http://droidyue.com/images/post_images/installed_app_details_clear_default.png"></p>

<p>如果用户从安装详情页回到你的程序,你需要检测是不是用户清理了默认的程序设置,判断依据还是是否有默认的程序设置,如果还有默认的,继续提示需要手动清理其他已设置的程序,直到用户彻底清理完成之后,然后按照下面的没有默认设置程序的情况处理.</p>

<p>注意,存在多次清理的情况,如设置浏览器,先清理了UC默认设置后,可能还需要清理海豚浏览器的情况.</p>

<h2>没有默认的程序.</h2>

<p>如果没有默认的程序,我们就需要设置我们希望的程序作为默认,但是,这页不能在代码中实现,还是需要人为的交互选择才可以.你需要做的就是使用类似如下代码,然后弹出一个提示,告诉用户选择你的程序作为默认的程序.至于提示语你可以充分发挥你的想象力.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testStartChooseDialog</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;android.intent.action.VIEW&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">addCategory</span><span class="o">(</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;http://droidyue.com&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">intent</span><span class="o">.</span><span class="na">setComponent</span><span class="o">(</span><span class="k">new</span> <span class="n">ComponentName</span><span class="o">(</span><span class="s">&quot;android&quot;</span><span class="o">,</span><span class="s">&quot;com.android.internal.app.ResolverActivity&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">getActivity</span><span class="o">().</span><span class="na">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>取消自己的默认程序设置</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testClearDefault</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">PackageManager</span> <span class="n">pm</span> <span class="o">=</span> <span class="n">mContext</span><span class="o">.</span><span class="na">getPackageManager</span><span class="o">();</span>
</span><span class='line'>    <span class="n">pm</span><span class="o">.</span><span class="na">clearPackagePreferredActivities</span><span class="o">(</span><span class="n">mContext</span><span class="o">.</span><span class="na">getPackageName</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上述方法只能清理自己的默认设置.</p>

<h2>更近一步</h2>

<p>实际上关于默认设置的配置文件存放在/data/system/packages.xml</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;preferred-activities&gt;</span>
</span><span class='line'><span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">&quot;com.mx.browser/.MxBrowserActivity&quot;</span> <span class="na">match=</span><span class="s">&quot;200000&quot;</span> <span class="na">set=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;set</span> <span class="na">name=</span><span class="s">&quot;com.android.browser/.BrowserActivity&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;set</span> <span class="na">name=</span><span class="s">&quot;com.mx.browser/.MxBrowserActivity&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;filter&gt;</span>
</span><span class='line'><span class="nt">&lt;action</span> <span class="na">name=</span><span class="s">&quot;android.intent.action.VIEW&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;cat</span> <span class="na">name=</span><span class="s">&quot;android.intent.category.BROWSABLE&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;cat</span> <span class="na">name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;scheme</span> <span class="na">name=</span><span class="s">&quot;http&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/filter&gt;</span>
</span><span class='line'><span class="nt">&lt;/item&gt;</span>
</span><span class='line'><span class="nt">&lt;/preferred-activities&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>One More Thing</h2>

<ul>
<li>提问:当一个程序程序安装或卸载,系统会做什么</li>
<li><p>回答:当一个程序安装或者卸载,以浏览器为例子,如果你安装了一个傲游浏览器或者卸载了一个UC浏览器,当你从外部程序打开一个链接时,系统不会使用之前的默认程序打开,而是弹出一个选择对话框供你选择.</p></li>
<li><p>提问:什么时候系统会弹出选择打开程序列表</p></li>
<li>回答:经本人测试,实际是这样的,当有一个Intent过来的时候,系统会动态地收集能处理的Activity,然后从/data/system/packages.xml 读取进行比较,如果两者不同,则弹出选择对话框.</li>
</ul>


<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B009OLU8EE/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B009OLU8EE&linkCode=as2&tag=droidyue-23">Android系统源代码情景分析</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B009OLU8EE" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[顶部带进度条的Webview]]></title>
    <link href="http://droidyue.com/blog/2014/07/12/ding-bu-dai-jin-du-tiao-de-webview/"/>
    <updated>2014-07-12T21:34:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/12/ding-bu-dai-jin-du-tiao-de-webview</id>
    <content type="html"><![CDATA[<p>写这篇文章,做份备忘,简单滴展示一个带进度条的Webview示例,进度条位于Webview上面.</p>

<p>示例图如下</p>

<!--more-->


<p><img src="http://droidyueimg.qiniudn.com/webview_with_progressbar.png" title="webview_with_progressbar" ></p>

<h3>主Activity代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">droidyue</span><span class="o">.</span><span class="na">demo</span><span class="o">.</span><span class="na">webviewprogressbar</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.Menu</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View.OnClickListener</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebChromeClient</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.webkit.WebView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ProgressBar</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.droidyue.demo.webviewprogressbar.R</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">);</span>
</span><span class='line'>      <span class="kd">final</span> <span class="n">ProgressBar</span> <span class="n">bar</span> <span class="o">=</span> <span class="o">(</span><span class="n">ProgressBar</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">myProgressBar</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">final</span> <span class="n">WebView</span> <span class="n">webView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">myWebView</span><span class="o">);</span>
</span><span class='line'>      <span class="n">webView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="n">WebChromeClient</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgressChanged</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="kt">int</span> <span class="n">newProgress</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="o">(</span><span class="n">newProgress</span> <span class="o">==</span> <span class="mi">100</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">bar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                  <span class="k">if</span> <span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">INVISIBLE</span> <span class="o">==</span> <span class="n">bar</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">bar</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">);</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>                  <span class="n">bar</span><span class="o">.</span><span class="na">setProgress</span><span class="o">(</span><span class="n">newProgress</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>              <span class="kd">super</span><span class="o">.</span><span class="na">onProgressChanged</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">newProgress</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>          
</span><span class='line'>      <span class="o">});</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">myButton</span><span class="o">).</span><span class="na">setOnClickListener</span><span class="o">(</span><span class="k">new</span> <span class="n">OnClickListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="nd">@Override</span>
</span><span class='line'>          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClick</span><span class="o">(</span><span class="n">View</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">webView</span><span class="o">.</span><span class="na">reload</span><span class="o">();</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>          
</span><span class='line'>      <span class="o">});</span>
</span><span class='line'>      <span class="kd">final</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://droidyue.com&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">webView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onCreateOptionsMenu</span><span class="o">(</span><span class="n">Menu</span> <span class="n">menu</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">getMenuInflater</span><span class="o">().</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">menu</span><span class="o">.</span><span class="na">main</span><span class="o">,</span> <span class="n">menu</span><span class="o">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>布局文件代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;RelativeLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">xmlns:tools=</span><span class="s">&quot;http://schemas.android.com/tools&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:paddingBottom=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
</span><span class='line'>    <span class="na">android:paddingLeft=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
</span><span class='line'>    <span class="na">android:paddingRight=</span><span class="s">&quot;@dimen/activity_horizontal_margin&quot;</span>
</span><span class='line'>    <span class="na">android:paddingTop=</span><span class="s">&quot;@dimen/activity_vertical_margin&quot;</span>
</span><span class='line'>    <span class="na">tools:context=</span><span class="s">&quot;.MainActivity&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>  
</span><span class='line'>    <span class="nt">&lt;Button</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/myButton&quot;</span>
</span><span class='line'>        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>        <span class="na">android:text=</span><span class="s">&quot;Reload&quot;</span>
</span><span class='line'>        <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;ProgressBar</span>
</span><span class='line'>      <span class="na">style=</span><span class="s">&quot;?android:attr/progressBarStyleHorizontal&quot;</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/myProgressBar&quot;</span>
</span><span class='line'>        <span class="na">android:layout_below=</span><span class="s">&quot;@id/myButton&quot;</span>
</span><span class='line'>        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>        <span class="na">android:layout_height=</span><span class="s">&quot;5px&quot;</span>
</span><span class='line'>        <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;WebView</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/myWebView&quot;</span>
</span><span class='line'>      <span class="na">android:layout_below=</span><span class="s">&quot;@id/myProgressBar&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/RelativeLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>不要忘记在Mainfest加入使用网络权限哟.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.INTERNET&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>实现很简单,没什么技术含量.备忘而已.</p>

<p>关于如何自定义进度条请参考:<a href="http://winwyf.blog.51cto.com/4561999/857867" target="_blank"><a href="http://winwyf.blog.51cto.com/4561999/857867">http://winwyf.blog.51cto.com/4561999/857867</a></a></p>

<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00ASIN7G8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00ASIN7G8&linkCode=as2&tag=droidyue-23">精通Android</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00ASIN7G8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android扫描多媒体文件剖析]]></title>
    <link href="http://droidyue.com/blog/2014/07/12/scan-media-files-in-android-chinese-edition/"/>
    <updated>2014-07-12T19:59:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/12/scan-media-files-in-android-chinese-edition</id>
    <content type="html"><![CDATA[<p>这篇文章从系统源代码分析，讲述如何将程序创建的多媒体文件加入系统的媒体库，如何从媒体库删除，以及大多数程序开发者经常遇到的无法添加到媒体库的问题等。本人将通过对源代码的分析，一一解释这些问题。</p>

<!--more-->


<h2>Android中的多媒体文件扫描机制</h2>

<p>Android提供了一个很棒的程序来处理将多媒体文件加入的媒体库中。这个程序就是MediaProvider，现在我们简单看以下这个程序。首先看一下它的Receiver</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>    <span class="nt">&lt;receiver</span> <span class="na">android:name=</span><span class="s">&quot;MediaScannerReceiver&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.BOOT_COMPLETED&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA_MOUNTED&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;file&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA_UNMOUNTED&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;file&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MEDIA_SCANNER_SCAN_FILE&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;data</span> <span class="na">android:scheme=</span><span class="s">&quot;file&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/receiver&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>MediaScannerReceiver只接收符合action和数据规则正确的intent。</p>

<h3>MediaScannerReciever如何处理Intent</h3>

<ul>
<li>当且仅当接收到<strong>action android.intent.action.BOOT_COMPLETED</strong>才扫描内部存储（非内置和外置sdcard）</li>
<li>除了action为<strong>android.intent.action.BOOT_COMPLETED</strong> 的以外的intent都必须要有数据传递。</li>
<li>当收到 <strong>Intent.ACTION_MEDIA_MOUNTED</strong> intent，扫描Sdcard</li>
<li>当收到 <strong>Intent.ACTION_MEDIA_SCANNER_SCAN_FILE</strong> intent，检测没有问题，将扫描单个文件。</li>
</ul>


<h3>MediaScannerService如何工作</h3>

<p>实际上MediaScannerReceiver并不是真正处理扫描工作，它会启动一个叫做MediaScannerService的服务。我们继续看MediaProvider的manifest中关于service的部分。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>   <span class="nt">&lt;service</span> <span class="na">android:name=</span><span class="s">&quot;MediaScannerService&quot;</span> <span class="na">android:exported=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>            <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.media.IMediaScannerService&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/service&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>MediaScannerService中的scanFile方法</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">Uri</span> <span class="nf">scanFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">String</span> <span class="n">mimeType</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">volumeName</span> <span class="o">=</span> <span class="n">MediaProvider</span><span class="o">.</span><span class="na">EXTERNAL_VOLUME</span><span class="o">;</span>
</span><span class='line'>    <span class="n">openDatabase</span><span class="o">(</span><span class="n">volumeName</span><span class="o">);</span>
</span><span class='line'>    <span class="n">MediaScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">createMediaScanner</span><span class="o">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">scanner</span><span class="o">.</span><span class="na">scanSingleFile</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">volumeName</span><span class="o">,</span> <span class="n">mimeType</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>MediaScannerService中的scan方法</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">scan</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">directories</span><span class="o">,</span> <span class="n">String</span> <span class="n">volumeName</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// don&#39;t sleep while scanning</span>
</span><span class='line'>    <span class="n">mWakeLock</span><span class="o">.</span><span class="na">acquire</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentValues</span><span class="o">();</span>
</span><span class='line'>    <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">MEDIA_SCANNER_VOLUME</span><span class="o">,</span> <span class="n">volumeName</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Uri</span> <span class="n">scanUri</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">().</span><span class="na">insert</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">getMediaScannerUri</span><span class="o">(),</span> <span class="n">values</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">&quot;file://&quot;</span> <span class="o">+</span> <span class="n">directories</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
</span><span class='line'>    <span class="n">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_STARTED</span><span class="o">,</span> <span class="n">uri</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">volumeName</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">MediaProvider</span><span class="o">.</span><span class="na">EXTERNAL_VOLUME</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">openDatabase</span><span class="o">(</span><span class="n">volumeName</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">MediaScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="n">createMediaScanner</span><span class="o">();</span>
</span><span class='line'>        <span class="n">scanner</span><span class="o">.</span><span class="na">scanDirectories</span><span class="o">(</span><span class="n">directories</span><span class="o">,</span> <span class="n">volumeName</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;exception in MediaScanner.scan()&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">getContentResolver</span><span class="o">().</span><span class="na">delete</span><span class="o">(</span><span class="n">scanUri</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">sendBroadcast</span><span class="o">(</span><span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_FINISHED</span><span class="o">,</span> <span class="n">uri</span><span class="o">));</span>
</span><span class='line'>    <span class="n">mWakeLock</span><span class="o">.</span><span class="na">release</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>MediaScannerService中的createMediaScanner方法</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">MediaScanner</span> <span class="nf">createMediaScanner</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">MediaScanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MediaScanner</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>        <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">getResources</span><span class="o">().</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">locale</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">locale</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">language</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="na">getLanguage</span><span class="o">();</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">country</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="na">getCountry</span><span class="o">();</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">localeString</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">language</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">country</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">scanner</span><span class="o">.</span><span class="na">setLocale</span><span class="o">(</span><span class="n">language</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span> <span class="o">+</span> <span class="n">country</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">scanner</span><span class="o">.</span><span class="na">setLocale</span><span class="o">(</span><span class="n">language</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">return</span> <span class="n">scanner</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>从上面可以发现，真正工作的其实是<a href="https://android.googlesource.com/platform/frameworks/base/+/cd92588/media/java/android/media/MediaScanner.java" target="_blank">android.media.MediaScanner.java</a> 具体扫描过程就请点击左侧链接查看。</p>

<h2>如何扫描一个刚创建的文件</h2>

<p>这里介绍两种方式来实现将新创建的文件加入媒体库。</p>

<h3>最简单的方式</h3>

<p>只需要发送一个正确的intent广播到MediaScannerReceiver即可。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span> <span class="n">saveAs</span> <span class="o">=</span> <span class="s">&quot;Your_Created_File_Path&quot;</span>
</span><span class='line'><span class="n">Uri</span> <span class="n">contentUri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">saveAs</span><span class="o">));</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">mediaScanIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">,</span><span class="n">contentUri</span><span class="o">);</span>
</span><span class='line'><span class="n">getContext</span><span class="o">().</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="n">mediaScanIntent</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面的极简方法大多数情况下正常工作，但是有些情况下是不会工作的，稍后的部分会介绍。即使你使用上述方法成功了，还是建议你继续阅读稍后的为什么发广播不成功的部分。</p>

<h3>使用MediaScannerConnection</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">mediaScan</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">MediaScannerConnection</span><span class="o">.</span><span class="na">scanFile</span><span class="o">(</span><span class="n">getActivity</span><span class="o">(),</span>
</span><span class='line'>            <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()</span> <span class="o">},</span> <span class="kc">null</span><span class="o">,</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">OnScanCompletedListener</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="nd">@Override</span>
</span><span class='line'>                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onScanCompleted</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">Log</span><span class="o">.</span><span class="na">v</span><span class="o">(</span><span class="s">&quot;MediaScanWork&quot;</span><span class="o">,</span> <span class="s">&quot;file &quot;</span> <span class="o">+</span> <span class="n">path</span>
</span><span class='line'>                            <span class="o">+</span> <span class="s">&quot; was scanned seccessfully: &quot;</span> <span class="o">+</span> <span class="n">uri</span><span class="o">);</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>MediaScannerConnection的scanFile方法从2.2（API 8）开始引入。</p>

<h3>创建一个MediaScannerConnection对象然后调用scanFile方法</h3>

<p>很简单，参考<a href="http://developer.android.com/reference/android/media/MediaScannerConnection.html" target="_blank"><a href="http://developer.android.com/reference/android/media/MediaScannerConnection.html">http://developer.android.com/reference/android/media/MediaScannerConnection.html</a></a></p>

<h3>如何扫描多个文件</h3>

<ul>
<li>发送多个Intent.ACTION_MEDIA_SCANNER_SCAN_FILE广播</li>
<li>使用MediaScannerConnection，传入要加入的路径的数组。</li>
</ul>


<h2>为什么发送MEDIA_SCANNER_SCAN_FILE广播不生效</h2>

<p>关于为什么有些设备上不生效，很多人认为是API原因，其实不是的，这其实和你传入的文件路径有关系。看一下接收者Receiver的onReceive代码。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getAction</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">intent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_BOOT_COMPLETED</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// scan internal storage</span>
</span><span class='line'>        <span class="n">scan</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">MediaProvider</span><span class="o">.</span><span class="na">INTERNAL_VOLUME</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">getScheme</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;file&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// handle intents related to external storage</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">getPath</span><span class="o">();</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">externalStoragePath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">().</span><span class="na">getPath</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;action: &quot;</span> <span class="o">+</span> <span class="n">action</span> <span class="o">+</span> <span class="s">&quot; path: &quot;</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_MOUNTED</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                <span class="c1">// scan whenever any volume is mounted</span>
</span><span class='line'>                <span class="n">scan</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">MediaProvider</span><span class="o">.</span><span class="na">EXTERNAL_VOLUME</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">action</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span><span class='line'>                    <span class="n">path</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">path</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">externalStoragePath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">scanFile</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">path</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>所有的部分都正确除了传入的路径。因为你可能硬编码了文件路径。因为有一个这样的判断<code>path.startsWith(externalStoragePath + "/")</code>,这里我举一个简单的小例子。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="n">String</span> <span class="n">saveAs</span> <span class="o">=</span> <span class="s">&quot;/sdcard/&quot;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;_add.png&quot;</span><span class="o">;</span>
</span><span class='line'><span class="n">Uri</span> <span class="n">contentUri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">saveAs</span><span class="o">));</span>
</span><span class='line'><span class="n">Intent</span> <span class="n">mediaScanIntent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_MEDIA_SCANNER_SCAN_FILE</span><span class="o">,</span><span class="n">contentUri</span><span class="o">);</span>
</span><span class='line'><span class="n">getContext</span><span class="o">().</span><span class="na">sendBroadcast</span><span class="o">(</span><span class="n">mediaScanIntent</span><span class="o">);</span>
</span><span class='line'><span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">mediaScanIntent</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span><span class='line'><span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">uri</span><span class="o">.</span><span class="na">getPath</span><span class="o">();</span>
</span><span class='line'><span class="n">String</span> <span class="n">externalStoragePath</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="na">getExternalStorageDirectory</span><span class="o">().</span><span class="na">getPath</span><span class="o">();</span>
</span><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;LOGTAG&quot;</span><span class="o">,</span> <span class="s">&quot;Androidyue onReceive intent= &quot;</span> <span class="o">+</span> <span class="n">mediaScanIntent</span>
</span><span class='line'>                        <span class="o">+</span> <span class="s">&quot;;path=&quot;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&quot;;externalStoragePath=&quot;</span> <span class="o">+</span>
</span><span class='line'>                        <span class="n">externalStoragePath</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们看一下输出日志，分析原因。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>LOGTAG Androidyue onReceive <span class="nv">intent</span><span class="o">=</span> Intent <span class="o">{</span> <span class="nv">act</span><span class="o">=</span>android.intent.action.MEDIA_SCANNER_SCAN_FILE <span class="nv">dat</span><span class="o">=</span>file:///sdcard/1390136305831_add.png <span class="o">}</span>;<span class="nv">path</span><span class="o">=</span>/sdcard/1390136305831_add.png;externalStoragePath<span class="o">=</span>/mnt/sdcard
</span></code></pre></td></tr></table></div></figure>


<p>上述输出分析，你发送的广播，action是正确的，数据规则也是正确的，而且你的文件路径也是存在的，<strong>但是</strong>，文件的路径<strong>/sdcard/1390136305831_add.png</strong>并不是以外部存储根路径<strong>/mnt/sdcard/</strong>开头。所以扫描操作没有开始，导致文件没有加入到媒体库。所以，请检查文件的路径。</p>

<h2>如何从多媒体库中移除</h2>

<p>如果我们删除一个多媒体文件的话，也就意味我们还需要将这个文件从媒体库中删除掉。</p>

<h3>能不能简简单单发广播？</h3>

<p>仅仅发一个广播能解决问题么？我倒是希望可以，但是实际上是不工作的，查看如下代码即可明白。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// this function is used to scan a single file</span>
</span><span class='line'><span class="kd">public</span> <span class="n">Uri</span> <span class="nf">scanSingleFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">String</span> <span class="n">volumeName</span><span class="o">,</span> <span class="n">String</span> <span class="n">mimeType</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">initialize</span><span class="o">(</span><span class="n">volumeName</span><span class="o">);</span>
</span><span class='line'>        <span class="n">prescan</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// lastModified is in milliseconds on Files.</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">lastModifiedSeconds</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">lastModified</span><span class="o">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// always scan the file, so we can return the content://media Uri for existing files</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">mClient</span><span class="o">.</span><span class="na">doScanFile</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">mimeType</span><span class="o">,</span> <span class="n">lastModifiedSeconds</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span>
</span><span class='line'>                <span class="kc">false</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">MediaScanner</span><span class="o">.</span><span class="na">isNoMediaPath</span><span class="o">(</span><span class="n">path</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">RemoteException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;RemoteException in MediaScanner.scanFile()&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>正如上述代码，会对文件是否存在进行检查，如果文件不存在，直接停止向下执行。所以这样是不行的。那怎么办呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDeleteFile</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">existingFilePath</span> <span class="o">=</span> <span class="s">&quot;/mnt/sdcard/1390116362913_add.png&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="n">File</span>  <span class="n">existingFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">existingFilePath</span><span class="o">);</span>
</span><span class='line'>    <span class="n">existingFile</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
</span><span class='line'>    <span class="n">ContentResolver</span> <span class="n">resolver</span> <span class="o">=</span> <span class="n">getActivity</span><span class="o">().</span><span class="na">getContentResolver</span><span class="o">();</span>
</span><span class='line'>    <span class="n">resolver</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">EXTERNAL_CONTENT_URI</span><span class="o">,</span> <span class="n">Images</span><span class="o">.</span><span class="na">Media</span><span class="o">.</span><span class="na">DATA</span> <span class="o">+</span> <span class="s">&quot;=?&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="n">existingFilePath</span><span class="o">});</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上述代码是可以工作的，直接从MediaProvider删除即可。
具体的删除代码请参考<a href="http://droidyue.com/blog/2014/02/09/code-snippet-for-media-on-android/" target="_blank">Code Snippet for Media on Android</a></p>

<h2>One More Thing</h2>

<ul>
<li>你可以通过查看/data/data/com.android.providers.media/的external.db文件可以了解更多的信息。</li>
</ul>


<h3>Others</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B009OLU8EE/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B009OLU8EE&linkCode=as2&tag=droidyue-23">Android系统源代码情景分析</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B009OLU8EE" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android中检测当前是否为主线程]]></title>
    <link href="http://droidyue.com/blog/2014/07/12/check-main-thread-in-android-chinese-edition/"/>
    <updated>2014-07-12T16:50:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/12/check-main-thread-in-android-chinese-edition</id>
    <content type="html"><![CDATA[<p>如果在Android中判断某个线程是否是主线程？对于这个问题，你可能说根据线程的名字，当然这个可以解决问题，但是这样是最可靠的么？万一某天Google一下子将线程的名字改称其他神马东西呢。</p>

<!-- more -->


<h2>方法揭晓</h2>

<p>下面的方法是最可靠的解决方案。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isInMainThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">()</span> <span class="o">==</span> <span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>实际上，写到这里就基本解决了文章标题的问题了，但是仅仅研究到这里太肤浅了，刨的不够深，所以需要继续，希望你也可以继续读下去。</p>

<h2>刨根问底</h2>

<h3>实验一</h3>

<p>好，现在，我们对这个稳定的方法做一些测试，首先，下面的方法会增加一些调试打印信息。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isInMainThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Looper</span> <span class="n">myLooper</span> <span class="o">=</span> <span class="n">Looper</span><span class="o">.</span><span class="na">myLooper</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Looper</span> <span class="n">mainLooper</span> <span class="o">=</span> <span class="n">Looper</span><span class="o">.</span><span class="na">getMainLooper</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;isInMainThread myLooper=&quot;</span> <span class="o">+</span> <span class="n">myLooper</span>
</span><span class='line'>      <span class="o">+</span> <span class="s">&quot;;mainLooper=&quot;</span> <span class="o">+</span> <span class="n">mainLooper</span><span class="o">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">myLooper</span> <span class="o">==</span> <span class="n">mainLooper</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
好，然后我们在主线程中运行一个测试，调用上述方法。比如我们这样调用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testInMainThread inMainThread=&quot;</span> <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK，我们看一下输出日志。验证OK。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>;<span class="nv">mainLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testInMainThread <span class="nv">inMainThread</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></td></tr></table></div></figure>


<h3>实验二</h3>

<p>现在我们继续在一个没有消息循环的非主线程，进行验证。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testIn NOT in MainThread isMainThread=&quot;</span>
</span><span class='line'>          <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>正如我们看到的如下日志结果，主线程的Looper（翻译成循环泵，不是很好听）已经被初始化赋值。但是我们新创建的线程的looper还是null。这是因为<strong>Android中的线程默认没有一个和它绑定了的消息循环</strong>（<strong>Threads by default do not have a message loop associated with them. Of course, the method works</strong>）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>null;mainLooper<span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testIn NOT in MainThread <span class="nv">isMainThread</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<h3>实验三</h3>

<p>继续，我们创建一个绑定了消息循环的线程，根据Android开发者文档说明，以下是一个典型的创建消息循环线程的示例，使用单独prepare（）方法和loop（）方法来创建一个绑定到Looper的Handler。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">Thread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Handler</span> <span class="n">mHandler</span><span class="o">;</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Looper</span><span class="o">.</span><span class="na">prepare</span><span class="o">();</span>
</span><span class='line'>      <span class="n">mHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Handler</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>              <span class="c1">// process incoming messages here</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">};</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;testInNonMainLooperThread isMainThread=&quot;</span>
</span><span class='line'>            <span class="o">+</span> <span class="n">isInMainThread</span><span class="o">());</span>
</span><span class='line'>      <span class="n">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'><span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>OK，现在再次检查以下日志，</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: isInMainThread <span class="nv">myLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d72c58<span class="o">}</span>;<span class="nv">mainLooper</span><span class="o">=</span>Looper<span class="o">{</span>40d35ef8<span class="o">}</span>
</span><span class='line'>I/TestInMainThread<span class="o">(</span>32028<span class="o">)</span>: testInNonMainLooperThread <span class="nv">isMainThread</span><span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>两个Looper都被初始化赋值了，但是他们是不同的对象。</p>

<h2>原理发掘</h2>

<p>但是，这是为什么呢，这里面有什么奥秘呢？ 好，让我们看以下Looper.class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// sThreadLocal.get() will return null unless you&#39;ve called prepare().</span>
</span><span class='line'><span class="kd">static</span> <span class="kd">final</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Looper</span><span class="o">&gt;</span> <span class="n">sThreadLocal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Looper</span><span class="o">&gt;();</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="n">sMainLooper</span><span class="o">;</span>  <span class="c1">// guarded by Looper.class</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Initialize the current thread as a looper, marking it as an</span>
</span><span class='line'><span class="cm"> * application&#39;s main looper. The main looper for your application</span>
</span><span class='line'><span class="cm"> * is created by the Android environment, so you should never need</span>
</span><span class='line'><span class="cm"> * to call this function yourself.  See also: {@link #prepare()}</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepareMainLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">prepare</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">sMainLooper</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="s">&quot;The main Looper has already been prepared.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">sMainLooper</span> <span class="o">=</span> <span class="n">myLooper</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">quitAllowed</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">&quot;Only one Looper may be created per thread&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">Looper</span><span class="o">(</span><span class="n">quitAllowed</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Return the Looper object associated with the current thread.  </span>
</span><span class='line'><span class="cm"> * Returns null if the calling thread is not associated with a Looper.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="nf">myLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">sThreadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'> <span class="cm">/** Returns the application&#39;s main looper, which lives in the main thread of the application.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Looper</span> <span class="nf">getMainLooper</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">synchronized</span> <span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">sMainLooper</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>对于主线程来说，prepareMainLooper这个方法会被Android运行环境调用，而不是程序显式调用。通过这个方法，主线程的looper被创建，并且将对象引用传递给sMainLooper。所以保证了主线程myLooper()获取到的引用和getMainLooper()获取到的都是同一个引用。</p>

<p>对于没有消息循环的非主线程，默认的当前线程的looper是null，因为你从来没有手动地调用prepare()，所以它和主线程的looper不一样。</p>

<p>对于绑定了消息循环的非主线程，当调用Looper.prepare方法时，主线程的Looper已经由Android运行环境创建，当调用prepare方法后，绑定到这个非主线程的looper被创建，当然，这不可能和主线程的Looper一样。</p>

<p>综上所述，这个方法是可靠的。</p>

<p>引用:</p>

<ul>
<li> <a href="http://developer.android.com/reference/android/os/Looper.html">http://developer.android.com/reference/android/os/Looper.html</a></li>
<li> <a href="http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.4.2_r1/android/os/Looper.java/">http://grepcode.com/file/repository.grepcode.com/java/ext/com.google.android/android/4.4.2_r1/android/os/Looper.java/</a></li>
</ul>


<h3>其他</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B009OLU8EE/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B009OLU8EE&linkCode=as2&tag=droidyue-23">Android系统源代码情景分析</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B009OLU8EE" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Webview加载网页时发送HTTP头信息]]></title>
    <link href="http://droidyue.com/blog/2014/07/12/load-url-with-extra-header-in-android-webview-chinese-edition/"/>
    <updated>2014-07-12T08:36:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/12/load-url-with-extra-header-in-android-webview-chinese-edition</id>
    <content type="html"><![CDATA[<p>众所周知，当你点击一个超链接进行跳转时，WebView会自动将当前地址作为Referer（引荐）发给服务器，因此很多服务器端程序通过是否包含referer来控制盗链，所以有些时候，直接输入一个网络地址，可能有问题，那么怎么解决盗链控制问题呢，其实在webview加载时加入一个referer就可以了，如何添加呢？</p>

<!-- more -->


<p>从Android 2.2 （也就是API 8）开始，WebView新增加了一个接口方法，就是为了便于我们加载网页时又想发送其他的HTTP头信息的。</p>

<blockquote><p>public void loadUrl (String url, Map&lt;String, String> additionalHttpHeaders)<br/>
Added in API level 8<br/>
Loads the given URL with the specified additional HTTP headers.<br/>
Parameters<br/>
url the URL of the resource to load<br/>
additionalHttpHeaders   the additional headers to be used in the HTTP request for this URL, specified as a map from name to value. Note that if this map contains any of the headers that are set by default by this WebView, such as those controlling caching, accept types or the User-Agent, their values may be overriden by this WebView&rsquo;s defaults.</p></blockquote>

<p>以下是一个简单的demo，来展示以下如何使用。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLoadURLWithHTTPHeaders</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://droidyue.com&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="n">WebView</span> <span class="n">webView</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebView</span><span class="o">(</span><span class="n">getActivity</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">extraHeaders</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="n">extraHeaders</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;Referer&quot;</span><span class="o">,</span> <span class="s">&quot;http://www.google.com&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">webView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">extraHeaders</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>同样上面也可以应用到UserAgent等其他HTTP头信息<br/>
<a href="http://droidyue.com/blog/2014/05/27/load-url-with-extra-http-headers-using-webview-in-android/" target="_blank">英文版文章</a></p>

<h3>其他</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00LF7R8MA/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00LF7R8MA&linkCode=as2&tag=droidyue-23">高性能浏览器网络</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00LF7R8MA" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gmail查找存档的邮件]]></title>
    <link href="http://droidyue.com/blog/2014/07/10/search-archived-mails-in-gmail/"/>
    <updated>2014-07-10T20:56:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/10/search-archived-mails-in-gmail</id>
    <content type="html"><![CDATA[<h2>什么是已归档邮件</h2>

<p>邮件归档后将从您的收件箱中删除，但是仍保留在您的账户中，便于之后查找。归档操作就像将邮件放入档案柜中妥善保管一样，而不是将其丢入垃圾箱。</p>

<!--more-->


<h2>如何查找已归档邮件</h2>

<p>输入如下,进行搜索即可.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>has:nouserlabels -in:Sent -in:Chat -in:Draft -in:Inbox
</span></code></pre></td></tr></table></div></figure>


<h2>语法解释</h2>

<ul>
<li>has:nouserlabels 搜索尚未应用您所创建标签的邮件</li>
<li>-（连字符）用于排除不包含您的搜索字词的邮件</li>
</ul>


<h2>参考</h2>

<ul>
<li><a href="https://support.google.com/mail/answer/6576?hl=zh-Hans">https://support.google.com/mail/answer/6576?hl=zh-Hans</a></li>
<li><a href="https://support.google.com/mail/answer/7190?hl=zh-Hans">https://support.google.com/mail/answer/7190?hl=zh-Hans</a></li>
</ul>


<h2>Others</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/0672338394/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=0672338394&linkCode=as2&tag=droidyue-23">Gmail in 10 Minutes, Sams Teach Yourself</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=0672338394" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac终端新标签打开当前目录]]></title>
    <link href="http://droidyue.com/blog/2014/07/10/set-working-directory-as-the-current-one-in-terminal-on-mac/"/>
    <updated>2014-07-10T19:02:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/10/set-working-directory-as-the-current-one-in-terminal-on-mac</id>
    <content type="html"><![CDATA[<p>Mac中终端每次打开一个标签都是一个固定的路径,这点对于从Linux发行版过来的用户来说,简直是很不爽,那么如何实现像Linux发行版一样,新标签的打开路径和启动它的标签路径一直呢?</p>

<p>以下几种方法仅供参考.分别是设置shell脚本, 修改Terminal设置,和修改iTerm设置.</p>

<!--more-->


<h2>最Geek</h2>

<p>创建文件/usr/local/bin/nt (需要Root权限),内容为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>osascript -e <span class="s1">&#39;tell application &quot;Terminal&quot;&#39;</span> <span class="se">\</span>
</span><span class='line'>-e <span class="s1">&#39;tell application &quot;System Events&quot; to tell process &quot;Terminal&quot; to keystroke &quot;t&quot; using command down&#39;</span> <span class="se">\</span>
</span><span class='line'>-e <span class="s2">&quot;do script with command \&quot;cd `pwd`;clear\&quot; in selected tab of the front window&quot;</span> <span class="se">\</span>
</span><span class='line'>-e <span class="s1">&#39;end tell&#39;</span> &amp;&gt; /dev/null
</span></code></pre></td></tr></table></div></figure>


<p>赋予可执行权限</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo chmod a+x /usr/local/bin/nt
</span></code></pre></td></tr></table></div></figure>


<p>如不生效,重启终端程序.</p>

<h2>修改Terminal设置</h2>

<p>选择Preferences&mdash;Startup&mdash;New tabs open with 或者如下图.
<img src="http://droidyueimg.qiniudn.com/system_terminal_working_path.png" title="Mac Set Terminal Wroking Directory" ></p>

<h2>修改iTerm设置</h2>

<p>选择Preferences&mdash;Profile&mdash;General&mdash;Working Directory 或者如下图
<img src="http://droidyueimg.qiniudn.com/iterm_set_working_path.png" title="Mac iTerm Set Working Directory" ></p>

<h2>Others</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B004BR2OW0/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B004BR2OW0&linkCode=as2&tag=droidyue-23">开始Mac:实战手册</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B004BR2OW0" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[WebView重写onJsAlert那些事]]></title>
    <link href="http://droidyue.com/blog/2014/07/09/override-javascript-alert-in-android/"/>
    <updated>2014-07-09T21:35:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/09/override-javascript-alert-in-android</id>
    <content type="html"><![CDATA[<p>本文主要将如何重写onJsAlert,让烦人的对话框变为无干扰的Toast,以及为什么onJsAlert只调用一次的问题.</p>

<h3>什么是Javascript Alert</h3>

<p>Alert是一种提示信息或者警告信息的对话框,一旦显示到用户面前,只能点击OK才能关闭.</p>

<!--more-->


<p>通常一般的实现类似</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>    <span class="nt">&lt;SCRIPT </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;This is alert dialog !&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="nt">&lt;/SCRIPT&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>对应的效果图:</p>

<p><img src="http://droidyueimg.qiniudn.com/js_alert.png" title="javascript alert dialog" ></p>

<h3>onJsAlert API 介绍</h3>

<blockquote><p>public boolean onJsAlert (WebView view, String url, String message, JsResult result)<br/>
Added in API level 1<br/>
Tell the client to display a javascript alert dialog. If the client returns true, WebView will assume that the client will handle the dialog. If the client returns false, it will continue execution.<br/>
Parameters<br/>
view    The WebView that initiated the callback.<br/>
url The url of the page requesting the dialog.<br/>
message Message to be displayed in the window.<br/>
result  A JsResult to confirm that the user hit enter.<br/>
Returns<br/>
boolean Whether the client will handle the alert dialog.</p></blockquote>

<h3>重写为Toast展示</h3>

<p>其实Alert,只是提示信息,而且这个提示信息还是阻塞其他操作的,为什么我们不适用一个长时间显示的Toast呢?</p>

<p>下面示范一下如何换成Toast.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">onJsAlert</span><span class="o">(</span><span class="n">WebView</span> <span class="n">view</span><span class="o">,</span> <span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">,</span> <span class="n">JsResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;onJsAlert url=&quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">&quot;;message=&quot;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">(),</span> <span class="n">message</span><span class="o">,</span> <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>    <span class="n">result</span><span class="o">.</span><span class="na">confirm</span><span class="o">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>为什么onJsAlert只调用了一次</h3>

<p>如果你没有参考上述部分或者没有留意,有时候你会发现onJsAlert只调用了一次,为什么呢,实际上,你可能忽略了一句调用.就是处理JsResult.</p>

<blockquote><p>public final void cancel ()
Added in API level 1
Handle the result if the user cancelled the dialog.</p>

<p>public final void confirm ()
Added in API level 1
Handle a confirmation response from the user.</p></blockquote>

<p>你需要调用result.confirm()或者result.cancel()来处理jsResult,否则会出问题.</p>

<h3>demo下载</h3>

<ul>
<li><a href="http://pan.baidu.com/s/14bjMA">http://pan.baidu.com/s/14bjMA</a></li>
</ul>


<h3>延伸阅读:</h3>

<p><a href="http://www.w3schools.com/js/js_popup.asp">http://www.w3schools.com/js/js_popup.asp</a>
<a href="http://developer.android.com/reference/android/webkit/JsResult.html">http://developer.android.com/reference/android/webkit/JsResult.html</a></p>

<h3>推荐</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00FQEDTA8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00FQEDTA8&linkCode=as2&tag=droidyue-23">精彩绝伦的Android UI设计:响应式用户界面与设计模式</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00FQEDTA8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B0097CON2S/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B0097CON2S&linkCode=as2&tag=droidyue-23">JavaScript语言精粹</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B0097CON2S" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[实践整理：日语考试注意]]></title>
    <link href="http://droidyue.com/blog/2014/07/08/nihongo-test-attentions/"/>
    <updated>2014-07-08T21:21:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/08/nihongo-test-attentions</id>
    <content type="html"><![CDATA[<p>上周日刚刚参加了N4考试，之前一直对日语考试有很多疑惑，终于亲自参加了，种种问题明白了，这里整理一下，备解他人之惑。</p>

<!--more-->


<h2>考试时间安排</h2>

<ul>
<li>13：00可以进考场，具体地点可能不一样</li>
<li>13：15 左右宣布考场注意事项</li>
<li>13：30 ～ 14：00 文字词汇 第一场，考完收卷</li>
<li>14：05～15：05 文法读解 第二场，考完收卷</li>
<li>第二场结束，貌似可以去休息一下，允许去洗手间。</li>
<li>15：10~15:45 听解 第三场，考完收卷，考试全部结束，即可离场</li>
</ul>


<h2>试卷答题卡相关</h2>

<ul>
<li><font color="red">提问：听说听力答题卡正确的选项涂第一行，错误的涂第二行，是这样么</font></li>
<li><p><font color="blue"><strong>回答：本人亲测不是这样的，就只有一行，涂圆正确的选项即可</strong>。实际上随着日语能力改革（主要多出N5和调整难度）后，听力涂卡也更加回归人性化了。</font></p></li>
<li><p><font color="red">提问：试卷和答题卡都要写自己名字么</font></p></li>
<li><p><font color="blue">回答：试卷其实无所谓，建议写上，估计没有人会看，答题卡上面已经写好了你的名字，请检查是否正确。</font></p></li>
<li><p><font color="red">提问：试卷可以带出考场么</font></p></li>
<li><p><font color="blue">回答：不行，会被老师收回。</font></p></li>
<li><p><font color="red">提问：试卷如果写名字写汉字还是拼音</font></p></li>
<li><font color="blue">回答：都可以，这个不重要。毕竟试卷考完后几乎没人看你的。</font></li>
</ul>


<h2>携带物品相关</h2>

<ul>
<li><font color="red">提问：考试必备的物品都有哪些？</font></li>
<li><p><font color="blue">回答：准考证，身份证，铅笔(2B or HB)，橡皮， <strong>碳素笔什么的基本用不上</strong>。</font></p></li>
<li><p><font color="red">提问：桌子上允许放哪些东西</font></p></li>
<li><p><font color="blue">回答：以上的考试必备物品，还有手表。 <strong>其他都不允许，如水，文具盒等</strong></font></p></li>
<li><p><font color="red">提问：需要自己带手表么</font></p></li>
<li><font color="blue">回答：现场会有一个钟表，为了避免重复抬头看，允许自带。</font></li>
</ul>


<h2>其他</h2>

<ul>
<li>参加7月份考试，注意不要中暑</li>
<li>发了试卷，监考老师会提示不要打开试卷，希望同学们还是要遵守。</li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00B3PZ8Z8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00B3PZ8Z8&linkCode=as2&tag=droidyue-23">新日本语能力考试N1-N5文法详解</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00B3PZ8Z8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B0076TP7HE/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B0076TP7HE&linkCode=as2&tag=droidyue-23">新日本语能力考试N5、N4文字词汇(详解+练习)</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B0076TP7HE" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android支持RTL(从右向左)语言]]></title>
    <link href="http://droidyue.com/blog/2014/07/07/support-rtl-in-android/"/>
    <updated>2014-07-07T13:28:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/07/support-rtl-in-android</id>
    <content type="html"><![CDATA[<h2>RTL语言</h2>

<ul>
<li>RTL语言即Right-to-left(从右向左)的语言.其书写习惯为从右向左,朝左继续.</li>
<li>这里的RTL严格意义上指的是Right-to-left,top-to-bottom 从右向左,从上到下. 而汉语,日语以及朝鲜语中存在Top-to-bottom, right-to-left从上到下,从右向左的情况. 但是这些语言大多数使用从左向右的情况.</li>
<li>常见的RTL语言有阿拉伯语,希伯来语等.</li>
<li>LTR语言和RTL语言刚好相反,即我们常见的Left-to-right,Top-to-bottom,从左向右,从上到下,朝右继续.这种语言很常见, 代表语言为英语等.</li>
<li>双向文本( Bi-Directional Text),即RTL文本和LTR文本混合的情况.比较复杂.</li>
</ul>


<!--more-->


<h2>Android对RTL支持情况</h2>

<ul>
<li>Android 4.1 Jelly Bean,引入了有限的在TextView和EditText支持RTL和LTR混合的双向文本的支持.</li>
<li>从Android 4.2 开始,提供了全面的本地布局支持,允许镜像布局,可以同时支持RTL和LTR.</li>
</ul>


<h2>如何支持RTL</h2>

<h3>快速应用RTL镜像布局</h3>

<ul>
<li>在manifest中的Application元素加入<strong>android:supportsRtl=&ldquo;true&rdquo;</strong>这个属性.</li>
</ul>


<p>未加入android:supportsRtl=&ldquo;true&rdquo; 阿拉伯语(RTL)的示例.<br/>
<img src="http://droidyueimg.qiniudn.com/no_rtl_support_ar.png" width="240" height="400" title="layout without rtl support" ></p>

<p>加入该属性的英文(LTR)语言效果.<br/>
<img src="http://droidyueimg.qiniudn.com/rtl_support_en.png" width="240" height="400" title="rtl support english" ></p>

<p>加入该属性的阿拉伯语(RTL)语言效果.<br/>
<img src="http://droidyueimg.qiniudn.com/rtl_support_ar.png" width="240" height="400" title="rtl support arabic" ></p>

<ul>
<li>将所有的左右(left/right)布局属性替换成开始结束(start/end)属性.
如下述代码,使用paddingLeft</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;TextView</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/tvOne&quot;</span>
</span><span class='line'>      <span class="na">android:paddingLeft=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>      <span class="na">android:background=</span><span class="s">&quot;#ccefc8&quot;</span>
</span><span class='line'>      <span class="na">android:text=</span><span class="s">&quot;@string/share&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>阿拉伯语下的效果图为<br/>
<img src="http://droidyueimg.qiniudn.com/padding_left.png" title="paddingLeft Arabic" >
如上面所说,RTL语言是以右作为开始,所以paddingLeft明显不符合规则.
那我们使用paddingStart看一下.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;TextView</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/tvOne&quot;</span>
</span><span class='line'>      <span class="na">android:paddingStart=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>      <span class="na">android:background=</span><span class="s">&quot;#ccefc8&quot;</span>
</span><span class='line'>      <span class="na">android:text=</span><span class="s">&quot;@string/share&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上述代码在阿拉伯语下的效果图:<br/>
<img src="http://droidyueimg.qiniudn.com/padding_start.png" title="paddingStart Arabic" ></p>

<h2>高级处理</h2>

<ul>
<li>android:layoutDirection 设置组件的布局方向</li>
<li>android:textDirection   设置组件文字的方向</li>
<li>android:textAlignment   设置组件文字的对齐</li>
<li>getLayoutDirectionFromLocale() 获取指定Locale的方向</li>
<li>创建单独的资源文件夹,以&#8217;ldrtl&#8217;(layout direction right-to-left)为后缀.如layout_ldrtl</li>
<li>使用Hierarchy Viewer来查看View的start/end属性,layoutDirection,textDirection,textAlignment属性.</li>
</ul>


<h2>贴代码</h2>

<h3>manifest</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">package=</span><span class="s">&quot;com.example.rtldemo&quot;</span>
</span><span class='line'>    <span class="na">android:versionCode=</span><span class="s">&quot;1&quot;</span>
</span><span class='line'>    <span class="na">android:versionName=</span><span class="s">&quot;1.0&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;uses-sdk</span>
</span><span class='line'>        <span class="na">android:minSdkVersion=</span><span class="s">&quot;8&quot;</span>
</span><span class='line'>        <span class="na">android:targetSdkVersion=</span><span class="s">&quot;19&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;application</span>
</span><span class='line'>        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>        <span class="na">android:icon=</span><span class="s">&quot;@drawable/ic_launcher&quot;</span>
</span><span class='line'>        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
</span><span class='line'>        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span>
</span><span class='line'>        <span class="na">android:supportsRtl=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>         <span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">&quot;.MainActivity&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>              <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.action.MAIN&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>              <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.MULTIWINDOW_LAUNCHER&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/activity&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/application&gt;</span>
</span><span class='line'><span class="nt">&lt;/manifest&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>MainActivity.java</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">rtldemo</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.annotation.SuppressLint</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.text.TextUtils</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.util.Log</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.LayoutInflater</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.View</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.view.ViewGroup</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.BaseAdapter</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ImageView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.ListView</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LOGTAG</span> <span class="o">=</span> <span class="s">&quot;MainActivity&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@SuppressLint</span><span class="o">(</span><span class="s">&quot;NewApi&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="nd">@Override</span>
</span><span class='line'>  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>      <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main_layout</span><span class="o">);</span>
</span><span class='line'>      <span class="n">ListView</span> <span class="n">listView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ListView</span><span class="o">)</span><span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">lvOne</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="kt">int</span> <span class="n">layoutDirection</span> <span class="o">=</span> <span class="n">TextUtils</span><span class="o">.</span><span class="na">getLayoutDirectionFromLocale</span><span class="o">(</span><span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">());</span>
</span><span class='line'>      <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;onCreate layoutDirection=&quot;</span> <span class="o">+</span> <span class="n">layoutDirection</span><span class="o">);</span>
</span><span class='line'>      <span class="n">TestAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestAdapter</span><span class="o">();</span>
</span><span class='line'>      <span class="n">adapter</span><span class="o">.</span><span class="na">mData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">share</span><span class="o">));</span>
</span><span class='line'>      <span class="n">adapter</span><span class="o">.</span><span class="na">mData</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">share</span><span class="o">));</span>
</span><span class='line'>      <span class="n">listView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</span><span class='line'>      
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="kd">class</span> <span class="nc">TestAdapter</span> <span class="kd">extends</span> <span class="n">BaseAdapter</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">mData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCount</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">mData</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="n">String</span> <span class="nf">getItem</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">mData</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getItemId</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">position</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nd">@Override</span>
</span><span class='line'>      <span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">View</span> <span class="n">view</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>          <span class="n">view</span> <span class="o">=</span> <span class="n">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">getApplicationContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">listview_item</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class='line'>          <span class="n">ImageView</span> <span class="n">imgView</span> <span class="o">=</span> <span class="o">(</span><span class="n">ImageView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">itemImageView</span><span class="o">);</span>
</span><span class='line'>          <span class="n">imgView</span><span class="o">.</span><span class="na">setImageResource</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">);</span>
</span><span class='line'>          <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span><span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">itemTextView</span><span class="o">);</span>
</span><span class='line'>          <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">mData</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">position</span><span class="o">));</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">view</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>main_layout.xml</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;Button</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/btnOne&quot;</span>
</span><span class='line'>        <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>        <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>        <span class="na">android:text=</span><span class="s">&quot;@string/share&quot;</span>
</span><span class='line'>        <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nt">&lt;TextView</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/tvOne&quot;</span>
</span><span class='line'>      <span class="na">android:paddingStart=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>      <span class="na">android:background=</span><span class="s">&quot;#ccefc8&quot;</span>
</span><span class='line'>      <span class="na">android:text=</span><span class="s">&quot;@string/share&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nt">&lt;EditText</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/etOne&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nt">&lt;LinearLayout</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span>
</span><span class='line'>      <span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;CheckBox</span>
</span><span class='line'>          <span class="na">android:layout_width=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>          <span class="na">android:layout_height=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>          <span class="nt">/&gt;</span>
</span><span class='line'>      <span class="nt">&lt;TextView</span>
</span><span class='line'>          <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>          <span class="na">android:layout_height=</span><span class="s">&quot;100dp&quot;</span>
</span><span class='line'>          <span class="na">android:text=</span><span class="s">&quot;@string/share&quot;</span>
</span><span class='line'>          <span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/LinearLayout&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nt">&lt;ListView</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/lvOne&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nt">&gt;&lt;/ListView&gt;</span>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/LinearLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>listview_item.xml</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;ImageView</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/itemImageView&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="nt">&lt;TextView</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/itemTextView&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/LinearLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Demo下载</h2>

<ul>
<li><a href="http://pan.baidu.com/s/1eQvL0MA">http://pan.baidu.com/s/1eQvL0MA</a></li>
</ul>


<h2>延伸阅读</h2>

<ul>
<li><a href="http://android-developers.blogspot.hk/2013/03/native-rtl-support-in-android-42.html">http://android-developers.blogspot.hk/2013/03/native-rtl-support-in-android-42.html</a></li>
<li>RTL语言:<a href="http://en.wikipedia.org/wiki/Right-to-left">http://en.wikipedia.org/wiki/Right-to-left</a></li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00FQEDTA8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00FQEDTA8&linkCode=as2&tag=droidyue-23">精彩绝伦的Android UI设计:响应式用户界面与设计模式</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00FQEDTA8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00B1OC4AI/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00B1OC4AI&linkCode=as2&tag=droidyue-23">深入剖析Android系统</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00B1OC4AI" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2014年下半年个人计划]]></title>
    <link href="http://droidyue.com/blog/2014/07/06/my-plan-for-the-left-half-of-2014/"/>
    <updated>2014-07-06T19:52:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/06/my-plan-for-the-left-half-of-2014</id>
    <content type="html"><![CDATA[<p>今天日语考完了，小小的战役结束了，又要开始新的征途了，简短地列举一下下半年的一些企划，希望自己可以出色地完成。</p>

<!--more-->


<h3>编程</h3>

<ul>
<li>开始接触Ruby。</li>
<li>重读Thinking In Java English Edition</li>
<li>整理出一套（Java）编程规范。</li>
<li>写几个小程序</li>
<li>使用Ruby或Python完成一个gitlab的hook handling application</li>
</ul>


<h3>网站</h3>

<ul>
<li>争取九月份的PageRank更新为0，十二月份的更新能更新为1</li>
<li>日均IP过百。</li>
<li>国内备案再纠结一下。</li>
</ul>


<h3>日语</h3>

<ul>
<li>来年7月份N3备战，侧重语法部分。</li>
<li>提高口语和听力，为明年去日本旅游做好充分准备。</li>
</ul>


<h3>健身</h3>

<ul>
<li>入手体感游戏机</li>
<li>等待Jawbone出带手表功能的运动手环</li>
<li>赶走轻度脂肪肝</li>
</ul>


<h3>其他</h3>

<ul>
<li>英语恢复到高中水平</li>
<li>多和小伙伴们出去玩耍</li>
</ul>


<h3>推荐</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00FXONTU6/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00FXONTU6&linkCode=as2&tag=droidyue-23">从你的全世界路过:让所有人心动的故事</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00FXONTU6" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B0052CDWJC/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B0052CDWJC&linkCode=as2&tag=droidyue-23">人生不设限</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B0052CDWJC" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[日语N4错题整理]]></title>
    <link href="http://droidyue.com/blog/2014/07/05/nihongo-n4-test-summary/"/>
    <updated>2014-07-05T20:59:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/05/nihongo-n4-test-summary</id>
    <content type="html"><![CDATA[<p>明天就要日语考试了，连续做了5套模拟试题，笔试部分的正确率大概为80%左右。这里整理一下重点有代表性的错题。一是加深印象，而是希望能帮助其他同样参加考试的同学们。
<strong>汉字对应假名部分只列出正确答案，其他问题正确的部分使用红色字体表示出来</strong></p>

<!--more-->


<h3>1.ははは　<u>台所</u>で　料理を　作って　います。</h3>

<ul>
<li><font color="red">だいどころ</font></li>
</ul>


<h3>2.うちの　まんなかに　自動車が　<u>とめて</u>　あります。</h3>

<ul>
<li><font color="red">泊めて</font> <a href="http://kotobank.jp/word/%E6%B3%8A%E3%82%81%E3%82%8B">http://kotobank.jp/word/%E6%B3%8A%E3%82%81%E3%82%8B</a></li>
<li>止めて <a href="http://kotobank.jp/word/%E6%AD%A2%E3%82%81%E3%82%8B">http://kotobank.jp/word/%E6%AD%A2%E3%82%81%E3%82%8B</a></li>
<li>留めて</li>
<li>亭めて</li>
</ul>


<h3>3.<u>こどもは　がっこうで　せんせいに　しかられました。</u></h3>

<ul>
<li>こどもは　がっこうで　せんせいに　そだてられました。受到养育</li>
<li><font color="red">こどもは　がっこうで　せんせいに　おこられました。</font>受到斥责</li>
<li>こどもは　がっこうで　せんせいに　わらわれました。受到嘲笑</li>
<li>こどもは　がっこうで　せんせいに　ほめられました。受到夸奖
句子的是孩子在学校收到老师骂。</li>
</ul>


<h3>4.林さんは　もう　ちこくを　しないと　言った（）、また　ちこくを　した。</h3>

<ul>
<li>でも 表示逆接，意思是 即使。。。，但是。。。</li>
<li>から 表示主观理由</li>
<li><font color="red">のに</font> 表示转折，却。。。</li>
<li>ので 表示客观理由</li>
</ul>


<h3>5.A【なにを　飲みますか】　B [わたしは　ジュース（）　します]。</h3>

<ul>
<li>で 方式方法，单位，动作发生场所</li>
<li>が 提示主语</li>
<li>を 动作作用对象，经过场所，动作的起点，出发点</li>
<li><font color="red">に</font> 动作，作用涉及到的对象</li>
</ul>


<h3>6.明日の　朝は　早いので、今晩は　早く　（）　と思います。</h3>

<ul>
<li>寝ろう 命令形</li>
<li>寝る   基本形</li>
<li>寝て</li>
<li><font color="red">寝よう</font> 表示主观意念</li>
</ul>


<h3>7.料理を　作ったとき、いつも　<u>主人</u>に　あじを　みて　もらいます。</h3>

<ul>
<li><font color="red">しゅじん</font></li>
</ul>


<h3>8.寒くて　手や　足が　<u>氷</u>のように　つめたく　なりました。</h3>

<ul>
<li><font color="red">こおり</font></li>
</ul>


<h3>9.とても　いそがし（）、あまり　寝る　時間が　ありません。</h3>

<ul>
<li>いで　语法错误</li>
<li>ので  表示客观原因 前面接い形容词简体形</li>
<li><font color="red">くて</font> い形形容词て形表并列或递进</li>
<li>から 表示主观原因 前接小句简体形</li>
</ul>


<h3>10.これから　わたしたちの　生活は　もっと　便利に　（）。</h3>

<ul>
<li>なっている</li>
<li>なった</li>
<li>なってきた</li>
<li><font color="red">なりそうだ</font> 动词ます形主体加そうだ表示好像似乎的意思，是根据自己所见所闻作出的判断。</li>
</ul>


<h3>11.きょうは　月曜日でから、あの図書館は（）のはずだ。</h3>

<ul>
<li>やすむ</li>
<li><font color="red">やすみ</font></li>
<li>やすんだ</li>
<li>やすまない
名词+の/い形容词简体形/な形容词简体＋な/动词简体形 + はず，やすみ为名词。</li>
</ul>


<h3>12.すみません、ちょっと　てつだって　（）　ませんか。</h3>

<ul>
<li>いただき</li>
<li>いたっだいて</li>
<li>いたでけて</li>
<li><font color="red">いただけ</font> 为可能形。<a href="http://bulo.hujiang.com/question/13970/">http://bulo.hujiang.com/question/13970/</a></li>
</ul>


<h3>13.ここに　おいた　はずなのですが、さいふが　（）。</h3>

<ul>
<li>おちていません　没丢</li>
<li>みつけません    没发现 他动词</li>
<li>おとしません    没掉</li>
<li><font color="red">みつかりません</font>  没找到，找不到了</li>
</ul>


<h3>14.新しい　うちを　買う（）　せつやくをしています。</h3>

<ul>
<li>ように  将某种状态作为目标，前面要用非意志动词</li>
<li><font color="red">ために</font></li>
<li>ことに</li>
<li>ためから</li>
</ul>


<h3>15.レポートを　書く（）　三日　かかりましたよ。</h3>

<ul>
<li>のは</li>
<li>ので</li>
<li><font color="red">のに</font> 这里的のに不是转折的意思，重点用了に的表示动作，作用涉及的对象的意思。</li>
<li>のを</li>
</ul>


<h3>16.きのう、友だちに　嫌いな　お酒を（）、きょうは　頭が　痛いです。</h3>

<ul>
<li>飲まれて</li>
<li><font color="red">飲まされて</font></li>
<li>飲ませて</li>
<li>飲まさせて
参考文章：<a href="http://www.italki.com/question/155473">http://www.italki.com/question/155473</a></li>
</ul>


<h3>17.道が　分からなかったので、<u>住所</u>と　ちずを　見ながら　大使館へ　行きました。</h3>

<ul>
<li><font color="red">じゅうしょ</font></li>
</ul>


<h3>18.昼から　はじめたのに、<u>夕方</u>に　なっても　仕事は　終わりませんでした。</h3>

<ul>
<li><font color="red">ゆうがた</font></li>
</ul>


<h3>19.この　スカートは　色も　デザインも　いい。（）値段も　安い。</h3>

<ul>
<li>そして</li>
<li><font color="red">それに</font></li>
<li>それで</li>
<li>それが
参考文章:<a href="http://yakyuboy.pixnet.net/blog/post/6588690-%E3%81%9D%E3%82%8C%E3%81%AB%E3%80%81%E3%81%9D%E3%81%97%E3%81%A6%E3%80%81%E3%81%9D%E3%82%8C%E3%81%8B%E3%82%89%E3%80%81%E3%81%9D%E3%82%8C%E3%81%A7">http://yakyuboy.pixnet.net/blog/post/6588690-%E3%81%9D%E3%82%8C%E3%81%AB%E3%80%81%E3%81%9D%E3%81%97%E3%81%A6%E3%80%81%E3%81%9D%E3%82%8C%E3%81%8B%E3%82%89%E3%80%81%E3%81%9D%E3%82%8C%E3%81%A7</a></li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B008AGPWKO/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B008AGPWKO&linkCode=as2&tag=droidyue-23">新日本语能力测试50天逐级突破N5、N4、N3:阅读天天做</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B008AGPWKO" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B0036CWCEG/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B0036CWCEG&linkCode=as2&tag=droidyue-23">新日本语能力考试N4语法解说篇</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B0036CWCEG" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[为Android程序申请权限注意]]></title>
    <link href="http://droidyue.com/blog/2014/07/04/attentions-when-adding-permission-for-android-application/"/>
    <updated>2014-07-04T14:54:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/04/attentions-when-adding-permission-for-android-application</id>
    <content type="html"><![CDATA[<p>Android系统提供为程序提供了权限申请,即在manifest中使用<strong>uses-permission</strong>来申请即可.实现起来非常简单,但是有些问题会随之浮出水面. 常见的现象是,有时候新加一个权限,(在Google Play上)程序显示的支持的设备会减少.</p>

<!--more-->


<h2>为什么权限越多,支持设备越少</h2>

<p>因为有些权限隐式地需要feature,即当你显示使用<strong>uses-permission</strong>,会默认地为程序加入<strong>uses-feature</strong>.     <br/>
而Android以及Google Play判断是否可以安装和现实的依据是,设备包含的system features是否完全包含程序申请的全部features.    <strong>只有在全部满足了程序需要的feature的设备上才可以展示并安装</strong>.</p>

<h2>如何查看程序使用了哪些features</h2>

<p>使用<strong>aapt dump badging your_apk_file_path</strong>,具体可以参考<a href="http://droidyue.com/blog/2013/12/03/get-an-application-required-features/">获取程序需要的features</a></p>

<h2>如何查看设备具有的features</h2>

<p>Android提供了该API,具体参考<a href="http://droidyue.com/blog/2013/12/03/get-android-system-available-features/">获取系统支持的features</a></p>

<h2>举个例子</h2>

<p>我们在程序manifest加入一行申请摄像头的权限.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.CAMERA&quot;</span> <span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后查看程序加入的feature</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>14:29 <span class="nv">$ </span>aapt dump badging PermissionDemo.apk | grep uses-feature
</span></code></pre></td></tr></table></div></figure>


<p>我们就会发现,这两个权限是新加的</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>uses-feature:<span class="s1">&#39;android.hardware.camera&#39;</span>
</span><span class='line'>uses-feature:<span class="s1">&#39;android.hardware.camera.autofocus&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>解决问题:如何加权限,不减少支持设备</h2>

<p>如果你增加的权限并且及引入的feature不是必须使用的,可以显示地将该feature设置为不需要.继续上面的例子.在manifest中加入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera.autofocus&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>重新生成程序.再次查看需要的权限.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>14:29 <span class="nv">$ </span>aapt dump badging PermissionDemo.apk | grep uses-feature
</span><span class='line'>uses-feature-not-required:<span class="s1">&#39;android.hardware.camera.autofocus&#39;</span>
</span><span class='line'>uses-feature-not-required:<span class="s1">&#39;android.hardware.camera&#39;</span>
</span><span class='line'>uses-feature:<span class="s1">&#39;android.hardware.touchscreen&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>就这样,可以做到增加权限,同时保证支持设备不减少.</p>

<h2>Show Me The Code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">package=</span><span class="s">&quot;com.droidyue.demo.permission&quot;</span>
</span><span class='line'>    <span class="na">android:versionCode=</span><span class="s">&quot;1&quot;</span>
</span><span class='line'>    <span class="na">android:versionName=</span><span class="s">&quot;1.0&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">&quot;android.permission.CAMERA&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera.autofocus&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>  <span class="nt">&lt;uses-feature</span> <span class="na">android:name=</span><span class="s">&quot;android.hardware.camera&quot;</span> <span class="na">android:required=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;uses-sdk</span>
</span><span class='line'>        <span class="na">android:minSdkVersion=</span><span class="s">&quot;8&quot;</span>
</span><span class='line'>        <span class="na">android:targetSdkVersion=</span><span class="s">&quot;19&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;application</span>
</span><span class='line'>        <span class="na">android:allowBackup=</span><span class="s">&quot;true&quot;</span>
</span><span class='line'>        <span class="na">android:icon=</span><span class="s">&quot;@drawable/ic_launcher&quot;</span>
</span><span class='line'>        <span class="na">android:label=</span><span class="s">&quot;@string/app_name&quot;</span>
</span><span class='line'>        <span class="na">android:theme=</span><span class="s">&quot;@style/AppTheme&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/application&gt;</span>
</span><span class='line'><span class="nt">&lt;/manifest&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>延伸阅读</h2>

<ul>
<li><a href="http://developer.android.com/guide/topics/manifest/uses-feature-element.html#permissions">http://developer.android.com/guide/topics/manifest/uses-feature-element.html#permissions</a></li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00CE1JQO4/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00CE1JQO4&linkCode=as2&tag=droidyue-23">Android 4高级编程</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00CE1JQO4" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00J4DXWDG/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00J4DXWDG&linkCode=as2&tag=droidyue-23">Android编程权威指南</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00J4DXWDG" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gitlab开启Commit中comments通知]]></title>
    <link href="http://droidyue.com/blog/2014/07/03/receive-notifications-when-comments-for-commits-are-created-in-gitlab/"/>
    <updated>2014-07-03T20:58:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/03/receive-notifications-when-comments-for-commits-are-created-in-gitlab</id>
    <content type="html"><![CDATA[<p>团队中使用Gitlab来管理代码,带来了很大的效率提高.于是就这样边使用边摸索着了解gitlab的功能.今天解决了一个关于通知的问题.
在gitlab中很常见的一个功能就是对代码增加评论,如下图所示.</p>

<!--more-->


<p><img src="http://droidyueimg.qiniudn.com/add_commit_comments.png">
那么,我增加了评论对方为什么收不到呢? 如果不支持对方收到,那么评论这样的代码审核还有什么太大的效率呢? 实际上对方是能否收到的,只是需要设置一下对方接受通知的级别.</p>

<h3>如下修改</h3>

<p>让对方(建议是项目的全体开发)登陆,然后选择个人资料
<img src="http://droidyueimg.qiniudn.com/login_user_profile.png">
选择Notification项目,设置Notification Level为Watch.
<img src="http://droidyueimg.qiniudn.com/set_notify_level_global.png">
以上即可搞定.然后有修改后就能收到邮件通知了。</p>

<p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;实现和完美的分割线&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>

<h3>单独设置组的Notification Level</h3>

<p><img src="http://droidyueimg.qiniudn.com/set_notify_level_group.png"></p>

<h3>单独设置工程的Notification Level</h3>

<p><img src="http://droidyueimg.qiniudn.com/set_notify_level_group.png"></p>

<h2>延伸链接</h2>

<ul>
<li><a href="https://about.gitlab.com/">https://about.gitlab.com/</a></li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00DSZVXH8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00DSZVXH8&linkCode=as2&tag=droidyue-23">Git版本控制</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00DSZVXH8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[curl发送POST请求]]></title>
    <link href="http://droidyue.com/blog/2014/07/02/send-post-request-using-curl/"/>
    <updated>2014-07-02T20:35:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/02/send-post-request-using-curl</id>
    <content type="html"><![CDATA[<p>curl发送POST请求
今天写Gitlab的一个merge request hook,使用curl来简化测试请求.简单备忘一下,如何使用curl发送POST请求.以下为使用curl发送一个携带json数据的POST请求.</p>

<!--more-->


<h3>命令介绍</h3>

<blockquote><p>-H, &mdash;header LINE   Custom header to pass to server (H)<br/>
-d, &mdash;data DATA     HTTP POST data (H)</p></blockquote>

<h3>示例命令</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>curl -H "Content-Type: application/json" -d '{"object_kind":"merge_request","object_attributes":{"id":22,"target_branch":"master","source_branch":"master","source_project_id":57,"author_id":9,"assignee_id":null,"title":"Master Title","created_at":"2014-07-02T02:31:20.000Z","updated_at":"2014-07-02T02:36:33.008Z","milestone_id":null,"state":"closed","merge_status":"unchecked","target_project_id":55,"iid":7,"description":"description_content"}}' http://10.0.6.122:9002/merge_request</span></code></pre></td></tr></table></div></figure>


<h3>推荐</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B002A2LQR2/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B002A2LQR2&linkCode=as2&tag=droidyue-23">Shell脚本学习指南</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B002A2LQR2" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[EditText和AutoCompleteTextView设置文字选中颜色]]></title>
    <link href="http://droidyue.com/blog/2014/07/01/set-selection-color-of-textviews/"/>
    <updated>2014-07-01T20:58:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/07/01/set-selection-color-of-textviews</id>
    <content type="html"><![CDATA[<p>EditText和AutoCompleteTextView设置文字选中颜色
大多数Android Rom上,文本选择的背景色都是很好看的鲜绿色, 但是在某些垃圾的三星手机上,居然是蓝色,令人恶心反感,其实完全可以通过程序来修改,文本的默认选中背景色.</p>

<!--more-->


<h3>所用API解释</h3>

<blockquote><p>android:textColorHighlight
Color of the text selection highlight.</p></blockquote>

<h3>EditText设置效果</h3>

<p><img src="http://droidyueimg.qiniudn.com/demo-edittext_selection_bg.png"></p>

<h3>AutoCompleteTextView 设置效果</h3>

<p><img src="http://droidyueimg.qiniudn.com/demo_autocompletetextview_selection_bg.png"></p>

<h3>实现代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>    <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;EditText</span>
</span><span class='line'>      <span class="na">android:id=</span><span class="s">&quot;@+id/et_inputBox&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>      <span class="na">android:textColorHighlight=</span><span class="s">&quot;#B4DF87&quot;</span>
</span><span class='line'>        <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;AutoCompleteTextView</span>
</span><span class='line'>        <span class="na">android:id=</span><span class="s">&quot;@+id/act_input&quot;</span>
</span><span class='line'>        <span class="na">android:layout_below=</span><span class="s">&quot;@id/et_inputBox&quot;</span>
</span><span class='line'>        <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
</span><span class='line'>      <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
</span><span class='line'>      <span class="na">android:textColorHighlight=</span><span class="s">&quot;#B4DF87&quot;</span>
</span><span class='line'>        <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/LinearLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>推荐</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00ELMXLOK/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00ELMXLOK&linkCode=as2&tag=droidyue-23">更优秀的APP:31个APP用户界面设计经典案例</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00ELMXLOK" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B007B78JUS/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B007B78JUS&linkCode=as2&tag=droidyue-23">Android创意实例详解</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B007B78JUS" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[在bash中检测进程是否正在运行]]></title>
    <link href="http://droidyue.com/blog/2014/06/29/check-running-process-in-bash/"/>
    <updated>2014-06-29T17:03:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/06/29/check-running-process-in-bash</id>
    <content type="html"><![CDATA[<p>这里简单介绍一个自己写的检测某个进程是否存在的bash小脚本。直接上代码。</p>

<!--more-->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="nv">ps_out</span><span class="o">=</span><span class="sb">`</span>ps -ef | grep <span class="nv">$1</span> | grep -v <span class="s1">&#39;grep&#39;</span> | grep -v <span class="nv">$0</span><span class="sb">`</span>
</span><span class='line'><span class="nv">result</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$ps_out</span> | grep <span class="s2">&quot;$1&quot;</span><span class="k">)</span>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;$result&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">]]</span>;<span class="k">then</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Running&quot;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'><span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;Not Running&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<h2>举例使用</h2>

<p>比如我们启动了一个这样的进程<code>python -m SimpleHTTPServer 8000</code>,我们想检测这个进程是否存在，可以这样。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>17:38:07-androidyue~/osc_git/shell_works <span class="o">(</span>master<span class="o">)</span><span class="nv">$ </span>./checkRunningProcess.sh <span class="s1">&#39;SimpleHTTPServer&#39;</span>
</span><span class='line'>Running
</span></code></pre></td></tr></table></div></figure>


<h2>些许说明</h2>

<ul>
<li>该脚本会自动去除<strong>包含目标信息的grep进程</strong>。以及<strong>当前这个正在执行的脚本</strong>。</li>
<li>使用保存文件后，确保具有可执行属性。</li>
</ul>


<h2>Read More</h2>

<ul>
<li><a href="http://stackoverflow.com/questions/2903354/bash-script-to-check-running-process/24140715#24140715">http://stackoverflow.com/questions/2903354/bash-script-to-check-running-process/24140715#24140715</a></li>
</ul>


<h2>推荐</h2>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B009O49G7Q/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B009O49G7Q&linkCode=as2&tag=droidyue-23">Shell脚本编程诀窍:适用于Linux、Bash等</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B009O49G7Q" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mac更改默认网络连接]]></title>
    <link href="http://droidyue.com/blog/2014/06/24/set-default-network-connection-on-mac/"/>
    <updated>2014-06-24T21:06:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/06/24/set-default-network-connection-on-mac</id>
    <content type="html"><![CDATA[<p>使用了新的VPN,可以连接通过,但是访问Google还是不很慢,简直就是不生效.后来,运维同事帮忙解决了一下,解决方法就是将vpn设置默认的网络连接.</p>

<!--more-->


<p>查看网络连接.直接的结果应该类似这样.
<img src="http://droidyueimg.qiniudn.com/connection_previous.png">
需要修改成这样的效果
<img src="http://droidyueimg.qiniudn.com/connection_after.png"></p>

<h3>How to do</h3>

<h4>打开网络连接,按如下选择.</h4>

<p><img src="http://droidyueimg.qiniudn.com/set_service_order.png"></p>

<h4>拖拽你想要设置为默认的网络连接到顶部</h4>

<p><img src="http://droidyueimg.qiniudn.com/drag_dest.png" title="" ></p>

<h3>Recommends</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00H1OF8ZA/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00H1OF8ZA&linkCode=as2&tag=droidyue-23">苹果Mac OS X 10.9 Mavericks高手真经</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00H1OF8ZA" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00A11060M/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00A11060M&linkCode=as2&tag=droidyue-23">Mac功夫:OSX的300多个技巧和小窍门</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00A11060M" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[处理Python未捕获异常]]></title>
    <link href="http://droidyue.com/blog/2014/06/23/python-handle-uncaught-exceptions/"/>
    <updated>2014-06-23T21:01:00+08:00</updated>
    <id>http://droidyue.com/blog/2014/06/23/python-handle-uncaught-exceptions</id>
    <content type="html"><![CDATA[<h3>Talk Is Cheap</h3>

<p>和Java一样,python也提供了对于checked exception和unchecked exception. 对于checked exception,我们通常使用<strong>try except</strong>可以显示解决,对于unchecked 异常,其实也是提供回调或者是钩子来帮助我们处理的,我们可以在钩子里面记录崩溃栈追踪或者发送崩溃数据. <br/>
下面代码可以实现python unchecked exception回调,并输出日志信息.</p>

<!--more-->


<h3>Show Me The Code</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'><span class="c"># coding=utf-8</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">logging</span>
</span><span class='line'><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
</span><span class='line'><span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span><span class='line'><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">handle_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">):</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="ne">KeyboardInterrupt</span><span class="p">):</span>
</span><span class='line'>        <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span>
</span><span class='line'>    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;Uncaught exception&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'><span class="n">sys</span><span class="o">.</span><span class="n">excepthook</span> <span class="o">=</span> <span class="n">handle_exception</span>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Test unhandled Exception&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>相关解释</h3>

<ul>
<li>上述忽略处理终端下键盘按Ctrl + C 终止异常.</li>
<li>上述使用python的日志管理模块输出格式化的异常信息.</li>
</ul>


<h3>参考文章</h3>

<p><a href="http://stackoverflow.com/questions/6234405/logging-uncaught-exceptions-in-python/16993115#16993115">http://stackoverflow.com/questions/6234405/logging-uncaught-exceptions-in-python/16993115#16993115</a></p>

<h3>Recommends</h3>

<ul>
<li><a href="http://www.amazon.cn/gp/product/B00EEDI2X6/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00EEDI2X6&linkCode=as2&tag=droidyue-23">像计算机科学家一样思考Python</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00EEDI2X6" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a href="http://www.amazon.cn/gp/product/B00KYFJTP8/ref=as_li_tf_tl?ie=UTF8&camp=536&creative=3200&creativeASIN=B00KYFJTP8&linkCode=as2&tag=droidyue-23">编写高质量代码:改善Python程序的91个建议</a><img src="http://ir-cn.amazon-adsystem.com/e/ir?t=droidyue-23&l=as2&o=28&a=B00KYFJTP8" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>

]]></content>
  </entry>
  
</feed>
