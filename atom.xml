<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[æŠ€æœ¯å°é»‘å±‹]]></title>
  <link href="https://droidyue.com/atom.xml" rel="self"/>
  <link href="https://droidyue.com/"/>
  <updated>2019-03-17T21:01:29+08:00</updated>
  <id>https://droidyue.com/</id>
  <author>
    <name><![CDATA[androidyue]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[èŠä¸€èŠSLAP:å•ä¸€æŠ½è±¡å±‚çº§åŸåˆ™]]></title>
    <link href="https://droidyue.com/blog/2019/03/17/slap-single-level-of-abstraction-principle/"/>
    <updated>2019-03-17T20:52:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/03/17/slap-single-level-of-abstraction-principle</id>
    <content type="html"><![CDATA[<p>ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬æ€»æ˜¯å’Œæ–¹æ³•æ‰“äº¤é“ï¼Œä¸çŸ¥ä¸è§‰éƒ½ä¼šæ¥è§¦Long method(æ–¹æ³•ä½“è¾ƒé•¿çš„æ–¹æ³•)ï¼Œä¸è®ºæ˜¯è‡ªå·±å†™çš„è¿˜æ˜¯ä»–äººå†™çš„ï¼Œè€ŒLong method(é•¿æ–¹æ³•)å¾€å¾€æ˜¯é—®é¢˜çš„ä½“ç°ï¼Œä»£è¡¨ç€ä»£ç æœ‰ä¸€ç§åçš„å‘³é“ï¼Œä¹Ÿæ„å‘³ç€éœ€è¦å¯¹è¿™æ®µä»£ç è¿›è¡Œé‡æ„å¤„ç†ã€‚</p>

<!--more-->


<p>é•¿æ–¹æ³•çš„é—®é¢˜é€šå¸¸è¡¨ç°åœ¨</p>

<ul>
<li>å¯è¯»æ€§å¾ˆå·®</li>
<li>å¤ç”¨æ€§å·®</li>
<li>éš¾ä»¥è°ƒè¯•</li>
<li>éš¾ä»¥ç»´æŠ¤</li>
<li>å†—ä½™ä»£ç å¤š</li>
</ul>


<p>æ—¢ç„¶é•¿æ–¹æ³•ä¸å¥½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å†™short method(çŸ­æ–¹æ³•)ï¼Œä½†æ˜¯ä»€ä¹ˆæ ·çš„æ–¹æ³•æ‰ç®—çŸ­æ–¹æ³•å‘¢ï¼Œæœ‰ä»€ä¹ˆè¡¡é‡å‘¢ï¼Ÿ</p>

<h2>è¡Œæ•°é™å®š</h2>

<p>é¦–å…ˆæˆ‘ä»¬æƒ³åˆ°çš„å¯èƒ½æ˜¯é™åˆ¶æ–¹æ³•çš„è¡Œæ•°ï¼Œæ˜¯çš„ï¼Œæœ‰äººè¯´æ˜¯20è¡Œä¸ºå®œï¼Œæœ‰äººè¯´æ˜¯10è¡Œæœ€ä½³ï¼Œä¼—è¯´çº·çº­ï¼Œæ— ä¸€å®šè®ºã€‚</p>

<p>ä½†æ˜¯è¡Œæ•°é™å®šä¹Ÿæœ‰é—®é¢˜</p>

<ul>
<li>æ²¡æœ‰å…·ä½“çš„è¡Œæ•°é™å®š</li>
<li>è¡Œæ•°é™å®šå¦‚æœæ‰§è¡Œï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ­»æ¿</li>
</ul>


<p>æ˜¾ç„¶é™¤äº†è¡Œæ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´åŠ æ˜ç¡®æ— äº‰è®®çš„é¿å…é•¿æ–¹æ³•äº§ç”Ÿçš„æ–¹æ³•ï¼Œæ¯”å¦‚ä»Šå¤©æˆ‘ä»¬æåˆ°çš„ SLAPï¼ˆå•ä¸€æŠ½è±¡å±‚åŸåˆ™ï¼‰ã€‚</p>

<h2>å®šä¹‰</h2>

<p>SLAP æ˜¯ Single Level of Abstraction çš„ç¼©å†™ã€‚</p>

<p>å…³äºSLAPçš„ä¸€äº›å…·ä½“è§£é‡Š</p>

<blockquote><p>æŒ‡å®šä»£ç å—çš„ä»£ç åº”è¯¥åœ¨å•ä¸€çš„æŠ½è±¡å±‚ä¸Šã€‚</p></blockquote>

<p>å…¶å®å…³äºå®šä¹‰æœ€éš¾ç†è§£çš„åº”è¯¥æ˜¯æŠ½è±¡å±‚ï¼Œå…¶åŸå› å¯èƒ½åœ¨äº</p>

<ul>
<li>æˆ‘ä»¬æ¥å—ç€å„ç§éé»‘å³ç™½ï¼Œéå–„æ—¢æ¶çš„æ•™è‚²å’Œç†é™¶</li>
<li>å¯¹äº‹ç‰©åšæŠ½è±¡åŒ–ï¼Œä¸æ˜¯ä¸€ä¸‹å­è¾¾åˆ°å¦ä¸€ä¸ªæç«¯çš„æŠ½è±¡æè¿°ã€‚</li>
<li>æŠ½è±¡å¯ä»¥æ˜¯å¾ªåºæ¸è¿›ï¼Œåˆ†å±‚çš„ã€‚</li>
</ul>


<p>ä¸¾ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œåœ¨ä¸­å­¦æ—¶æœŸæˆ‘ä»¬å­¦ä¹ è‹±è¯­ï¼Œå¤§æ¦‚å¬è¿‡ä¸€ä¸ªè¿™æ ·ç±»ä¼¼çš„çŸ­å¥&#8221;ç¾å°åœ†æ—§é»„æ³•å›½æœ¨ä¹¦æˆ¿&#8221;,è¿™æ˜¯ä¸ºäº†è¾…åŠ©åœ¨è‹±è¯­ä¸­å¿«é€Ÿæ’åˆ—å®šè¯­é¡ºåºçš„è®°å¿†æŠ€å·§æ€»ç»“ã€‚</p>

<p>åœ¨è‹±è¯­ï¼ˆæˆ–å…¶ä»–è¯­è¨€ï¼‰ä¸­</p>

<ul>
<li>å¯¹åè¯ä¸»ä½“å¢åŠ å®šè¯­(åè¯ï¼Œå½¢å®¹è¯)ä¿®é¥°ï¼Œä½¿å¾—ä¸»ä½“æ›´åŠ å…·ä½“</li>
<li>åä¹‹å¯¹ä¸»ä½“åˆ é™¤å®šè¯­ï¼ˆåè¯ï¼Œå½¢å®¹è¯ï¼‰ï¼Œä¼šä½¿å¾—ä¸»ä½“æ›´åŠ æŠ½è±¡</li>
</ul>


<p>æ¯”å¦‚æˆ‘ä»¬å¯¹â€œç¾å°åœ†æ—§é»„æ³•å›½æœ¨ä¹¦æˆ¿â€ é€æ­¥åˆ é™¤å®šè¯­ï¼Œå¤§è‡´ä¼šäº§ç”Ÿè¿™æ ·çš„æŠ½è±¡å±‚</p>

<ol>
<li> ç¾å°åœ†æ³•å›½æœ¨ä¹¦æˆ¿</li>
<li> æ—§é»„æ³•å›½æœ¨ä¹¦æˆ¿</li>
<li> æ³•å›½æœ¨ä¹¦æˆ¿</li>
<li> æ³•å›½ä¹¦æˆ¿</li>
<li> ä¹¦æˆ¿</li>
<li> æˆ¿</li>
</ol>


<p>æˆ‘ä»¬å›å½’ç¼–ç ï¼Œæ¥çœ‹ä¸€ä¸ªä¾‹å­</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">validateUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//æ£€æµ‹é‚®ç®±æ˜¯å¦åˆæ³•</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">ePattern</span> <span class="o">=</span> <span class="s">&quot;^[a-zA-Z0-9.!#$%&amp;&#39;*+/=?^_`{|}~-]+@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">regex</span><span class="o">.</span><span class="na">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">regex</span><span class="o">.</span><span class="na">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">ePattern</span><span class="o">);</span>
</span><span class='line'>    <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">regex</span><span class="o">.</span><span class="na">Matcher</span> <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">email</span><span class="o">);</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(!</span><span class="n">m</span><span class="o">.</span><span class="na">matches</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//æ£€æµ‹å¯†ç æ˜¯å¦åˆæ³•</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">password</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">:</span> <span class="n">user</span><span class="o">.</span><span class="na">password</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(!</span><span class="n">Character</span><span class="o">.</span><span class="na">isLetterOrDigit</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//return true if it goes here.</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç </p>

<ul>
<li>validateUser æ–¹æ³•ç”¨æ¥æ ¡éªŒç”¨æˆ·çš„åˆæ³•æ€§</li>
<li>æ–¹æ³•ä½“çš„å‰6è¡Œä»£ç åšçš„äº‹æƒ…æ˜¯æ ¡éªŒç”¨æˆ·çš„emailåœ°å€æ˜¯å¦åˆæ³•</li>
<li>æ–¹æ³•ä½“çš„åå‡ è¡Œçš„ä»£ç ï¼Œç”¨æ¥æ ¡éªŒç”¨æˆ·çš„å¯†ç æ˜¯å¦åˆæ³•</li>
</ul>


<p>ä¸Šé¢ä»£ç å­˜åœ¨çš„é—®é¢˜æ˜¯</p>

<ul>
<li>validateUser æ–¹æ³•ä¸­æš´éœ²äº†æ ¡éªŒemailå’Œå¯†ç çš„å…·ä½“å®ç°</li>
<li>validateUser åº”è¯¥åªå…³å¿ƒæ ¡éªŒemailå’Œå¯†ç çš„æŠ½è±¡ï¼ˆç¬¬ä¸€å±‚æŠ½è±¡ï¼‰ï¼Œè€Œä¸æ˜¯å…·ä½“å®ç°ï¼ˆç¬¬äºŒå±‚æŠ½è±¡ï¼‰</li>
<li>å¾ˆæ˜æ˜¾validateUser è¿èƒŒäº†SLAPåŸåˆ™</li>
</ul>


<p>è§£å†³æ–¹æ³•</p>

<ul>
<li>å°†è¿èƒŒSLAPåŸåˆ™çš„ä»£ç åšæå–ï¼Œå½¢æˆç‹¬ç«‹çš„æ–¹æ³•</li>
</ul>


<p>æ‰€ä»¥æŒ‰ç…§SLAPåŸåˆ™ä¿®æ”¹ä¹‹åçš„ä»£ç åº”è¯¥ç±»ä¼¼äº</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserValidator</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EMAIL_REGULAR_EXPRESSION</span> <span class="o">=</span> <span class="s">&quot;^[a-zA-Z0-9.!#$%&amp;&#39;*+/=?^_`{|}~-]+@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">validateEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Pattern</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="n">EMAIL_REGULAR_EXPRESSION</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">email</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">validatePassword</span><span class="o">(</span><span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">for</span> <span class="o">(</span><span class="kt">char</span> <span class="n">c</span> <span class="o">:</span> <span class="n">password</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(!</span><span class="n">Character</span><span class="o">.</span><span class="na">isLetterOrDigit</span><span class="o">(</span><span class="n">c</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">validateUserSLAP</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">UserValidator</span><span class="o">.</span><span class="na">validateEmail</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">email</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">UserValidator</span><span class="o">.</span><span class="na">validatePassword</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">password</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>å¸¸è§çš„è¿èƒŒSLAPçš„ä»£ç åœºæ™¯å’Œæƒ…å†µ</h2>

<h3>æ³¨é‡Šæˆ–ç©ºè¡Œåˆ†å‰²çš„æ–¹æ³•ä½“</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//æ³¨é‡Š1</span>
</span><span class='line'><span class="err">ä»£ç ç‰‡æ®µ</span><span class="mi">1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//æ³¨é‡Š2</span>
</span><span class='line'><span class="err">ä»£ç ç‰‡æ®µ</span><span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//æ³¨é‡Š3</span>
</span><span class='line'><span class="c1">//ä»£ç ç‰‡æ®µ3</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç </p>

<ul>
<li>æ³¨é‡Šæˆ–ç©ºè¡Œåˆ†å‰²çš„ä»£ç ç‰‡æ®µå¤„ç†ç›¸å¯¹ç‹¬ç«‹é€»è¾‘ï¼Œå¯ä»¥æŠ½è±¡æˆç‹¬ç«‹çš„æ–¹æ³•</li>
<li>ä¸Šé¢çš„ä»£ç å¦‚æœä¸å¤„ç†ï¼Œå¾€å¾€éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¼šä½¿å¾—æ‰€åœ¨çš„æ–¹æ³•è†¨èƒ€ï¼Œè¿›è€Œå½¢æˆä¸Šé¢çš„é•¿æ–¹æ³•</li>
</ul>


<h3>forå¾ªç¯ä½“å†…éƒ¨ä»£ç </h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResultDto</span><span class="o">&gt;</span> <span class="nf">buildResult</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ResultEntity</span><span class="o">&gt;</span> <span class="n">resultSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">ResultDto</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">ResultEntity</span> <span class="n">entity</span> <span class="o">:</span> <span class="n">resultSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">ResultDto</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultDto</span><span class="o">();</span>
</span><span class='line'>        <span class="n">dto</span><span class="o">.</span><span class="na">setShoeSize</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getShoeSize</span><span class="o">());</span>
</span><span class='line'>        <span class="n">dto</span><span class="o">.</span><span class="na">setNumberOfEarthWorms</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getNumberOfEarthWorms</span><span class="o">());</span>
</span><span class='line'>        <span class="n">dto</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">computeAge</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">()));</span>
</span><span class='line'>        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">dto</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢forå¾ªç¯ä½“å†…éƒ¨çš„ä»£ç ï¼Œå¤„ç†äº†å°†ResultEntityè½¬åŒ–æˆResultDtoï¼Œå¯ä»¥å®Œå…¨å•ç‹¬æŠ½ç¦»æˆå•ç‹¬çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤º</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ResultDto</span><span class="o">&gt;</span> <span class="nf">buildResult</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ResultEntity</span><span class="o">&gt;</span> <span class="n">resultSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">ResultDto</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">ResultEntity</span> <span class="n">entity</span> <span class="o">:</span> <span class="n">resultSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">result</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">toDto</span><span class="o">(</span><span class="n">entity</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="n">ResultDto</span> <span class="nf">toDto</span><span class="o">(</span><span class="n">ResultEntity</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ResultDto</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResultDto</span><span class="o">();</span>
</span><span class='line'>    <span class="n">dto</span><span class="o">.</span><span class="na">setShoeSize</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getShoeSize</span><span class="o">());</span>
</span><span class='line'>    <span class="n">dto</span><span class="o">.</span><span class="na">setNumberOfEarthWorms</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getNumberOfEarthWorms</span><span class="o">());</span>
</span><span class='line'>    <span class="n">dto</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">computeAge</span><span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getBirthday</span><span class="o">()));</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">dto</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>å›è°ƒ</h3>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œå›è°ƒæ–¹æ³•ä¹Ÿæ˜¯å®¹æ˜“å½¢æˆé•¿æ–¹æ³•çš„é‡ç¾åŒºï¼Œè¿™ä¸€ç‚¹æ— éœ€å†å¤šä¸¾ä¾‹ã€‚</p>

<h2>ç­”ç–‘</h2>

<h3>åº”ç”¨SLAP ä¼šå¯¼è‡´æ›´å¤šçš„çŸ­æ–¹æ³•ï¼Œç»´æŠ¤æˆæœ¬æ›´é«˜äº†å§</h3>

<p>é¦–å…ˆï¼Œå¿…é¡»æ‰¿è®¤ï¼ŒSLAPåº”ç”¨åï¼Œä¼šäº§ç”Ÿä¸€äº›çŸ­æ–¹æ³•ï¼Œä½†æ˜¯å…³äºç»´æŠ¤æˆæœ¬æå‡ï¼Œè¿™ä¸€ç‚¹è¿˜æ˜¯éœ€è¦è€ƒç©¶çš„ã€‚</p>

<p>å› ä¸º</p>

<ul>
<li>çŸ­æ–¹æ³•çš„æå–äº§ç”Ÿï¼Œä¼šä½¿å¾—æ–¹æ³•æ›´åŠ å…·æœ‰åŸå­æ€§ï¼ŒèŒè´£æ›´åŠ å•ä¸€ï¼Œæ›´åŠ çš„ç¬¦åˆUnixçš„å“²å­¦ Do one thing, and do it wellã€‚</li>
<li>çŸ­æ–¹æ³•çš„å¤ç”¨æ€§æ›´å¼ºï¼Œä½¿å¾—ç¼–ç æ›´åŠ ä¾¿æ·</li>
<li>çŸ­æ–¹æ³•å¯è¯»æ€§æ›´å¼ºï¼Œæ›´åŠ ä¾¿äºç†è§£</li>
<li>å®è·µè¡¨æ˜ï¼ŒSLAPåº”ç”¨åï¼Œç»´æŠ¤æˆæœ¬åº”è¯¥æ˜¯é™ä½çš„ã€‚</li>
</ul>


<p>æ‰€ä»¥ï¼Œä¸è¦ç•æƒ§ï¼ŒçŸ­æ–¹æ³•çš„äº§ç”Ÿï¼Œåº”è¯¥æ˜¯å–œæ¬¢ä¸ŠçŸ­æ–¹æ³•ã€‚</p>

<h3>SLAP çš„ç¼©å†™</h3>

<p>SLAPæ˜¯Single Level of Abstractionçš„ç¼©å†™ï¼Œä¸æ˜¯Same Level of Abstractionï¼ŒğŸ˜€</p>

<h2>References</h2>

<ul>
<li><a href="https://dzone.com/articles/slap-your-methods-and-dont-make-me-think">https://dzone.com/articles/slap-your-methods-and-dont-make-me-think</a></li>
<li><a href="http://principles-wiki.net/principles:single_level_of_abstraction">http://principles-wiki.net/principles:single_level_of_abstraction</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¤„ç†Retrofit MalformedJsonExceptionæŠ¥é”™]]></title>
    <link href="https://droidyue.com/blog/2019/03/10/retrofit-json-convetor-error/"/>
    <updated>2019-03-10T20:25:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/03/10/retrofit-json-convetor-error</id>
    <content type="html"><![CDATA[<p>ä½¿ç”¨Retrofité…åˆGsonConverterï¼Œæˆ‘ä»¬èƒ½å¾ˆå¥½åœ°å°†ç½‘ç»œå“åº”å†…å®¹è½¬æ¢æˆå¯¹åº”çš„å¯¹è±¡ã€‚æ¯”å¦‚åƒä¸‹é¢è¿™æ ·ã€‚</p>

<!--more-->


<p>Retrofitç½‘ç»œæ¥å£æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DroidNetwork</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/content/test.json&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">Call</span><span class="o">&lt;</span><span class="n">DroidResponse</span><span class="o">&gt;</span> <span class="nf">jsonData</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/content/helloworld.txt&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">Call</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">plainText</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯¹åº”çš„åº”ç”¨æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">val</span> <span class="n">retrofit</span> <span class="o">=</span> <span class="n">Retrofit</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span><span class='line'>            <span class="o">.</span><span class="na">baseUrl</span><span class="o">(</span><span class="s">&quot;https://asset.droidyue.com/&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">addConverterFactory</span><span class="o">(</span><span class="n">GsonConverterFactory</span><span class="o">.</span><span class="na">create</span><span class="o">())</span>
</span><span class='line'>            <span class="o">.</span><span class="na">build</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">val</span> <span class="n">droidNetwork</span> <span class="o">=</span> <span class="n">retrofit</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nl">DroidNetwork:</span><span class="o">:</span><span class="n">class</span><span class="o">.</span><span class="na">java</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">droidNetwork</span><span class="o">.</span><span class="na">jsonData</span><span class="o">().</span><span class="na">enqueue</span><span class="o">(</span><span class="n">object</span> <span class="o">:</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">DroidResponse</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">override</span> <span class="n">fun</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">DroidResponse</span><span class="o">&gt;?,</span> <span class="nl">t:</span> <span class="n">Throwable</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">t</span><span class="o">?.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">override</span> <span class="n">fun</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">DroidResponse</span><span class="o">&gt;?,</span> <span class="nl">response:</span> <span class="n">Response</span><span class="o">&lt;</span><span class="n">DroidResponse</span><span class="o">&gt;?)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">dumpMessage</span><span class="o">(</span><span class="s">&quot;onResponse content=${response?.body()}&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">})</span>
</span><span class='line'>
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„æ–¹æ³•æ‰§è¡Œéƒ½å¾ˆæ­£å¸¸ï¼Œå¯æ˜¯æ‰§è¡Œè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">droidNetwork</span><span class="o">.</span><span class="na">plainText</span><span class="o">().</span><span class="na">enqueue</span><span class="o">(</span><span class="n">object</span> <span class="o">:</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">override</span> <span class="n">fun</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;?,</span> <span class="nl">t:</span> <span class="n">Throwable</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Exception</span><span class="o">(</span><span class="s">&quot;causedByPlainText&quot;</span><span class="o">,</span> <span class="n">t</span><span class="o">)?.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">override</span> <span class="n">fun</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;?,</span> <span class="nl">response:</span> <span class="n">Response</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;?)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">dumpMessage</span><span class="o">(</span><span class="s">&quot;onResponse content=${response}&quot;</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>å´©æºƒçš„ä¿¡æ¯å¦‚ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Exception</span><span class="o">:</span> <span class="n">causedByPlainText</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">secoo</span><span class="o">.</span><span class="na">retrofitconvertor</span><span class="o">.</span><span class="na">MainActivity</span><span class="n">$doNetworkRequest$2</span><span class="o">.</span><span class="na">onFailure</span><span class="o">(</span><span class="n">MainActivity</span><span class="o">.</span><span class="na">kt</span><span class="o">:</span><span class="mi">41</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">retrofit2</span><span class="o">.</span><span class="na">ExecutorCallAdapterFactory</span><span class="n">$ExecutorCallbackCall$1$2</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">ExecutorCallAdapterFactory</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">80</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Handler</span><span class="o">.</span><span class="na">handleCallback</span><span class="o">(</span><span class="n">Handler</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">891</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Handler</span><span class="o">.</span><span class="na">dispatchMessage</span><span class="o">(</span><span class="n">Handler</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">102</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Looper</span><span class="o">.</span><span class="na">loop</span><span class="o">(</span><span class="n">Looper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">207</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">android</span><span class="o">.</span><span class="na">app</span><span class="o">.</span><span class="na">ActivityThread</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">ActivityThread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">7470</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">Native</span> <span class="n">Method</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">RuntimeInit</span><span class="n">$MethodAndArgsCaller</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">RuntimeInit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">524</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">ZygoteInit</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">ZygoteInit</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">958</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span> <span class="n">Caused</span> <span class="nl">by:</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">MalformedJsonException</span><span class="o">:</span> <span class="n">Use</span> <span class="n">JsonReader</span><span class="o">.</span><span class="na">setLenient</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="n">to</span> <span class="n">accept</span> <span class="n">malformed</span> <span class="n">JSON</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span> <span class="n">column</span> <span class="mi">1</span> <span class="n">path</span> <span class="n">$</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">JsonReader</span><span class="o">.</span><span class="na">syntaxError</span><span class="o">(</span><span class="n">JsonReader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1568</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">JsonReader</span><span class="o">.</span><span class="na">checkLenient</span><span class="o">(</span><span class="n">JsonReader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1409</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">JsonReader</span><span class="o">.</span><span class="na">doPeek</span><span class="o">(</span><span class="n">JsonReader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">593</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">stream</span><span class="o">.</span><span class="na">JsonReader</span><span class="o">.</span><span class="na">peek</span><span class="o">(</span><span class="n">JsonReader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">425</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">bind</span><span class="o">.</span><span class="na">TypeAdapters</span><span class="n">$16</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">TypeAdapters</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">393</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">bind</span><span class="o">.</span><span class="na">TypeAdapters</span><span class="n">$16</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">TypeAdapters</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">390</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">retrofit2</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">GsonResponseBodyConverter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">GsonResponseBodyConverter</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">39</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">retrofit2</span><span class="o">.</span><span class="na">converter</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">GsonResponseBodyConverter</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">GsonResponseBodyConverter</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">27</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">retrofit2</span><span class="o">.</span><span class="na">OkHttpCall</span><span class="o">.</span><span class="na">parseResponse</span><span class="o">(</span><span class="n">OkHttpCall</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">223</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">retrofit2</span><span class="o">.</span><span class="na">OkHttpCall</span><span class="n">$1</span><span class="o">.</span><span class="na">onResponse</span><span class="o">(</span><span class="n">OkHttpCall</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">121</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">okhttp3</span><span class="o">.</span><span class="na">RealCall</span><span class="n">$AsyncCall</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">RealCall</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">206</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">okhttp3</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">NamedRunnable</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">NamedRunnable</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">32</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">ThreadPoolExecutor</span><span class="o">.</span><span class="na">runWorker</span><span class="o">(</span><span class="n">ThreadPoolExecutor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">1167</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">ThreadPoolExecutor</span><span class="n">$Worker</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">ThreadPoolExecutor</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">641</span><span class="o">)</span>
</span><span class='line'> <span class="n">W</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">:</span>    <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">784</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>åŸå› å…¶å®å¾ˆç®€å•</p>

<ul>
<li> <a href="http://asset.droidyue.com/content/test.json">http://asset.droidyue.com/content/test.json</a> æ˜¯ä¸€ä¸ªåˆæ³•çš„jsonå†…å®¹</li>
<li> <a href="https://asset.droidyue.com/content/helloworld.txt">https://asset.droidyue.com/content/helloworld.txt</a> æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬ï¼Œå†…å®¹ä¸º<code>helloworld</code></li>
<li> å› ä¸ºä¸Šé¢çš„retrofit å¯¹è±¡ è®¾ç½®äº†GSONConvertorï¼Œä¼šå°è¯•é»˜è®¤å°†æ‰€æœ‰çš„å†…å®¹è½¬æˆå¯¹åº”çš„å¯¹è±¡å†…å®¹ï¼Œæ•…ä¸Šé¢çš„æ™®é€šæ–‡æœ¬å°±ä¼šå¤±è´¥æŠ¥é”™ã€‚</li>
</ul>


<p>è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ª</p>

<ul>
<li>ä¿®æ”¹æœåŠ¡å™¨ç«¯çš„<a href="https://asset.droidyue.com/content/helloworld.txt">https://asset.droidyue.com/content/helloworld.txt</a> ä¸ºJSONå†…å®¹</li>
<li>è°ƒæ•´å®¢æˆ·ç«¯ä»£ç æ”¯æŒã€‚</li>
</ul>


<p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»åè€…çš„å¤„ç†æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ResponseBodyè€Œä¸æ˜¯ä¹‹å‰çš„Stringï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹ä»£ç åº”ç”¨å³å¯ã€‚</p>

<p>æ¥å£ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/content/helloworld.txt&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">Call</span><span class="o">&lt;</span><span class="n">ResponseBody</span><span class="o">&gt;</span> <span class="nf">plainTextAsResponseBody</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>åº”ç”¨ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="n">droidNetwork</span><span class="o">.</span><span class="na">plainTextAsResponseBody</span><span class="o">().</span><span class="na">enqueue</span><span class="o">(</span><span class="n">object</span> <span class="o">:</span> <span class="n">Callback</span><span class="o">&lt;</span><span class="n">ResponseBody</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">override</span> <span class="n">fun</span> <span class="nf">onFailure</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">ResponseBody</span><span class="o">&gt;?,</span> <span class="nl">t:</span> <span class="n">Throwable</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">t</span><span class="o">?.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">override</span> <span class="n">fun</span> <span class="nf">onResponse</span><span class="o">(</span><span class="nl">call:</span> <span class="n">Call</span><span class="o">&lt;</span><span class="n">ResponseBody</span><span class="o">&gt;?,</span> <span class="nl">response:</span> <span class="n">Response</span><span class="o">&lt;</span><span class="n">ResponseBody</span><span class="o">&gt;?)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">dumpMessage</span><span class="o">(</span><span class="s">&quot;onResponse of plainTextAsResponseBody content=${response?.body()?.string()}&quot;</span><span class="o">)</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="o">})</span>
</span></code></pre></td></tr></table></div></figure>


<h2>é™„åŠ å†…å®¹</h2>

<p>å¦‚æœåœ¨æŸç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå…³å¿ƒè¯·æ±‚æ“ä½œï¼Œè€Œä¸å…³å¿ƒå“åº”å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@GET</span><span class="o">(</span><span class="s">&quot;/content/helloworld.txt&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">Call</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">ignoreResult</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç ç›¸å¯¹æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºè¿™é‡Œçœç•¥äº†å°†å“åº”å†…å®¹è½¬æˆå†…å­˜å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ç»ˆç«¯åç¼–è¯‘å­—èŠ‚ç åˆ©å™¨ CFR]]></title>
    <link href="https://droidyue.com/blog/2019/02/24/decompile-class-file-command-line/"/>
    <updated>2019-02-24T21:11:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/02/24/decompile-class-file-command-line</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç ”ç©¶ä¸€ä¸‹classå­—èŠ‚ç çš„ä¸œè¥¿ï¼Œå°è¯•å°†classæ–‡ä»¶åç¼–è¯‘æˆjavaæ–‡ä»¶ã€‚å°è¯•äº†å¾ˆå¤šçš„å·¥å…·ï¼Œæ¯”å¦‚JD-GUIåŠå…¶æ’ä»¶ä»¥åŠå„ç§åœ¨çº¿åç¼–è¯‘ï¼Œå§‹ç»ˆæ„Ÿè§‰ä¸å¤Ÿé…·ï¼Œæ¯•ç«Ÿæˆ‘æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¾èµ–ç»ˆç«¯çš„äººï¼Œæ‰€ä»¥å°è¯•æ‰¾ä¸€äº›èƒ½å¦åœ¨ç»ˆç«¯å¯ä»¥å®ç°åç¼–è¯‘çš„å·¥å…·ã€‚</p>

<!--more-->


<p></p>

<p>è¿˜æ˜¯Googleå¥½ï¼Œå¾ˆå¿«å°±æ‰¾åˆ°äº†ä¸€ä¸ªå¾ˆæ»¡æ„çš„å·¥å…·ã€‚</p>

<ul>
<li>å®ƒæ˜¯ä¸€ä¸ªjaråŒ…</li>
<li>åç§°å«åšCFR(Class File Reader)</li>
<li>æ”¯æŒåç¼–è¯‘classæ–‡ä»¶å’ŒjaråŒ…</li>
</ul>


<p>å¦‚ä¸‹ä»‹ç»ä¸¤ä¸ªå¸¸ç”¨çš„å‘½ä»¤ä½¿ç”¨</p>

<h2>åç¼–è¯‘classæ–‡ä»¶</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">java</span> <span class="o">-</span><span class="n">jar</span> <span class="o">~/</span><span class="n">Documents</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">cfr</span><span class="o">-</span><span class="mf">0.139</span><span class="o">.</span><span class="na">jar</span> <span class="n">JavaTest</span><span class="o">.</span><span class="na">class</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * Decompiled with CFR 0.139.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.io.PrintStream</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaTest</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">functionOne</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;functionOne&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">functionTwo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;functionTwo&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>åç¼–è¯‘jaråŒ…</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>java -jar ~/Documents/scripts/cfr-0.139.jar ~/Documents/scripts/cfr-0.139.jar --outputdir /tmp/outputdir
</span><span class='line'>Processing org.benf.cfr.reader.api.CfrDriver
</span><span class='line'>Processing org.benf.cfr.reader.api.ClassFileSource
</span><span class='line'>Processing org.benf.cfr.reader.api.OutputSinkFactory
</span><span class='line'>Processing org.benf.cfr.reader.api.SinkReturns
</span><span class='line'>Processing org.benf.cfr.reader.bytecode.analysis.opgraph.Graph
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>æ‰§è¡Œä¸Šè¿°å‘½ä»¤ç»“æŸåï¼Œä»è¾“å‡ºç›®å½•(outputdir)ä¸‹å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„javaæ–‡ä»¶äº†ã€‚</p>

<h2>åŒ…è£…æˆè„šæœ¬</h2>

<h3>åç¼–è¯‘æŸä¸ªclassæ–‡ä»¶</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>java -jar ~/Documents/scripts/cfr-0.139.jar <span class="nv">$1</span>
</span></code></pre></td></tr></table></div></figure>


<h3>åç¼–è¯‘æŸä¸ªjaråŒ…</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>java -jar ~/Documents/scripts/cfr-0.139.jar <span class="nv">$1</span> --outputdir <span class="nv">$2</span>
</span></code></pre></td></tr></table></div></figure>


<h2>èµ„æº</h2>

<ul>
<li><a href="http://www.benf.org/other/cfr/index.html">http://www.benf.org/other/cfr/index.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¤„ç† WebView ä¸ ViewPager æ»‘åŠ¨å†²çª]]></title>
    <link href="https://droidyue.com/blog/2019/01/27/webview-javascript-scrolling-issue/"/>
    <updated>2019-01-27T20:07:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/01/27/webview-javascript-scrolling-issue</id>
    <content type="html"><![CDATA[<p>é—®é¢˜åœºæ™¯
åœ¨é¡¹ç›®çš„Appä¸­ï¼Œæœ‰ä¸€ä¸ªViewPagerï¼Œå®ƒå†…éƒ¨åŒ…å«äº†WebViewï¼Œè€Œå†…éƒ¨çš„webviewåŠ è½½äº†ä¸€ä¸ªå¯ä»¥æ»‘åŠ¨çš„ç½‘é¡µã€‚</p>

<p>å½“æˆ‘ä»¬åœ¨ç½‘é¡µæ»‘åŠ¨çš„æ—¶å€™ï¼Œä¼šç›´æ¥åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªviewpagerçš„é¡µé¢ï¼Œè€Œä¸æ˜¯ä¼˜å…ˆå“åº”webviewçš„æ»‘åŠ¨ã€‚</p>

<!--more-->


<p>å…·ä½“çš„æ•ˆæœå¦‚è§†é¢‘</p>

<p><video style="width:50%"   controls>
  <source src="https://asset.droidyue.com/video/web_scroll_bad.mp4" type="video/mp4">
</video></p>

<p>æœŸå¾…çš„ç¤ºä¾‹æ•ˆæœ
<video style="width:50%"   controls>
  <source src="https://asset.droidyue.com/video/web_scroll_good.mp4" type="video/mp4">
</video></p>

<h2>è§£å†³æ€è·¯</h2>

<p>å…¶å®æ€è·¯è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¤§æ¦‚å¦‚ä¸‹</p>

<ul>
<li>ä¼˜å…ˆå“åº”webviewå†…éƒ¨æ»‘åŠ¨</li>
<li>å¦‚æœwebviewå†…éƒ¨æ»‘åŠ¨å®Œæˆï¼Œåˆ™å“åº”å¤–éƒ¨çš„æ»‘åŠ¨</li>
</ul>


<p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œæ€ä¹ˆåˆ¤æ–­webviewå†…éƒ¨æ»‘åŠ¨ç»“æŸå°±æ˜¯è§£å†³é—®é¢˜çš„å…³é”®äº†ã€‚</p>

<p>è§£å†³é—®é¢˜çš„å…³é”®å°±åœ¨äºWebView.onOverScrolledæ–¹æ³•</p>

<p><img src="https://asset.droidyue.com/image/overscrolled_webview.png" alt="WebView.onOverScrolled" /></p>

<p>çœ‹äº†ä¸Šé¢çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æ˜¯æœ‰ä¸€äº›ç–‘æƒ‘ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯overScrollã€‚æ­£æ‰€è°“ä¸€å›¾èƒœåƒè¨€ï¼Œçœ‹ä¸€ä¸‹ä¸‹å›¾å°±çŸ¥é“äº†ã€‚</p>

<p><img src="https://asset.droidyue.com/image/overscroll_effect.png" alt="Webview overscrolled effect" /></p>

<p>ä¸Šé¢çº¢æ¡†çš„å†…å®¹å°±æ˜¯overScrollçš„æ•ˆæœï¼Œå…¶å®å°±æ˜¯åˆ’è¿‡äº†çš„æ„æ€ï¼ˆè‹±è¯­ä¸­overæœ‰è¿‡çš„æ„æ€ï¼‰</p>

<p>äº†è§£äº†ä¸Šé¢çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å…·ä½“çš„å®æ–½åŠæ³•ä¹Ÿå°±æœ‰äº†ã€‚</p>

<ul>
<li>åœ¨WebViewçš„onTouchEventäº‹ä»¶ä¸ºACTION_DOWNæ—¶ï¼ŒæŸ¥æ‰¾çˆ¶è§†å›¾æ˜¯å¦æ˜¯å¯ä»¥æ»‘åŠ¨çš„è§†å›¾(å¦‚ViewPager)ï¼Œå¦‚æœæ˜¯,åˆ™é€šè¿‡requestDisallowInterceptTouchEvent(true)è°ƒç”¨ï¼Œè¯·æ±‚çˆ¶è§†å›¾ä¸è¦æ‹¦æˆªtouchEvent</li>
<li>å¦‚æœWebViewä¸å†å“åº”å†…éƒ¨æ»‘åŠ¨ï¼ˆå³onOverScrolledä¸­clampedXæˆ–è€…clampedYå€¼ä¸ºtrueï¼‰ï¼Œæˆ‘ä»¬å†èµ·è°ƒç”¨requestDisallowInterceptTouchEvent(false)è¯·æ±‚çˆ¶è§†å›¾æ¢å¤æ‹¦æˆªå¤„ç†touchEvent.</li>
</ul>


<p>æ ¸å¿ƒä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onTouchEvent</span><span class="o">(</span><span class="nl">event:</span> <span class="n">MotionEvent</span><span class="o">):</span> <span class="n">Boolean</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">action</span> <span class="o">==</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">val</span> <span class="n">viewParent</span> <span class="o">=</span> <span class="n">findViewParentIfNeeds</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class='line'>       <span class="n">viewParent</span><span class="o">?.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">onTouchEvent</span><span class="o">(</span><span class="n">event</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onOverScrolled</span><span class="o">(</span><span class="nl">scrollX:</span> <span class="n">Int</span><span class="o">,</span> <span class="nl">scrollY:</span> <span class="n">Int</span><span class="o">,</span> <span class="nl">clampedX:</span> <span class="n">Boolean</span><span class="o">,</span> <span class="nl">clampedY:</span> <span class="n">Boolean</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">dumpMessage</span><span class="o">(</span><span class="s">&quot;onOverScrolled scrollX=&quot;</span> <span class="o">+</span> <span class="n">scrollX</span> <span class="o">+</span> <span class="s">&quot;;scrollY=&quot;</span> <span class="o">+</span> <span class="n">scrollY</span>
</span><span class='line'>           <span class="o">+</span> <span class="s">&quot;;clampedX=&quot;</span> <span class="o">+</span> <span class="n">clampedX</span> <span class="o">+</span> <span class="s">&quot;;clampedY=&quot;</span> <span class="o">+</span> <span class="n">clampedY</span><span class="o">)</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">clampedX</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">val</span> <span class="n">viewParent</span> <span class="o">=</span> <span class="n">findViewParentIfNeeds</span><span class="o">(</span><span class="k">this</span><span class="o">)</span>
</span><span class='line'>       <span class="n">viewParent</span><span class="o">?.</span><span class="na">requestDisallowInterceptTouchEvent</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="kd">super</span><span class="o">.</span><span class="na">onOverScrolled</span><span class="o">(</span><span class="n">scrollX</span><span class="o">,</span> <span class="n">scrollY</span><span class="o">,</span> <span class="n">clampedX</span><span class="o">,</span> <span class="n">clampedY</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="n">fun</span> <span class="nf">findViewParentIfNeeds</span><span class="o">(</span><span class="nl">tag:</span> <span class="n">View</span><span class="o">):</span> <span class="n">ViewParent</span><span class="o">?</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="na">parent</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="n">parent</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="k">return</span> <span class="nf">if</span> <span class="o">(</span><span class="n">parent</span> <span class="n">is</span> <span class="n">ViewPager</span> <span class="o">||</span>
</span><span class='line'>           <span class="n">parent</span> <span class="n">is</span> <span class="n">AbsListView</span> <span class="o">||</span>
</span><span class='line'>           <span class="n">parent</span> <span class="n">is</span> <span class="n">ScrollView</span> <span class="o">||</span>
</span><span class='line'>           <span class="n">parent</span> <span class="n">is</span> <span class="n">HorizontalScrollView</span> <span class="o">||</span>
</span><span class='line'>           <span class="n">parent</span> <span class="n">is</span> <span class="n">GridView</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">parent</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="n">is</span> <span class="n">View</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">findViewParentIfNeeds</span><span class="o">(</span><span class="n">parent</span> <span class="n">as</span> <span class="n">View</span><span class="o">)</span>
</span><span class='line'>       <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">parent</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åˆ©ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°±èƒ½å®Œç¾çš„è§£å†³æ°´å¹³æ»‘åŠ¨çš„é—®é¢˜ï¼Œå¯¹äºå‚ç›´çºµå‘çš„é—®é¢˜ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæœ¬æ–‡æ–¹æ³•åšç±»ä¼¼å®ç°ã€‚</p>

<h2>ç¤ºä¾‹ä»£ç </h2>

<ul>
<li><a href="https://github.com/androidyue/WebViewViewPagerScrollingIssue">https://github.com/androidyue/WebViewViewPagerScrollingIssue</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[èŠä¸€èŠæœªæ•è·å¼‚å¸¸ä¸è¿›ç¨‹é€€å‡ºçš„å…³è”]]></title>
    <link href="https://droidyue.com/blog/2019/01/21/thread-process-and-uncaught-exceptions/"/>
    <updated>2019-01-21T19:52:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/01/21/thread-process-and-uncaught-exceptions</id>
    <content type="html"><![CDATA[<p>ä¹‹å‰çš„æ–‡ç« <a href="https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions/">JVM å¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸</a> æˆ‘ä»¬ä»‹ç»äº†JVMå¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸ï¼Œä»Šå¤©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸ªæ›´åŠ æœ‰æ„æ€çš„é—®é¢˜ï¼Œå°±æ˜¯åœ¨JVMä¸­å¦‚æœå‘ç”Ÿäº†æœªæ•è·å¼‚å¸¸ï¼Œä¼šå¯¼è‡´JVMè¿›ç¨‹é€€å‡ºä¹ˆã€‚</p>

<p>å…³äºä»€ä¹ˆæ˜¯æœªæ•è·å¼‚å¸¸ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œå¦‚æ¬²äº†è§£ï¼Œè¯·é˜…è¯»<a href="https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions/">JVM å¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸</a></p>

<!--more-->


<h2>è¾…åŠ©æ–¹æ³•</h2>

<h3>ä¸€ä¸ªäº§ç”Ÿæœªæ•è·å¼‚å¸¸çš„æ–¹æ³•</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//In Utils.java file</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">causeNPE</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>        <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>çº¿ç¨‹ç¡çœ æ–¹æ³•</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//In Utils.java file</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">makeThreadSleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">durationInMillSeconds</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">durationInMillSeconds</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;makeThreadSleep interrupted&quot;</span><span class="o">);</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä½¿ç”¨è¯¥æ–¹æ³•çš„ç›®çš„ä¸»è¦æœ‰</p>

<ul>
<li>è®©å½“å‰çº¿ç¨‹ç¡çœ ï¼Œç¡®ä¿å…¶ä»–çº¿ç¨‹å¯åŠ¨å®Œæˆ</li>
<li>è®©å½“å‰çº¿ç¨‹ç¡çœ ï¼Œç¡®ä¿å½“å‰çº¿ç¨‹ä¸è‡³äºå¿«é€Ÿç»“æŸè€Œé”€æ¯</li>
</ul>


<h3>æ‰“å°å…¨éƒ¨çº¿ç¨‹ä¿¡æ¯æ–¹æ³•</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//In Utils.java file</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">dumpAllThreadsInfo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Thread</span><span class="o">&gt;</span> <span class="n">threadSet</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">getAllStackTraces</span><span class="o">().</span><span class="na">keySet</span><span class="o">();</span>
</span><span class='line'>        <span class="k">for</span><span class="o">(</span><span class="n">Thread</span> <span class="nl">thread:</span> <span class="n">threadSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dumpAllThreadsInfo thread.name=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
</span><span class='line'>                    <span class="o">+</span> <span class="s">&quot;;thread.state=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getState</span><span class="o">()</span>
</span><span class='line'>                    <span class="o">+</span> <span class="s">&quot;;thread.isAlive=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">()</span>
</span><span class='line'>                    <span class="o">+</span> <span class="s">&quot;;group=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">()</span>
</span><span class='line'>            <span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>æ‰“å°è¾…åŠ©æµ‹è¯•çš„æ—¶é—´</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//è¾“å‡ºç»“æœç±»ä¼¼ 16:55:55</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getTimeForDebug</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">SimpleDateFormat</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;HH:mm:ss&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>éªŒè¯æ–¹æ³•</h2>

<p>è¿™é‡Œçš„éªŒè¯æˆ‘ä»¬æŒ‰ç…§è¡¨ç°æ¥åŒºåˆ†ï¼Œæˆ‘ä»¬å°†éªŒè¯ä»¥ä¸‹åœºæ™¯</p>

<ul>
<li>åœ¨å­çº¿ç¨‹ä¸­åˆ¶é€ æœªæ•è·å¼‚å¸¸</li>
<li>åœ¨ä¸»çº¿ç¨‹ä¸­åˆ¶é€ æœªæ•è·å¼‚å¸¸</li>
</ul>


<p>åŒæ—¶ä¸Šé¢çš„åœºæ™¯ï¼Œåœ¨é€šç”¨çš„JVMå’ŒAndroidä¸Šè¡¨ç°æœ‰ä¸€äº›å·®å¼‚ï¼Œæˆ‘ä»¬ä¹Ÿéƒ½ä¼šè¿›è¡Œè¦†ç›–ç ”ç©¶ã€‚</p>

<h2>å­çº¿ç¨‹ä¸­çš„æœªæ•è·å¼‚å¸¸</h2>

<p>æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªåœ¨å­çº¿ç¨‹ä¸­å‡ºç°æœªæ•è·å¼‚å¸¸çš„åœºæ™¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">startErrorThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;startErrorThread currentThread.name=&quot;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>
</span><span class='line'>            <span class="o">+</span> <span class="s">&quot;; happened at &quot;</span> <span class="o">+</span> <span class="n">Utils</span><span class="o">.</span><span class="na">getTimeForDebug</span><span class="o">());</span>
</span><span class='line'>            <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Utils</span><span class="o">.</span><span class="na">makeThreadSleep</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Thread main sleepFinished at &quot;</span> <span class="o">+</span> <span class="n">Utils</span><span class="o">.</span><span class="na">getTimeForDebug</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Utils</span><span class="o">.</span><span class="na">dumpAllThreadsInfo</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬æœŸå¾…çš„è¾“å‡ºç»“æœæ˜¯</p>

<ul>
<li>æ–°å¯åŠ¨çš„å­çº¿(åº”è¯¥æ˜¯Thread-0)ç¨‹å› ä¸ºNPEæœªæ•è·è€Œå¯¼è‡´çº¿ç¨‹é”€æ¯</li>
<li>ä¸»çº¿ç¨‹ä¸å—åˆšåˆšå¼‚å¸¸çš„å½±å“(è¿›ç¨‹è¿˜å­˜åœ¨)ï¼Œåœ¨ç¡çœ 10ç§’åï¼Œä¼šæ‰“å°å‡ºæ‰€æœ‰çº¿ç¨‹çš„ä¿¡æ¯ï¼ˆä¸åŒ…å«åˆšåˆšå´©æºƒçº¿ç¨‹Thread-0çš„ä¿¡æ¯ï¼‰</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//å¼‚å¸¸å‘ç”Ÿ è¾“å‡ºçº¿ç¨‹åç§°å’Œå‘ç”Ÿå¼‚å¸¸çš„æ—¶é—´</span>
</span><span class='line'><span class="n">startErrorThread</span> <span class="n">currentThread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">;</span> <span class="n">happened</span> <span class="n">at</span> <span class="mi">16</span><span class="o">:</span><span class="mi">59</span><span class="o">:</span><span class="mi">04</span>
</span><span class='line'><span class="c1">//å¼‚å¸¸å´©æºƒçš„ä¿¡æ¯</span>
</span><span class='line'><span class="n">Exception</span> <span class="n">in</span> <span class="n">thread</span> <span class="s">&quot;Thread-0&quot;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">35</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Main$3</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">115</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Thread</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">Thread</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">748</span><span class="o">)</span>
</span><span class='line'><span class="c1">//ä¸»çº¿ç¨‹ç¡çœ ç»“æŸ(å¯¹æ¯”æ—¶é—´ï¼Œç¡®å®šå·®ä¸º10ç§’)    </span>
</span><span class='line'><span class="n">Thread</span> <span class="n">main</span> <span class="n">sleepFinished</span> <span class="n">at</span> <span class="mi">16</span><span class="o">:</span><span class="mi">59</span><span class="o">:</span><span class="mi">14</span>
</span><span class='line'><span class="c1">//ä¸»çº¿ç¨‹ä¸å—å½±å“ï¼Œç»§ç»­æ‰§è¡Œæ“ä½œ</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Attach</span> <span class="n">Listener</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Reference</span> <span class="n">Handler</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">WAITING</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Monitor</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">Break</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Signal</span> <span class="n">Dispatcher</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Finalizer</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">WAITING</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">main</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="c1">//è¿›ç¨‹ç»“æŸ</span>
</span><span class='line'><span class="n">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹èµ·æ¥ï¼Œå­çº¿ç¨‹å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸ä¸ä¼šå¯¼è‡´è¿›ç¨‹çš„é€€å‡ºï¼ˆä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„çº¿ç¨‹)ã€‚</p>

<h3>Androidæœ‰ç‚¹ä¸ä¸€æ ·</h3>

<p>è¿™ä¸ªæ—¶å€™å¯èƒ½åšAndroidå¼€å‘çš„åŒå­¦å¯èƒ½ä¼šç«™èµ·æ¥ã€‚</p>

<p><strong>æé—®</strong>ï¼šä¸å¯¹å•Šï¼Œæˆ‘æŠŠä½ çš„ä»£ç æ”¾åˆ°Androidé¡¹ç›®ä¸­æ‰§è¡Œï¼Œä¼šå‡ºç°åº”ç”¨å·²åœæ­¢çš„å¯¹è¯æ¡†ï¼Œç„¶åæˆ‘çš„è¿›ç¨‹æ€ä¹ˆå°±é€€å‡ºäº†å‘¢,è€å“¥ï¼Œä½ çš„ç»“è®ºä¸å¯¹å§ã€‚</p>

<p><strong>å›ç­”</strong>ï¼šå“ˆå“ˆï¼Œè¿™ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªå¥½é—®é¢˜ï¼Œæƒ³è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦äº†è§£JVMå¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸çš„ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¹‹å‰æ–‡ç« <a href="https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions/">JVM å¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸</a>ä»‹ç»çš„ã€‚</p>

<p>è¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹å°±æ˜¯ï¼Œå½“JVMå‘ç°å¼‚å¸¸å</p>

<ul>
<li>é¦–å…ˆå°è¯•æ£€æµ‹å½“å‰çš„Threadæ˜¯å¦æœ‰UncaughtExeptionHandlerï¼Œå¹¶å°è¯•åˆ†å‘å‡ºé—®é¢˜çš„Throwableå®ä¾‹</li>
<li>å¦‚æœä¸Šä¸€æ­¥æ‰¾ä¸åˆ°å¯¹åº”çš„UncaughtExceptionHandlerï¼Œåˆ™åˆ†å‘é—®é¢˜çš„Throwableå®ä¾‹åˆ°å…¶æ‰€åœ¨çš„ThreadGroup</li>
<li>ThreadGroupä¼˜å…ˆä¼šå°†Throwableå®ä¾‹åˆ†å‘ç»™å…¶çˆ¶ThreadGroup</li>
<li>å¦‚æœThreadGroupæ²¡æœ‰çˆ¶ThreadGroupï¼Œåˆ™å°è¯•åˆ†å‘ç»™æ‰€æœ‰çº¿ç¨‹é»˜è®¤ä½¿ç”¨çš„UncaughtExceptionHandler</li>
</ul>


<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªæµç¨‹æ‰’äº†ä¸€ä¸‹<a href="https://android.googlesource.com/platform/frameworks/base/+/jb-mr1-release/core/java/com/android/internal/os/RuntimeInit.java">RuntimeInit.java</a> å‘ç°äº†è¿™æ ·çš„ä»£ç ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Use this to log a message when a thread exits due to an uncaught</span>
</span><span class='line'><span class="cm"> * exception.  The framework catches these for the main threads, so</span>
</span><span class='line'><span class="cm"> * this should only matter for threads created by applications.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">UncaughtHandler</span> <span class="kd">implements</span> <span class="n">Thread</span><span class="o">.</span><span class="na">UncaughtExceptionHandler</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">uncaughtException</span><span class="o">(</span><span class="n">Thread</span> <span class="n">t</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// Don&#39;t re-enter -- avoid infinite loops if crash-reporting crashes.</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">mCrashing</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
</span><span class='line'>            <span class="n">mCrashing</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">mApplicationObject</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Slog</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;*** FATAL EXCEPTION IN SYSTEM PROCESS: &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Slog</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;FATAL EXCEPTION: &quot;</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="c1">// å±•ç¤º åº”ç”¨å·²åœæ­¢çš„ å¯¹è¯æ¡†</span>
</span><span class='line'>            <span class="c1">// Bring up crash dialog, wait for it to be dismissed</span>
</span><span class='line'>            <span class="n">ActivityManagerNative</span><span class="o">.</span><span class="na">getDefault</span><span class="o">().</span><span class="na">handleApplicationCrash</span><span class="o">(</span>
</span><span class='line'>                    <span class="n">mApplicationObject</span><span class="o">,</span> <span class="k">new</span> <span class="n">ApplicationErrorReport</span><span class="o">.</span><span class="na">CrashInfo</span><span class="o">(</span><span class="n">e</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Slog</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">TAG</span><span class="o">,</span> <span class="s">&quot;Error reporting crash&quot;</span><span class="o">,</span> <span class="n">t2</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t3</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="c1">// Even Slog.e() fails!  Oh well.</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>          <span class="c1">//æ€æ‰è¿›ç¨‹</span>
</span><span class='line'>            <span class="c1">// Try everything to make sure this process goes away.</span>
</span><span class='line'>            <span class="n">Process</span><span class="o">.</span><span class="na">killProcess</span><span class="o">(</span><span class="n">Process</span><span class="o">.</span><span class="na">myPid</span><span class="o">());</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šè¿°ä»£ç ä¼šæ‰§è¡Œä¸¤ä¸ªä¸»è¦çš„æ“ä½œ</p>

<ul>
<li>å±•ç¤ºä¸€ä¸ªå´©æºƒçš„å¯¹è¯æ¡†</li>
<li>åœ¨finally éƒ¨åˆ†ï¼Œæ€æ‰å½“å‰çš„è¿›ç¨‹</li>
</ul>


<p>Androidç³»ç»Ÿä¼šåœ¨è¿›ç¨‹å¯åŠ¨åï¼Œé€šè¿‡ä¸‹é¢çš„ä»£ç ä¸ºæ‰€æœ‰çš„çº¿ç¨‹è®¾ç½®é»˜è®¤çš„UncaughtExceptionHandler</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/* set default handler; this applies to all threads in the VM */</span>
</span><span class='line'><span class="n">Thread</span><span class="o">.</span><span class="na">setDefaultUncaughtExceptionHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">UncaughtHandler</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>åŒæ—¶ç”±äºå¦‚ä¸‹åŸå› </p>

<ul>
<li>å‡ºé—®é¢˜çš„çº¿ç¨‹æ²¡æœ‰é€šè¿‡<code>Thread.setUncaughtExceptionHandler</code>æ˜¾å¼è®¾ç½®å¯¹åº”çš„å¤„ç†è€…</li>
<li>çº¿ç¨‹æ‰€åœ¨çš„ThreadGroupå®ä¾‹å±äºåŸç”Ÿçš„ThreadGroupï¼Œè€Œä¸æ˜¯ç”¨æˆ·è‡ªå®šä¹‰å¹¶é‡å†™<code>uncaughtException</code>çš„ThreadGroupå­ç±»ã€‚</li>
</ul>


<p>æ‰€ä»¥å‡ºç°æœªæ•è·çš„å¼‚å¸¸ï¼Œé»˜è®¤å°±ä¼šèµ°åˆ°äº†Androidç³»ç»Ÿé»˜è®¤è®¾ç½®çš„æ‰€æœ‰çº¿ç¨‹å…±ç”¨çš„å¤„ç†è€…ã€‚</p>

<h3>å¦‚æœå‘ç”Ÿåœ¨ä¸»çº¿ç¨‹ä¸­å‘¢</h3>

<p>å‰é¢è¯´çš„éƒ½æ˜¯å­çº¿ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœä¸»çº¿ç¨‹å‡ºç°æœªæ•è·å¼‚å¸¸ï¼Œè¿›ç¨‹åº”è¯¥ä¼šé€€å‡ºå§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">uncaughtExceptionInMainThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œå¾—åˆ°è¿›ç¨‹é€€å‡ºçš„æ—¥å¿—</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Exception</span> <span class="n">in</span> <span class="n">thread</span> <span class="s">&quot;main&quot;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">35</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Main</span><span class="o">.</span><span class="na">uncaughtExceptionInMainThread</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">28</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Main</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">14</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯æ˜¯å½“æˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„è¿™ä»½ä»£ç ï¼ˆå¯åŠ¨å¦ä¸€ä¸ªçº¿ç¨‹å¹¶ä¼‘çœ 20ç§’ï¼‰ï¼Œç»“æœå´æ˜¯ä¸ä¸€æ ·çš„</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">uncaughtExceptionInMainThreadNotLastUserThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Utils</span><span class="o">.</span><span class="na">makeThreadSleep</span><span class="o">(</span><span class="mi">20</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;uncaughtExceptionInMainThreadNotLastUserThread time=&quot;</span> <span class="o">+</span> <span class="n">Utils</span><span class="o">.</span><span class="na">getTimeForDebug</span><span class="o">()</span>
</span><span class='line'>                <span class="o">+</span> <span class="s">&quot;;thread=&quot;</span> <span class="o">+</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>
</span><span class='line'>            <span class="o">);</span>
</span><span class='line'>            <span class="n">Utils</span><span class="o">.</span><span class="na">dumpAllThreadsInfo</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Utils</span><span class="o">.</span><span class="na">makeThreadSleep</span><span class="o">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;uncaughtExceptionInMainThreadNotLastUserThread mainThread time=&quot;</span> <span class="o">+</span> <span class="n">Utils</span><span class="o">.</span><span class="na">getTimeForDebug</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¾—åˆ°çš„æ—¥å¿—è¾“å‡ºæ˜¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">uncaughtExceptionInMainThreadNotLastUserThread</span> <span class="n">mainThread</span> <span class="n">time</span><span class="o">=</span><span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">09</span>
</span><span class='line'><span class="c1">// å¼‚å¸¸å‘ç”Ÿ</span>
</span><span class='line'><span class="n">Exception</span> <span class="n">in</span> <span class="n">thread</span> <span class="s">&quot;main&quot;</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">NullPointerException</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Utils</span><span class="o">.</span><span class="na">causeNPE</span><span class="o">(</span><span class="n">Utils</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">35</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Main</span><span class="o">.</span><span class="na">uncaughtExceptionInMainThreadNotLastUserThread</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">44</span><span class="o">)</span>
</span><span class='line'>  <span class="n">at</span> <span class="n">Main</span><span class="o">.</span><span class="na">main</span><span class="o">(</span><span class="n">Main</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">15</span><span class="o">)</span>
</span><span class='line'><span class="c1">//Thread-0  çº¿ç¨‹ä¼‘çœ ç»“æŸ   </span>
</span><span class='line'><span class="n">uncaughtExceptionInMainThreadNotLastUserThread</span> <span class="n">time</span><span class="o">=</span><span class="mi">20</span><span class="o">:</span><span class="mi">48</span><span class="o">:</span><span class="mi">24</span><span class="o">;</span><span class="n">thread</span><span class="o">=</span><span class="n">Thread</span><span class="o">-</span><span class="mi">0</span>
</span><span class='line'><span class="c1">// æ‰“å°æ­¤æ—¶çš„å…¨éƒ¨çº¿ç¨‹ä¿¡æ¯</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Signal</span> <span class="n">Dispatcher</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">DestroyJavaVM</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Thread</span><span class="o">-</span><span class="mi">0</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Monitor</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">Break</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Reference</span> <span class="n">Handler</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">WAITING</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Attach</span> <span class="n">Listener</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">RUNNABLE</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Finalizer</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">state</span><span class="o">=</span><span class="n">WAITING</span><span class="o">;</span><span class="n">thread</span><span class="o">.</span><span class="na">isAlive</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'><span class="c1">//è¿›ç¨‹é€€å‡º</span>
</span><span class='line'><span class="n">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿›ç¨‹å¹¶æ²¡æœ‰éšç€ä¸»çº¿ç¨‹ä¸­å‡ºç°æœªæ•è·å¼‚å¸¸è€Œç†è§£é€€å‡ºï¼Œè€Œæ˜¯ç­‰åˆ°æˆ‘ä»¬å¯åŠ¨çš„Thread-0ç»“æŸä¹‹åæ‰é€€å‡ºçš„ã€‚</p>

<p>é‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œçœ‹è¿‡æˆ‘ä¹‹å‰æ–‡ç« <a href="https://droidyue.com/blog/2018/12/16/daemon-thread-in-java/">JVM ä¸­çš„å®ˆæŠ¤çº¿ç¨‹</a>çš„æœ‹å‹åº”è¯¥äº†è§£</p>

<p>JVMé€€å‡ºé€šå¸¸æœ‰ä¸¤ç§æƒ…å†µ</p>

<ul>
<li>æœ‰æ•ˆçš„è°ƒç”¨System.exit()</li>
<li>æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹é€€å‡ºåï¼ŒJVMå°±ä¼šè‡ªåŠ¨é€€å‡º</li>
</ul>


<p>å› æ­¤ä¸éš¾å¾—å‡ºç»“è®º</p>

<ul>
<li>ç¬¬ä¸€æ®µä»£ç ä¸­ï¼Œåªæœ‰ä¸»çº¿ç¨‹ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹é”€æ¯ï¼Œæ‰€ä»¥è¿›ç¨‹ä¼šç»“æŸ</li>
<li>ç¬¬äºŒæ®µä»£ç ä¸­ï¼Œä¸»çº¿ç¨‹é”€æ¯åï¼Œè¿˜æœ‰ä¸€ä¸ªThread-0(ç”±ä¸»çº¿ç¨‹å¯åŠ¨ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹)ï¼ŒJVMä¼šç­‰å¾…å…¶ç»“æŸåè€Œé€€å‡ºã€‚</li>
</ul>


<h2>ç»“è®º</h2>

<p>æ‰€ä»¥æœªæ•è·å¼‚å¸¸åªä¼šå¯¼è‡´æ‰€å±çº¿ç¨‹é”€æ¯ï¼Œå¹¶ä¸ä¼šå¯¼è‡´JVMé€€å‡ºã€‚è¿™é‡Œæˆ‘è¿˜æ‰¾åˆ°ä¸€ä»½å®˜æ–¹APIæ–‡æ¡£ä½œä¸ºä½è¯ã€‚</p>

<blockquote><p>Uncaught exceptions are handled in shutdown hooks just as in any other thread, by invoking the uncaughtException method of the thread&rsquo;s ThreadGroup object. The default implementation of this method prints the exception&rsquo;s stack trace to System.err and terminates the thread; it does not cause the virtual machine to exit or halt.</p></blockquote>

<p>ä¸Šé¢çš„å†…å®¹æ¥è‡ª<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread">Runtime.addShutdownHook</a></p>

<h2>å‚è€ƒå£°æ˜</h2>

<ul>
<li><a href="https://stackoverflow.com/questions/40902082/will-an-exception-thrown-in-a-different-thread-will-crash-the-main-thread">Will an exception thrown in a Different thread will crash the main thread?</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è§£å†³Androidæ‰‹æœºè¿æ¥Charles unknowné—®é¢˜]]></title>
    <link href="https://droidyue.com/blog/2019/01/13/resolve-charles-unknow-indicator-on-android-phones/"/>
    <updated>2019-01-13T20:59:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/01/13/resolve-charles-unknow-indicator-on-android-phones</id>
    <content type="html"><![CDATA[<p>æœ€è¿‘å¾ˆå¤šåŒäº‹åé¦ˆä½¿ç”¨CharlesæŠ“åŒ…å‡ºç°äº†å¾ˆå¤šunknownçš„é—®é¢˜ï¼Œç°è±¡å¦‚ä¸‹å›¾</p>

<p><img src="https://asset.droidyue.com/image/2019_first_half/charles_unknow_error.png" alt="charles unknown" /></p>

<p>æŸ¥çœ‹å³ä¾§çš„åŸå› ï¼Œç»™å‡ºçš„ç»“æœæ˜¯è¿™æ ·çš„</p>

<p><img src="https://asset.droidyue.com/image/2019_first_half/failure_reason_charles_unknown.png" alt="Error detail" /></p>

<p>è¿™é‡Œå°†è®²è§£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¼€å§‹é˜…è¯»ä¹‹å‰ï¼Œè¯·ç¡®è®¤ç¬¦åˆå¦‚ä¸‹çš„æ¡ä»¶</p>

<ul>
<li>æœ¬æ–‡ä»…é€‚ç”¨äºAndroid 7åŠä¹‹åè®¾å¤‡</li>
<li>å¾…æŠ“åŒ…çš„åº”ç”¨è®¾ç½®äº†targetSDK ä¸º24åŠå…¶ä»¥ä¸Š</li>
<li>å·²ç»é…ç½®å¥½äº†charlesçš„è¯ä¹¦</li>
</ul>


<p>å¥½çš„ï¼Œå¼€å§‹äº†ã€‚</p>

<!--more-->


<h2>åŸå› </h2>

<ul>
<li>æˆ‘ä»¬åœ¨è®¾å¤‡ä¸Šå®‰è£…çš„charlesè¯ä¹¦ï¼Œå±äºç”¨æˆ·æ·»åŠ çš„è¯ä¹¦</li>
<li>å‡ºäºåº”ç”¨å®‰å…¨çš„ç›®çš„ï¼ŒAndroid 7åŠä¹‹åé»˜è®¤ä¸ä¿¡ä»»ç”¨æˆ·æ·»åŠ çš„è¯ä¹¦(Android 7 ä¹‹å‰æ˜¯é»˜è®¤ä¿¡ä»»ç”¨æˆ·æ·»åŠ çš„è¯ä¹¦)</li>
<li>å½“æˆ‘ä»¬å°†Appçš„ç¼–è¯‘ç›®æ ‡æåˆ°24åŠå…¶ä»¥ä¸Šï¼Œç³»ç»Ÿå°±ä¼šæ¿€æ´»è¿™ä¸€å®‰å…¨é™åˆ¶ã€‚</li>
</ul>


<h2>å¦‚ä½•è§£å†³</h2>

<h3>åˆ›å»ºAppç½‘ç»œå®‰å…¨é…ç½®æ–‡ä»¶</h3>

<p>åœ¨åº”ç”¨xmlç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªåä¸º<code>network_security_config.xml</code>ï¼Œå†…å®¹ä¸º</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;network-security-config&gt;</span>
</span><span class='line'>    <span class="nt">&lt;debug-overrides&gt;</span>
</span><span class='line'>        <span class="nt">&lt;trust-anchors&gt;</span>
</span><span class='line'>            <span class="c">&lt;!-- Trust user added CAs while debuggable only --&gt;</span>
</span><span class='line'>            <span class="nt">&lt;certificates</span> <span class="na">src=</span><span class="s">&quot;user&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/trust-anchors&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/debug-overrides&gt;</span>
</span><span class='line'><span class="nt">&lt;/network-security-config&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç ä»…ä»…åœ¨debugç¼–è¯‘åŒ…ï¼Œä¿¡ä»»ç”¨æˆ·æ·»åŠ çš„CAè¯ä¹¦</p>

<h3>åº”ç”¨é…ç½®</h3>

<p>åœ¨AndroidManifest ApplicationèŠ‚ç‚¹å¢åŠ å±æ€§</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;manifest</span> <span class="err">...</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;application</span> <span class="na">android:networkSecurityConfig=</span><span class="s">&quot;@xml/network_security_config&quot;</span>
</span><span class='line'>                    <span class="err">...</span> <span class="nt">&gt;</span>
</span><span class='line'>        ...
</span><span class='line'>    <span class="nt">&lt;/application&gt;</span>
</span><span class='line'><span class="nt">&lt;/manifest&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>å»ºè®®é‡å¯åº”ç”¨ï¼Œå°±èƒ½è§£å†³é—®é¢˜äº†ã€‚</p>

<h2>æ³¨æ„</h2>

<p>è€ƒè™‘åˆ°å®‰å…¨é—®é¢˜ï¼Œä¸Šé¢çš„å®ç°</p>

<ul>
<li>ä»…ä»…å¯¹debugç±»å‹çš„å®‰è£…åŒ…æœ‰æ•ˆï¼ˆå‚è€ƒå€¼ä¸ºapplicationèŠ‚ç‚¹çš„android:debuggableå±æ€§å€¼ï¼‰</li>
<li>Releaseç±»å‹çš„å®‰è£…åŒ…ä¸ä¼šæœ‰é¢å¤–çš„å®‰å…¨å½±å“</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JVM å¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸]]></title>
    <link href="https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions/"/>
    <updated>2019-01-06T21:18:00+08:00</updated>
    <id>https://droidyue.com/blog/2019/01/06/how-java-handle-uncaught-exceptions</id>
    <content type="html"><![CDATA[<p>ç»§ä¹‹å‰çš„æ–‡ç«  <a href="https://droidyue.com/blog/2018/10/21/how-jvm-handle-exceptions/">è¯¦è§£JVMå¦‚ä½•å¤„ç†å¼‚å¸¸</a>ï¼Œä»Šå¤©å†æ¬¡å‘å¸ƒä¸€ç¯‡æ¯”è¾ƒå…³è”çš„æ–‡ç« ï¼Œå¦‚é¢˜ç›®å¯çŸ¥ï¼Œä»Šå¤©èŠä¸€èŠåœ¨JVMä¸­çº¿ç¨‹é‡åˆ°æœªæ•è·å¼‚å¸¸çš„é—®é¢˜ï¼Œå…¶ä¸­æ¶‰åŠåˆ°çº¿ç¨‹å¦‚ä½•å¤„ç†æœªæ•è·å¼‚å¸¸å’Œä¸€äº›å†…å®¹ä»‹ç»ã€‚</p>

<!--more-->


<h2>ä»€ä¹ˆæ˜¯æœªæ•è·å¼‚å¸¸</h2>

<p>æœªæ•è·å¼‚å¸¸æŒ‡çš„æ˜¯æˆ‘ä»¬åœ¨æ–¹æ³•ä½“ä¸­æ²¡æœ‰ä½¿ç”¨try-catchæ•è·çš„å¼‚å¸¸ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testUncaughtException</span><span class="o">(</span><span class="n">String</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">arg</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ArithmeticException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç å¾ˆæœ‰å¯èƒ½å‘ç”Ÿå¦‚ä¸‹æƒ…å†µ</p>

<ul>
<li>å¦‚æœæ–¹æ³•å‚æ•°argä¼ é€’nullï¼Œä¼šå‡ºç°NullPointerException</li>
<li>å¦‚æœå‚æ•°argä¼ é€’å†…å®¹ä¸ºç©ºçš„å­—ç¬¦ä¸²(&ldquo;&rdquo;)ï¼Œä¼šå‡ºç°ArithmeticException</li>
</ul>


<p>å¯¹äºä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°</p>

<ul>
<li>ä¸Šé¢å¯èƒ½å‡ºç°çš„NullPointerExceptionå’ŒArithmeticExceptionéƒ½å±äºUnchecked Exceptions</li>
<li>è€ŒArithmeticExceptionè¢«æˆ‘ä»¬äººä¸ºtry-catchæ•è·äº†ï¼Œå®ƒä¸ç¬¦åˆæœ¬æ–‡å¯¹äºæœªæ•è·å¼‚å¸¸çš„å®šä¹‰</li>
<li>NullPointerException ç”±äºæˆ‘ä»¬æ²¡æœ‰catchä½ï¼Œå°±å˜æˆäº†æˆ‘ä»¬è¦èŠçš„æœªæ•è·å¼‚å¸¸</li>
<li>å¦å¤–ï¼Œæœªæ•è·å¼‚å¸¸å®é™…æ˜¯Unchecked Exceptionsçš„å­é›†</li>
</ul>


<h2>UncaughtExceptionHandler æ˜¯ä»€ä¹ˆ</h2>

<ul>
<li>å®ƒæ˜¯çº¿ç¨‹é‡åˆ°æœªæ•è·å¼‚å¸¸çš„ä¸€ä¸ªå¤„ç†è€…æ¥å£</li>
<li>å®ƒåŒ…å«ä¸€ä¸ªæ–¹æ³•<code>void uncaughtException(Thread t, Throwable e);</code> ç”¨æ¥å¤„ç†æ¥æ”¶å¤„ç†å¼‚å¸¸å‘ç”Ÿåçš„æ“ä½œï¼Œæ¯”å¦‚æ”¶é›†å´©æºƒä¿¡æ¯å¹¶ä¸ŠæŠ¥ç­‰</li>
<li>å¯ä»¥é€šè¿‡ å®ä¾‹æ–¹æ³• <code>Thread.setUncaughtExceptionHandler</code> ä¸ºæŸä¸€ä¸ªThreadå®ä¾‹è®¾ç½®æœªæ•è·å¼‚å¸¸å¤„ç†è€…</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡ é™æ€æ–¹æ³• <code>Thread.setDefaultUncaughtExceptionHandler</code> è®¾ç½®æ‰€æœ‰Threadå®ä¾‹çš„æœªæ•è·å¼‚å¸¸å¤„ç†è€…</li>
</ul>


<h2>ThreadGroup æ˜¯ä»€ä¹ˆ</h2>

<ul>
<li>ThreadGroup æ˜¯çº¿ç¨‹çš„é›†åˆ</li>
<li>ThreadGroup ä¹Ÿå¯ä»¥åŒ…å«å­ThreadGroup</li>
<li>é™¤äº†åˆå§‹çš„ThreadGroup ä¹‹å¤–ï¼Œæ¯ä¸ªThreadGroupéƒ½æœ‰ä¸€ä¸ªçˆ¶ ThreadGroup</li>
<li>ThreadGroup è‡ªèº«å®ç°äº†Thread.UncaughtExceptionHandlerï¼Œç”¨æ¥ç›¸åº”å¤„ç†å…¶å†…éƒ¨çš„çº¿ç¨‹å’ŒThreadGroupå‘ç”Ÿæœªæ•è·å¼‚å¸¸ã€‚</li>
</ul>


<h2>æœªæ•è·å¼‚å¸¸å¤„ç†è€… è®¾ç½®æŒ‡å—</h2>

<p><img src="https://asset.droidyue.com/image/2019_first_half/how_to_set_uncaught_exceptions.png" alt="how to set uncaught exception handler" /></p>

<h2>çº¿ç¨‹å‘ç”Ÿäº†æœªæ•è·å¼‚å¸¸ï¼ŒJVMæ€ä¹ˆå¤„ç†</h2>

<h3>åˆ†å‘Throwableå®ä¾‹</h3>

<p>å½“çº¿ç¨‹Aä¸­å‡ºç°äº†æœªæ•è·å¼‚å¸¸æ—¶ï¼ŒJVMä¼šè°ƒç”¨çº¿ç¨‹Açš„<code>dispatchUncaughtException(Throwable)</code>æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Dispatch an uncaught exception to the handler. This method is</span>
</span><span class='line'><span class="cm"> * intended to be called only by the JVM.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">void</span> <span class="nf">dispatchUncaughtException</span><span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">getUncaughtExceptionHandler</span><span class="o">().</span><span class="na">uncaughtException</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>è·å–æœªæ•è·å¼‚å¸¸å¤„ç†è€…</h3>

<ul>
<li>æ¯ä¸ªçº¿ç¨‹ä¼šæœ‰ä¸€ä¸ªå˜é‡(uncaughtExceptionHandler)æ¥ä¿å­˜æœªæ•è·å¼‚å¸¸çš„å¤„ç†è€…</li>
<li>åœ¨çº¿ç¨‹éœ€è¦ç¡®å®šThrowableåˆ†å‘ç›®æ ‡çš„å¤„ç†è€…æ—¶ï¼Œä¼˜å…ˆè·å–å½“å‰çº¿ç¨‹ä¸­uncaughtExceptionHandlerå˜é‡</li>
<li>å¦‚æœå‡ºé—®é¢˜çº¿ç¨‹çš„uncaughtExceptionHandlerä¸ºnullï¼ˆå³æ²¡æœ‰æ˜¾å¼è®¾ç½®å¼‚å¸¸å¤„ç†è€…ï¼‰ï¼Œåˆ™ä½¿ç”¨è‡ªå·±æ‰€åœ¨çš„ThreadGroupæ¥ä½œä¸ºæœªæ•è·å¼‚å¸¸å¤„ç†è€…ã€‚</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * Returns the handler invoked when this thread abruptly terminates</span>
</span><span class='line'><span class="cm"> * due to an uncaught exception. If this thread has not had an</span>
</span><span class='line'><span class="cm"> * uncaught exception handler explicitly set then this thread&#39;s</span>
</span><span class='line'><span class="cm"> * &lt;tt&gt;ThreadGroup&lt;/tt&gt; object is returned, unless this thread</span>
</span><span class='line'><span class="cm"> * has terminated, in which case &lt;tt&gt;null&lt;/tt&gt; is returned.</span>
</span><span class='line'><span class="cm"> * @since 1.5</span>
</span><span class='line'><span class="cm"> * @return the uncaught exception handler for this thread</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="n">UncaughtExceptionHandler</span> <span class="nf">getUncaughtExceptionHandler</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">uncaughtExceptionHandler</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span>
</span><span class='line'>        <span class="n">uncaughtExceptionHandler</span> <span class="o">:</span> <span class="n">group</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>å¦‚æœThrowableåˆ†å‘ç»™ThreadGroup</h4>

<ul>
<li>ThreadGroupä¼šå°è¯•è½¬ç»™å®ƒçš„çˆ¶ThreadGroupï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰</li>
<li>å¦‚æœä¸Šé¢æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ThreadGroupï¼Œåˆ™å°è¯•è·å–<code>Thread.getDefaultUncaughtExceptionHandler()</code>å¹¶åˆ†å‘</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Called by the Java Virtual Machine when a thread in this</span>
</span><span class='line'><span class="cm">     * thread group stops because of an uncaught exception, and the thread</span>
</span><span class='line'><span class="cm">     * does not have a specific {@link Thread.UncaughtExceptionHandler}</span>
</span><span class='line'><span class="cm">     * installed.</span>
</span><span class='line'><span class="cm">     * &lt;p&gt;</span>
</span><span class='line'><span class="cm">     * The &lt;code&gt;uncaughtException&lt;/code&gt; method of</span>
</span><span class='line'><span class="cm">     * &lt;code&gt;ThreadGroup&lt;/code&gt; does the following:</span>
</span><span class='line'><span class="cm">     * &lt;ul&gt;</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;If this thread group has a parent thread group, the</span>
</span><span class='line'><span class="cm">     *     &lt;code&gt;uncaughtException&lt;/code&gt; method of that parent is called</span>
</span><span class='line'><span class="cm">     *     with the same two arguments.</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;Otherwise, this method checks to see if there is a</span>
</span><span class='line'><span class="cm">     *     {@linkplain Thread#getDefaultUncaughtExceptionHandler default</span>
</span><span class='line'><span class="cm">     *     uncaught exception handler} installed, and if so, its</span>
</span><span class='line'><span class="cm">     *     &lt;code&gt;uncaughtException&lt;/code&gt; method is called with the same</span>
</span><span class='line'><span class="cm">     *     two arguments.</span>
</span><span class='line'><span class="cm">     * &lt;li&gt;Otherwise, this method determines if the &lt;code&gt;Throwable&lt;/code&gt;</span>
</span><span class='line'><span class="cm">     *     argument is an instance of {@link ThreadDeath}. If so, nothing</span>
</span><span class='line'><span class="cm">     *     special is done. Otherwise, a message containing the</span>
</span><span class='line'><span class="cm">     *     thread&#39;s name, as returned from the thread&#39;s {@link</span>
</span><span class='line'><span class="cm">     *     Thread#getName getName} method, and a stack backtrace,</span>
</span><span class='line'><span class="cm">     *     using the &lt;code&gt;Throwable&lt;/code&gt;&#39;s {@link</span>
</span><span class='line'><span class="cm">     *     Throwable#printStackTrace printStackTrace} method, is</span>
</span><span class='line'><span class="cm">     *     printed to the {@linkplain System#err standard error stream}.</span>
</span><span class='line'><span class="cm">     * &lt;/ul&gt;</span>
</span><span class='line'><span class="cm">     * &lt;p&gt;</span>
</span><span class='line'><span class="cm">     * Applications can override this method in subclasses of</span>
</span><span class='line'><span class="cm">     * &lt;code&gt;ThreadGroup&lt;/code&gt; to provide alternative handling of</span>
</span><span class='line'><span class="cm">     * uncaught exceptions.</span>
</span><span class='line'><span class="cm">     *</span>
</span><span class='line'><span class="cm">     * @param   t   the thread that is about to exit.</span>
</span><span class='line'><span class="cm">     * @param   e   the uncaught exception.</span>
</span><span class='line'><span class="cm">     * @since   JDK1.0</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">uncaughtException</span><span class="o">(</span><span class="n">Thread</span> <span class="n">t</span><span class="o">,</span> <span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">parent</span><span class="o">.</span><span class="na">uncaughtException</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Thread</span><span class="o">.</span><span class="na">UncaughtExceptionHandler</span> <span class="n">ueh</span> <span class="o">=</span>
</span><span class='line'>                <span class="n">Thread</span><span class="o">.</span><span class="na">getDefaultUncaughtExceptionHandler</span><span class="o">();</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">ueh</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">ueh</span><span class="o">.</span><span class="na">uncaughtException</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(!(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">ThreadDeath</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Exception in thread \&quot;&quot;</span>
</span><span class='line'>                                 <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\&quot; &quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°†ä¸Šé¢çš„å¤„ç†æµç¨‹åšæˆå›¾çš„å½¢å¼ï¼Œå°±æ˜¯ä¸‹å›¾æ‰€ç¤º</p>

<p><img src="https://asset.droidyue.com/image/2019_first_half/UncaughtExceptionProcess.png" alt="Uncaught exception process" /></p>

<p>æ³¨ï¼šä¸Šè¿°å›¾ç‰‡æ¥è‡ª<a href="https://www.javamex.com/tutorials/exceptions/exceptions_uncaught_handler.shtml">https://www.javamex.com/tutorials/exceptions/exceptions_uncaught_handler.shtml</a></p>

<h2>Questions</h2>

<h3>åˆå§‹çš„ThreadGroupæ˜¯ä»€ä¹ˆ</h3>

<p>ä¸Šé¢æåˆ°äº†åˆå§‹çš„ThreadGroupæ²¡æœ‰çˆ¶ThreadGroupï¼Œæ˜¯ä¸»çº¿ç¨‹æ‰€åœ¨çš„ThreadGroupä¹ˆï¼Ÿ</p>

<p>è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·ä¸€æ®µä»£ç éªŒè¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">dumpThreadGroups</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ThreadGroup</span> <span class="n">threadGroup</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getThreadGroup</span><span class="o">();</span>
</span><span class='line'>    <span class="k">while</span><span class="o">(</span><span class="n">threadGroup</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dumpThreadGroups threadGroup=&quot;</span> <span class="o">+</span> <span class="n">threadGroup</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span><span class='line'>        <span class="n">threadGroup</span> <span class="o">=</span> <span class="n">threadGroup</span><span class="o">.</span><span class="na">getParent</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ‰§è¡Œè¯¥æ–¹æ³•å¯¹åº”çš„è¾“å‡ºæ˜¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dumpThreadGroups</span> <span class="n">threadGroup</span><span class="o">=</span><span class="n">main</span>
</span><span class='line'><span class="n">dumpThreadGroups</span> <span class="n">threadGroup</span><span class="o">=</span><span class="n">system</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› æ­¤æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåˆå§‹çš„ThreadGroupæ˜¯ä¸€ä¸ªå«åšsystemçš„ThreadGroupï¼Œè€Œä¸æ˜¯main ThreadGroup</p>

<h3>setDefaultUncaughtExceptionHandler è®¾ç½®çš„ä¸€å®šä¼šè¢«è°ƒç”¨åˆ°ä¹ˆ</h3>

<p>è¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ä¸ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨ä»¥ä¸‹çš„æƒ…å†µ</p>

<ul>
<li>å‡ºé—®é¢˜çš„çº¿ç¨‹è®¾ç½®äº†å¯¹åº”çš„UncaughtExcpetionHandlerï¼Œä¼˜å…ˆå“åº”åˆ†å‘åˆ°è¿™ä¸ªHandler</li>
<li>å‡ºé—®é¢˜çš„çº¿ç¨‹æ‰€åœ¨çš„ThreadGroupåŒ…æ‹¬å…¶ç¥–å…ˆThreadGroup é‡å†™äº†uncaughtException ä¹Ÿå¯èƒ½é€ æˆçº¿ç¨‹é»˜è®¤çš„Handleræ— æ³•è¢«è°ƒç”¨</li>
<li>å‡ºé—®é¢˜çš„çº¿ç¨‹é‡å†™äº†dispatchUncaughtException å¯èƒ½æ€§è¾ƒå°</li>
<li>å‡ºé—®é¢˜çš„çº¿ç¨‹é‡å†™äº†getUncaughtExceptionHandler å¯èƒ½æ€§è¾ƒå°</li>
</ul>


<h2>å‚è€ƒå£°æ˜</h2>

<ul>
<li><a href="https://www.javamex.com/tutorials/exceptions/exceptions_uncaught_handler.shtml">How uncaught exceptions are handled</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JVM ä¸­çš„å®ˆæŠ¤çº¿ç¨‹]]></title>
    <link href="https://droidyue.com/blog/2018/12/16/daemon-thread-in-java/"/>
    <updated>2018-12-16T19:22:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/12/16/daemon-thread-in-java</id>
    <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„<a href="https://droidyue.com/blog/2018/10/21/how-jvm-handle-exceptions/">ã€Šè¯¦è§£JVMå¦‚ä½•å¤„ç†å¼‚å¸¸ã€‹</a>æåˆ°äº†å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æ—¶æ²¡æœ‰è¯¦ç»†è§£é‡Šï¼Œæ‰€ä»¥æ‰“ç®—æ”¾åˆ°ä»Šå¤©æ¥è§£é‡Šè¯´æ˜ä¸€ä¸‹JVMå®ˆæŠ¤çº¿ç¨‹çš„å†…å®¹ã€‚</p>

<h2>ç‰¹ç‚¹</h2>

<ul>
<li>é€šå¸¸ç”±JVMå¯åŠ¨</li>
<li>è¿è¡Œåœ¨åå°å¤„ç†ä»»åŠ¡ï¼Œæ¯”å¦‚åƒåœ¾å›æ”¶ç­‰</li>
<li>ç”¨æˆ·å¯åŠ¨çº¿ç¨‹æ‰§è¡Œç»“æŸæˆ–è€…JVMç»“æŸæ—¶ï¼Œä¼šç­‰å¾…æ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œä½†æ˜¯ä¸ä¼šå› ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„å­˜åœ¨è€Œå½±å“å…³é—­ã€‚</li>
</ul>


<!--more-->


<h2>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹</h2>

<p>åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»è¦ä¾æ®å¦‚ä¸‹çš„å†…å®¹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/* Whether or not the thread is a daemon thread. */</span>
</span><span class='line'><span class="kd">private</span> <span class="kt">boolean</span>     <span class="n">daemon</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">* Tests if this thread is a daemon thread.</span>
</span><span class='line'><span class="cm">*</span>
</span><span class='line'><span class="cm">* @return  &lt;code&gt;true&lt;/code&gt; if this thread is a daemon thread;</span>
</span><span class='line'><span class="cm">*          &lt;code&gt;false&lt;/code&gt; otherwise.</span>
</span><span class='line'><span class="cm">* @see     #setDaemon(boolean)</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">final</span> <span class="kt">boolean</span> <span class="nf">isDaemon</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">daemon</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸‹é¢æˆ‘ä»¬è¿›è¡Œä¸€äº›ç®€å•çš„ä»£ç ï¼ŒéªŒè¯ä¸€äº›å…³äºå®ˆæŠ¤çº¿ç¨‹çš„ç‰¹æ€§å’Œä¸€äº›çŒœæµ‹ã€‚</p>

<h2>è¾…åŠ©æ–¹æ³•</h2>

<p>æ‰“å°çº¿ç¨‹ä¿¡æ¯çš„æ–¹æ³•ï¼Œè¾“å‡ºçº¿ç¨‹çš„ç»„ï¼Œæ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ä»¥åŠå¯¹åº”çš„ä¼˜å…ˆçº§ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">dumpAllThreadsInfo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Set</span><span class="o">&lt;</span><span class="n">Thread</span><span class="o">&gt;</span> <span class="n">threadSet</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">getAllStackTraces</span><span class="o">().</span><span class="na">keySet</span><span class="o">();</span>
</span><span class='line'>   <span class="k">for</span><span class="o">(</span><span class="n">Thread</span> <span class="nl">thread:</span> <span class="n">threadSet</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dumpAllThreadsInfo thread.name=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span>
</span><span class='line'>               <span class="o">+</span> <span class="s">&quot;;group=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getThreadGroup</span><span class="o">()</span>
</span><span class='line'>               <span class="o">+</span> <span class="s">&quot;;isDaemon=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">isDaemon</span><span class="o">()</span>
</span><span class='line'>               <span class="o">+</span> <span class="s">&quot;;priority=&quot;</span> <span class="o">+</span> <span class="n">thread</span><span class="o">.</span><span class="na">getPriority</span><span class="o">());</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>çº¿ç¨‹ç¡çœ çš„æ–¹æ³•</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">makeThreadSleep</span><span class="o">(</span><span class="kt">long</span> <span class="n">durationInMillSeconds</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">durationInMillSeconds</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>éªŒè¯æ™®é€šçš„(éå®ˆæŠ¤çº¿ç¨‹)çº¿ç¨‹ä¼šå½±å“è¿›ç¨‹(JVM)é€€å‡º</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testNormalThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>   <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="s">&quot;NormalThread&quot;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="nd">@Override</span>
</span><span class='line'>       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>           <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>           <span class="c1">//ä¿æŒç¡çœ ï¼Œç¡®ä¿åœ¨æ‰§è¡ŒdumpAllThreadsInfoæ—¶ï¼Œè¯¥çº¿ç¨‹ä¸ä¼šå› ä¸ºé€€å‡ºå¯¼è‡´dumpAllThreadsInfoæ— æ³•æ‰“å°ä¿¡æ¯ã€‚</span>
</span><span class='line'>           <span class="n">makeThreadSleep</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>           <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;startNormalThread normalThread.time cost=&quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">));</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>   <span class="c1">//ä¸»çº¿ç¨‹æš‚å®š3ç§’ï¼Œç¡®ä¿å­çº¿ç¨‹éƒ½å¯åŠ¨å®Œæˆ</span>
</span><span class='line'>   <span class="n">makeThreadSleep</span><span class="o">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>   <span class="n">dumpAllThreadsInfo</span><span class="o">();</span>
</span><span class='line'>   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;MainThread.time cost = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è·å–è¾“å‡ºæ—¥å¿—</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Signal</span> <span class="n">Dispatcher</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">9</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Attach</span> <span class="n">Listener</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">9</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Monitor</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">Break</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Reference</span> <span class="n">Handler</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">10</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">main</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">NormalThread</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Finalizer</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">8</span>
</span><span class='line'><span class="n">MainThread</span><span class="o">.</span><span class="na">time</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">3009</span>
</span><span class='line'><span class="n">startNormalThread</span> <span class="n">normalThread</span><span class="o">.</span><span class="na">time</span> <span class="n">cost</span><span class="o">=</span><span class="mi">10003</span>
</span><span class='line'><span class="n">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>   <span class="err">ç»“æŸè¿›ç¨‹</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°</p>

<ul>
<li> <code>startNormalThread normalThread.time cost=10003</code>ä»£è¡¨ç€å­çº¿ç¨‹æ‰§è¡Œç»“æŸï¼Œå…ˆäºåé¢çš„è¿›ç¨‹ç»“æŸæ‰§è¡Œã€‚</li>
<li> <code>Process finished with exit code 0</code>  ä»£è¡¨ ç»“æŸè¿›ç¨‹</li>
</ul>


<p>ä»¥ä¸Šæ—¥å¿—å¯ä»¥éªŒè¯è¿›ç¨‹æ˜¯åœ¨æˆ‘ä»¬å¯åŠ¨çš„å­çº¿ç¨‹ç»“æŸä¹‹åæ‰é€€å‡ºçš„ã€‚</p>

<h2>éªŒè¯JVMä¸ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹å°±ä¼šç»“æŸ</h2>

<p>å…¶å®ä¸Šé¢çš„ä¾‹å­ä¹Ÿå¯ä»¥éªŒè¯JVMä¸ç­‰å¾…JVMå¯åŠ¨çš„å®ˆæŠ¤çº¿ç¨‹(Reference Handler,Signal Dispatcherç­‰)æ‰§è¡Œç»“æŸå°±é€€å‡ºã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬å†æ¬¡ç”¨ä¸€æ®µä»£ç éªŒè¯ä¸€ä¸‹JVMä¸ç­‰å¾…ç”¨æˆ·å¯åŠ¨çš„å®ˆæŠ¤çº¿ç¨‹ç»“æŸå°±é€€å‡ºçš„äº‹å®ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testDaemonThread</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span><span class='line'>   <span class="n">Thread</span> <span class="n">daemonThreadSetByUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="s">&quot;daemonThreadSetByUser&quot;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="nd">@Override</span>
</span><span class='line'>       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">makeThreadSleep</span><span class="o">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>           <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span><span class='line'>           <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;daemonThreadSetByUser.time cost=&quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">));</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">};</span>
</span><span class='line'>   <span class="n">daemonThreadSetByUser</span><span class="o">.</span><span class="na">setDaemon</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>   <span class="n">daemonThreadSetByUser</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span><span class='line'>   <span class="c1">//ä¸»çº¿ç¨‹æš‚å®š3ç§’ï¼Œç¡®ä¿å­çº¿ç¨‹éƒ½å¯åŠ¨å®Œæˆ</span>
</span><span class='line'>   <span class="n">makeThreadSleep</span><span class="o">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>   <span class="n">dumpAllThreadsInfo</span><span class="o">();</span>
</span><span class='line'>   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;MainThread.time cost = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ç»“æœå¾—åˆ°çš„è¾“å‡ºæ—¥å¿—ä¸º</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Signal</span> <span class="n">Dispatcher</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">9</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Attach</span> <span class="n">Listener</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">9</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Monitor</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">Break</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Reference</span> <span class="n">Handler</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">10</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">main</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">daemonThreadSetByUser</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">main</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">5</span>
</span><span class='line'><span class="n">dumpAllThreadsInfo</span> <span class="n">thread</span><span class="o">.</span><span class="na">name</span><span class="o">=</span><span class="n">Finalizer</span><span class="o">;</span><span class="n">group</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ThreadGroup</span><span class="o">[</span><span class="n">name</span><span class="o">=</span><span class="n">system</span><span class="o">,</span><span class="n">maxpri</span><span class="o">=</span><span class="mi">10</span><span class="o">];</span><span class="n">isDaemon</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span><span class="n">priority</span><span class="o">=</span><span class="mi">8</span>
</span><span class='line'><span class="n">MainThread</span><span class="o">.</span><span class="na">time</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">3006</span>
</span><span class='line'>
</span><span class='line'><span class="n">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„æ—¥å¿—æ²¡æœ‰ç±»ä¼¼daemonThreadSetByUser.time cost=çš„ä¿¡æ¯ã€‚å¯ä»¥ç¡®å®šJVMæ²¡æœ‰ç­‰å¾…å®ˆæŠ¤çº¿ç¨‹ç»“æŸå°±é€€å‡ºäº†ã€‚</p>

<p>æ³¨æ„ï¼š</p>

<ul>
<li>æ–°çš„çº¿ç¨‹æ˜¯å¦åˆå§‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œå–å†³äºå¯åŠ¨è¯¥çº¿ç¨‹çš„çº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>å®ˆæŠ¤çº¿ç¨‹é»˜è®¤å¯åŠ¨çš„çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œéå®ˆæŠ¤çº¿ç¨‹å¯åŠ¨çš„çº¿ç¨‹é»˜è®¤ä¸ºéå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>ä¸»çº¿ç¨‹ï¼ˆéå®ˆæŠ¤çº¿ç¨‹ï¼‰å¯ç”¨ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œéœ€è¦è°ƒç”¨Thread.setDaemonæ¥è®¾ç½®å¯åŠ¨çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
</ul>


<h2>å…³äºPriorityä¸å®ˆæŠ¤çº¿ç¨‹çš„å…³ç³»</h2>

<p>æœ‰ä¸€ç§ä¼ è¨€ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§è¦ä½ï¼Œç„¶è€Œäº‹å®æ˜¯</p>

<ul>
<li>ä¼˜å…ˆçº§ä¸æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰å¿…ç„¶çš„è”ç³»</li>
<li>æ–°çš„çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¸åˆ›å»ºè¯¥çº¿ç¨‹çš„çº¿ç¨‹ä¼˜å…ˆçº§ä¸€è‡´ã€‚</li>
<li>ä½†æ˜¯å»ºè®®å°†å®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§é™ä½ä¸€äº›ã€‚</li>
</ul>


<p>æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±éªŒè¯ä¸€ä¸‹ï¼ˆå…¶å®ä¸Šé¢çš„ä»£ç å·²ç»æœ‰éªŒè¯äº†ï¼‰</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è¯¦è§£JVMå¦‚ä½•å¤„ç†å¼‚å¸¸]]></title>
    <link href="https://droidyue.com/blog/2018/10/21/how-jvm-handle-exceptions/"/>
    <updated>2018-10-21T20:14:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/10/21/how-jvm-handle-exceptions</id>
    <content type="html"><![CDATA[<p>æ— è®ºä½ æ˜¯ä½¿ç”¨ä½•ç§ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨æ—¥å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šä¸å¯é¿å…çš„è¦å¤„ç†å¼‚å¸¸ã€‚ä»Šå¤©æœ¬æ–‡å°†å°è¯•è®²è§£ä¸€äº›JVMå¦‚ä½•å¤„ç†å¼‚å¸¸é—®é¢˜ï¼Œå¸Œæœ›èƒ½å¤Ÿè®²æ¸…æ¥šè¿™ä¸ªå†…éƒ¨çš„æœºåˆ¶ï¼Œå¦‚æœå¯¹å¤§å®¶æœ‰æ‰€å¯å‘å’Œå¸®åŠ©ï¼Œåˆ™ç”šå¥½ã€‚</p>

<h2>å½“å¼‚å¸¸ä¸ä»…ä»…æ˜¯å¼‚å¸¸</h2>

<p>æˆ‘ä»¬åœ¨æ ‡é¢˜ä¸­æåˆ°äº†å¼‚å¸¸ï¼Œç„¶è€Œè¿™é‡ŒæŒ‡çš„å¼‚å¸¸å¹¶ä¸æ˜¯å•çº¯çš„Exceptionï¼Œè€Œæ˜¯æ›´ä¸ºå®½æ³›çš„Throwableã€‚åªæ˜¯æˆ‘ä»¬å·¥ä½œä¸­ä¹ ä»¥ä¸ºå¸¸çš„å°†å®ƒä»¬ï¼ˆé”™è¯¯åœ°ï¼‰è¿™æ ·ç§°è°“ã€‚</p>

<p>å…³äºExceptionå’ŒThrowableçš„å…³ç³»ç®€å•æè¿°ä¸€ä¸‹</p>

<ul>
<li>Exceptionå±äºThrowableçš„å­ç±»ï¼ŒThrowableçš„å¦ä¸€ä¸ªé‡è¦çš„å­ç±»æ˜¯Error</li>
<li>throwå¯ä»¥æŠ›å‡ºçš„éƒ½æ˜¯Throwableå’Œå…¶å­ç±»ï¼Œcatchå¯æ•è·çš„ä¹Ÿæ˜¯Throwableå’Œå…¶å­ç±»ã€‚</li>
</ul>


<!--more-->


<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½†æ˜¯Exceptionä¹Ÿæœ‰ä¸€äº›éœ€è¦æˆ‘ä»¬å†æ¬¡å¼ºè°ƒçš„</p>

<ul>
<li>Exceptionåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç§ä¸ºChecked Exceptionï¼Œå¦ä¸€ç§ä¸ºunchecked Exception</li>
<li>Checked Exceptionï¼Œæ¯”å¦‚æœ€å¸¸è§çš„IOExceptionï¼Œè¿™ç§å¼‚å¸¸éœ€è¦è°ƒç”¨å¤„æ˜¾å¼å¤„ç†ï¼Œè¦ä¹ˆä½¿ç”¨try catchæ•è·ï¼Œè¦ä¹ˆå†æ¬¡æŠ›å‡ºå»ã€‚</li>
<li>Unchecked ExceptionæŒ‡çš„æ˜¯æ‰€æœ‰ç»§æ‰¿è‡ªErrorï¼ˆåŒ…å«è‡ªèº«ï¼‰æˆ–è€…æ˜¯RuntimeExceptionï¼ˆåŒ…å«è‡ªèº«ï¼‰çš„ç±»ã€‚è¿™äº›å¼‚å¸¸ä¸å¼ºåˆ¶åœ¨è°ƒç”¨å¤„è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥try catchå¤„ç†ã€‚</li>
</ul>


<p>æ³¨ï¼šæœ¬æ–‡æš‚ä¸åšChecked Exceptionè®¾è®¡çš„å¥½åçš„åˆ†æã€‚</p>

<h2>Exception Table å¼‚å¸¸è¡¨</h2>

<p>æåˆ°JVMå¤„ç†å¼‚å¸¸çš„æœºåˆ¶ï¼Œå°±éœ€è¦æåŠException Tableï¼Œä»¥ä¸‹ç§°ä¸ºå¼‚å¸¸è¡¨ã€‚æˆ‘ä»¬æš‚ä¸”ä¸æ€¥äºä»‹ç»å¼‚å¸¸è¡¨ï¼Œå…ˆçœ‹ä¸€ä¸ªç®€å•çš„Javaå¤„ç†å¼‚å¸¸çš„å°ä¾‹å­ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">simpleTryCatch</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">testNPE</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œç”¨æ¥æ•è·å¤„ç†ä¸€ä¸ªæ½œåœ¨çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p>

<p>å½“ç„¶å¦‚æœåªæ˜¯çœ‹ç®€ç®€å•å•çš„ä»£ç ï¼Œæˆ‘ä»¬å¾ˆéš¾çœ‹å‡ºä»€ä¹ˆé«˜æ·±ä¹‹å¤„ï¼Œæ›´æ²¡æœ‰äº†ä»Šå¤©æ–‡ç« è¦è°ˆè®ºçš„å†…å®¹ã€‚</p>

<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€æŠŠç¥å…µåˆ©å™¨ï¼Œå®ƒå°±æ˜¯javap,ä¸€ä¸ªç”¨æ¥æ‹†è§£classæ–‡ä»¶çš„å·¥å…·ï¼Œå’Œjavacä¸€æ ·ç”±JDKæä¾›ã€‚</p>

<p>ç„¶åæˆ‘ä»¬ä½¿ç”¨javapæ¥åˆ†æè¿™æ®µä»£ç ï¼ˆéœ€è¦å…ˆä½¿ç”¨javacç¼–è¯‘ï¼‰</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//javap -c Main</span>
</span><span class='line'> <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">simpleTryCatch</span><span class="o">();</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// Method testNPE:()V</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">11</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">astore_0</span>
</span><span class='line'>       <span class="mi">7</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>       <span class="mi">8</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/Exception.printStackTrace:()V</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>    <span class="n">Exception</span> <span class="nl">table:</span>
</span><span class='line'>       <span class="n">from</span>    <span class="n">to</span>  <span class="n">target</span> <span class="n">type</span>
</span><span class='line'>           <span class="mi">0</span>     <span class="mi">3</span>     <span class="mi">6</span>   <span class="n">Class</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Exception</span>
</span></code></pre></td></tr></table></div></figure>


<p>çœ‹åˆ°ä¸Šé¢çš„ä»£ç ï¼Œåº”è¯¥ä¼šæœ‰ä¼šå¿ƒä¸€ç¬‘ï¼Œå› ä¸ºç»ˆäºçœ‹åˆ°äº†Exception tableï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦ç ”ç©¶çš„å¼‚å¸¸è¡¨ã€‚</p>

<p>å¼‚å¸¸è¡¨ä¸­åŒ…å«äº†ä¸€ä¸ªæˆ–å¤šä¸ªå¼‚å¸¸å¤„ç†è€…(Exception Handler)çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åŒ…å«å¦‚ä¸‹</p>

<ul>
<li>from å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„èµ·å§‹ç‚¹</li>
<li>to å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ç»“æŸç‚¹</li>
<li>target ä¸Šè¿°fromå’Œtoä¹‹å‰å‘ç”Ÿå¼‚å¸¸åçš„å¼‚å¸¸å¤„ç†è€…çš„ä½ç½®</li>
<li>type å¼‚å¸¸å¤„ç†è€…å¤„ç†çš„å¼‚å¸¸çš„ç±»ä¿¡æ¯</li>
</ul>


<h2>é‚£ä¹ˆå¼‚å¸¸è¡¨ç”¨åœ¨ä»€ä¹ˆæ—¶å€™å‘¢</h2>

<p>ç­”æ¡ˆæ˜¯å¼‚å¸¸å‘ç”Ÿçš„æ—¶å€™ï¼Œå½“ä¸€ä¸ªå¼‚å¸¸å‘ç”Ÿæ—¶</p>

<p>1.JVMä¼šåœ¨å½“å‰å‡ºç°å¼‚å¸¸çš„æ–¹æ³•ä¸­ï¼ŒæŸ¥æ‰¾å¼‚å¸¸è¡¨ï¼Œæ˜¯å¦æœ‰åˆé€‚çš„å¤„ç†è€…æ¥å¤„ç†</p>

<p>2.å¦‚æœå½“å‰æ–¹æ³•å¼‚å¸¸è¡¨ä¸ä¸ºç©ºï¼Œå¹¶ä¸”å¼‚å¸¸ç¬¦åˆå¤„ç†è€…çš„fromå’ŒtoèŠ‚ç‚¹ï¼Œå¹¶ä¸”typeä¹ŸåŒ¹é…ï¼Œåˆ™JVMè°ƒç”¨ä½äºtargetçš„è°ƒç”¨è€…æ¥å¤„ç†ã€‚</p>

<p>3.å¦‚æœä¸Šä¸€æ¡æœªæ‰¾åˆ°åˆç†çš„å¤„ç†è€…ï¼Œåˆ™ç»§ç»­æŸ¥æ‰¾å¼‚å¸¸è¡¨ä¸­çš„å‰©ä½™æ¡ç›®</p>

<p>4.å¦‚æœå½“å‰æ–¹æ³•çš„å¼‚å¸¸è¡¨æ— æ³•å¤„ç†ï¼Œåˆ™å‘ä¸ŠæŸ¥æ‰¾ï¼ˆå¼¹æ ˆå¤„ç†ï¼‰åˆšåˆšè°ƒç”¨è¯¥æ–¹æ³•çš„è°ƒç”¨å¤„ï¼Œå¹¶é‡å¤ä¸Šé¢çš„æ“ä½œã€‚</p>

<p>5.å¦‚æœæ‰€æœ‰çš„æ ˆå¸§è¢«å¼¹å‡ºï¼Œä»ç„¶æ²¡æœ‰å¤„ç†ï¼Œåˆ™æŠ›ç»™å½“å‰çš„Threadï¼ŒThreadåˆ™ä¼šç»ˆæ­¢ã€‚</p>

<p>6.å¦‚æœå½“å‰Threadä¸ºæœ€åä¸€ä¸ªéå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸”æœªå¤„ç†å¼‚å¸¸ï¼Œåˆ™ä¼šå¯¼è‡´JVMç»ˆæ­¢è¿è¡Œã€‚</p>

<p>ä»¥ä¸Šå°±æ˜¯JVMå¤„ç†å¼‚å¸¸çš„ä¸€äº›æœºåˆ¶ã€‚</p>

<h2>try catch -finally</h2>

<p>é™¤äº†ç®€å•çš„try-catchå¤–ï¼Œæˆ‘ä»¬è¿˜å¸¸å¸¸å’Œfinallyåšç»“åˆä½¿ç”¨ã€‚æ¯”å¦‚è¿™æ ·çš„ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">simpleTryCatchFinally</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">testNPE</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Finally&quot;</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åŒæ ·æˆ‘ä»¬ä½¿ç”¨javapåˆ†æä¸€ä¸‹ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">simpleTryCatchFinally</span><span class="o">();</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// Method testNPE:()V</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>       <span class="mi">8</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">41</span>
</span><span class='line'>      <span class="mi">14</span><span class="o">:</span> <span class="n">astore_0</span>
</span><span class='line'>      <span class="mi">15</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>      <span class="mi">16</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/Exception.printStackTrace:()V</span>
</span><span class='line'>      <span class="mi">19</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">22</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>      <span class="mi">24</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">27</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">41</span>
</span><span class='line'>      <span class="mi">30</span><span class="o">:</span> <span class="n">astore_1</span>
</span><span class='line'>      <span class="mi">31</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">34</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>      <span class="mi">36</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">39</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>      <span class="mi">40</span><span class="o">:</span> <span class="n">athrow</span>
</span><span class='line'>      <span class="mi">41</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>    <span class="n">Exception</span> <span class="nl">table:</span>
</span><span class='line'>       <span class="n">from</span>    <span class="n">to</span>  <span class="n">target</span> <span class="n">type</span>
</span><span class='line'>           <span class="mi">0</span>     <span class="mi">3</span>    <span class="mi">14</span>   <span class="n">Class</span> <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="n">Exception</span>
</span><span class='line'>           <span class="mi">0</span>     <span class="mi">3</span>    <span class="mi">30</span>   <span class="n">any</span>
</span><span class='line'>          <span class="mi">14</span>    <span class="mi">19</span>    <span class="mi">30</span>   <span class="n">any</span>
</span></code></pre></td></tr></table></div></figure>


<p>å’Œä¹‹å‰æœ‰æ‰€ä¸åŒï¼Œè¿™æ¬¡</p>

<ul>
<li>å¼‚å¸¸è¡¨ä¸­ï¼Œæœ‰ä¸‰æ¡æ•°æ®ï¼Œè€Œæˆ‘ä»¬ä»…ä»…æ•è·äº†ä¸€ä¸ªException</li>
<li>å¼‚å¸¸è¡¨çš„åä¸¤ä¸ªitemçš„typeä¸ºany</li>
</ul>


<p>ä¸Šé¢çš„ä¸‰æ¡å¼‚å¸¸è¡¨itemçš„æ„æ€ä¸º</p>

<ul>
<li>å¦‚æœ0åˆ°3ä¹‹é—´ï¼Œå‘ç”Ÿäº†Exceptionç±»å‹çš„å¼‚å¸¸ï¼Œè°ƒç”¨14ä½ç½®çš„å¼‚å¸¸å¤„ç†è€…ã€‚</li>
<li>å¦‚æœ0åˆ°3ä¹‹é—´ï¼Œæ— è®ºå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½è°ƒç”¨30ä½ç½®çš„å¤„ç†è€…</li>
<li>å¦‚æœ14åˆ°19ä¹‹é—´ï¼ˆå³catchéƒ¨åˆ†ï¼‰ï¼Œä¸è®ºå‘ç”Ÿä»€ä¹ˆå¼‚å¸¸ï¼Œéƒ½è°ƒç”¨30ä½ç½®çš„å¤„ç†è€…ã€‚</li>
</ul>


<p>å†æ¬¡åˆ†æä¸Šé¢çš„Javaä»£ç ï¼Œfinallyé‡Œé¢çš„éƒ¨åˆ†å·²ç»è¢«æå–åˆ°äº†tryéƒ¨åˆ†å’Œcatchéƒ¨åˆ†ã€‚æˆ‘ä»¬å†æ¬¡è°ƒä¸€ä¸‹ä»£ç æ¥çœ‹ä¸€ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">simpleTryCatchFinally</span><span class="o">();</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>      <span class="c1">//try éƒ¨åˆ†æå–finallyä»£ç ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™æ‰§è¡Œè¾“å‡ºfinallyæ“ä½œï¼Œç›´è‡³gotoåˆ°41ä½ç½®ï¼Œæ‰§è¡Œè¿”å›æ“ä½œã€‚  </span>
</span><span class='line'>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// Method testNPE:()V</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>       <span class="mi">8</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">41</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//catchéƒ¨åˆ†æå–finallyä»£ç ï¼Œå¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œåˆ™æ‰§è¡Œè¾“å‡ºfinallyæ“ä½œï¼Œç›´è‡³æ‰§è¡Œgotåˆ°41ä½ç½®ï¼Œæ‰§è¡Œè¿”å›æ“ä½œã€‚</span>
</span><span class='line'>      <span class="mi">14</span><span class="o">:</span> <span class="n">astore_0</span>
</span><span class='line'>      <span class="mi">15</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>      <span class="mi">16</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">5</span>                  <span class="c1">// Method java/lang/Exception.printStackTrace:()V</span>
</span><span class='line'>      <span class="mi">19</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">22</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>      <span class="mi">24</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">27</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">41</span>
</span><span class='line'>      <span class="c1">//finallyéƒ¨åˆ†çš„ä»£ç å¦‚æœè¢«è°ƒç”¨ï¼Œæœ‰å¯èƒ½æ˜¯tryéƒ¨åˆ†ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯catchéƒ¨åˆ†å‘ç”Ÿå¼‚å¸¸ã€‚</span>
</span><span class='line'>      <span class="mi">30</span><span class="o">:</span> <span class="n">astore_1</span>
</span><span class='line'>      <span class="mi">31</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">34</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// String Finally</span>
</span><span class='line'>      <span class="mi">36</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">39</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>      <span class="mi">40</span><span class="o">:</span> <span class="n">athrow</span>     <span class="c1">//å¦‚æœå¼‚å¸¸æ²¡æœ‰è¢«catchæ•è·ï¼Œè€Œæ˜¯åˆ°äº†è¿™é‡Œï¼Œæ‰§è¡Œå®Œfinallyçš„è¯­å¥åï¼Œä»ç„¶è¦æŠŠè¿™ä¸ªå¼‚å¸¸æŠ›å‡ºå»ï¼Œä¼ é€’ç»™è°ƒç”¨å¤„ã€‚</span>
</span><span class='line'>      <span class="mi">41</span><span class="o">:</span> <span class="k">return</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Catchå…ˆåé¡ºåºçš„é—®é¢˜</h2>

<p>æˆ‘ä»¬åœ¨ä»£ç ä¸­çš„catchçš„é¡ºåºå†³å®šäº†å¼‚å¸¸å¤„ç†è€…åœ¨å¼‚å¸¸è¡¨çš„ä½ç½®ï¼Œæ‰€ä»¥ï¼Œè¶Šæ˜¯å…·ä½“çš„å¼‚å¸¸è¦å…ˆå¤„ç†ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸‹é¢çš„é—®é¢˜</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">misuseCatchException</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">testNPE</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">t</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//error occurs during compilings with tips Exception Java.lang.Exception has already benn caught.</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™æ®µä»£ç ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼Œå› ä¸ºå…ˆæ•è·Throwableåæ•è·Exceptionï¼Œä¼šå¯¼è‡´åé¢çš„catchæ°¸è¿œæ— æ³•è¢«æ‰§è¡Œã€‚</p>

<h2>Return å’Œfinallyçš„é—®é¢˜</h2>

<p>è¿™ç®—æ˜¯æˆ‘ä»¬æ‰©å±•çš„ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒæç«¯çš„é—®é¢˜ï¼Œå°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼Œæ—¢æœ‰returnï¼Œåˆæœ‰finallyï¼Œé‚£ä¹ˆfinallyå¯¼è‡´ä¼šä¸ä¼šæ‰§è¡Œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">tryCatchReturn</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">testNPE</span><span class="o">();</span>
</span><span class='line'>       <span class="k">return</span>  <span class="s">&quot;OK&quot;</span><span class="o">;</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="s">&quot;ERROR&quot;</span><span class="o">;</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;tryCatchReturn&quot;</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç­”æ¡ˆæ˜¯finallyä¼šæ‰§è¡Œï¼Œé‚£ä¹ˆè¿˜æ˜¯ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸ºä»€ä¹ˆfinallyä¼šæ‰§è¡Œã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span> <span class="nf">tryCatchReturn</span><span class="o">();</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">3</span>                  <span class="c1">// Method testNPE:()V</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">6</span>                  <span class="c1">// String OK</span>
</span><span class='line'>       <span class="mi">5</span><span class="o">:</span> <span class="n">astore_0</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>       <span class="mi">9</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// String tryCatchReturn</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">9</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">14</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>      <span class="mi">15</span><span class="o">:</span> <span class="n">areturn</span>       <span class="err">è¿”å›</span><span class="n">OK</span><span class="err">å­—ç¬¦ä¸²ï¼Œ</span><span class="n">areturn</span><span class="err">æ„æ€ä¸º</span><span class="k">return</span> <span class="n">a</span> <span class="n">reference</span> <span class="n">from</span> <span class="n">a</span> <span class="n">method</span>
</span><span class='line'>      <span class="mi">16</span><span class="o">:</span> <span class="n">astore_0</span>
</span><span class='line'>      <span class="mi">17</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">10</span>                 <span class="c1">// String ERROR</span>
</span><span class='line'>      <span class="mi">19</span><span class="o">:</span> <span class="n">astore_1</span>
</span><span class='line'>      <span class="mi">20</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">23</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// String tryCatchReturn</span>
</span><span class='line'>      <span class="mi">25</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">9</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">28</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>      <span class="mi">29</span><span class="o">:</span> <span class="n">areturn</span>  <span class="c1">//è¿”å›ERRORå­—ç¬¦ä¸²</span>
</span><span class='line'>      <span class="mi">30</span><span class="o">:</span> <span class="n">astore_2</span>
</span><span class='line'>      <span class="mi">31</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">7</span>                  <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">34</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">8</span>                  <span class="c1">// String tryCatchReturn</span>
</span><span class='line'>      <span class="mi">36</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">9</span>                  <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
</span><span class='line'>      <span class="mi">39</span><span class="o">:</span> <span class="n">aload_2</span>
</span><span class='line'>      <span class="mi">40</span><span class="o">:</span> <span class="n">athrow</span>  <span class="err">å¦‚æœ</span><span class="k">catch</span><span class="err">æœ‰æœªå¤„ç†çš„å¼‚å¸¸ï¼ŒæŠ›å‡ºå»ã€‚</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¡Œæ–‡ä»“ä¿ƒï¼ŒåŠ ä¹‹æœ¬äººæ°´å¹³æœ‰é™ï¼Œæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¯·æŒ‡å‡ºã€‚</p>

<p>å‚è€ƒæ–‡ç« ï¼š</p>

<ul>
<li><a href="http://blog.jamesdbloom.com/JVMInternals.html#exception_table">http://blog.jamesdbloom.com/JVMInternals.html#exception_table</a></li>
<li><a href="https://blog.takipi.com/the-surprising-truth-of-java-exceptions-what-is-really-going-on-under-the-hood/">https://blog.takipi.com/the-surprising-truth-of-java-exceptions-what-is-really-going-on-under-the-hood/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Java_bytecode_instruction_listings">https://en.wikipedia.org/wiki/Java_bytecode_instruction_listings</a></li>
<li><a href="https://dzone.com/articles/the-truth-of-java-exceptions-whats-really-going-on">https://dzone.com/articles/the-truth-of-java-exceptions-whats-really-going-on</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æœ‰ç‚¹æ„æ€çš„Kotlinçš„é»˜è®¤å‚æ•°ä¸JVMOverloads]]></title>
    <link href="https://droidyue.com/blog/2018/10/14/dive-into-kotlin-default-arguments-and-jvmoverloads/"/>
    <updated>2018-10-14T19:18:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/10/14/dive-into-kotlin-default-arguments-and-jvmoverloads</id>
    <content type="html"><![CDATA[<p>åœ¨Javaä¸­ï¼Œå½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œæ€»ä¼šå‡ºç°ä¸€äº›å˜é‡æ˜¯å¿…é¡»è¦å¡«å†™çš„ï¼Œè€Œå¦ä¸€äº›æ˜¯å¯é€‰çš„ã€‚æ¯”å¦‚åƒä¸‹é¢è¿™æ ·ï¼Œæˆ‘ä»¬å®šä¸€ä¸ªPersonç±»ï¼Œå…¶ä¸­nameæ˜¯å¿…é¡»å¡«å†™çš„ï¼Œè€Œæ€§åˆ«sexå’ŒisChineseå¯é€‰ï¼Œå¦‚æœä¸å¡«å†™å°±ç›´æ¥ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>

<!--more-->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span><span class='line'>   <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{}</span>
</span><span class='line'>   <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sex</span><span class="o">)</span> <span class="o">{}</span>
</span><span class='line'>   <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChinese</span><span class="o">){}</span>
</span><span class='line'>   <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sex</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChinese</span><span class="o">)</span> <span class="o">{}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å½“ä»…ä»…åªæœ‰è¿™ä¸¤ä¸ªå¯é€‰å‚æ•°æ—¶ï¼Œä¸Šè¿°çš„æƒ…å†µè¿˜å¥½å¾ˆå¤šï¼Œå¯æ˜¯å½“æ–°å¢äº†å…¶ä»–çš„å±æ€§çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å®ç°æ›´å¤šçš„æ„é€ æ–¹æ³•é‡è½½ã€‚è¿™åœ¨Javaä¸­æ›´åŠ å®¹æ˜“å‡ºç°telescoping constructorçš„é—®é¢˜,è¿›è€Œå½±å“æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡å’Œä»£ç å¯è¯»æ€§ã€‚</p>

<p>åœ¨Kotlinä¸­ï¼Œè¿™ç§é—®é¢˜å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ã€‚è¿™ä¾¿æ˜¯è¦æåˆ°çš„æ–¹æ³•çš„é»˜è®¤å‚æ•°ï¼Œå…¶å®è¿™ä¸ªå¾ˆç®€å•ï¼Œåœ¨å…¶ä»–çš„è¯­è¨€ä¹Ÿæ˜¯æ”¯æŒçš„ã€‚</p>

<p>ä¾¿äºå¤§å®¶ç†è§£ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€çœ‹é»˜è®¤å‚æ•°æ˜¯ä»€ä¹ˆï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªBookçš„ç±»å’Œå®ƒçš„æ„é€ æ–¹æ³•ï¼ˆKotlinä»£ç ï¼‰</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nf">Book</span><span class="o">(</span><span class="n">var</span> <span class="nl">name:</span> <span class="n">String</span><span class="o">,</span> <span class="n">val</span> <span class="nl">isChineseBook:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
</span><span class='line'>          <span class="n">val</span> <span class="nl">hasMultipleAuthor:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">val</span> <span class="nl">isPopular:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span>
</span><span class='line'>           <span class="n">val</span> <span class="nl">isForChildren:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„Kotlinä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">1</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book0&quot;</span><span class="o">)</span>
</span><span class='line'><span class="mi">2</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book1&quot;</span><span class="o">,</span> <span class="n">isForChildren</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
</span><span class='line'><span class="mi">3</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book2&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="mi">4</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book3&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="mi">5</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book4&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="mi">6</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book5&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å¡«å†™å¿…è¦çš„å‚æ•°å€¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åƒç¬¬1è¡Œ<code>Book("Book1", isForChildren = false)</code> ä¸æŒ‰ç…§é¡ºåºå¡«å†™å‚æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆèµçš„ç‰¹æ€§ï¼Œèƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šå¢å¼ºä»£ç çš„å¯è¯»æ€§ã€‚</p>

<p>ä½†æ˜¯Kotlinçš„è¿™ä¸€ç‰¹æ€§ï¼Œåªåº”ç”¨äºKotlinä»£ç è°ƒç”¨çš„åœºæ™¯ï¼Œå¦‚æœæ˜¯åœ¨Javaä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¿…é¡»è¦å¡«å†™å®Œæ•´çš„å‚æ•°ã€‚è¿™ä¸€ç‚¹ç€å®ä»¤äººæ²®ä¸§ã€‚ä¸è¿‡è¿˜åœ¨æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨@JvmOverloadsæ³¨è§£ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">People</span> <span class="nd">@JvmOverloads</span> <span class="n">constructor</span><span class="o">(</span><span class="n">val</span> <span class="nl">name:</span> <span class="n">String</span><span class="o">,</span> <span class="n">val</span> <span class="nl">sex:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">val</span> <span class="nl">isChinese:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨Javaä¸­è°ƒç”¨ç¤ºä¾‹æ•ˆæœ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">//call constructor with JVMOverloads</span>
</span><span class='line'><span class="n">People</span> <span class="n">people</span> <span class="o">=</span> <span class="k">new</span> <span class="n">People</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">People</span> <span class="n">people1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">People</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="n">People</span> <span class="n">people2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">People</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>é‚£ä¹ˆJvmOverloadsæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ</p>

<p>å…¶å®@JvmOverloadsçš„ä½œç”¨å°±æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè‡ªåŠ¨ç”Ÿæˆå¤šä¸ªè¯¥æ–¹æ³•çš„é‡è½½ã€‚å› ä¸ºæˆ‘ä»¬é€šè¿‡åç¼–è¯‘åˆ†æå³å¯éªŒè¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@JvmOverloads</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">People</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sex</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChinese</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Intrinsics</span><span class="o">.</span><span class="na">checkParameterIsNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">sex</span> <span class="o">=</span> <span class="n">sex</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">isChinese</span> <span class="o">=</span> <span class="n">isChinese</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $FF: synthetic method</span>
</span><span class='line'><span class="nd">@JvmOverloads</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">People</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var2</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var3</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var4</span><span class="o">,</span> <span class="n">DefaultConstructorMarker</span> <span class="n">var5</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var4</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var4</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var3</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var3</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@JvmOverloads</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">People</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">sex</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@JvmOverloads</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">People</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼Œä¸Šé¢çš„é‡è½½æ–¹æ³•å¹¶æ²¡æœ‰æŒ‰ç…§ç»„åˆæ¥ç”Ÿæˆï¼Œæ¯”å¦‚<code>public People(@NotNull String name, int sex, boolean isChinese)</code>,å› ä¸ºè¿™æ ·ä¹Ÿæ˜¯å‡ºäºå¯è¯»æ€§æ¥è€ƒè™‘å’Œé¿å…æ½œåœ¨æ–¹æ³•ç­¾åå†²çªé—®é¢˜ã€‚</p>

<p>æœ€åï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹Kotlinä¸­é»˜è®¤å‚æ•°çš„å®ç°åŸç†ã€‚å› ä¸ºè¿™é‡Œé¢å­˜åœ¨ç€ä¸€äº›ç¨‹åºè®¾è®¡çš„å·§å¦™ä¹‹å¤„ã€‚</p>

<p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨åˆšåˆšæåˆ°çš„Bookè¿™ä¸ªç±»</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nf">Book</span><span class="o">(</span><span class="n">var</span> <span class="nl">name:</span> <span class="n">String</span><span class="o">,</span> <span class="n">val</span> <span class="nl">isChineseBook:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span>
</span><span class='line'>          <span class="n">val</span> <span class="nl">hasMultipleAuthor:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">val</span> <span class="nl">isPopular:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span>
</span><span class='line'>           <span class="n">val</span> <span class="nl">isForChildren:</span> <span class="n">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é€šè¿‡åç¼–è¯‘ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€äº›ç±»ä¼¼è¿™æ ·çš„ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isChineseBook</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">hasMultipleAuthor</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isPopular</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isForChildren</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Intrinsics</span><span class="o">.</span><span class="na">checkParameterIsNotNull</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">super</span><span class="o">();</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">isChineseBook</span> <span class="o">=</span> <span class="n">isChineseBook</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">hasMultipleAuthor</span> <span class="o">=</span> <span class="n">hasMultipleAuthor</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">isPopular</span> <span class="o">=</span> <span class="n">isPopular</span><span class="o">;</span>
</span><span class='line'>  <span class="k">this</span><span class="o">.</span><span class="na">isForChildren</span> <span class="o">=</span> <span class="n">isForChildren</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// $FF: synthetic method</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var2</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var3</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var4</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var5</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var6</span><span class="o">,</span> <span class="n">DefaultConstructorMarker</span> <span class="n">var7</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var2</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var3</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var4</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var5</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var3</span><span class="o">,</span> <span class="n">var4</span><span class="o">,</span> <span class="n">var5</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ˜¯ä¸æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå®ƒåªç”Ÿæˆäº†ä¸¤ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œä¸æ˜¯æ‰€è°“çš„å¤šä¸ªå‚æ•°ç»„åˆçš„æ„é€ æ–¹æ³•ã€‚æ›´æœ‰æ„æ€çš„æ˜¯ï¼Œå½“æˆ‘ä»¬è¿™æ ·è°ƒç”¨æ—¶</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book0&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book2&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book3&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book4&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span><span class='line'><span class="n">Book</span><span class="o">(</span><span class="s">&quot;Book5&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…¶å¯¹åº”çš„å­—èŠ‚ç åç¼–è¯‘æˆjavaæ˜¯</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="s">&quot;Book0&quot;</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="s">&quot;Book2&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">28</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="s">&quot;Book3&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">24</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="s">&quot;Book4&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="o">(</span><span class="n">DefaultConstructorMarker</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="s">&quot;Book5&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬ä¼šæ³¨æ„åˆ°ä¸Šé¢æœ‰å¾ˆå¤šæ•°å­—ï¼Œæ¯”å¦‚30,14,28,24,16ç­‰ã€‚é‚£ä¹ˆè¿™äº›æ•°å­—æ˜¯æ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿ</p>

<p>å¯¹äºæ„é€ æ–¹æ³•çš„æ¯ä¸ªå‚æ•°ï¼Œ</p>

<ul>
<li>éƒ½æœ‰ä¸€ä¸ªä½ç½®ï¼Œå³æ–¹æ³•å£°æ˜æ—¶æ‰€åœ¨çš„ä½ç½®ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨iä»£æ›¿è¡¨ç¤ºã€‚æ³¨æ„è¯¥ä»0å¼€å§‹ï¼Œ</li>
<li>æ¯ä¸ªå‚æ•°æœ‰ä¸€ä¸ªmaskå€¼ï¼Œè¯¥å€¼ä¸º2çš„iæ¬¡æ–¹ï¼Œæ¯”å¦‚ç¬¬0ä¸ªä½ç½®çš„å‚æ•°çš„maskå€¼ä¸º1ï¼Œç¬¬1ä¸ªä½ç½®çš„maskå€¼ä¸º2ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>å¦‚æœåœ¨è°ƒç”¨æ—¶ï¼Œç¼–è¯‘å™¨æ£€æµ‹åˆ°æŸäº›å‚æ•°æ²¡æœ‰è°ƒç”¨ï¼Œå°±å°†è¿™äº›å‚æ•°çš„maskå€¼ï¼Œæ±‚å’Œï¼Œä¾¿ç”Ÿæˆäº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„æ•°å­—ã€‚</li>
</ul>


<p>å…·ä½“ç¤ºä¾‹å¦‚ä¸‹</p>

<p><img src="https://asset.droidyue.com/image/kotlin_jvm_overloads.png" alt="https://asset.droidyue.com/image/kotlin_jvm_overloads.png" /></p>

<p>æ¯”å¦‚Book(&ldquo;Book0&rdquo;)æˆ‘ä»¬ä¼ é€’äº†ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æœ€åçš„30 å°±æ˜¯ç”± 2 + 4 + 8 + 16 è¿™äº›ç¼ºå¤±çš„ä½ç½®çš„maskå€¼è®¡ç®—å¾—å‡ºæ¥çš„ã€‚</p>

<p>çŸ¥é“äº†ï¼Œmaskå€¼çš„ç”Ÿæˆè§„åˆ™ï¼Œå°±ä¾¿äºæˆ‘ä»¬ç†è§£ç¼–è¯‘å™¨ç”Ÿæˆçš„æ„é€ æ–¹æ³•äº†ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// $FF: synthetic method</span>
</span><span class='line'><span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var2</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var3</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var4</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">var5</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var6</span><span class="o">,</span> <span class="n">DefaultConstructorMarker</span> <span class="n">var7</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var2</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var3</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var4</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="o">((</span><span class="n">var6</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="o">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="n">var5</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="o">(</span><span class="n">var1</span><span class="o">,</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var3</span><span class="o">,</span> <span class="n">var4</span><span class="o">,</span> <span class="n">var5</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…¶å®è¿™ä¸ªæ„é€ æ–¹æ³•å°±æ˜¯æ ¹æ®æ ¹æ®maskåˆ¤æ–­ï¼ŒæŸä¸ªä½ç½®çš„å‚æ•°æ˜¯å¦åœ¨è°ƒç”¨æ—¶è¿›è¡Œäº†èµ‹å€¼ï¼Œå¦‚æœæ²¡æœ‰èµ‹å€¼åˆ™è¿›è¡Œè®¾ç½®é»˜è®¤å€¼æ“ä½œã€‚</p>

<p>è¿™ç§ä½¿ç”¨maskæˆ–è€…flagçš„æ–¹æ³•å…¶å®å¾ˆå·§ï¼Œå‡å°‘äº†ä¸€äº›ä¸å¿…è¦çš„é‡è½½æ–¹æ³•çš„ç”Ÿæˆã€‚å¯¹äºæˆ‘ä»¬ä»¥åå¤„ç†ç±»ä¼¼çš„é—®é¢˜ï¼Œæä¾›äº†ä¸€äº›ä¸è¿‡çš„æ€è·¯å’Œå‚è€ƒä»·å€¼ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æ¢ç©¶Kotlinçš„å±€éƒ¨æ–¹æ³•]]></title>
    <link href="https://droidyue.com/blog/2018/10/07/dive-into-kotlins-local-function/"/>
    <updated>2018-10-07T19:47:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/10/07/dive-into-kotlins-local-function</id>
    <content type="html"><![CDATA[<p>åœ¨Kotlinä¸­ï¼Œå®šä¹‰æ–¹æ³•å¾ˆæœ‰è¶£ï¼Œä¸ä»…ä»…å› ä¸ºæ–¹æ³•çš„å…³é”®å­—æ˜¯fun(functionå‰å‡ ä¸ªå­—ç¬¦)ï¼Œè¿˜æ˜¯å› ä¸ºä½ ä¼šæƒŠå¥‡çš„å‘ç°ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨æ–¹æ³•ä¸­å®šä¹‰æ–¹æ³•ã€‚å¦‚ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">fun</span> <span class="nf">methodA</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">fun</span> <span class="nf">methodB</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="n">methodB</span><span class="o">()</span> <span class="c1">//valid</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//methodB() invalid</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>å…¶ä¸­</p>

<ul>
<li>methodBå®šä¹‰åœ¨methodAçš„æ–¹æ³•ä½“ä¸­ï¼Œå³methodBè¢«ç§°ä¸ºå±€éƒ¨æ–¹æ³•æˆ–å±€éƒ¨å‡½æ•°</li>
<li>methodBåªèƒ½åœ¨methodAä¸­æ–¹æ³•è°ƒç”¨</li>
<li>methodBåœ¨methodAæ–¹æ³•å¤–è°ƒç”¨ï¼Œä¼šå¼•èµ·ç¼–è¯‘é”™è¯¯</li>
</ul>


<p>æ—¢ç„¶Kotlinæ”¯æŒäº†å±€éƒ¨æ–¹æ³•ï¼Œç›¸æ¯”å®ƒåº”è¯¥æœ‰ä»€ä¹ˆç‰¹æ®Šçš„ç”¨æ­¦ä¹‹åœ°å‘¢</p>

<p>é¦–å…ˆå®ƒçš„ç‰¹ç‚¹è¿˜æ˜¯åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå±€éƒ¨ï¼Œè¿™å°±æ„å‘³ç€å®ƒæœ‰ç€æ— å¯æ¯”æ‹Ÿçš„æ›´å°èŒƒå›´çš„é™å®šèƒ½åŠ›ã€‚ä¿è¯äº†å°èŒƒå›´çš„å¯ç”¨æ€§ï¼Œéš”ç»äº†æ½œåœ¨çš„ä¸ç›¸å…³è°ƒç”¨çš„å¯èƒ½ã€‚</p>

<p>ä½œä¸ºç¼–ç¨‹ä¸­çš„é‡‘ç§‘ç‰å¾‹ï¼Œæ–¹æ³•è¶Šå°è¶Šå¥½ï¼Œç›¸æ¯”çºµå‘å†—é•¿çš„ä»£ç ç‰‡æ®µï¼Œå°†å…¶æŒ‰ç…§èŒè´£åˆ‡åˆ†æˆåŠŸèƒ½å•ä¸€çš„å°çš„å±€éƒ¨æ–¹æ³•ï¼Œæœ€åç»„ç»‡èµ·æ¥è°ƒç”¨ï¼Œä¼šè®©æˆ‘ä»¬çš„ä»£ç æ˜¾å¾—æ›´åŠ çš„æœ‰æ¡ç†å’Œæ¸…æ™°ã€‚</p>

<p>ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œå¥½å¥‡åº”è¯¥æ˜¯ä»–çš„ç‰¹è´¨ä¹‹ä¸€ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šæƒ³è¦ç ”ç©¶ä¸€ä¸‹ï¼Œå±€éƒ¨æ–¹æ³•çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œè‡³å°‘æˆ‘ä»¬åœ¨Javaæ—¶ä»£ä»æ¥æ²¡æœ‰è§è¿‡è¿™ç§æ¦‚å¿µã€‚</p>

<p>å…¶å®è¿™ä»¶äº‹ä»”ç»†ç ”ç©¶èµ·æ¥ï¼Œè¿˜æ˜¯æœ‰ä¸å°‘ç»†èŠ‚çš„ã€‚å› ä¸ºè¿™å…¶ä¸­å±€éƒ¨æ–¹æ³•å¯ä»¥æ•è·å¤–éƒ¨çš„å˜é‡ä¹Ÿå¯ä»¥ä¸æ•è·å¤–éƒ¨çš„å˜é‡ã€‚</p>

<p>ä¸‹é¢å°±æ˜¯æ•è·å¤–éƒ¨å˜é‡çš„ä¸€ç§æƒ…å†µ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">fun</span> <span class="nf">outMethodCapture</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">fun</span> <span class="nf">checkArgs</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">println</span><span class="o">(</span><span class="s">&quot;innerMethod check args&quot;</span><span class="o">)</span>
</span><span class='line'>           <span class="n">Throwable</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="n">checkArgs</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è¿™å…¶ä¸­ï¼Œå±€éƒ¨æ–¹æ³•checkArgsæ•è·äº†outMethodCaptureçš„å‚æ•°argsã€‚</p>

<p>æ‰€ä»¥ï¼Œä¸æ•è·å¤–éƒ¨å˜é‡çš„æƒ…å†µä¹Ÿä¸éš¾ç†è§£ï¼Œå¦‚ä¸‹,å³checkArgså¤„ç†argséƒ½æ˜¯é€šè¿‡å‚æ•°ä¼ é€’çš„ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">fun</span> <span class="nf">outMethodNonCapture</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">fun</span> <span class="nf">checkArgs</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">println</span><span class="o">(</span><span class="s">&quot;outMethodNonCapture check args&quot;</span><span class="o">)</span>
</span><span class='line'>           <span class="n">Throwable</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="n">checkArgs</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>é¦–å…ˆæˆ‘ä»¬åˆ†æä¸€ä¸‹æ•è·å˜é‡çš„å±€éƒ¨æ–¹æ³•çš„å®ç°åŸç†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">outMethodCapture</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Intrinsics</span><span class="o">.</span><span class="na">checkParameterIsNotNull</span><span class="o">(</span><span class="n">args</span><span class="o">,</span> <span class="s">&quot;args&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">undefinedtype</span><span class="o">&gt;</span> <span class="n">checkArgs$</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Function0</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>     <span class="c1">// $FF: synthetic method</span>
</span><span class='line'>     <span class="c1">// $FF: bridge method</span>
</span><span class='line'>     <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">invoke</span><span class="o">();</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">Unit</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Object</span><span class="o">[]</span> <span class="n">var1</span> <span class="o">=</span> <span class="o">(</span><span class="n">Object</span><span class="o">[])</span><span class="n">args</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">var1</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">String</span> <span class="n">var2</span> <span class="o">=</span> <span class="s">&quot;innerMethod check args&quot;</span><span class="o">;</span>
</span><span class='line'>           <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">var2</span><span class="o">);</span>
</span><span class='line'>           <span class="o">(</span><span class="k">new</span> <span class="n">Throwable</span><span class="o">()).</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>     <span class="o">}</span>
</span><span class='line'>  <span class="o">};</span>
</span><span class='line'>  <span class="n">checkArgs$</span><span class="o">.</span><span class="na">invoke</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚ä¸Šå®ç°åŸç†ï¼Œå°±æ˜¯å±€éƒ¨æ–¹æ³•å®ç°å…¶å®å°±æ˜¯å®ç°äº†ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»çš„å®ä¾‹ï¼Œç„¶åå†æ¬¡è°ƒç”¨å³å¯ã€‚
å¯¹äºä¸æ•è·çš„å±€éƒ¨æ–¹æ³•è¦ç¨æœ‰ä¸åŒï¼Œé¦–å…ˆæˆ‘ä»¬åç¼–è¯‘å¾—åˆ°å¯¹åº”çš„Javaä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">outMethodNonCapture</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">Intrinsics</span><span class="o">.</span><span class="na">checkParameterIsNotNull</span><span class="o">(</span><span class="n">args</span><span class="o">,</span> <span class="s">&quot;args&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">undefinedtype</span><span class="o">&gt;</span> <span class="n">checkArgs$</span> <span class="o">=</span> <span class="kc">null</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
</span><span class='line'>  <span class="n">checkArgs$</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªä¸å®Œæ•´çš„ä»£ç ï¼Œè¿™æ—¶å€™éœ€è¦æˆ‘ä»¬å‰å¾€é¡¹ç›®å·¥ç¨‹ï¼Œç»“åˆä¸€äº›å¯¹åº”çš„classæ–‡ä»¶åˆ†æã€‚é¦–å…ˆæˆ‘ä»¬æ‰¾åˆ°ç±»ä¼¼è¿™æ ·çš„æ–‡ä»¶<code>MainKt$outMethodCapture$1.class</code> (å…¶classæ–‡ä»¶æŒ‰ç…§â€æ–‡ä»¶å$æ–¹æ³•å$å†…éƒ¨ç±»åºå·â€çš„è§„åˆ™)ã€‚</p>

<p>ä½¿ç”¨javapæ–¹æ³•å†æ¬¡åç¼–è¯‘åˆ†æè¯¥æ–‡ä»¶ï¼Œæ³¨æ„å¯¹äº$ç¬¦å·éœ€è¦ç®€å•å¤„ç†ä¸€ä¸‹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="err">âœ</span>  <span class="n">KotlinInnerFunction</span> <span class="n">javap</span> <span class="o">-</span><span class="n">c</span> <span class="s">&quot;MainKt\$outMethodNonCapture\$1.class&quot;</span>
</span><span class='line'><span class="n">Compiled</span> <span class="n">from</span> <span class="s">&quot;Main.kt&quot;</span>
</span><span class='line'><span class="kd">final</span> <span class="kd">class</span> <span class="nc">MainKt</span><span class="n">$outMethodNonCapture$1</span> <span class="kd">extends</span> <span class="n">kotlin</span><span class="o">.</span><span class="na">jvm</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">Lambda</span> <span class="kd">implements</span> <span class="n">kotlin</span><span class="o">.</span><span class="na">jvm</span><span class="o">.</span><span class="na">functions</span><span class="o">.</span><span class="na">Function1</span><span class="o">&lt;</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[],</span> <span class="n">kotlin</span><span class="o">.</span><span class="na">Unit</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">MainKt$outMethodNonCapture$1</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Object</span><span class="o">);</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>       <span class="mi">1</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>       <span class="mi">2</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="mi">11</span>                 <span class="c1">// class &quot;[Ljava/lang/String;&quot;</span>
</span><span class='line'>       <span class="mi">5</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">14</span>                 <span class="c1">// Method invoke:([Ljava/lang/String;)V</span>
</span><span class='line'>       <span class="mi">8</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">20</span>                 <span class="c1">// Field kotlin/Unit.INSTANCE:Lkotlin/Unit;</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="n">areturn</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">String</span><span class="o">[]);</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>       <span class="mi">1</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">23</span>                 <span class="c1">// String args</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">invokestatic</span>  <span class="err">#</span><span class="mi">29</span>                 <span class="c1">// Method kotlin/jvm/internal/Intrinsics.checkParameterIsNotNull:(Ljava/lang/Object;Ljava/lang/String;)V</span>
</span><span class='line'>       <span class="mi">6</span><span class="o">:</span> <span class="n">aload_1</span>
</span><span class='line'>       <span class="mi">7</span><span class="o">:</span> <span class="n">checkcast</span>     <span class="err">#</span><span class="mi">31</span>                 <span class="c1">// class &quot;[Ljava/lang/Object;&quot;</span>
</span><span class='line'>      <span class="mi">10</span><span class="o">:</span> <span class="n">astore_2</span>
</span><span class='line'>      <span class="mi">11</span><span class="o">:</span> <span class="n">aload_2</span>
</span><span class='line'>      <span class="mi">12</span><span class="o">:</span> <span class="n">arraylength</span>
</span><span class='line'>      <span class="mi">13</span><span class="o">:</span> <span class="n">ifne</span>          <span class="mi">20</span>
</span><span class='line'>      <span class="mi">16</span><span class="o">:</span> <span class="n">iconst_1</span>
</span><span class='line'>      <span class="mi">17</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">21</span>
</span><span class='line'>      <span class="mi">20</span><span class="o">:</span> <span class="n">iconst_0</span>
</span><span class='line'>      <span class="mi">21</span><span class="o">:</span> <span class="n">ifeq</span>          <span class="mi">44</span>
</span><span class='line'>      <span class="mi">24</span><span class="o">:</span> <span class="n">ldc</span>           <span class="err">#</span><span class="mi">33</span>                 <span class="c1">// String outMethodNonCapture check args</span>
</span><span class='line'>      <span class="mi">26</span><span class="o">:</span> <span class="n">astore_2</span>
</span><span class='line'>      <span class="mi">27</span><span class="o">:</span> <span class="n">getstatic</span>     <span class="err">#</span><span class="mi">39</span>                 <span class="c1">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
</span><span class='line'>      <span class="mi">30</span><span class="o">:</span> <span class="n">aload_2</span>
</span><span class='line'>      <span class="mi">31</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">45</span>                 <span class="c1">// Method java/io/PrintStream.println:(Ljava/lang/Object;)V</span>
</span><span class='line'>      <span class="mi">34</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">47</span>                 <span class="c1">// class java/lang/Throwable</span>
</span><span class='line'>      <span class="mi">37</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>      <span class="mi">38</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">51</span>                 <span class="c1">// Method java/lang/Throwable.&quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>      <span class="mi">41</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">54</span>                 <span class="c1">// Method java/lang/Throwable.printStackTrace:()V</span>
</span><span class='line'>      <span class="mi">44</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">MainKt$outMethodNonCapture$1</span><span class="o">();</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
</span><span class='line'>       <span class="mi">1</span><span class="o">:</span> <span class="n">iconst_1</span>
</span><span class='line'>       <span class="mi">2</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">61</span>                 <span class="c1">// Method kotlin/jvm/internal/Lambda.&quot;&lt;init&gt;&quot;:(I)V</span>
</span><span class='line'>       <span class="mi">5</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">static</span> <span class="o">{};</span>
</span><span class='line'>    <span class="nl">Code:</span>
</span><span class='line'>       <span class="mi">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">2</span>                  <span class="c1">// class MainKt$outMethodNonCapture$1</span>
</span><span class='line'>       <span class="mi">3</span><span class="o">:</span> <span class="n">dup</span>
</span><span class='line'>       <span class="mi">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">80</span>                 <span class="c1">// Method &quot;&lt;init&gt;&quot;:()V</span>
</span><span class='line'>       <span class="mi">7</span><span class="o">:</span> <span class="n">putstatic</span>     <span class="err">#</span><span class="mi">82</span>                 <span class="c1">// Field INSTANCE:LMainKt$outMethodNonCapture$1;</span>
</span><span class='line'>      <span class="mi">10</span><span class="o">:</span> <span class="k">return</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ç±»å…¶å®æ¯”è¾ƒç®€å•ï¼Œæ›´é‡è¦çš„è¿™æ˜¯ä¸€ä¸ªå•ä¾‹çš„å®ç°ã€‚å› ä¸ºè¿™æ ·ç›¸æ¯”æ•è·çš„æƒ…å†µä¸‹ï¼Œå‡å°‘äº†åŒ¿åå†…éƒ¨ç±»çš„ç”Ÿæˆå’Œå®ä¾‹çš„åˆ›å»ºï¼Œç†è®ºä¸Šå¸¦æ¥çš„ä»£ä»·ä¹Ÿä¼šæ›´å°ã€‚</p>

<p>è€ƒè™‘åˆ°ä¸Šé¢çš„å¯¹æ¯”ï¼Œå¦‚æœåœ¨ä½¿ç”¨å±€éƒ¨æ–¹æ³•æ—¶ï¼Œå»ºè®®ä½¿ç”¨ä¸æ•è·å¤–éƒ¨å˜é‡çš„æ–¹å¼ä¼šæ›´åŠ æ¨èã€‚</p>

<h3>ä½¿ç”¨æ³¨æ„</h3>

<p>æ˜¯çš„ï¼Œä½¿ç”¨å±€éƒ¨æ–¹æ³•æœ‰ä¸€ä¸ªæ³¨æ„äº‹é¡¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§è§„åˆ™çº¦å®šï¼Œé‚£å°±æ˜¯éœ€è¦å…ˆå®šä¹‰æ‰èƒ½ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">fun</span> <span class="nf">outMethodInvalidCase</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">checkArgs</span><span class="o">()</span><span class="c1">//invalid unresolved reference</span>
</span><span class='line'>   <span class="n">fun</span> <span class="nf">checkArgs</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">println</span><span class="o">(</span><span class="s">&quot;innerMethod check args&quot;</span><span class="o">)</span>
</span><span class='line'>           <span class="n">Throwable</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="n">checkArgs</span><span class="o">()</span><span class="c1">//valid</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
ä½†æ˜¯å‘¢ï¼Œå…ˆå®šä¹‰å±€éƒ¨æ–¹æ³•ï¼Œå†ä½¿ç”¨è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œè¿™ç§é—®é¢˜ä¸»è¦è¡¨ç°åœ¨ä»£ç å¯è¯»æ€§ä¸Šã€‚</p>

<p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ è¿›å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œçœ‹åˆ°çš„æ˜¯ä¸€è¿ä¸²çš„å±€éƒ¨æ–¹æ³•ï¼Œå¯èƒ½æˆ–å¤šæˆ–å°‘æœ‰ç‚¹åˆ«æ‰­ã€‚</p>

<p>ä½†æ˜¯è¯•æƒ³ä¸€ä¸‹ï¼Œæ—¢ç„¶æœ‰è¿™æ ·çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¿˜è¦è¢«è®¾è®¡æˆè¿™ä¸ªæ ·å­å‘¢ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸ªå°ä¾‹å­</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">0</span><span class="n">fun</span> <span class="n">outMethodInvalidCase</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'><span class="mi">1</span>   <span class="n">checkArgs</span><span class="o">(</span><span class="n">args</span><span class="o">)</span>
</span><span class='line'><span class="mi">2</span>   <span class="n">var</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">//the reason why it&#39;s unresolved</span>
</span><span class='line'><span class="mi">3</span>   <span class="n">fun</span> <span class="n">checkArgs</span><span class="o">(</span><span class="nl">args:</span> <span class="n">Array</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;)</span> <span class="o">{</span>
</span><span class='line'><span class="mi">4</span>       <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'><span class="mi">5</span>           <span class="n">println</span><span class="o">(</span><span class="s">&quot;outMethodNonCapture check args&quot;</span><span class="o">)</span>
</span><span class='line'><span class="mi">6</span>           <span class="n">Throwable</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'><span class="mi">7</span>           <span class="n">a</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span>
</span><span class='line'><span class="mi">8</span>       <span class="o">}</span>
</span><span class='line'><span class="mi">9</span>   <span class="o">}</span>
</span><span class='line'><span class="mi">10</span><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› ä¸ºå±€éƒ¨æ–¹æ³•å¯ä»¥captureå±€éƒ¨å˜é‡ï¼ŒcheckArgsæ•è·äº†å±€éƒ¨å˜é‡aï¼Œå½“ç¬¬ä¸€è¡Œä»£ç checkArgsè°ƒç”¨æ—¶ï¼Œè€ŒcheckArgsçœ‹ä¼¼å®šä¹‰äº†ï¼Œä½†æ˜¯ç¬¬äºŒè¡Œå´è¿˜æ²¡æœ‰æ‰§è¡Œåˆ°ï¼Œå¯¼è‡´äº†ç¼–è¯‘é—®é¢˜ã€‚</p>

<p>ç›®å‰ï¼Œcaptureå˜é‡å’Œécaptureçš„å±€éƒ¨æ–¹æ³•ä½¿ç”¨éƒ½æ˜¯ä¸€è‡´çš„ï¼Œéƒ½éœ€è¦å…ˆå®šä¹‰ï¼Œå†ä½¿ç”¨ã€‚</p>

<p>å…³äºKotlinä¸­çš„å±€éƒ¨æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å»å°è¯•æ¥è¾¾åˆ°é™å®šèŒƒå›´ï¼Œæ‹†åˆ†æ–¹æ³•çš„ç›®çš„ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œå°½é‡é€‰æ‹©éæ•è·çš„å½¢å¼çš„å±€éƒ¨æ–¹æ³•ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[æµ…æWeakHashMap]]></title>
    <link href="https://droidyue.com/blog/2018/07/23/a-briefing-looking-at-weakhashmap/"/>
    <updated>2018-07-23T17:24:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/07/23/a-briefing-looking-at-weakhashmap</id>
    <content type="html"><![CDATA[<p>åœ¨Javaæˆ–è€…æ˜¯Androidç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨åˆ°Mapï¼Œæ¯”å¦‚HashMapè¿™æ ·çš„å…·ä½“å®ç°ã€‚æ›´é«˜çº§ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä½¿ç”¨WeakHashMapã€‚</p>

<p>WeakHashMapå…¶å®å’ŒHashMapå¤§å¤šæ•°è¡Œä¸ºæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯WeakHashMapä¸ä¼šé˜»æ­¢GCå›æ”¶keyå¯¹è±¡ï¼ˆä¸æ˜¯valueï¼‰ï¼Œé‚£ä¹ˆWeakHashMapæ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç ”ç©¶çš„ä¸»è¦é—®é¢˜ã€‚</p>

<!--more-->


<p>åœ¨å¼€å§‹WeakHashMapä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦å¯¹å¼±å¼•ç”¨æœ‰ä¸€å®šçš„äº†è§£ã€‚</p>

<p>åœ¨Javaä¸­ï¼Œæœ‰å››ç§å¼•ç”¨ç±»å‹</p>

<ul>
<li>å¼ºå¼•ç”¨(Strong Reference)ï¼Œæˆ‘ä»¬æ­£å¸¸ç¼–ç æ—¶é»˜è®¤çš„å¼•ç”¨ç±»å‹ï¼Œå¼ºåº”ç”¨ä¹‹æ‰€ä»¥ä¸ºå¼ºï¼Œæ˜¯å› ä¸ºå¦‚æœä¸€ä¸ªå¯¹è±¡åˆ°GC Rootså¼ºå¼•ç”¨å¯åˆ°è¾¾ï¼Œå°±å¯ä»¥é˜»æ­¢GCå›æ”¶è¯¥å¯¹è±¡</li>
<li>è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰é˜»æ­¢GCå›æ”¶çš„èƒ½åŠ›ç›¸å¯¹å¼±ä¸€äº›ï¼Œå¦‚æœæ˜¯è½¯å¼•ç”¨å¯ä»¥åˆ°è¾¾ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¼šåœç•™åœ¨å†…å­˜æ›´æ—¶é—´ä¸Šé•¿ä¸€äº›ã€‚å½“å†…å­˜ä¸è¶³æ—¶åƒåœ¾å›æ”¶å™¨æ‰ä¼šå›æ”¶è¿™äº›è½¯å¼•ç”¨å¯åˆ°è¾¾çš„å¯¹è±¡</li>
<li>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰æ— æ³•é˜»æ­¢GCå›æ”¶ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ—¶å¼±å¼•ç”¨å¯åˆ°è¾¾ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€ä¸ªGCå›æ”¶æ‰§è¡Œæ—¶ï¼Œè¯¥å¯¹è±¡å°±ä¼šè¢«å›æ”¶æ‰ã€‚</li>
<li>è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰ååˆ†è„†å¼±ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨å°±æ˜¯å½“å…¶æŒ‡å‘çš„å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œè‡ªå·±è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨ä½œè®°å½•è¯¥å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å·²è¢«é”€æ¯</li>
</ul>


<p>è¿™å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µå«åšå¼•ç”¨é˜Ÿåˆ—(Reference Queue)</p>

<ul>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå¯¹è±¡æ ‡è®°ä¸ºåƒåœ¾ï¼ˆå¹¶ä¸ä»£è¡¨å›æ”¶äº†ï¼‰åï¼Œä¼šåŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ã€‚</li>
<li>å¯¹äºè™šå¼•ç”¨æ¥è¯´ï¼Œå®ƒæŒ‡å‘çš„å¯¹è±¡ä¼šåªæœ‰è¢«å›æ”¶åæ‰ä¼šåŠ å…¥å¼•ç”¨é˜Ÿåˆ—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä½œè®°å½•è¯¥å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦å›æ”¶ã€‚</li>
</ul>


<h3>WeakHashMapå¦‚ä½•ä¸é˜»æ­¢å¯¹è±¡å›æ”¶å‘¢</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="kd">implements</span>
</span><span class='line'>       <span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>   <span class="kt">int</span> <span class="n">hash</span><span class="o">;</span>
</span><span class='line'>   <span class="kt">boolean</span> <span class="n">isNull</span><span class="o">;</span>
</span><span class='line'>   <span class="n">V</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>   <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
</span><span class='line'>   <span class="kd">interface</span> <span class="nc">Type</span><span class="o">&lt;</span><span class="n">R</span><span class="o">,</span> <span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">R</span> <span class="nf">get</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">entry</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>   <span class="n">Entry</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">object</span><span class="o">,</span> <span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="kd">super</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">queue</span><span class="o">);</span>
</span><span class='line'>       <span class="n">isNull</span> <span class="o">=</span> <span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>       <span class="n">hash</span> <span class="o">=</span> <span class="n">isNull</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</span><span class='line'>       <span class="n">value</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
</span><span class='line'>   <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¦‚æºç æ‰€ç¤ºï¼Œ</p>

<ul>
<li>WeakHashMapçš„Entryç»§æ‰¿äº†WeakReferenceã€‚</li>
<li>å…¶ä¸­Keyä½œä¸ºäº†WeakReferenceæŒ‡å‘çš„å¯¹è±¡</li>
<li>å› æ­¤WeakHashMapåˆ©ç”¨äº†WeakReferenceçš„æœºåˆ¶æ¥å®ç°ä¸é˜»æ­¢GCå›æ”¶Key</li>
</ul>


<h3>å¦‚ä½•åˆ é™¤è¢«å›æ”¶çš„keyæ•°æ®å‘¢</h3>

<p>åœ¨Javadocä¸­å…³äºWeakHashMapæœ‰è¿™æ ·çš„æè¿°ï¼Œå½“keyä¸å†å¼•ç”¨æ—¶ï¼Œå…¶å¯¹åº”çš„key/valueä¹Ÿä¼šè¢«ç§»é™¤ã€‚</p>

<p>é‚£ä¹ˆæ˜¯å¦‚ä½•ç§»é™¤çš„å‘¢ï¼Œè¿™é‡Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§å‡è®¾ç­–ç•¥</p>

<ul>
<li>å½“å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™ï¼Œè¿›è¡Œé€šçŸ¥</li>
<li>WeakHashMapè½®è¯¢å¤„ç†æ—¶æ•ˆçš„Entry</li>
</ul>


<p>è€ŒWeakHashMapé‡‡ç”¨çš„æ˜¯è½®è¯¢çš„å½¢å¼ï¼Œåœ¨å…¶put/get/sizeç­‰æ–¹æ³•è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šé¢„å…ˆè°ƒç”¨ä¸€ä¸ªpollçš„æ–¹æ³•ï¼Œæ¥æ£€æŸ¥å¹¶åˆ é™¤å¤±æ•ˆçš„Entry</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">void</span> <span class="nf">poll</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;</span> <span class="n">toRemove</span><span class="o">;</span>
</span><span class='line'>   <span class="k">while</span> <span class="o">((</span><span class="n">toRemove</span> <span class="o">=</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span> <span class="n">V</span><span class="o">&gt;)</span> <span class="n">referenceQueue</span><span class="o">.</span><span class="na">poll</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">removeEntry</span><span class="o">(</span><span class="n">toRemove</span><span class="o">);</span>
</span><span class='line'>       <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="n">LOGTAG</span><span class="o">,</span> <span class="s">&quot;removeEntry=&quot;</span> <span class="o">+</span> <span class="n">toRemove</span><span class="o">.</span><span class="na">value</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨çœ‹ä¼¼æ›´å¥½çš„é€šçŸ¥å‘¢ï¼Œæˆ‘æƒ³æ˜¯å› ä¸ºåœ¨Javaä¸­æ²¡æœ‰ä¸€ä¸ªå¯é çš„é€šçŸ¥å›è°ƒï¼Œæ¯”å¦‚å¤§å®¶å¸¸è¯´çš„finalizeæ–¹æ³•ï¼Œå…¶å®ä¹Ÿä¸æ˜¯æ ‡å‡†çš„ï¼Œä¸åŒçš„JVMå¯ä»¥å®ç°ä¸åŒï¼Œç”šè‡³æ˜¯ä¸è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>

<p>å½“ç„¶é™¤äº†å•çº¯çš„çœ‹æºç ï¼Œè¿›è¡Œåˆç†çš„éªŒè¯æ˜¯æ£€éªŒåˆ†ææ­£ç¡®çš„ä¸€ä¸ªé‡è¦æ–¹æ³•ã€‚</p>

<p>è¿™é‡Œé¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªMyObjectç±»ï¼Œå¤„ç†ä¸€ä¸‹finalizeæ–¹æ³•ï¼ˆåœ¨æˆ‘çš„æµ‹è¯•æœºä¸Šå¯ä»¥æ­£å¸¸è°ƒç”¨ï¼Œä»…ä»…åšä¸ºè¾…åŠ©éªŒè¯æ‰‹æ®µï¼‰</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nf">MyObject</span><span class="o">(</span><span class="n">val</span> <span class="nl">id:</span> <span class="n">String</span><span class="o">)</span> <span class="o">:</span> <span class="n">Any</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="kd">protected</span> <span class="n">fun</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;Object($id) finalize method is called&quot;</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ç„¶åæ˜¯è°ƒç”¨è€…çš„ä»£ç ï¼Œå¦‚ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">val</span> <span class="n">weakHashMap</span> <span class="o">=</span> <span class="n">WeakHashMap</span><span class="o">&lt;</span><span class="n">Any</span><span class="o">,</span> <span class="n">Int</span><span class="o">&gt;()</span>
</span><span class='line'><span class="n">var</span> <span class="n">count</span> <span class="o">:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nl">savedInstanceState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">)</span>
</span><span class='line'>   <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_main</span><span class="o">)</span>
</span><span class='line'>   <span class="n">setSupportActionBar</span><span class="o">(</span><span class="n">toolbar</span><span class="o">)</span>
</span><span class='line'>   <span class="n">dumpWeakInfo</span><span class="o">()</span>
</span><span class='line'>   <span class="n">fab</span><span class="o">.</span><span class="na">setOnClickListener</span> <span class="o">{</span> <span class="n">view</span> <span class="o">-&gt;</span>
</span><span class='line'>       <span class="c1">//System.gc()// this seldom works use Android studio force gc stop</span>
</span><span class='line'>       <span class="n">weakHashMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">MyObject</span><span class="o">(</span><span class="n">count</span><span class="o">.</span><span class="na">toString</span><span class="o">()),</span> <span class="n">count</span><span class="o">)</span>
</span><span class='line'>       <span class="n">count</span> <span class="o">++</span>
</span><span class='line'>       <span class="n">dumpWeakInfo</span><span class="o">()</span>
</span><span class='line'>       <span class="n">Snackbar</span><span class="o">.</span><span class="na">make</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="s">&quot;Replace with your own action&quot;</span><span class="o">,</span> <span class="n">Snackbar</span><span class="o">.</span><span class="na">LENGTH_LONG</span><span class="o">)</span>
</span><span class='line'>               <span class="o">.</span><span class="na">setAction</span><span class="o">(</span><span class="s">&quot;Action&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">).</span><span class="na">show</span><span class="o">()</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">fun</span> <span class="nf">dumpWeakInfo</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="s">&quot;MainActivity&quot;</span><span class="o">,</span> <span class="s">&quot;dumpWeakInfo weakInfo.size=${weakHashMap.size}&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬æŒ‰ç…§å¦‚ä¸‹æ“ä½œ</p>

<ul>
<li>ç‚¹å‡»fabæ§ä»¶ï¼Œæ¯æ¬¡å¯¹WeakhashMapå¯¹è±¡å¢åŠ ä¸€ä¸ªEntryï¼Œå¹¶æ‰“å°WeakHashMapçš„size æ‰§è¡Œ3æ­¤</li>
<li>åœ¨æ²¡æœ‰å¼ºåˆ¶è§¦å‘GCæ—¶ï¼ŒWeakHashMapå¯¹è±¡sizeä¸€ç›´ä¼šå¢åŠ </li>
<li>æ‰‹åŠ¨å‡ºå‘Force GCï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°MyObjectæœ‰finalizeæ–¹æ³•è¢«è°ƒç”¨</li>
<li>å†æ¬¡ç‚¹å‡»fabç©ºé—´ï¼Œç„¶åè¾“å‡ºçš„WeakHashMap sizeæ€¥å‰§å‡å°‘ã€‚</li>
<li>åŒæ ·æˆ‘ä»¬æ”¶åˆ°åœ¨WeakHashMapå¢åŠ çš„æ—¥å¿—ä¹Ÿä¼šè¾“å‡º</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">dumpWeakInfo</span> <span class="n">weakInfo</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">1</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">dumpWeakInfo</span> <span class="n">weakInfo</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">2</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">dumpWeakInfo</span> <span class="n">weakInfo</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">3</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">Object</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="n">finalize</span> <span class="n">method</span> <span class="n">is</span> <span class="n">called</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">Object</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="n">finalize</span> <span class="n">method</span> <span class="n">is</span> <span class="n">called</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">Object</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="n">finalize</span> <span class="n">method</span> <span class="n">is</span> <span class="n">called</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">WeakHashMap</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">removeEntry</span><span class="o">=</span><span class="mi">2</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">WeakHashMap</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">removeEntry</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">WeakHashMap</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">removeEntry</span><span class="o">=</span><span class="mi">1</span>
</span><span class='line'><span class="n">I</span><span class="o">/</span><span class="n">MainActivity</span><span class="o">(</span><span class="mi">10202</span><span class="o">):</span> <span class="n">dumpWeakInfo</span> <span class="n">weakInfo</span><span class="o">.</span><span class="na">size</span><span class="o">=</span><span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ³¨æ„ï¼šSystem.gc()å¹¶ä¸ä¸€å®šå¯ä»¥å·¥ä½œ,å»ºè®®ä½¿ç”¨Android Studioçš„Force GC</p>

<p>å®Œæ•´çš„æµ‹è¯•ä»£ç å¯ä»¥è®¿é—®è¿™é‡Œ  <a href="https://github.com/androidyue/WeakHashMapSample">https://github.com/androidyue/WeakHashMapSample</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¸ºä»€ä¹ˆå±€éƒ¨å˜é‡éœ€è¦æ˜¾å¼è®¾ç½®åˆå§‹åŒ–å€¼]]></title>
    <link href="https://droidyue.com/blog/2018/07/16/variable-localname-might-not-have-been-initialized/"/>
    <updated>2018-07-16T08:40:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/07/16/variable-localname-might-not-have-been-initialized</id>
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­ï¼Œæ— æ—¶æ— åˆ»åœ°éƒ½åœ¨äºæ–¹æ³•æ‰“äº¤é“ï¼Œè€Œåœ¨æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¾ˆéš¾ä¸ä½¿ç”¨å±€éƒ¨å˜é‡ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸‹é¢çš„è¿™æ ·ä¸€æ®µå¾ˆç®€å•çš„ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">dump</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">localName</span><span class="o">;</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dump localName=&quot;</span> <span class="o">+</span> <span class="n">localName</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>éšç€æˆ‘ä»¬æ•²æ‰“å‡ºä¸Šé¢çš„ä»£ç ï¼ŒIDEä¹Ÿä¼šåŒæ—¶æŠ›ç»™æˆ‘ä»¬ä¸€ä¸ªé”™è¯¯ï¼Œå°±æ˜¯
<code>Variable 'localName' might not have been initialized</code></p>

<p>è¿™æ˜¯ä»€ä¹ˆé”™è¯¯ï¼ŒlocalNameæ²¡æœ‰åˆå§‹åŒ–ï¼Ÿä¸ºä»€ä¹ˆæˆå‘˜å˜é‡æ˜¯å¯ä»¥çš„çš„ï¼Œä¸ä¿¡ä½ çœ‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">dumpField</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dumpField name=&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æ˜¯çš„ï¼Œä¸Šé¢çš„æˆå‘˜å˜é‡æ˜¯æ²¡æœ‰é—®é¢˜ï¼Œä¹Ÿæ²¡æœ‰è­¦å‘Šçš„ã€‚</p>

<p>è¿™å°±å¥‡æ€ªäº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Œjavacæ€ä¹ˆè¿™ä¹ˆè ¢å‘¢ï¼Ÿ</p>

<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚javacè¶³å¤Ÿæœ‰èƒ½åŠ›æ¨æ–­å‡ºå±€éƒ¨å˜é‡å¹¶åˆå§‹åŒ–é»˜è®¤å€¼ã€‚ç„¶è€Œå®ƒå¹¶æ²¡æœ‰è¿™æ ·åšã€‚</p>

<p>æƒ³è¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆè¿™æ ·åšå°±ï¼Œå°±éœ€è¦ææ¸…æ¥šå±€éƒ¨å˜é‡å’Œæˆå‘˜å˜é‡çš„å…³äºèµ‹å€¼å’Œå–å€¼çš„é¡ºåºçš„å·®å¼‚ã€‚</p>

<p>å¯¹äºæˆå‘˜å˜é‡è€Œè¨€ï¼Œå…¶èµ‹å€¼å’Œå–å€¼è®¿é—®çš„å…ˆåé¡ºåºå…·æœ‰ä¸ç¡®å®šæ€§ã€‚è¿˜æ˜¯ä»¥è¿™æ®µä»£ç ä¸ºä¾‹ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span>  <span class="kt">void</span> <span class="nf">dumpField</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dumpField name=&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>nameçš„èµ‹å€¼å¯ä»¥å‘ç”Ÿåœ¨dumpFieldä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨dumpFieldä¹‹åã€‚è¿™æ˜¯åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„ï¼Œåœ¨ç¼–è¯‘å™¨æ¥çœ‹ç¡®å®šä¸äº†çš„ã€‚å¯¹äºæ²¡æŠŠæ¡çš„äº‹æƒ…ï¼Œjavacæ˜¯ä¸ä¼šå»åšçš„ï¼Œè¿™ç§äº‹æƒ…äº¤ç»™è¿è¡Œæ—¶çš„JVMå°±å¯ä»¥äº†ã€‚</p>

<p>è€Œå¯¹äºæˆå‘˜å˜é‡è€Œè¨€ï¼Œå…¶èµ‹å€¼å’Œå–å€¼è®¿é—®é¡ºåºæ˜¯ç¡®å®šçš„ã€‚æ¯”å¦‚è¿™æ®µä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">dump</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">String</span> <span class="n">localName</span><span class="o">;</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;dump localName=&quot;</span> <span class="o">+</span> <span class="n">localName</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å› ä¸ºlocalNameçš„ä½œç”¨èŒƒå›´åªé™å®šäºdumpæ–¹æ³•ä¸­ï¼Œå¿…ç„¶çš„é¡ºåºå°±æ˜¯å…ˆèµ‹å€¼ï¼ˆå£°æ˜ï¼‰ï¼Œå†è¿›è¡Œè®¿é—®ã€‚</p>

<p>è¯´äº†åŠå¤©è¿˜æ²¡æœ‰è¯´å±€éƒ¨å˜é‡ä¸ºä»€ä¹ˆæ˜¾å¼è®¾ç½®åˆå§‹å€¼å‘¢ï¼Ÿ</p>

<p>å…¶å®ä¹‹æ‰€ä»¥è¿™æ ·åšå°±æ˜¯ä¸€ç§å¯¹ç¨‹åºå‘˜çš„çº¦æŸé™åˆ¶ã€‚å› ä¸ºç¨‹åºå‘˜ï¼ˆäººï¼‰æ˜¯ï¼ˆæœ‰äº›æƒ…å†µä¸‹ï¼‰æ˜¯é ä¸ä½çš„ï¼Œå‡ä½¿å±€éƒ¨å˜é‡å¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ï¼Œæˆ‘ä»¬æ€»ä¼šæ— æ„é—´å¿˜è®°èµ‹å€¼ï¼Œè¿›è€Œå¯¼è‡´ä¸å¯é¢„æœŸçš„æƒ…å†µå‡ºç°ã€‚è¿™</p>

<p>â€œä¹‹æ‰€ä»¥è®¾è®¡æˆè¿™æ ·å®Œå…¨æ˜¯ä¸€ç§ç­–ç•¥å†³å®šï¼Œå¹¶éæ˜¯æˆ‘åŠ›ä¸èƒ½åŠï¼Œå¹´è½»äººï¼Œæˆ‘åªèƒ½å¸®ä½ åˆ°è¿™é‡Œäº†ã€‚â€ï¼ŒJavacå¦‚æ˜¯è¯´ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AssetManager.finalize() timed out after 10 secondsåˆ†æ]]></title>
    <link href="https://droidyue.com/blog/2018/07/10/android-dot-content-dot-res-dot-assetmanager-dot-finalize-timed-out-after-10-seconds/"/>
    <updated>2018-07-10T21:44:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/07/10/android-dot-content-dot-res-dot-assetmanager-dot-finalize-timed-out-after-10-seconds</id>
    <content type="html"><![CDATA[<p>æ²¡æœ‰ä»£ç ï¼Œå°±æ²¡æœ‰bugã€‚ç¨‹åºå‘˜åœ¨ç¼–ç æ—¶ï¼Œæ€»ä¼šæ¯”ä¸é¿å…çš„å‡ºç°bugã€‚å€’ä¸æ˜¯å› ä¸ºæˆ‘ä»¬çƒ­çˆ±åˆ¶é€ bugï¼Œåˆ›é€ æœºä¼šå’Œæµ‹è¯•å¦¹å­é¢‘ç¹æ²Ÿé€šã€‚è€Œæ˜¯ç°å®æƒ…å†µå¾ˆå¤æ‚ï¼Œå­˜åœ¨ç€å¾ˆå¤šä¸ç¡®å®šæ€§ã€‚å°¤å…¶æ˜¯é‚£äº›å´©æºƒä»stacktraceä¸Šæ¥çœ‹ï¼Œå®Œå…¨æƒ³è±¡ä¸åˆ°å’Œé¡¹ç›®ä»£ç ä¹‹é—´çš„ç›´æ¥è”ç³»ã€‚</p>

<!--more-->


<p>åœ¨æˆ‘ä»¬çš„é¡¹ç›®å´©æºƒä¸­ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„bugï¼Œå°±æ˜¯ java.util.concurrent.TimeoutException android.content.res.AssetManager.finalize() timed out after 10 seconds  æ„æ€ç®€å•æ˜äº†ï¼Œå°±æ˜¯è¯´åœ¨AssetManagerææ„çš„æ—¶å€™å‘ç”Ÿäº†è¶…æ—¶å¼‚å¸¸ã€‚</p>

<p>æ˜¯çš„ï¼Œé“ç†æˆ‘éƒ½æ‡‚ï¼Œå¯æ˜¯AssetManagerä¸æ˜¯æˆ‘å†™çš„å•Šï¼Œè¿™ä¸æ˜¯Android Frameworkçš„ä¸œè¥¿ä¹ˆï¼Œè€Œä¸”åœ¨stacktraceä¸­ä¸æ¯«çœ‹ä¸åˆ°æˆ‘é¡¹ç›®ä»£ç çš„å †æ ˆä¿¡æ¯ã€‚è¿™ç®€ç›´æ˜¯æ— ä»ä¸‹æ‰‹ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±éœ€è¦ä»å´©æºƒåå°æ‰‹æœºä¸Šçš„ä¿¡æ¯å»åˆ†æäº§ç”Ÿçš„åŸå› äº†</p>

<h3>åŸç†åˆ†æ</h3>

<ul>
<li>Androidåœ¨å¯åŠ¨åä¼šåˆ›å»ºä¸€äº›å®ˆæŠ¤è¿›ç¨‹ï¼Œå…¶ä¸­æ¶‰åŠåˆ°è¯¥é—®é¢˜çš„æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯FinalizerDaemonå’ŒFinalizerWatchdogDaemon</li>
<li>FinalizerDaemon ææ„å®ˆæŠ¤çº¿ç¨‹ã€‚å¯¹äºé‡å†™äº†æˆå‘˜å‡½æ•°finalizeçš„å¯¹è±¡ï¼Œå®ƒä»¬è¢«GCå†³å®šå›æ”¶æ—¶ï¼Œå¹¶æ²¡æœ‰é©¬ä¸Šè¢«å›æ”¶ï¼Œè€Œæ˜¯è¢«æ”¾å…¥åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…FinalizerDaemonå®ˆæŠ¤çº¿ç¨‹å»è°ƒç”¨å®ƒä»¬çš„æˆå‘˜å‡½æ•°finalizeï¼Œç„¶åå†è¢«å›æ”¶ã€‚</li>
<li>FinalizerWatchdogDaemonææ„ç›‘æŠ¤å®ˆæŠ¤çº¿ç¨‹ã€‚ç”¨æ¥ç›‘æ§FinalizerDaemonçº¿ç¨‹çš„æ‰§è¡Œã€‚ä¸€æ—¦æ£€æµ‹é‚£äº›é‡å†™äº†finalizeçš„å¯¹è±¡åœ¨æ‰§è¡Œæˆå‘˜å‡½æ•°finalizeæ—¶è¶…å‡ºä¸€å®šæ—¶é—´ï¼Œé‚£ä¹ˆå°±ä¼šé€€å‡ºVMã€‚</li>
<li>å¦‚æœæ˜¯FinalizerDaemonè¿›è¡Œå¯¹è±¡ææ„æ—¶é—´è¶…è¿‡äº†MAX_FINALIZE_NANOSï¼ˆè¿™é‡Œæ˜¯10sï¼‰ï¼ŒFinalizerWatchdogDaemonè¿›è¡Œå°±ä¼šæŠ›å‡ºTimeoutException</li>
</ul>


<p>å‡ºç°åœºæ™¯
10sçš„è¶…æ—¶å…¶å®æ˜¯å¾ˆå¤§çš„ä¸€ä¸ªå€¼ï¼Œä¸€èˆ¬çš„ææ„æ–¹æ³•å¾ˆéš¾æ‰§è¡Œæ—¶é—´è¾¾åˆ°è¿™ä¸ªæ•°å€¼ï¼Œé‚£ä¹ˆå°±è¦åˆ†æä¸€ä¸‹è¿™ä¸ªé—®é¢˜çš„ç‰¹å¾ï¼Œæ¥æ€»ç»“ä¸€ä¸‹å‡ºç°åœºæ™¯äº†ã€‚</p>

<p>é’ˆå¯¹åˆ†æäº†è¿™ç±»çš„å´©æºƒçš„æ•°æ®ï¼Œä¸éš¾ä¼šå¾—åˆ°å‡ ä¸ªç‰¹å¾</p>

<ul>
<li>è¿™ä¸ªå´©æºƒä»æ•°æ®æ¥çœ‹ï¼Œå´©æºƒéƒ½æ˜¯åº”ç”¨å¤„äºåå°ä¸å¯è§çš„æƒ…å†µä¸‹å‘ç”Ÿ</li>
<li>å´©æºƒæ—¶åº”ç”¨çš„ä½¿ç”¨æ—¶é•¿ï¼ˆå´©æºƒç»Ÿè®¡ç»„ä»¶æä¾›ï¼‰æ™®éåœ¨å‡ ä¸ªå°æ—¶çš„çº§åˆ«</li>
</ul>


<p>ä»Stack Overflowä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒåˆç†çš„å‡ºç°åœºæ™¯</p>

<ul>
<li>å½“ä½ çš„åº”ç”¨å¤„äºåå°ï¼Œæœ‰å¯¹è±¡éœ€è¦é‡Šæ”¾å›æ”¶å†…å­˜æ—¶</li>
<li>è®°å½•ä¸€ä¸ªstart_time ç„¶åæ˜¯FinalizerDaemon å¼€å§‹ææ„AssetManagerå¯¹è±¡</li>
<li>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè®¾å¤‡çªç„¶è¿›å…¥äº†ä¼‘çœ çŠ¶æ€ï¼Œææ„æ‰§è¡Œè¢«æš‚åœ</li>
<li>å½“è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œè®¾å¤‡è¢«å”¤é†’ï¼Œææ„ä»»åŠ¡è¢«æ¢å¤ï¼Œç»§ç»­æ‰§è¡Œï¼Œç›´è‡³ç»“æŸ</li>
<li>åœ¨ææ„å®Œæˆåï¼Œå¾—åˆ°ä¸€ä¸ªend_time</li>
<li>FinalizerWatchdogDaemon å¯¹end_timeä¸start_timeè¿›è¡Œå·®å€¼å¯¹æ¯”ï¼Œå‘ç°è¶…è¿‡äº†MAX_FINALIZE_NANOSï¼Œäºæ˜¯å°±æŠ›å‡ºäº†TimeOutå¼‚å¸¸ã€‚</li>
</ul>


<p>æ³¨æ„ï¼šåº”ç”¨åå°æ‰§è¡Œçš„æ—¶é—´è¶Šé•¿ï¼Œå‡ºç°çš„æ¦‚ç‡åº”è¯¥å°±ä¼šè¶Šå¤§ã€‚</p>

<h3>å¦‚ä½•è§£å†³</h3>

<p>è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä¸åƒNPEé‚£æ ·ï¼Œå¯ä»¥å¿«é€Ÿå®šä½è§£å†³ï¼Œç”šè‡³æ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜å‡ ä¹æ— è§£ã€‚</p>

<p>ç†è®ºä¸Šå¯èƒ½æœ‰å¸®åŠ©çš„æªæ–½æ˜¯</p>

<ul>
<li>å‡å°‘å†…å­˜å ç”¨ï¼Œé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>æ¶ˆé™¤å†…å­˜æ³„éœ²é—®é¢˜ï¼Œç¼“è§£GCå‹åŠ›</li>
</ul>


<p>ä½†æ˜¯è¿™äº›æªæ–½ï¼Œå¯¹äºè§£å†³è¯¥é—®é¢˜èµ·åˆ°çš„ä½œç”¨å¾ˆå¾®å°ã€‚</p>

<h3>å¦‚ä½•ç¼“è§£</h3>

<p>å‡¡äº‹æ€»æœ‰ä½†æ˜¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç¼“è§£è¿™ä¸ªé—®é¢˜é€ æˆçš„å½±å“ã€‚</p>

<p>æ‰€è°“ç¼“è§£ä¹‹æ³•ï¼Œå°±æ˜¯è®©å´©æºƒæ‚„æ— å£°æ¯åœ°å‘ç”Ÿï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼Œåšåˆ°ç”¨æˆ·æ— æ„ŸçŸ¥å´©æºƒã€‚</p>

<p>å‰é¢ä¹Ÿæåˆ°äº†ï¼Œå› ä¸ºè¿™ç§å´©æºƒåªå‡ºç°åœ¨åå°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹äºè¿™ç±»çš„å´©æºƒï¼Œç¨ä½œå¤„ç†ï¼Œå°±å¯ä»¥è®©å´©æºƒçš„å¯¹è¯æ¡†ä¸æ˜¾ç¤ºã€‚å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://droidyue.com/blog/2018/04/01/do-not-bother-the-user-when-app-crash-in-a-background-state/">Androidä¸­å®ç°ç”¨æˆ·æ— æ„ŸçŸ¥å¤„ç†åå°å´©æºƒ</a></p>

<p>ä»¥ä¸Šã€‚æ„Ÿè°¢ä¸‹é¢çš„å‚è€ƒæ–‡ç« </p>

<h3>å‚è€ƒæ–‡ç« </h3>

<ul>
<li><a href="https://blog.csdn.net/jamin0107/article/details/78793021">https://blog.csdn.net/jamin0107/article/details/78793021</a></li>
<li><a href="https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin">https://stackoverflow.com/questions/24021609/how-to-handle-java-util-concurrent-timeoutexception-android-os-binderproxy-fin</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å®½å¸¦æé€Ÿè®°]]></title>
    <link href="https://droidyue.com/blog/2018/07/01/kuan-dai-ti-su-ji/"/>
    <updated>2018-07-01T20:14:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/07/01/kuan-dai-ti-su-ji</id>
    <content type="html"><![CDATA[<p>ç”¨äº†ä¸€å¹´å®½å¸¦é©¬ä¸Šå°±è¦åˆ°æœŸäº†ï¼Œå»è”é€šè¥ä¸šå…å’¨è¯¢äº†ä¸€ä¸‹ï¼Œå‘ç°è”é€šå·²ç»æ‚„æ‚„çš„æŠŠæˆ‘çš„100Må…è´¹å‡çº§æˆäº†300M(åšå¥½äº‹ä¸ºä»€ä¹ˆä¸å‘Šè¯‰æˆ‘ä¸€å£°)ã€‚å¿ƒä¸­åˆ’è¿‡ä¸€ä¸çªƒå–œï¼Œä½†æ˜¯éšåè„‘æµ·ä¸­æŠ›å‡ºäº†ä¸€ä¸ªç–‘é—®ï¼Œéƒ½å‡åˆ°äº†300Mäº†ï¼Œæ€ä¹ˆä¸æ¯«æ²¡æœ‰æ„Ÿè§‰åˆ°é€Ÿåº¦æå‡å‘¢ï¼Ÿ</p>

<!--more-->


<h3>è”é€šç»™çš„å…‰çŒ«WIFIæœ‰é—®é¢˜</h3>

<p>åœ¨ä¸€å¹´å‰æŠ¥è£…çš„æ—¶å€™ï¼Œæˆ‘ç¡®å®æµ‹è¿‡ç½‘é€Ÿï¼Œå½“æ—¶ä½¿ç”¨QQæ‰‹æœºç®¡å®¶æµ‹è¿‡ï¼Œå°†è¿‘50Måˆ°100Mã€‚è§‰å¾—å¯èƒ½æ˜¯æµ‹è¯•èŠ‚ç‚¹çš„é—®é¢˜ï¼Œå°±æ²¡æœ‰å¤ªç•™æ„ã€‚</p>

<p>ä¸è¿‡ç°åœ¨éƒ½300Mçš„å¸¦å®½äº†ï¼Œæ€ä¹ˆè¿˜æ˜¯ä¸èƒ½è·‘æ»¡ï¼Œåæ¥æ‰“è”é€šå®¢æœï¼Œå®¢æœå°å“¥è¯´ï¼Œå…‰çŒ«çš„WIFIå±äºé™„åŠ åŠŸèƒ½ï¼Œæ— æ³•å‘æŒ¥åˆ°å¸¦å®½çš„ç†æƒ³çŠ¶æ€ã€‚</p>

<p>äºæ˜¯åœ¨äº¬ä¸œä¸Šå¼€å§‹æŒ‘é€‰è·¯ç”±å™¨ï¼Œè´§æ¯”Nå®¶ï¼Œæœ€ç»ˆé€‰æ‹©äº†ä¸€ä¸ªä¸è´Ÿæ‰€æœ›çš„<a href="https://union-click.jd.com/jdc?d=o1fjbn">Tenda AC1206</a>ï¼Œè…¾è¾¾è¿˜æ˜¯æŒºæœ‰è‰¯å¿ƒçš„å›½äº§å“ç‰Œ</p>

<p>å½“ç„¶æˆ‘æœ€çœ‹é‡çš„è¿™å‡ ç‚¹</p>

<ul>
<li>åŒåƒå…†ï¼ŒWIFIå’ŒLanå£éƒ½æ˜¯åƒå…†</li>
<li>æ™ºèƒ½ç®¡ç†ï¼Œè®¾å¤‡ä¸Šçº¿æé†’ï¼ˆå¯ä»¥çœ‹åˆ°å®¶äººå›å®¶åœ¨å®¶æƒ…å†µï¼‰</li>
<li>2.4Ghzä¸5GhzåŒæ—¶æ”¯æŒ</li>
<li>WIFIä¿¡å·å®šå‘å¢å¼ºåŠŸèƒ½</li>
</ul>


<h3>å…‰çŒ«Lanå£é€‰æ‹©å¾ˆé‡è¦</h3>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè”é€šçš„å…‰çŒ«ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸­å…´çš„F627Zaï¼Œæœ‰ç‚¹ç‰¹æ®Šï¼Œåªæœ‰Lan1å£æ”¯æŒåƒå…†ï¼Œå…¶ä»–æ˜¯æœ€é«˜ç™¾å…†ï¼Œæ‰€ä»¥å¦‚æœé€‰æ‹©å‡ºé”™ï¼Œæ— æ³•ä½“éªŒåˆ°è¶…ç™¾å…†çš„é€Ÿåº¦ï¼Œé’±ä¹Ÿå°±ç™½èŠ±äº†ã€‚</p>

<h3>æµ‹é€Ÿè½¯ä»¶å¾ˆé‡è¦</h3>

<p>é€‰æ‹©ä¸€ä¸ªå¥½çš„æµ‹é€Ÿè½¯ä»¶ï¼Œä¼šä½¿å¾—æˆ‘ä»¬çš„éªŒè¯å¯ä»¥é‡åŒ–ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯speedtestè½¯ä»¶ï¼Œï¼ŒAndroidï¼ŒMacç­‰éƒ½æ”¯æŒï¼Œæ³¨æ„Webä¹Ÿæ”¯æŒï¼Œä¸è¿‡ä¸è¦ç”¨å±±å¯¨çš„www.speedtest.cn, è€Œæ˜¯è¦ä½¿ç”¨è¿™ä¸ª <a href="http://www.speedtest.net/">http://www.speedtest.net/</a></p>

<p>æ³¨æ„åšæµ‹é€Ÿå°½é‡é€‰æ‹©ç»Ÿä¸€è¿è¥å•†çš„æµ‹é€ŸèŠ‚ç‚¹ï¼Œä¸è¦å‡ºç°è”é€šçš„ç”¨æˆ·ç«¯é€‰æ‹©ç”µä¿¡èŠ‚ç‚¹æ¥æµ‹è¯•å¸¦å®½çš„æƒ…å†µã€‚</p>

<h3>2.4Gå¾ˆæ…¢ï¼Œæˆ‘è¦ç”¨5G</h3>

<p>å¯æ˜¯å½“æˆ‘ä½¿ç”¨Androidæ‰‹æœºè¿æ¥è…¾è¾¾WIFIæ—¶ï¼Œæµ‹é€Ÿå·²ç„¶ä¸åˆ°ç™¾å…†ï¼Œè¿™å°±å¥‡æ€ªäº†ï¼Œåæ¥å½“æˆ‘ä»2.4Gåˆ‡æ¢åˆ°5Gæ—¶ï¼Œé€Ÿåº¦å‘ç”Ÿäº†å·¨å˜ï¼Œå°†è¿‘200Mã€‚</p>

<p>è¿™å°±æ¶‰åŠåˆ°äº†2.4Gå’Œ5Gçš„åŒºåˆ«äº†</p>

<ul>
<li>è¿™é‡Œçš„2.4Gå’Œ5G å…·ä½“åº”è¯¥æ˜¯2.4Ghzå’Œ5Ghz æ‰€ä»¥è¿™é‡Œçš„5Gå’Œ5Gé€šä¿¡ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µ</li>
<li>2.4Gä¼ è¾“è·ç¦»è¾ƒé•¿ï¼Œå¸¦å®½è¦å°‘ï¼Œç©¿å¢™èƒ½åŠ›è¦å¥½ï¼Œä½†æ˜¯ç½‘ç»œæ‹¥å µä¹Ÿæ¯”è¾ƒå¤š</li>
<li>5Gä¼ è¾“è·ç¦»è¾ƒçŸ­ï¼Œå¸¦å®½è¦å¤šä¸€äº›ï¼Œç©¿å¢™èƒ½åŠ›è¾ƒå¼±ï¼Œç½‘ç»œæ‹¥å µå°‘</li>
</ul>


<p>é‚£ä¹ˆè¯¥æ€ä¹ˆé€‰æ‹©</p>

<ul>
<li>æœ‰äº›è®¾å¤‡ä¸æ”¯æŒ5Gï¼Œä»…æ”¯æŒ2.4Ghzï¼Œå°¤å…¶æ˜¯ä¸€äº›å¸¦WIFIçš„ç©ºè°ƒå’Œç±³å®¶è®¾å¤‡</li>
<li>å¦‚æœä½ çš„è®¾å¤‡æ”¯æŒ5Gï¼ˆå³èƒ½æœç´¢åˆ°_5Gç»“å°¾çš„WIFIï¼‰è·ç¦»è·¯ç”±å™¨æ¯”è¾ƒè¿‘ï¼Œæˆ–è€…éš”å¢™å°‘ï¼Œå»ºè®®ä½¿ç”¨5G</li>
<li>å½“ç„¶å®é™…æƒ…å†µä¸‹ï¼Œå¯ä»¥åˆ†åˆ«è¿æ¥ä½¿ç”¨speedteståšä¸ªæµ‹é€Ÿ</li>
</ul>


<h3>Macè¿æ¥5Gå±…ç„¶æœ€æ…¢ï¼Œæ›´æ”¹ä¿¡é“</h3>

<p>æ‰‹æœºä¸Šä¸€åˆ‡éƒ½å¥½äº†ï¼Œå¯æ˜¯æˆ‘ä½¿ç”¨Macè¿æ¥5Gï¼Œå‘ç°å‡ºå¥‡åœ°æ…¢ï¼Œç”±äºæˆ‘çš„Macå®‰è£…äº†åŒç³»ç»Ÿï¼Œåˆ‡åˆ°windowsä¸‹ï¼Œå¯ä»¥è·‘æ»¡300Mï¼Œä½†æ˜¯Macç³»ç»Ÿä¸‹å°±ä¸è¡Œã€‚å°è¯•äº†å¾ˆå¤šæ–¹æ³•ï¼Œæœ€åä¿®æ”¹äº†5Gçš„ä¿¡é“ï¼Œæ”¹æˆäº†161ï¼Œæµ‹é€Ÿå°±å¯ä»¥è¾¾åˆ°300Mäº†ã€‚</p>

<p>å¤§å®¶å¯ä»¥æ›´æ”¹5Gçš„ä¿¡é“å»å°è¯•ï¼Œå›½å†…è§„å®šå¯ç”¨çš„5Gä¿¡é“åªæœ‰149ã€153ã€157ã€161ã€165è¿™5ä¸ªï¼Œå…·ä½“ä»¥æµ‹è¯•æ•°æ®ä¸ºå‡†ã€‚</p>

<p>æ³¨æ„æ›´æ”¹ä¿¡é“åï¼Œå»ºè®®é‡å¯è·¯ç”±å™¨æˆ–è€…å®¢æˆ·ç«¯é‡æ–°è¿æ¥WIFIã€‚</p>

<h3>æ‰‹æœºè·‘ä¸æ»¡ï¼Œç”µè„‘å¾ˆå¯ä»¥</h3>

<p>æ³¨æ„ï¼Œæˆ‘åœ¨æµ‹é€Ÿçš„æ—¶å€™ä¹Ÿå‘ç°äº†ï¼Œæ‰‹æœºé€šå¸¸æ— æ³•è·‘æ»¡ï¼Œè€Œç”µè„‘æ˜¯å¯ä»¥çš„ï¼Œè¿™å…¶ä¸­åº”è¯¥å’Œç¡¬ä»¶çš„é…ç½®æœ‰å…³ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[è°æ¥æ£€æŸ¥æ–¹æ³•å‚æ•°åˆæ³•æ€§]]></title>
    <link href="https://droidyue.com/blog/2018/05/15/who-should-be-responsible-for-checking-parameter/"/>
    <updated>2018-05-15T21:31:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/05/15/who-should-be-responsible-for-checking-parameter</id>
    <content type="html"><![CDATA[<p>æˆ‘ä»¬åœ¨ç¼–ç¨‹ä¸­çš„å‡½æ•°æˆ–è€…æ˜¯æ–¹æ³•ï¼Œå¤§å¤šæ•°éƒ½æ˜¯æœ‰å‚æ•°çš„ã€‚å‚æ•°å¯¹äºæ–¹æ³•æ¥è¯´æ˜¯å¾ˆé‡è¦çš„è¾“å…¥æ•°æ®ï¼Œä¼ å…¥çš„å‚æ•°å€¼çš„åˆæ³•æ€§å½±å“ç€æ–¹æ³•çš„ç¨³å®šæ€§ï¼Œä¸¥é‡æ—¶ç”šè‡³å¯èƒ½å¯¼è‡´å´©æºƒé—®é¢˜çš„å‡ºç°ã€‚</p>

<!--more-->


<p>æ¯”å¦‚è¿™æ®µä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>   <span class="k">new</span> <span class="nf">Main</span><span class="o">().</span><span class="na">buy</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">buy</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ä¸Šé¢çš„ä»£ç åœ¨æ‰§è¡Œèµ·æ¥ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå…¶å®è§£å†³èµ·æ¥ä¹ŸæŒºç®€å•ï¼Œå°±æ˜¯åšä¸€äº›éç©ºçš„æ£€æŸ¥ï¼Œæ¯”å¦‚è¿™æ ·,åœ¨è°ƒç”¨å¤„è¿›è¡Œæ ¡éªŒ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">new</span> <span class="nf">Main</span><span class="o">().</span><span class="na">buy</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ–è€…æ˜¯è¿™æ ·åœ¨æ–¹æ³•å®šä¹‰çš„æ—¶å€™å¤„ç†</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">buy</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å°±è¿™ä¸ªæ¡ˆä¾‹è€Œè¨€ï¼Œä¸¤è€…éƒ½å¯ä»¥ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä»€ä¹ˆè§„èŒƒå‘¢</p>

<p>å…¶å®è¿˜æ˜¯æœ‰ä¸€äº›çº¦å®šçš„
å¦‚æœæ–¹æ³•æ˜¯public,protectedç­‰è¿™æ ·è¢«å¤–éƒ¨å¯è°ƒç”¨çš„æ—¶å€™ï¼Œæ–¹æ³•å®šä¹‰æ—¶éœ€è¦è¿›è¡Œå€¼çš„åˆæ³•æ€§æ£€éªŒï¼Œå› ä¸ºæ— æ³•ç¡®ä¿å¤–éƒ¨å§‹ç»ˆä¼ é€’åˆæ³•çš„å‚æ•°å€¼ã€‚
å¯¹äºå†…éƒ¨çš„privateç­‰å¯è§æ€§ç­‰ï¼Œåˆ™ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå†…éƒ¨è°ƒç”¨ç›¸å¯¹æ˜¯å¯æ§æ›´é«˜çš„ã€‚</p>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨JavaDocæ³¨é‡Šä¹Ÿéœ€è¦åŒæ­¥è·Ÿè¿›ï¼Œæ¯”å¦‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm">* bub a book</span>
</span><span class='line'><span class="cm">* @param book could be null</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">buy</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>æˆ‘ä»¬é€šè¿‡å¢åŠ <code>@param book could be null</code>å°±å¯ä»¥å‘Šè¯‰è°ƒç”¨è€…ï¼Œä¸ç”¨åšåˆæ³•æ€§æ£€æŸ¥ï¼Œæ–¹æ³•å†…éƒ¨å·²ç»å¤„ç†äº†ã€‚è¿™ç§æ–¹å¼å¯¹å¼€å‘è€…è¿˜æ˜¯æ¯”è¾ƒå‹å–„çš„ã€‚æ­¤å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨@Nullableæˆ–è€…@NonNullæ¥è¡¨æ˜å½“å‰å‚æ•°çš„æ£€æŸ¥èŒè´£å½’å±ã€‚</p>

<p>è‡³æ­¤æˆ‘ä»¬ä¹Ÿç†æ¸…äº†æ£€æŸ¥æ–¹æ³•å‚æ•°åˆæ³•æ€§çš„è´£ä»»å½’å±ï¼Œæ¬¢è¿è¯„è®ºäº¤æµã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Androidä¸­å®ç°ç”¨æˆ·æ— æ„ŸçŸ¥å¤„ç†åå°å´©æºƒ]]></title>
    <link href="https://droidyue.com/blog/2018/04/01/do-not-bother-the-user-when-app-crash-in-a-background-state/"/>
    <updated>2018-04-01T22:29:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/04/01/do-not-bother-the-user-when-app-crash-in-a-background-state</id>
    <content type="html"><![CDATA[<p>æ­£æ‰€è°“ï¼Œè¦æƒ³æ²¡æœ‰bugï¼Œå°±ä¸€è¡Œä»£ç ä¹Ÿä¸å†™ã€‚Appåˆ°äº†ç”¨æˆ·çš„æ‰‹é‡Œï¼Œè‚¯å®šæ˜¯å´©æºƒè¶Šå°‘è¶Šå¥½ã€‚Androidä¸­çš„å´©æºƒå¤„ç†å’ŒiOSä¸å¤ªä¸€æ ·ï¼ŒiOSå´©æºƒé€šå¸¸æ˜¯é—ªé€€ï¼Œè€Œå®‰å“ä¼šå‡ºç°å¦‚ä¸‹çš„è¹©è„šçš„å¯¹è¯æ¡†</p>

<p><img src="https://asset.droidyue.com/image/app_crash_v1.png" alt="https://asset.droidyue.com/image/app_crash_v1.png" /></p>

<p>å½“ä½ çš„ç”¨æˆ·çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å´©æºƒå¯¹è¯æ¡†æ—¶ï¼Œå¿ƒä¸­å¾—åˆ°â€œè¿™å±Šç¨‹åºå‘˜ä¸è¡Œå•Šâ€çš„æ„Ÿæ…¨ä¹Ÿä¸è¶³ä¸ºå¥‡ã€‚</p>

<!--more-->


<p>åœ¨å®‰å“ä¸­ï¼Œæˆ‘ä»¬åº”ç”¨ä¼šæœ‰æ‰€è°“çš„å‰å°å’Œåå°çš„æ¦‚å¿µï¼Œåœ¨æœ¬æ–‡è¿™é‡Œè¿™æ ·å®šä¹‰ï¼Œå½“å‰åº”ç”¨æœ‰Activityå±•ç¤ºï¼ˆå³ç”¨æˆ·æ˜æ˜¾æ„ŸçŸ¥åœ¨å½“å‰åº”ç”¨ï¼‰ï¼Œçº¦å®šä¸ºå‰å°ï¼Œå¦åˆ™ä¸ºåå°ã€‚</p>

<p>å¦‚æœåœ¨å‰å°æ—¶ï¼Œå‘ç”Ÿå´©æºƒç”¨æˆ·æ˜¯æ˜æ˜¾èƒ½æ„ŸçŸ¥çš„ï¼Œä½†å€˜è‹¥å‘ç”Ÿåœ¨åå°ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›ç®€å•çš„å°æ“ä½œï¼Œè®©ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°å´©æºƒçš„å‘ç”Ÿï¼ˆå³ä¸å¼¹å‡ºå´©æºƒçš„å¯¹è¯æ¡†ï¼‰ã€‚</p>

<p>åŸç†å…¶å®è›®ç®€å•çš„ã€‚</p>

<ul>
<li>æ£€æµ‹æ˜¯å¦ä¸ºåå°</li>
<li>å¦‚æœæ˜¯åå°åˆ™æ€æ‰è¯¥è¿›ç¨‹ï¼Œå¦åˆ™æ‰§è¡Œé»˜è®¤çš„å´©æºƒå¤„ç†</li>
</ul>


<p>æ£€æµ‹æ˜¯å¦ä¸ºåå°ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥è¿›ç¨‹ä¸­Activityçš„æ•°é‡ä½œä¸ºåˆ¤æ–­æ ‡å‡†</p>

<ul>
<li>å½“activity onStartæ—¶activityCountè‡ªå¢</li>
<li>å½“Activity onStopæ—¶activityCountè‡ªå‡</li>
<li>å½“activityCountä¸º0ï¼Œæˆ‘ä»¬åˆ™è®¤ä¸ºåº”ç”¨å¤„äºåå°çŠ¶æ€</li>
</ul>


<p>å…·ä½“å®ç°å¦‚ä¸‹</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">object</span> <span class="nl">ActivityLifecycleCallbackImp:</span> <span class="n">Application</span><span class="o">.</span><span class="na">ActivityLifecycleCallbacks</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">var</span> <span class="nl">activityCount:</span> <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityPaused</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityResumed</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityStarted</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">activityCount</span> <span class="o">++</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityDestroyed</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivitySaveInstanceState</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?,</span> <span class="nl">outState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityStopped</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">activityCount</span><span class="o">--</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onActivityCreated</span><span class="o">(</span><span class="nl">activity:</span> <span class="n">Activity</span><span class="o">?,</span> <span class="nl">savedInstanceState:</span> <span class="n">Bundle</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åœ¨Applicationä¸­è¿›è¡Œæ³¨å†Œ</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">MyApplication</span> <span class="o">:</span> <span class="n">Application</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>       <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">()</span>
</span><span class='line'>       <span class="n">registerActivityLifecycleCallbacks</span><span class="o">(</span><span class="n">ActivityLifecycleCallbackImp</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å‰©ä¸‹çš„å°±æ˜¯è®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„æœªæ•è·å¼‚å¸¸å¤„ç†å¤„ç†å™¨</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">val</span> <span class="n">defaultHandler</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">getDefaultUncaughtExceptionHandler</span><span class="o">()</span>
</span><span class='line'><span class="n">Thread</span><span class="o">.</span><span class="na">setDefaultUncaughtExceptionHandler</span> <span class="o">{</span> <span class="n">thread</span><span class="o">,</span> <span class="n">exception</span> <span class="o">-&gt;</span>
</span><span class='line'>   <span class="n">exception</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">()</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">isBackground</span> <span class="o">=</span> <span class="n">ActivityLifecycleCallbackImp</span><span class="o">.</span><span class="na">activityCount</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>   <span class="k">if</span> <span class="o">(</span><span class="n">isBackground</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">&quot;MyApplication&quot;</span><span class="o">,</span> <span class="s">&quot;isBackground just kill the process without annoying users&quot;</span><span class="o">)</span>
</span><span class='line'>       <span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Process</span><span class="o">.</span><span class="na">killProcess</span><span class="o">(</span><span class="n">android</span><span class="o">.</span><span class="na">os</span><span class="o">.</span><span class="na">Process</span><span class="o">.</span><span class="na">myPid</span><span class="o">())</span>
</span><span class='line'>   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">defaultHandler</span><span class="o">.</span><span class="na">uncaughtException</span><span class="o">(</span><span class="n">thread</span><span class="o">,</span> <span class="n">exception</span><span class="o">)</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>è‡³æ­¤åŠŸèƒ½å°±åŸºæœ¬å®ç°äº†ï¼Œç›¸å¯¹ä¹‹å‰ç¡¬é‚¦é‚¦çš„å¯¹è¯æ¡†ï¼Œåå°æ— å¹²æ‰°ç”¨æˆ·çš„é»˜é»˜æ€æ‰è¿›ç¨‹è¦å‹å¥½å¾ˆå¤šäº†ã€‚</p>

<p>å…³äºå´©æºƒçš„æ–‡ç« ï¼Œæˆ‘è¿˜æœ‰ä¸€ç¯‡ç›¸å…³çš„ï¼Œè¯·ç§»æ­¥è¿™é‡Œ<a href="https://droidyue.com/blog/2015/12/06/practise-about-crash-in-android/">Androidå¤„ç†å´©æºƒçš„ä¸€äº›å®è·µ</a>æŸ¥çœ‹ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºæ”¹å–„å¼ºè¿«ç—‡çš„ä¸€äº›æ–¹æ³•]]></title>
    <link href="https://droidyue.com/blog/2018/03/17/qiangpozheng/"/>
    <updated>2018-03-17T14:35:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/03/17/qiangpozheng</id>
    <content type="html"><![CDATA[<p>ä¸€ç›´ä»¥æ¥æˆ‘éƒ½æœ‰å¼ºè¿«ç—‡ï¼Œå°¤å…¶æ˜¯æ¯•ä¸šå·¥ä½œåï¼Œæ˜æ˜¾åœ°æ„Ÿè§‰æ›´åŠ ä¸¥é‡äº†ã€‚ç»å¸¸åå¤ç¡®è®¤æ°´é¾™å¤´æœ‰æ²¡æœ‰å…³ï¼Œé”é—¨åä¸‹æ¥¼æ¢¯ï¼Œå¾€å¾€åˆè¦ä¸Šæ¥æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦çœŸçš„é”ä¸Šã€‚æ€»æ˜¯æ‹…å¿ƒå¤©ç„¶æ°”æ°”æœ‰æ²¡æœ‰å…³ç´§ã€‚å¦‚æ­¤ç§ç§ï¼Œæ¯ä¸€å¤©åœ¨å‡ºé—¨ç¦»å®¶çš„æ—¶å€™éƒ½æ˜¯æœ€ç—›è‹¦çš„æ—¶æ®µã€‚</p>

<!--more-->


<p>ç§ç§ç„¦è™‘éƒ½æ˜¯åŸºäºè‡ªå·±çš„æŸç§ç›¸å¯¹æç«¯çš„å¹»æƒ³ï¼Œæ¯”å¦‚æ°´é¾™å¤´æ²¡æœ‰å…³çš„è¯ï¼Œä¼šä½¿å¾—å®¶é‡Œç”šè‡³æ¥¼ä¸‹è¢«æ³¡ï¼›é—¨æ²¡æœ‰é”å¯èƒ½å¯¼è‡´å®¶é‡Œé­çªƒï¼Œé‡è¦ä¸œè¥¿ä¸¢å¤±ï¼›å¤©ç„¶æ°”æ²¡æœ‰å…³å¥½ï¼Œç»“æœæ›´åŠ ä¸¥é‡ã€‚å¦‚æ­¤å¹»æƒ³ååå¤å¤ï¼Œä½¿å¾—æˆ‘å¿ƒç¥ä¸å®ï¼Œå€æ„Ÿç„¦è™‘ã€‚</p>

<p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™äº›å¹»æƒ³ï¼Ÿå‘è‡ªå†…å¿ƒçš„å£°éŸ³å‘Šè¯‰æˆ‘ï¼Œå› ä¸ºä¸æƒ³å› ä¸ºè‡ªå·±çš„ç–å¿½å¯¼è‡´ä»£ä»·è¾ƒå¤§ç”šè‡³ä¸¥é‡çš„åæœã€‚æˆ‘çš„æœ‹å‹ä»¬éƒ½è¯´è¿™æ˜¯ç¼ºä¹å®‰å…¨æ„Ÿçš„è¡¨ç°ï¼Œæˆ‘ä¹Ÿå¾ˆè®¤åŒè¿™ä¸€ç‚¹ã€‚</p>

<p>æˆ‘è®°å¾—æœ€ä¸¥é‡çš„ä¸€æ¬¡å°±æ˜¯æœ€è¿‘ï¼Œæˆ‘å·²ç»ä¹˜ååœ°é“é©¶å‡ºå¥½å‡ ç«™äº†ï¼Œä½†æ˜¯çªç„¶é—´åœ¨æƒ³æœ‰æ²¡æœ‰å…³çª—æˆ·å‘¢ï¼ŒçŠ¹è±«äº†å‡ åˆ†é’Ÿï¼Œæˆ‘ä¾¿åšå‡ºäº†è¿”ç¨‹å›å®¶ç¡®è®¤çš„å†³å®šï¼Œå›å®¶ç¡®è®¤ï¼Œçª—æˆ·ç´§ç´§å¾—é”ç€ã€‚äºæ˜¯ä¾¿å®‰å¿ƒäº†ï¼Œå¯æ˜¯è¿™ä¸€æŠ˜è…¾ï¼Œä¸Šç­æ—¶é—´å»¶è¯¯äº†30å¤šåˆ†é’Ÿã€‚å†…å¿ƒä¹Ÿç€å®åœ°ç—›è‹¦ã€‚</p>

<p>ä¸ºä»€ä¹ˆå½“æ—¶æ˜æ˜å…³ä¸Šçª—æˆ·é”ä¸Šé—¨ï¼Œè¿‡åå°±ä¸è®°å¾—äº†å‘¢ï¼Ÿå…³äºåŸå› çš„è§£é‡Šå¦‚ä¸‹</p>

<blockquote><p>è®¤çŸ¥å¿ƒç†å­¦é‡Œæœ‰ä¸ªè¯å„¿å«â€œç¬æ—¶è®°å¿†â€ï¼Œåˆå«â€œæ„Ÿè§‰ç™»è®°â€ã€‚æ„æ€æ˜¯è¯´ï¼Œå¤–éƒ¨ä¿¡æ¯åˆºæ¿€åˆ°äººçš„æ„Ÿå®˜ï¼Œå°±ä¼šåœ¨äººçš„å¤§è„‘é‡Œè¢«æš‚æ—¶æ€§çš„è´®å­˜ï¼Œè¿™ç§ä¸æ˜¯æœ‰æ„è¯†å»è·å¾—çš„å°±å«åšç¬æ—¶è®°å¿†ã€‚å®ƒå…·æœ‰ä¸°å¯Œçš„ä¿¡æ¯é‡ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½æ˜¯ä¸‹æ„è¯†ã€è¢«åŠ¨è·å¾—çš„ï¼Œå¤„äºæœªç»åŠ å·¥çš„åŸå§‹çŠ¶æ€ã€‚è¯´ç™½äº†å°±æ˜¯ï¼Œä½ çš„çœ¼ç›çœ‹è§äº†ï¼Œä½ çš„è€³æœµå¬è§äº†ï¼Œä½†æ˜¯ä½ æ²¡è¿‡è„‘å­ã€‚æ²¡è¿‡è„‘å­çš„è¿™ç§è®°å¿†ï¼Œä¿æŒæ—¶é—´å¾ˆçŸ­ï¼Œå¾ˆå®¹æ˜“ä¸§å¤±ã€‚è€Œäººçš„è®°å¿†åˆå¾ˆå®¹æ˜“å—åˆ°èº«è¾¹æ‰€æ„ŸçŸ¥åˆ°çš„ç©ºé—´çš„å½±å“ï¼Œä¸€æ—¦æ‰€å¤„çš„ç©ºé—´å‘ç”Ÿå˜åŒ–ï¼Œè®°å¿†ä¼šè¿›è¡Œä¸€äº›é‡æ–°å»ºæ„ã€‚è¿™å°±æ›´å®¹æ˜“æŠŠä¹‹å‰çš„ç¬æ—¶è®°å¿†ç»™ä¸¢äº†ã€‚å› è€Œå“ªæ€•æ˜¯èµ°ä¸‹æ¥¼ï¼Œå°±æƒ³ä¸èµ·æ¥åˆ°åº•æœ‰æ²¡æœ‰åšâ€œé”é—¨â€è¿™ä¸ªé‡å¤æ— æ•°æ¬¡æå…¶ç®€å•çš„åŠ¨ä½œçš„æƒ…å†µï¼Œå†æ­£å¸¸ä¸è¿‡äº†ã€‚</p>

<p>ä½œè€…ï¼šå­é¸¡
é“¾æ¥ï¼š<a href="https://www.zhihu.com/question/20978967/answer/22998357">https://www.zhihu.com/question/20978967/answer/22998357</a>
æ¥æºï¼šçŸ¥ä¹
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote>

<p>åæ¥æ…¢æ…¢åœ°æˆ‘å‘ç°äº†ä¸€äº›ç¼“è§£ç—‡çŠ¶çš„æ–¹æ³•å’ŒæŠ€å·§ã€‚</p>

<h2>å…³äºé”é—¨</h2>

<p>æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªä¸é”™çš„æŠ€å·§ã€‚é‚£å°±æ˜¯ç”¨å¾®ä¿¡æ‹ä¸€ä¸ª10ç§’é’Ÿçš„å…³é—¨å°è§†é¢‘ï¼Œç„¶åå‘ç»™æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹ã€‚å¦‚ä¸‹é¢çš„ç¤ºä¾‹è§†é¢‘è¿™æ ·
<video style="width:50%"   controls>
  <source src="https://asset.droidyue.com/video/close_the_door_video.mp4" type="video/mp4">
</video></p>

<p>è¿™æ ·æ¯æ¬¡å½“è‡ªå·±è®°ä¸èµ·æ¥çš„æ—¶å€™ï¼Œå°±çœ‹çœ‹å°è§†é¢‘å°±èƒ½ç¡®è®¤äº†ã€‚</p>

<h2>ç‡ƒæ°”ç¶</h2>

<p>ç‡ƒæ°”ç¶è¿™ä¸ªä¸€å®šè¦ç¡®ä¿å…³é—­ï¼Œæœ€å¼€å§‹éƒ½æ˜¯æ‰“å¼€ä»¥ä¸‹ï¼Œç„¶åå…³é—­å¬åˆ°â€œå™”â€çš„ä¸€å£°å°±æ”¾å¿ƒäº†ï¼Œä½†æ˜¯è¿™æ˜‚åå¤æ“ä½œä¹Ÿä¸ä¸€å®šå¥½ï¼Œåæ¥åªè¦å¼€å…³é˜€çš„æŒ‡ç¤ºæ ‡æŒ‡å‘Offå°±ç®—å…³é—­ã€‚
<img src="https://asset.droidyue.com/image/ranqizao_off.png" alt="https://asset.droidyue.com/image/ranqizao_off.png" /></p>

<p>ä¸è¿‡åæ¥ï¼Œæˆ‘æ¥è§¦äº†ä¸€ä¸ªæ›´åŠ æ™ºèƒ½çš„æ–¹æ³•ï¼Œæ¯”å¦‚å…³äºæ˜¯å¦é”é—¨ï¼Œæˆ‘ä½¿ç”¨äº†å°ç±³çš„é—¨çª—ä¼ æ„Ÿå™¨ï¼Œå¦‚ä¸‹å›¾ï¼Œé¢œå€¼å¾ˆæ­£ä¹‰ã€‚</p>

<p><img src="https://asset.droidyue.com/image/xiaomi_menchuang_chuanganqi.jpg" alt="https://asset.droidyue.com/image/xiaomi_menchuang_chuanganqi.jpg" /></p>

<p>å¯ä»¥å‡†ç¡®çš„å¾—åˆ°é—¨çš„å…³é—­çŠ¶æ€ã€‚å¹¶ä¸”ç»“åˆé…å¥—çš„å¤šåŠŸèƒ½ç½‘å…³ï¼Œå¯ä»¥å®ç°ï¼Œå½“æŸäº›æ¡ä»¶ä¸‹æ‰“å¼€é—¨ï¼Œè§¦å‘æŠ¥è­¦å‘å£°æˆ–è€…æé†’ç”¨æˆ·ã€‚</p>

<p>åŒæ ·å¯¹äºå¤©ç„¶æ°”ï¼Œå°ç±³ä¹Ÿæœ‰ä¸€ä¸ªæŠ¥è­¦å™¨ï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œå’ŒHoneyWellåˆä½œçš„ï¼Œå€¼å¾—ä¿¡èµ–ã€‚</p>

<p><img src="https://asset.droidyue.com/image/tianranqi_baojing.jpg" alt="https://asset.droidyue.com/image/tianranqi_baojing.jpg" /></p>

<p>å°ç±³ä¼ æ„Ÿå™¨ï¼Œå¤©ç„¶æ°”æŠ¥è­¦å™¨è´­ä¹°åœ°å€: <a href="https://union-click.jd.com/jdc?d=OOBAKt">ç‚¹å‡»è¿™é‡Œäº†è§£</a></p>

<p>é™¤æ­¤ä¹‹å¤–ï¼Œä»å¿ƒç†ä¸Šæ¥è§£å†³æ˜¯å¦å¤–çš„ä¸€ç§å¾ˆæœ‰æ•ˆçš„é€”å¾„ï¼Œæœ‰ä¸€æœ¬å«åš<a href="https://amazon.cn/gp/product/B0028RYAJ0/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=droidyue-23&amp;creative=3200&amp;linkCode=as2&amp;creativeASIN=B0028RYAJ0&amp;linkId=6668c1886a6115ac55956f28ea0efd07">ã€Šèµ°å‡ºå¼ºè¿«ç—‡ï¼šæ‰¾å›ç¾ä¸½çš„æ—¥å­ã€‹</a>  çš„ä¹¦ï¼Œé‡Œé¢æœ‰å¾ˆå¤šæ¡ˆä¾‹ï¼Œå¯¹äºè§£å†³é—®é¢˜è¿˜æ˜¯å¾ˆæœ‰å‚è€ƒä»·å€¼å’Œå¸®åŠ©çš„ã€‚</p>

<p>å…³äºå¼ºè¿«ç—‡ï¼Œæˆ‘ç›®å‰çš„åŠæ³•å°±æ˜¯è¿™äº›ï¼Œæ€»çš„æ¥è¯´è¿™æ ·ä¸‹æ¥å†ä¹Ÿä¸ä¼šå‡ºç°èµ°å‡ºå‡ å…¬é‡Œï¼Œåˆå›æ¥æ£€æŸ¥çš„è¡Œä¸ºäº†ã€‚ç¡®å®ç—›è‹¦å‡è½»äº†ä¸å°‘ã€‚</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[AndroidåŸºäºåæ ‡å¯¹Viewè¿›è¡Œæ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶]]></title>
    <link href="https://droidyue.com/blog/2018/03/11/simulate-view-click-by-x-and-y/"/>
    <updated>2018-03-11T20:30:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/03/11/simulate-view-click-by-x-and-y</id>
    <content type="html"><![CDATA[<p>åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¯¹äºViewè¿›è¡Œæ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“ï¼Œæ¯”å¦‚è°ƒç”¨<code>View.performClick</code>å³å¯ã€‚</p>

<p>ä½†æ˜¯æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦æ›´åŠ ç²¾ç»†çš„ç‚¹å‡»ï¼Œæ¯”å¦‚Viewçš„æŸä¸€åŒºåŸŸæˆ–è€…æŸä¸€ç‚¹è¿›è¡Œç‚¹å‡»ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚</p>

<!--more-->


<p><img src="https://asset.droidyue.com/image/simulate_view_click.png" alt="https://asset.droidyue.com/image/simulate_view_click.png" /></p>

<p>ä¸Šé¢æ˜¯ä¸€ä¸ªWebViewåŠ è½½äº†ä¸€ä¸ªè§†é¢‘ï¼Œæˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨ç‚¹ä¸€ä¸‹æ’­æ”¾æŒ‰é’®æ‰èƒ½è®©è§†é¢‘æ’­æ”¾ï¼Œå½“ç„¶æˆ‘ä»¬æƒ³è¦çš„æœ€å¥½æ˜¯å¦‚ä¸‹çš„è‡ªåŠ¨æ’­æ”¾æ•ˆæœï¼ˆè¿›å…¥ç•Œé¢åï¼Œè‡ªåŠ¨æ’­æ”¾è§†é¢‘ï¼‰</p>

<p><img src="https://asset.droidyue.com/image/simulate_view_click_by_x.y.gif" alt="https://asset.droidyue.com/image/simulate_view_click_by_x.y.gif" /></p>

<p>å½“ç„¶æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚é€šè¿‡javascriptè°ƒç”¨è§†é¢‘å…ƒç´ çš„clickäº‹ä»¶ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æš‚ä¸å¯¹è¯¥æ–¹æ³•è¿›è¡Œç»†ç©¶ã€‚æœ¬æ–‡æ—¨åœ¨æä¾›ä¸€ç§è§£å†³é—®é¢˜çš„å¯è¡Œæ–¹æ³•ã€‚</p>

<p>å…¶å®æˆ‘ä»¬å¯ä»¥é€šè¿‡View.dispatchTouchEventå°±èƒ½è§£å†³ï¼Œå› ä¸ºä¸€ä¸ªclickäº‹ä»¶å¯ä»¥ç†è§£æˆä¸€ä¸ªAction_downå’Œä¸€ä¸ªAction_up MotionEventçš„ç»„åˆï¼Œæ‰€ä»¥å®ç°èµ·æ¥å¦‚ä¸‹å³å¯ã€‚</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">fun</span> <span class="nf">simulateTouchEvent</span><span class="o">(</span><span class="nl">view:</span> <span class="n">View</span><span class="o">,</span> <span class="nl">x:</span> <span class="n">Float</span><span class="o">,</span> <span class="nl">y:</span> <span class="n">Float</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">downTime</span> <span class="o">=</span> <span class="n">SystemClock</span><span class="o">.</span><span class="na">uptimeMillis</span><span class="o">()</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">eventTime</span> <span class="o">=</span> <span class="n">SystemClock</span><span class="o">.</span><span class="na">uptimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="mi">100</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">metaState</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>   <span class="n">val</span> <span class="n">motionEvent</span> <span class="o">=</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">obtain</span><span class="o">(</span><span class="n">downTime</span><span class="o">,</span> <span class="n">eventTime</span><span class="o">,</span>
</span><span class='line'>           <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_DOWN</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">metaState</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">view</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">motionEvent</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>   <span class="n">val</span> <span class="n">upEvent</span> <span class="o">=</span> <span class="n">MotionEvent</span><span class="o">.</span><span class="na">obtain</span><span class="o">(</span><span class="n">downTime</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">,</span> <span class="n">eventTime</span> <span class="o">+</span> <span class="mi">1000</span><span class="o">,</span>
</span><span class='line'>           <span class="n">MotionEvent</span><span class="o">.</span><span class="na">ACTION_UP</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">,</span> <span class="n">metaState</span><span class="o">)</span>
</span><span class='line'>   <span class="n">view</span><span class="o">.</span><span class="na">dispatchTouchEvent</span><span class="o">(</span><span class="n">upEvent</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å…³äºåæ ‡ä½ç½®çš„é€‰æ‹©ï¼Œä»”ç»†åˆ†æä½ ä¼šå‘ç°ï¼Œä¸Šé¢çš„è§†é¢‘çš„æ’­æ”¾æŒ‰é’®å…¶å®æ˜¯æœ‰ç‰¹ç‚¹çš„ï¼Œæ’­æ”¾æŒ‰é’®å§‹ç»ˆå¤„äºWebViewçš„ä¸­å¿ƒï¼Œå³æ¨¡æ‹Ÿçš„ç‚¹å‡»å¯ä»¥æ˜¯WebView.getWidth/2å’ŒWebView.height/2è¿™ä¸ªç‚¹ã€‚</p>

<p>ä¸ºäº†ä¾¿äºæµ‹è¯•å’ŒéªŒè¯æ¨¡æ‹Ÿäº‹ä»¶çš„æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ OnTouchListenerè¿›è¡ŒéªŒè¯ï¼Œå¦‚ä¸‹ä»£ç </p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">webview</span><span class="o">?.</span><span class="na">setOnTouchListener</span> <span class="o">{</span> <span class="n">v</span><span class="o">,</span> <span class="n">event</span> <span class="o">-&gt;</span>
</span><span class='line'>   <span class="n">debugMessage</span><span class="o">(</span><span class="s">&quot;onTouchListener x=${event.x};y=${event.y}&quot;</span><span class="o">)</span>
</span><span class='line'>   <span class="kc">false</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>å¯¹äºä¾‹å­ä¸­çš„ä½•æ—¶å‡ºå‘æ¨¡æ‹Ÿäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨WebViewç½‘é¡µåŠ è½½å®Œæˆçš„æ—¶å€™å®ç°ï¼Œå³</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">webview</span><span class="o">?.</span><span class="na">webViewClient</span> <span class="o">=</span> <span class="n">object</span> <span class="o">:</span> <span class="n">WebViewClient</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>   <span class="n">override</span> <span class="n">fun</span> <span class="nf">onPageFinished</span><span class="o">(</span><span class="nl">view:</span> <span class="n">WebView</span><span class="o">?,</span> <span class="nl">url:</span> <span class="n">String</span><span class="o">?)</span> <span class="o">{</span>
</span><span class='line'>       <span class="kd">super</span><span class="o">.</span><span class="na">onPageFinished</span><span class="o">(</span><span class="n">view</span><span class="o">,</span> <span class="n">url</span><span class="o">)</span>
</span><span class='line'>       <span class="n">webview</span><span class="o">?.</span><span class="na">post</span> <span class="o">{</span>
</span><span class='line'>           <span class="n">webview</span><span class="o">?.</span><span class="na">let</span> <span class="o">{</span>
</span><span class='line'>               <span class="n">simulateTouchEvent</span><span class="o">(</span><span class="n">it</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">width</span> <span class="o">/</span> <span class="mi">2</span><span class="n">f</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="na">height</span> <span class="o">/</span> <span class="mi">2</span><span class="n">f</span><span class="o">)</span>
</span><span class='line'>           <span class="o">}</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>   <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>åŸºäºåæ ‡å¯¹Viewè¿›è¡Œæ¨¡æ‹Ÿç‚¹å‡»çš„ä»£ç ç¤ºä¾‹å®Œæ•´ç‰ˆï¼Œè¯·è®¿é—®  <a href="https://github.com/androidyue/SimulateViewClickByXandY">https://github.com/androidyue/SimulateViewClickByXandY</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å…³äºåº”ç”¨Kotlinåçš„ç¼–è¯‘é€Ÿåº¦é—®é¢˜]]></title>
    <link href="https://droidyue.com/blog/2018/01/31/how-to-speed-up-kotlin-compilation/"/>
    <updated>2018-01-31T22:10:00+08:00</updated>
    <id>https://droidyue.com/blog/2018/01/31/how-to-speed-up-kotlin-compilation</id>
    <content type="html"><![CDATA[<p>2017å¹´ Kotlin è¢« Google é’¦å®šä¸º Android å¼€å‘å®˜æ–¹è¯­è¨€ä¹‹ä¸€åï¼Œä¾¿å¦‚ç«å¦‚è¼ã€‚å¾ˆå¤šå›¢é˜Ÿå¼€å§‹åº”ç”¨äº†Kotlinï¼Œå¯è°“æ˜¯æ”¶ç›Šè‰¯å¤šï¼Œå¯æ˜¯ä¹Ÿæœ‰ä¸€äº›é—®é¢˜ï¼Œä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„å°±æ˜¯Kotlinåº”ç”¨åç¼–è¯‘é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚è¿™ç§æ„Ÿè§‰å°±åƒæˆ‘ä»¬ä»Eclipseè¿ç§»åˆ°Android Studioå˜æ…¢å·®ä¸å¤šã€‚æœ¬æ–‡å°†å°è¯•ä»‹ç»ä¸€äº›æ–¹æ³•æ¥æ”¹å–„è¿™ä¸€é—®é¢˜ã€‚</p>

<p>å…³äºé¡¹ç›®ç¼–è¯‘æ…¢æœ‰å¾ˆå¤šåŸå› ï¼Œåœ¨Androidé¡¹ç›®ä¸­ï¼Œé€šå¸¸ä¼šå’ŒKotlinå’ŒGradleæœ‰å…³ç³»ã€‚é¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€ç»„å›¾å°±èƒ½å‘ç°è¿™å…¶ä¸­çš„é—®é¢˜ã€‚å…¶ä¸­</p>

<ul>
<li>çº¢è‰²ä»£è¡¨Java,é’è‰²ä»£è¡¨Kotlin</li>
<li>Xè½´ä»£è¡¨ç¼–è¯‘æ¬¡æ•°æ•°æ®ï¼ŒYè½´è¾¾æ ‡æ¶ˆè€—çš„æ—¶é—´</li>
<li>Javaçš„é¡¹ç›®å’ŒKotlinçš„é¡¹ç›®å®ç°åŠŸèƒ½ä¸€è‡´ï¼Œæ— å…¶ä»–é¢å¤–å·®åˆ«</li>
</ul>


<!--more-->


<p>ä¸‹å›¾çš„æµ‹è¯•ä¸º10æ¬¡è¿ç»­çš„æœªä¿®æ”¹çš„ç¼–è¯‘ï¼Œä¸¤ä¸ªé¡¹ç›®å‡æ²¡æœ‰å¯åŠ¨Gradle daemonã€‚å¯ä»¥çœ‹å‡ºKotlinè€—æ—¶ç¡®å®è¦è€—æ—¶å¤šä¸€äº›ã€‚</p>

<p><img src="https://asset.droidyue.com/image/2019/01/Ten.Consecutive.clean.build.without.gradle.daemon.png" alt="Ten consecutive clean build without gradle daemon" /></p>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å¼€å¯Gradle daemonï¼Œä¸‹å›¾å³ä¸ºæ–°çš„æµ‹è¯•æ•°æ®ï¼ˆè¿ç»­10æ¬¡å¼€å¯gradle daemonç¼–è¯‘ï¼‰ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°å¼€å¯gradle daemonåï¼ŒJavaçš„ç¼–è¯‘è€—æ—¶å’ŒKotlinæ˜æ˜¾å‡å°‘ï¼Œä½†æ˜¯æ€»çš„æ¥çœ‹ï¼ŒKotlinè¿˜æ˜¯è¦è€—æ—¶ä¸€äº›ã€‚
<img src="https://asset.droidyue.com/image/2019/01/Ten.consecutive.clean.builds.with.gradle.daemon.png" alt="Ten consecutive clean build with gradle daemon" /></p>

<p>Kotlinåœ¨1.0.2åï¼Œå¢åŠ äº†å¢é‡ç¼–è¯‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹å¼€å¯å¢é‡ç¼–è¯‘åçš„æ•ˆæœå‘¢ï¼Œå¦‚ä¸‹å›¾ï¼ˆå¯ç”¨å¢é‡ç¼–è¯‘åï¼Œè¿ç»­10æ¬¡æ²¡æœ‰æ–‡ä»¶å˜åŒ–çš„ç¼–è¯‘ï¼‰</p>

<p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé™¤äº†ç¬¬ä¸€æ¬¡ç¼–è¯‘å·®è·å¤§ä¸€äº›çš„æƒ…å†µå¤–ï¼ˆå› ä¸ºå¢é‡ç¼–è¯‘å¯¹ç¬¬ä¸€æ¬¡ç¼–è¯‘ä¸èµ·ä½œç”¨ï¼‰ï¼Œåç»­çš„Javaå’ŒKotlinç¼–è¯‘æ—¶é—´å‡ ä¹ä¸€æ ·ï¼Œç”šè‡³Kotlinè€—æ—¶æ›´å°‘ã€‚
<img src="https://asset.droidyue.com/image/2019/01/Tensecutive.increament.builds.with.no.files.changed.png" alt="TenXconsecutiveincrementalbuildswithnofileschanged.png" /></p>

<p>ä¸€ä¸ªæ–‡ä»¶ä¸ä¿®æ”¹çš„å¢é‡ç¼–è¯‘ç°å®ä¸­å¾ˆå°‘ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬éƒ½ä¼šè¿›è¡Œæ–‡ä»¶çš„ä¿®æ”¹ã€‚å½“æˆ‘ä»¬å°è¯•ä¿®æ”¹ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œå†æ¬¡æ‰§è¡Œæµ‹è¯•ï¼Œçœ‹ä¸€çœ‹æœ‰ä»€ä¹ˆæ•ˆæœï¼Œå¦‚ä¸‹å›¾ã€‚</p>

<p>çœŸçš„ä¸å¯æ€è®®ï¼ŒKotlinè€—æ—¶è¿™ä¸‹å·²ç»å’ŒJavaæ‹‰å¼€äº†æ›´å¤§çš„å·®è·ï¼Œè¡¨ç°çš„æ›´åŠ ä¼˜ç§€ã€‚</p>

<p><img src="https://asset.droidyue.com/image/2019/01/Ten.consecutive.increamental.builds.with.one.isolated.file.changed.png" alt="Ten.consecutive.increamental.builds.with.one.isolated.file.changed.png" /></p>

<p>ç„¶è€Œé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬çš„ä¿®æ”¹å¾€å¾€å¯èƒ½æ˜¯é’ˆå¯¹ä¸€å—æ ¸å¿ƒçš„ä»£ç ï¼Œå¾ˆå¤šçš„åœ°æ–¹éƒ½è°ƒç”¨å®ƒï¼Œå½“æˆ‘ä»¬åœ¨å°è¯•ä¿®æ”¹ä¸€ä¸ªæ ¸å¿ƒä»£ç ï¼Œè¿ç»­10æ¬¡è¿›è¡Œæµ‹è¯•ï¼ˆkotlinå¼€å¯å¢é‡ç¼–è¯‘ï¼‰ï¼Œæ•°æ®åˆæ˜¯å¦‚ä½•å‘¢ï¼Ÿ</p>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒKotlinè¡¨ç°ä¾ç„¶ä¼˜ç§€äºJavaã€‚</p>

<p><img src="https://asset.droidyue.com/image/2019/01/Ten.consecutive.incremental.buids.with.one.core.file.changed.png" alt="Tenconsecutiveincrementalbuildswithonecorefilechanged.png" /></p>

<p>é€šè¿‡ä¸Šé¢çš„å›¾ä¾‹è¯´æ˜ï¼Œæˆ‘ä»¬å‘ç°å…¶å®Kotlinåœ¨æŸäº›æƒ…å†µä¸‹ç¼–è¯‘å¹¶ä¸æ…¢ã€‚åŒæ ·æˆ‘ä»¬ä¹Ÿå‘ç°äº†ä¸€äº›åŠ é€ŸKotlinç¼–è¯‘çš„æ–¹æ³•ï¼Œå³</p>

<ul>
<li>å¼€å¯gradle daemonï¼Œå³åœ¨~/.gradle/gradle.propertiesæ–‡ä»¶ä¸­ï¼Œå¢åŠ org.gradle.daemon=true</li>
<li>åœ¨é¡¹ç›®çš„gradle.propertiesä¸­å¢åŠ kotlin.incremental=true  å¼€å¯kotlinçš„å¢é‡ç¼–è¯‘ã€‚</li>
<li>å°è¯•ä½¿ç”¨æœ€æ–°çš„kotlinç‰ˆæœ¬ï¼Œå¢åŠ ç¼–è¯‘é€Ÿåº¦æ˜¯Kotlinå›¢é˜Ÿä¸€ç›´åŠªåŠ›çš„ç›®æ ‡</li>
<li>æ›´å¤šçš„åŠ é€Ÿç¼–è¯‘çš„æ–¹æ³•ï¼Œè¯·å‚è€ƒ<a href="http://droidyue.com/blog/2017/04/16/speedup-gradle-building/">ä¸€äº›å…³äºåŠ é€ŸGradleæ„å»ºçš„ä¸ªäººç»éªŒ</a></li>
</ul>


<h2>å¼•ç”¨èµ„æ–™</h2>

<ul>
<li>æ–‡ä¸­çš„æµ‹è¯•æ•°æ®å›¾å¼•ç”¨å‡ºä¸º<a href="https://medium.com/keepsafe-engineering/kotlin-vs-java-compilation-speed-e6c174b39b5d">Kotlin vs Java: Compilation speed</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
