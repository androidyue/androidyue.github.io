<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[技术小黑屋]]></title>
  <link href="https://droidyue.com/atom.xml" rel="self"/>
  <link href="https://droidyue.com/"/>
  <updated>2020-10-09T18:12:11+08:00</updated>
  <id>https://droidyue.com/</id>
  <author>
    <name><![CDATA[androidyue]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[巧用Kotlin反射实现按值取名，调试做到多快好省]]></title>
    <link href="https://droidyue.com/blog/2020/05/31/using-kotlin-reflection-to-get-constant-variable-name-by-value/"/>
    <updated>2020-05-31T20:55:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/31/using-kotlin-reflection-to-get-constant-variable-name-by-value</id>
    <content type="html"><![CDATA[<h2>痛点</h2>

<p>我们经常会定义一些常量，比如</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ItemType</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TYPE_TEXT</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TYPE_IMG</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TYPE_VIDEO</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TYPE_AUDIO</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TYPE_LINK</span> <span class="o">=</span> <span class="mi">4</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>当我们打印查看是哪种类型的时候，如果单纯是打印int值，并不能足够解释业务信息，所以，为了更好的输出信息，我们通常会这样做</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="n">fun</span> <span class="nf">inspectItemTypeUgly</span><span class="o">(</span><span class="nl">itemType:</span> <span class="n">Int</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">val</span> <span class="n">type</span> <span class="o">=</span> <span class="n">when</span><span class="o">(</span><span class="n">itemType</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">ItemType</span><span class="o">.</span><span class="na">TYPE_TEXT</span> <span class="o">-&gt;</span> <span class="s">&quot;text&quot;</span>
</span><span class='line'>        <span class="n">ItemType</span><span class="o">.</span><span class="na">TYPE_AUDIO</span> <span class="o">-&gt;</span> <span class="s">&quot;audio&quot;</span>
</span><span class='line'>        <span class="n">ItemType</span><span class="o">.</span><span class="na">TYPE_IMG</span> <span class="o">-&gt;</span> <span class="s">&quot;image&quot;</span>
</span><span class='line'>        <span class="n">ItemType</span><span class="o">.</span><span class="na">TYPE_LINK</span> <span class="o">-&gt;</span> <span class="s">&quot;link&quot;</span>
</span><span class='line'>        <span class="n">ItemType</span><span class="o">.</span><span class="na">TYPE_VIDEO</span> <span class="o">-&gt;</span> <span class="s">&quot;video&quot;</span>
</span><span class='line'>        <span class="k">else</span> <span class="o">-&gt;</span> <span class="kc">null</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">println</span><span class="o">(</span><span class="s">&quot;inspect item type =${inspectItemTypeUgly(itemType)};originalValue=$itemType&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后这样调用</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">val</span> <span class="n">itemType</span> <span class="o">=</span> <span class="n">getRandomItemType</span><span class="o">()</span>
</span><span class='line'><span class="n">print</span><span class="o">(</span><span class="n">inspectItemTypeUgly</span><span class="o">(</span><span class="n">itemType</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样做能打印出更加有意义的信息，但是需要编写额外的将int转换成String的方法，可谓是费时费力。</p>

<h2>有没有好办法</h2>

<p>方法是有的。</p>

<p>比如我们定义<code>public static final int TYPE_TEXT = 0;</code>的时候，我们定义了常量名和常量值。那么</p>

<ul>
<li>我们可以利用变量值查找对应的变量名</li>
<li>借助 Kotlin便捷的特性和反射库，我们可以更好更轻松实现。</li>
</ul>


<h2>秀代码</h2>

<h3>针对 Java 类（接口）和普通的 Kotlin类</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">getConstantNameByValueFromNormalClass</span><span class="p">(</span><span class="n">kClass</span><span class="p">:</span> <span class="n">KClass</span><span class="p">&lt;*&gt;,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">kClass</span><span class="p">.</span><span class="n">staticProperties</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>调用示例</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;itemType=${ItemType::class.getConstantNameByValueFromNormalClass(itemType)}&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>针对 Kotlin object</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">getConstantNameByValueForObject</span><span class="p">(</span><span class="n">kClass</span><span class="p">:</span> <span class="n">KClass</span><span class="p">&lt;*&gt;,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">kClass</span><span class="p">.</span><span class="n">memberProperties</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>调用示例</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="c1">//定义常量在Object对象中</span>
</span><span class='line'><span class="n">object</span> <span class="n">ErrorCodes</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">const</span> <span class="k">val</span> <span class="n">ERROR_OK</span> <span class="p">=</span> <span class="m">0</span>
</span><span class='line'>    <span class="n">const</span> <span class="k">val</span> <span class="n">ERROR_INVALID_PARAM</span> <span class="p">=</span> <span class="m">1</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//调用处</span>
</span><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;errorCode=&quot;</span> <span class="p">+</span> <span class="n">ErrorCodes</span><span class="p">::</span><span class="n">class</span><span class="p">.</span><span class="n">getConstantNameByValueForObject</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h3>针对 Kotlin Top Level 变量的问题</h3>

<ul>
<li>对于 Kotlin变量定义，我们推荐是定义在top level层级。</li>
<li>但是 Kotlin无法直接访问到 top level 层级的类</li>
<li>我们需要借助一些变量来辅助获取 top level 层级的类</li>
<li>但是 Kotlin的反射无法top level类，所以我们必须使用java class</li>
</ul>


<h4>借助一个变量或者顶层类</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">const</span> <span class="k">val</span> <span class="n">SOURCE_REMOTE</span> <span class="p">=</span> <span class="m">0</span>
</span><span class='line'><span class="n">const</span> <span class="k">val</span> <span class="n">SOURCE_LOCAL</span> <span class="p">=</span> <span class="m">1</span>
</span><span class='line'>
</span><span class='line'><span class="k">val</span> <span class="n">myConstantTopClass</span> <span class="p">=</span> <span class="n">object</span> <span class="p">:</span> <span class="n">Any</span><span class="p">()</span> <span class="p">{}.</span><span class="n">javaClass</span><span class="p">.</span><span class="n">enclosingClass</span>
</span></code></pre></td></tr></table></div></figure>


<h4>借助 Java class来获取常量（用KClass会抛出不支持异常）</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Class</span><span class="p">&lt;*&gt;.</span><span class="n">getConstantNameByValues</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">declaredFields</span><span class="p">.</span><span class="n">mapNotNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">kotlinProperty</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>调用处</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">println</span><span class="p">(</span><span class="s">&quot;sourceType=&quot;</span> <span class="p">+</span> <span class="n">myConstantTopClass</span><span class="p">.</span><span class="n">getConstantNameByValues</span><span class="p">(</span><span class="m">0</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<h2>总代码</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="n">import</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">KClass</span>
</span><span class='line'><span class="n">import</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">full</span><span class="p">.</span><span class="n">memberProperties</span>
</span><span class='line'><span class="n">import</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">full</span><span class="p">.</span><span class="n">staticProperties</span>
</span><span class='line'><span class="n">import</span> <span class="n">kotlin</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">jvm</span><span class="p">.</span><span class="n">kotlinProperty</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">KClass</span><span class="p">&lt;*&gt;.</span><span class="n">findConstantNameByValue</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">isKotlinObject</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">getConstantNameByValueForObject</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">getConstantNameByValueFromNormalClass</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">getConstantNameByValueFromNormalClass</span><span class="p">(</span><span class="n">kClass</span><span class="p">:</span> <span class="n">KClass</span><span class="p">&lt;*&gt;,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">kClass</span><span class="p">.</span><span class="n">staticProperties</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">getConstantNameByValueForObject</span><span class="p">(</span><span class="n">kClass</span><span class="p">:</span> <span class="n">KClass</span><span class="p">&lt;*&gt;,</span> <span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">kClass</span><span class="p">.</span><span class="n">memberProperties</span><span class="p">.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">Class</span><span class="p">&lt;*&gt;.</span><span class="n">getConstantNameByValues</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span> <span class="n">String</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">value</span> <span class="p">?:</span> <span class="k">return</span> <span class="k">null</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">declaredFields</span><span class="p">.</span><span class="n">mapNotNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">kotlinProperty</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">filter</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">isFinal</span>
</span><span class='line'>    <span class="p">}.</span><span class="n">firstOrNull</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">it</span><span class="p">.</span><span class="n">getter</span><span class="p">.</span><span class="n">call</span><span class="p">()</span> <span class="p">==</span> <span class="n">value</span>
</span><span class='line'>    <span class="p">}?.</span><span class="n">name</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="n">KClass</span><span class="p">&lt;*&gt;.</span><span class="n">isKotlinObject</span><span class="p">():</span> <span class="n">Boolean</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">objectInstance</span> <span class="p">!=</span> <span class="k">null</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Android 工程增加依赖(Kotlin 反射库)</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">implementation</span> <span class="s">&quot;org.jetbrains.kotlin:kotlin-reflect:$kotlin_version&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>性能问题</h2>

<ul>
<li>都说，反射的话性能比较差，是的，但是也不是那么的差。</li>
<li>如果担心性能，可以限定在非release版本下执行</li>
</ul>


<h2>注意事项</h2>

<ul>
<li>这种方法不适合于代码混淆后进行处理</li>
<li>定义变量的地方，保持业务单一，不要出现多个变量名对应一个变量值的问题</li>
</ul>


<h2>完整代码</h2>

<ul>
<li><a href="https://github.com/androidyue/KotlinReflectionSample">https://github.com/androidyue/KotlinReflectionSample</a></li>
</ul>


<h2>Kotlin其他内容推荐</h2>

<ul>
<li><a href="https://droidyue.com/blog/2019/05/19/do-and-dont-in-kotlin/">编写地道的 Kotlin 代码</a></li>
<li><a href="https://droidyue.com/blog/2017/05/08/how-to-study-kotlin/">研究学习Kotlin的一些方法</a></li>
<li><a href="https://droidyue.com/blog/categories/kotlin/">更多Kotlin系列文章</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[十个超级实用的git命令]]></title>
    <link href="https://droidyue.com/blog/2020/05/19/cool-git-skills/"/>
    <updated>2020-05-19T12:32:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/19/cool-git-skills</id>
    <content type="html"><![CDATA[<p>git无疑已经成为了大家代码版本控制最多的工具了，这其中有不少人是使用终端来进行操作git。这里列出一些超级实用的git脚本，希望可以对大家开发有所帮助。</p>

<p>建议大家讲下面的脚本内容，都保存成脚本，然后设置执行权限，将所在目录加入环境变量，这样使用起来更加方便。</p>

<!--more-->


<h2>查看未合并到master的分支</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>git branch --no-merged master
</span></code></pre></td></tr></table></div></figure>


<h2>列出最近修改过的分支</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>git <span class="k">for</span>-each-ref --count<span class="o">=</span>30 --sort<span class="o">=</span>-committerdate refs/heads/ --format<span class="o">=</span><span class="s1">&#39;%(refname:short)&#39;</span>%
</span></code></pre></td></tr></table></div></figure>


<h2>启用新的vim编写提交信息</h2>

<p>执行前的准备（后续无需执行该脚本），设置vim为默认的编辑器</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git config --global core.editor <span class="s2">&quot;vim&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>每次执行的脚本</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>git commit -a
</span></code></pre></td></tr></table></div></figure>


<h2>将未提交的修改丢弃，恢复到之前的干净状态</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>git reset --hard
</span></code></pre></td></tr></table></div></figure>


<h2>撤销上一个git提交</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> <span class="c">#!/bin/bash</span>
</span><span class='line'> git reset HEAD~
</span></code></pre></td></tr></table></div></figure>


<h2>未提交情况下，取消对于某个文件的修改</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/sh</span>
</span><span class='line'>git reset HEAD <span class="nv">$1</span> <span class="o">&amp;&amp;</span> git checkout <span class="nv">$1</span>
</span></code></pre></td></tr></table></div></figure>


<h2>查看暂存的差异</h2>

<p>用来查看当我们使用<code>git add</code>之后的内容的差异</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>git diff --cached
</span></code></pre></td></tr></table></div></figure>


<h2>切回上一个分支</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git checkout -
</span></code></pre></td></tr></table></div></figure>


<h2>查找包含某个提交的分支列表</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git branch --contains  9666b5979<span class="o">(</span>commit <span class="nb">hash</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>查找包含某个提交的tag列表</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git tag --contains 9666b5979<span class="o">(</span>commit <span class="nb">hash</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[用好 require,check,assert,写好 Kotlin 代码]]></title>
    <link href="https://droidyue.com/blog/2020/05/10/understanding-check-require-assert-in-kotlin/"/>
    <updated>2020-05-10T21:09:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/10/understanding-check-require-assert-in-kotlin</id>
    <content type="html"><![CDATA[<p>在编码的时候，我们需要做很多的检测判断，比如某个变量是否为<code>null</code>，某个成员属性是否为<code>true</code>，执行某个操作结果是否成功。比如像下面的这段代码</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">var</span> <span class="n">isDiskMounted</span> <span class="p">=</span> <span class="k">true</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="nf">createNewFile</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">File</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">if</span> <span class="p">(</span><span class="n">isDiskMounted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">file</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">file</span><span class="p">.</span><span class="n">createNewFile</span><span class="p">()</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>                <span class="k">true</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">println</span><span class="p">(</span><span class="s">&quot;Create file($file) failed&quot;</span><span class="p">)</span>
</span><span class='line'>                <span class="k">false</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">println</span><span class="p">(</span><span class="s">&quot;File($file) is null&quot;</span><span class="p">)</span>
</span><span class='line'>            <span class="k">false</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">println</span><span class="p">(</span><span class="s">&quot;Disk is not mounted&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="k">false</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->


<p>上面的代码实现了</p>

<ul>
<li>检测磁盘是否挂载</li>
<li>检测file参数是否为null</li>
<li>检测执行操作结果是否成功（file.exists()）</li>
</ul>


<p>但是上面的代码也有一些问题</p>

<ul>
<li>太多的if else 检测，层级产生，不够平</li>
<li>多个方法出口</li>
<li>更不容易发现异常和错误（有点类似fail safe模式）</li>
</ul>


<h2>使用今天的知识点改造</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="nf">createNewFileV2</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">File</span><span class="p">?):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">check</span><span class="p">(</span><span class="n">isDiskMounted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;Disk is not mounted&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">requireNotNull</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;file is null&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">file</span><span class="p">.</span><span class="n">createNewFile</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assert</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;createNewFileV2 file($file) does not exist&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">true</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>方法体没有多余层级，比较平</li>
<li>单个方法出口</li>
<li>更快更早发现问题（有点类似fail fast）</li>
<li><code>file.createNewFile()</code>执行时可以不需要再使用<code>file?.createNewFile()</code> 这一点是因为使用了<a href="https://droidyue.com/blog/2019/08/25/kotlin-contract-between-developers-and-the-compiler/">Contract</a>。</li>
</ul>


<h2>require</h2>

<ul>
<li><code>require(boolean)</code> 用来检测方法的参数，当参数boolean为false时，抛出<code>IllegalArgumentException</code></li>
</ul>


<h3>示例代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="nf">readFileContent</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="n">File</span><span class="p">?):</span> <span class="n">String</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//判断file不能为null</span>
</span><span class='line'>    <span class="n">requireNotNull</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//判断文件必须可读，并提供错误的信息</span>
</span><span class='line'>    <span class="n">require</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">canRead</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;readFileContent file($file) is not readable&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//read file content</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&quot;Your file content&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>变种方法</h3>

<ul>
<li><code>fun require(value: Boolean)</code></li>
<li><code>fun require(value: Boolean, lazyMessage: () -&gt; Any)</code></li>
<li><code>fun &lt;T : Any&gt; requireNotNull(value: T?)</code></li>
<li><code>fun &lt;T : Any&gt; requireNotNull(value: T?, lazyMessage: () -&gt; Any)</code></li>
</ul>


<h2>check</h2>

<ul>
<li><code>check(boolean)</code>用来检测对象的状态（属性），如果boolean为false，抛出异常<code>IllegalStateException</code></li>
</ul>


<h3>示例代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">class</span> <span class="nc">Engine</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">isStarted</span> <span class="p">=</span> <span class="k">false</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">fun</span> <span class="nf">speedUp</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">check</span><span class="p">(</span><span class="n">isStarted</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="s">&quot;Engine is not started, cannot be speed up now&quot;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">//speed up the engine</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>变种方法</h3>

<ul>
<li><code>fun check(value: Boolean, lazyMessage: () -&gt; Any)</code></li>
<li><code>fun &lt;T : Any&gt; checkNotNull(value: T?)</code></li>
<li><code>fun &lt;T : Any&gt; checkNotNull(value: T?, lazyMessage: () -&gt; Any)</code></li>
</ul>


<h2>assert</h2>

<ul>
<li><code>assert(boolean)</code> 用来检测执行结果，当boolean为false时，抛出<code>AssertionError</code>。但是需要在开启对应的JVM选项时才生效。</li>
</ul>


<h3>示例代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="nf">makeFile</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">file</span> <span class="p">=</span> <span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span class='line'>    <span class="n">file</span><span class="p">.</span><span class="n">createNewFile</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assert</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;make File($file) failed&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>使用顺序</h2>

<ul>
<li>先使用<code>check</code>检测对象的状态</li>
<li>再使用<code>require</code>检测方法的参数合法性</li>
<li>执行操作后，使用<code>assert</code>校验结果</li>
</ul>


<h2>关于lazyMessage</h2>

<ul>
<li>lazyMessage 可以允许我们提供更详细的错误辅助信息</li>
<li>lazyMessage的类型是<code>()-&gt; Any</code>,结合inline操作，可以实现惰性求值</li>
<li>具体可以参考 <a href="https://droidyue.com/blog/2019/11/24/smart-log-in-android-slash-kotlin/">这可能是最好的 Android/Kotlin日志输出方法</a></li>
</ul>


<h2>崩溃更多了，怎么办</h2>

<ul>
<li>是的，上面无论是<code>require</code>,<code>check</code>,<code>assert</code>都会在发现错误的时候抛出异常</li>
<li>这是为了让问题更早发现，这就是它们的哲学</li>
<li>如果想要考虑稳定的话，可以在业务侧 debug下崩溃，非debug下捕获吞掉异常</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">createNewFile</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="n">safeRun</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">createNewFileV2</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">val</span> <span class="n">isDebug</span> <span class="p">=</span> <span class="k">true</span>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="nf">safeRun</span><span class="p">(</span><span class="n">block</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Unit</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">block</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">t</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">isDebug</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">throw</span>  <span class="n">t</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>更多文章</h2>

<ul>
<li><a href="https://droidyue.com/blog/2019/05/19/do-and-dont-in-kotlin/">编写地道的 Kotlin 代码</a></li>
<li><a href="https://droidyue.com/blog/2017/05/08/how-to-study-kotlin/">研究学习Kotlin的一些方法</a></li>
<li><a href="https://droidyue.com/blog/2020/03/22/kotlin-tips-get-value-safely/">KotlinTips: getValueSafely 安全取值</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[解决Didn't find class java.lang.invoke.SerializedLambda 问题]]></title>
    <link href="https://droidyue.com/blog/2020/05/04/java-dot-lang-dot-invoke-dot-serializedlambda-not-found-android-7-below/"/>
    <updated>2020-05-04T19:28:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/04/java-dot-lang-dot-invoke-dot-serializedlambda-not-found-android-7-below</id>
    <content type="html"><![CDATA[<h2>问题表现</h2>

<ul>
<li>在低于 Android 7（Android Nougat）以下出现</li>
<li>错误的崩溃日志信息如下</li>
</ul>


<!--more-->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Caused</span> <span class="nl">by:</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassNotFoundException</span><span class="o">:</span> <span class="n">Didn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">find</span> <span class="kd">class</span> <span class="err">&quot;</span><span class="nc">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">invoke</span><span class="o">.</span><span class="na">SerializedLambda</span><span class="s">&quot; on path: DexPathList[[dex file &quot;</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="mi">0</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">/.</span><span class="mi">00000000000</span><span class="o">/</span><span class="n">A3AEECD8</span><span class="o">.</span><span class="na">dex</span><span class="s">&quot;, zip file &quot;</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="na">apk</span><span class="err">&quot;</span><span class="o">],</span><span class="n">nativeLibraryDirectories</span><span class="o">=[/</span><span class="n">data</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">arm</span><span class="o">,</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">app</span><span class="o">/</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">base</span><span class="o">.</span><span class="na">apk</span><span class="o">!/</span><span class="n">lib</span><span class="o">/</span><span class="n">armeabi</span><span class="o">-</span><span class="n">v7a</span><span class="o">,</span> <span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">lib</span><span class="o">,</span> <span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">lib</span><span class="o">]]</span>
</span><span class='line'><span class="n">at</span> <span class="n">dalvik</span><span class="o">.</span><span class="na">system</span><span class="o">.</span><span class="na">BaseDexClassLoader</span><span class="o">.</span><span class="na">findClass</span><span class="o">(</span><span class="n">BaseDexClassLoader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">56</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">ClassLoader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">511</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">ClassLoader</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">469</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">libcore</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">InternalNames</span><span class="o">.</span><span class="na">getClass</span><span class="o">(</span><span class="n">InternalNames</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">53</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getDexCacheType</span><span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">476</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">AbstractMethod</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">(</span><span class="n">AbstractMethod</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">166</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span><span class="o">.</span><span class="na">getParameterTypes</span><span class="o">(</span><span class="n">Method</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">170</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Class</span><span class="o">.</span><span class="na">getDeclaredMethods</span><span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">673</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>解决方法</h2>

<p>在项目的 gradle.properties 文件中增加如下一行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>android.enableD8.desugaring<span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[invalid byte sequence in US-ASCII (Argument Error) 问题修复]]></title>
    <link href="https://droidyue.com/blog/2020/05/04/invalid-byte-sequence-in-ascii-argument-error-rake/"/>
    <updated>2020-05-04T19:26:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/04/invalid-byte-sequence-in-ascii-argument-error-rake</id>
    <content type="html"><![CDATA[<p>在使用Octopress（rake命令时报错）<code>invalid byte sequence in US-ASCII (Argument Error) when I run rake</code></p>

<h2>修复方法</h2>

<p>终端执行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">RUBYOPT</span><span class="o">=</span><span class="s2">&quot;-KU -E utf-8:utf-8&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>或者将上面的代码内容放到.bashrc中。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[树莓派修改 DNS 服务器配置]]></title>
    <link href="https://droidyue.com/blog/2020/05/01/set-dns-server-on-reaspberry-pi/"/>
    <updated>2020-05-01T14:18:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/05/01/set-dns-server-on-reaspberry-pi</id>
    <content type="html"><![CDATA[<h2>修改配置文件</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo vim /etc/dhcpcd.conf
</span></code></pre></td></tr></table></div></figure>


<p>增加如下内容，我们使用Google DNS（北京联通测试速度不错）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>static <span class="nv">domain_name_servers</span><span class="o">=</span>8.8.8.8 8.8.4.4
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>完整的示例文件部分</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>interface eth0
</span><span class='line'>        static <span class="nv">ip_address</span><span class="o">=</span>192.168.1.3/24
</span><span class='line'>        static <span class="nv">routers</span><span class="o">=</span>192.168.1.1
</span><span class='line'>        static <span class="nv">domain_name_servers</span><span class="o">=</span>8.8.8.8 8.8.4.4
</span></code></pre></td></tr></table></div></figure>


<h2>设置配置生效</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo service dhcpcd restart
</span></code></pre></td></tr></table></div></figure>


<h2>验证是否生效</h2>

<p>我们使用dig命令验证dns是否生效</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>dig droidyue.com
</span><span class='line'>
</span><span class='line'>; &lt;&lt;&gt;&gt; DiG 9.11.5-P4-5.1-Raspbian &lt;&lt;&gt;&gt; droidyue.com
</span><span class='line'>;; global options: +cmd
</span><span class='line'>;; Got answer:
</span><span class='line'>;; -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: 54841
</span><span class='line'>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
</span><span class='line'>
</span><span class='line'>;; OPT PSEUDOSECTION:
</span><span class='line'>; EDNS: version: 0, flags:; udp: 512
</span><span class='line'>;; QUESTION SECTION:
</span><span class='line'>;droidyue.com.            IN  A
</span><span class='line'>
</span><span class='line'>;; ANSWER SECTION:
</span><span class='line'>droidyue.com.     299 IN  A   104.27.129.205
</span><span class='line'>droidyue.com.     299 IN  A   104.27.128.205
</span><span class='line'>
</span><span class='line'>;; Query <span class="nb">time</span>: 44 msec
</span><span class='line'>;; SERVER: 8.8.8.8#53<span class="o">(</span>8.8.8.8<span class="o">)</span>
</span><span class='line'>;; WHEN: Sun Apr 19 17:07:11 CST 2020
</span><span class='line'>;; MSG SIZE  rcvd: 73
</span></code></pre></td></tr></table></div></figure>


<p>重点看这个信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>;; Query <span class="nb">time</span>: 44 msec
</span><span class='line'>;; SERVER: 8.8.8.8#53<span class="o">(</span>8.8.8.8<span class="o">)</span>
</span><span class='line'>;; WHEN: Sun Apr 19 17:07:11 CST 2020
</span><span class='line'>;; MSG SIZE  rcvd: 73
</span></code></pre></td></tr></table></div></figure>


<h2>注意</h2>

<p>不要直接修改这个文件<code>/etc/resolv.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span>
</span><span class='line'><span class="c">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span>
</span><span class='line'>nameserver 8.8.8.8
</span><span class='line'>nameserver fe80::1%eth0
</span><span class='line'>You have new mail in /var/mail/pi
</span></code></pre></td></tr></table></div></figure>


<p>正如上面英文说得，这个文件会被冲掉，未来某个时间你还需要重新设置。所以按照文章中的修改即可。</p>

<h2>推荐阅读</h2>

<ul>
<li><a href="https://droidyue.com/blog/2016/08/22/before-you-buy-raspberry-pi/">树莓派入手指南</a></li>
<li><a href="https://droidyue.com/blog/2020/02/23/install-jdk-on-raspberry-pi/">树莓派安装jdk 8</a></li>
<li><a href="https://droidyue.com/blog/2020/03/29/install-gitlab-on-raspberry-pi-issues/">树莓派 Gitlab问题整理</a></li>
<li><a href="https://droidyue.com/blog/2020/03/29/ssh-raspberrypi-failure/">修复ssh 首次登录树莓派失败的问题</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux 下使用cut命令，实现更好切分数据]]></title>
    <link href="https://droidyue.com/blog/2020/04/25/linux-cut-command/"/>
    <updated>2020-04-25T22:07:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/25/linux-cut-command</id>
    <content type="html"><![CDATA[<h2>cut是什么</h2>

<ul>
<li>一个Unix终端命令</li>
<li>切割行内容，并进行标准输出</li>
<li>可以按照字节，字符，分隔符进行切分</li>
</ul>


<!--more-->


<h2>能有什么用</h2>

<p>我们举一个简单的例子（非全部示例）来描述cut有什么用，可以做什么</p>

<h3>简洁输出，去除干扰冗余信息</h3>

<p>比如这个日志，可能会出现折行，另外假设<code>04-19 18:26:55.605 22750 22883 W</code>这些列的信息属于干扰信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>04-19 18:26:55.605 22750 22883 W System.err: java.lang.NoSuchFieldException
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.au.a<span class="o">(</span>Unknown Source:16<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.au.a<span class="o">(</span>Unknown Source:4<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.z.a<span class="o">(</span>Unknown Source:880<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.z.a<span class="o">(</span>Unknown Source:188<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:821<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:605<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:11<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.d.a<span class="o">(</span>Unknown Source:46<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.ak.b<span class="o">(</span>Unknown Source:50<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.ak.a<span class="o">(</span>Unknown Source:10<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.XMPushService<span class="nv">$c</span>.a<span class="o">(</span>Unknown Source:8<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.XMPushService<span class="nv">$i</span>.run<span class="o">(</span>Unknown Source:37<span class="o">)</span>
</span><span class='line'>04-19 18:26:55.605 22750 22883 W System.err:  at com.xiaomi.push.service.g<span class="nv">$c</span>.run<span class="o">(</span>Unknown Source:175<span class="o">)</span>
</span><span class='line'>04-19 18:27:24.787 23660 23685 W System.err: load vdr indoor lib success.
</span></code></pre></td></tr></table></div></figure>


<p>使用cut 我们可以实现删除上面的冗余信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adb logcat | grep <span class="s2">&quot;System.err&quot;</span> --line-buffered | cut -d <span class="s2">&quot; &quot;</span> -f 6-
</span><span class='line'>System.err: java.lang.NoSuchFieldException
</span><span class='line'>System.err:   at com.xiaomi.push.au.a<span class="o">(</span>Unknown Source:16<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.au.a<span class="o">(</span>Unknown Source:4<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.z.a<span class="o">(</span>Unknown Source:880<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.z.a<span class="o">(</span>Unknown Source:188<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:821<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:605<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.p.a<span class="o">(</span>Unknown Source:11<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.d.a<span class="o">(</span>Unknown Source:46<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.ak.b<span class="o">(</span>Unknown Source:50<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.ak.a<span class="o">(</span>Unknown Source:10<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.XMPushService<span class="nv">$c</span>.a<span class="o">(</span>Unknown Source:8<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.XMPushService<span class="nv">$i</span>.run<span class="o">(</span>Unknown Source:37<span class="o">)</span>
</span><span class='line'>System.err:   at com.xiaomi.push.service.g<span class="nv">$c</span>.run<span class="o">(</span>Unknown Source:175<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>按照字节切分(cut -b)</h2>

<h3>按照字节位置切分</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 取第一个字节</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 1
</span><span class='line'>a
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># 取第二个字节</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 2
</span><span class='line'>b
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c"># 从1开始，0会报错</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 0
</span><span class='line'>cut: byte/character positions are numbered from 1
</span><span class='line'>Try <span class="s1">&#39;cut --help&#39;</span> <span class="k">for </span>more information.
</span></code></pre></td></tr></table></div></figure>


<h3>按照字节区间切分</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#1到2字节位置切分</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 1-2
</span><span class='line'>ab
</span><span class='line'>
</span><span class='line'><span class="c"># 限定区间起始位置，不限定结束位置</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 1-
</span><span class='line'>abcdef
</span><span class='line'>
</span><span class='line'><span class="c"># 限定区间结束位置，但不限定起始位置</span>
</span><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b -5
</span><span class='line'>abcde
</span></code></pre></td></tr></table></div></figure>


<h3>按照字节多个位置切分</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pi@raspberrypi:~ <span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;abcdef&quot;</span> | cut -b 1,3,5
</span><span class='line'>ace
</span></code></pre></td></tr></table></div></figure>


<h2>按照字符区分</h2>

<p>当我们按照字符进行切分时，会遇到一些问题，比如出现中文的时候（一个中文占用三个字节）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># 异常出现</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;小黑屋&quot;</span> | cut -b 1
</span><span class='line'>�
</span><span class='line'>
</span><span class='line'><span class="c">##必须限定满足正确的开始和结束位置</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;小黑屋&quot;</span> | cut -b 1-3
</span><span class='line'>小
</span></code></pre></td></tr></table></div></figure>


<p>但是如果中英文并存，就比较麻烦了，好在有按照字符切分的方法(cut -c)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s2">&quot;abcd技术小黑屋ef&quot;</span> | cut -c 7
</span><span class='line'>小
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;abcd技术小黑屋ef&quot;</span> | cut -c 7-9
</span><span class='line'>小黑屋
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;abcd技术小黑屋ef&quot;</span> | cut -c 7,8,9
</span><span class='line'>小黑屋
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;abcd技术小黑屋ef&quot;</span> | cut -c 5-
</span><span class='line'>技术小黑屋ef
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;abcd技术小黑屋ef&quot;</span> | cut -c -9
</span><span class='line'>abcd技术小黑屋
</span></code></pre></td></tr></table></div></figure>


<h2>按照分隔符切分（cut -d ）</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 1
</span><span class='line'>A
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 2
</span><span class='line'>BC
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 3
</span><span class='line'>DEF
</span><span class='line'>
</span><span class='line'><span class="c"># 区间，限定开始位置</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 1-
</span><span class='line'>A|BC|DEF|GHIJ
</span><span class='line'>
</span><span class='line'><span class="c">#区间，限定结束位置</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f -3
</span><span class='line'>A|BC|DEF
</span><span class='line'>
</span><span class='line'><span class="c"># 区间，限定开始和结束位置</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 1-2
</span><span class='line'>A|BC
</span><span class='line'>
</span><span class='line'><span class="c">#提供多个位置</span>
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;A|BC|DEF|GHIJ&quot;</span> |  cut -d <span class="s2">&quot;|&quot;</span> -f 1,2
</span><span class='line'>A|BC
</span></code></pre></td></tr></table></div></figure>


<h2>注意</h2>

<ul>
<li>上面为了示例简单实用了echo 加管道的方式</li>
<li>上面所有的例子，都可以实用类似加文件的形式</li>
<li>比如<code>cut -b 1 test_cut_file.txt</code>,<code>cut -c 1 test_cut_file.txt</code>,<code>cut -d "|" -f 1 test_cut_file.txt</code></li>
</ul>


<h2>更多</h2>

<ul>
<li><a href="https://droidyue.com/blog/categories/linux/">更多Linux文章</a></li>
<li><a href="https://droidyue.com/blog/categories/jiao-ben/">更多脚本文章</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Linux 下按照文件大小查找文件]]></title>
    <link href="https://droidyue.com/blog/2020/04/20/find-files-by-size-in-linux/"/>
    <updated>2020-04-20T20:33:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/20/find-files-by-size-in-linux</id>
    <content type="html"><![CDATA[<h2>为什么需要这篇文章</h2>

<p>我想大概是这种情况，你的Linux 机器下磁盘满了，需要清理，然后就需要查找大的文件，确定是否有用进行删除。</p>

<!--more-->


<h2>具体做法</h2>

<h3>查找500M以上的文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo find / -size +500M
</span><span class='line'>
</span><span class='line'>/swap.img
</span><span class='line'>/home/androidyue/file_server/ubuntu_18.04.tar
</span><span class='line'>/home/androidyue/bin/TeamCity-2019.2.2.tar.gz
</span><span class='line'>/proc/kcore
</span><span class='line'>find: ‘/proc/23619’: No such file or directory
</span></code></pre></td></tr></table></div></figure>


<h3>查找整整500M的文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo find / -size 500M
</span></code></pre></td></tr></table></div></figure>


<h3>查找小于500M的文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo find / -size -500M
</span><span class='line'>/
</span><span class='line'>/opt
</span><span class='line'>/opt/containerd
</span><span class='line'>/opt/containerd/lib
</span><span class='line'>/opt/containerd/bin
</span><span class='line'>/opt/gitlab
</span><span class='line'>/opt/gitlab/sv
</span><span class='line'>/opt/gitlab/sv/prometheus
</span><span class='line'>/opt/gitlab/sv/prometheus/log
</span><span class='line'>/opt/gitlab/sv/prometheus/log/run
</span><span class='line'>/opt/gitlab/sv/prometheus/log/main
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/stat
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/status
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/pid
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/lock
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/ok
</span><span class='line'>/opt/gitlab/sv/prometheus/log/supervise/control
</span><span class='line'>/opt/gitlab/sv/prometheus/run
</span><span class='line'>/opt/gitlab/sv/prometheus/env
</span></code></pre></td></tr></table></div></figure>


<h3>查找大于100M且小于500M的文件</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo find / -size -500M -size +100M
</span><span class='line'>/sys/devices/pci0000:00/0000:00:02.0/resource2_wc
</span><span class='line'>/sys/devices/pci0000:00/0000:00:02.0/resource2
</span><span class='line'>/usr/bin/dockerd
</span></code></pre></td></tr></table></div></figure>


<h2>其他查找单位</h2>

<ul>
<li>b – for 512-byte blocks (this is the default if no suffix is used)</li>
<li>c – for bytes</li>
<li>w – for two-byte words</li>
<li>k – for Kilobytes</li>
<li>M – for Megabytes</li>
<li>G – for Gigabytes</li>
</ul>


<h2>References</h2>

<ul>
<li><a href="https://www.ostechnix.com/find-files-bigger-smaller-x-size-linux/">https://www.ostechnix.com/find-files-bigger-smaller-x-size-linux/</a></li>
<li><a href="http://man7.org/linux/man-pages/man1/find.1.html">http://man7.org/linux/man-pages/man1/find.1.html</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Centos(Linux)系统下实现挂载硬盘]]></title>
    <link href="https://droidyue.com/blog/2020/04/12/mount-a-new-disk-on-centos-linux/"/>
    <updated>2020-04-12T20:50:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/12/mount-a-new-disk-on-centos-linux</id>
    <content type="html"><![CDATA[<h2>背景</h2>

<ul>
<li>团队的CI机器有两块硬盘，一块是256G SSD,另一块是1T 机械硬盘。</li>
<li>系统安装到了SSD上，1T的机械硬盘处于闲置状态，需要挂载，用来存放一些文件。</li>
</ul>


<!--more-->


<h2>注意事项</h2>

<ul>
<li>文章提到的<code>/dev/sda</code>和<code>/mnthhd_my</code>仅为示例说明</li>
<li>需要根据自己的真实情况进行替换，尤其是格式化硬盘是要格外注意。</li>
</ul>


<h2>确定新硬盘</h2>

<h3>使用fdisk -l</h3>

<p>使用fdisk并且配合目标硬盘的容量1T,我们可以轻松的找到未挂载的硬盘是<code>/dev/sda</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo fdisk -l
</span><span class='line'>
</span><span class='line'>Disk /dev/nvme0n1: 238.5 GiB, 256060514304 bytes, 500118192 sectors
</span><span class='line'>Units: sectors of 1 * <span class="nv">512</span> <span class="o">=</span> 512 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>Disklabel <span class="nb">type</span>: gpt
</span><span class='line'>Disk identifier: XXXXXX-C9A1-4D0D-8CF5-XXXXX
</span><span class='line'>
</span><span class='line'>Device           Start       End   Sectors   Size Type
</span><span class='line'>/dev/nvme0n1p1    2048   1230847   1228800   600M EFI System
</span><span class='line'>/dev/nvme0n1p2 1230848   3327999   2097152     1G Linux filesystem
</span><span class='line'>/dev/nvme0n1p3 3328000 500117503 496789504 236.9G Linux LVM
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/sda: 931.5 GiB, 1000204886016 bytes, 1953525168 sectors
</span><span class='line'>Units: sectors of 1 * <span class="nv">512</span> <span class="o">=</span> 512 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 4096 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 4096 bytes / 4096 bytes
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/mapper/cl-root: 50 GiB, 53687091200 bytes, 104857600 sectors
</span><span class='line'>Units: sectors of 1 * <span class="nv">512</span> <span class="o">=</span> 512 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/mapper/cl-swap: 15.7 GiB, 16869490688 bytes, 32948224 sectors
</span><span class='line'>Units: sectors of 1 * <span class="nv">512</span> <span class="o">=</span> 512 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Disk /dev/mapper/cl-home: 171.2 GiB, 183798595584 bytes, 358981632 sectors
</span><span class='line'>Units: sectors of 1 * <span class="nv">512</span> <span class="o">=</span> 512 bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512 bytes / 512 bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: 512 bytes / 512 bytes
</span></code></pre></td></tr></table></div></figure>


<h3>(可选)使用lsblk</h3>

<p>如果有下面的情况，可以使用lsblk</p>

<ul>
<li>新的硬盘和已有硬盘容量相同，无法确定</li>
<li>再次确定新的硬盘是否是没有挂载</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>➜  ~ lsblk
</span><span class='line'>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
</span><span class='line'>sda           8:0    0 931.5G  0 disk
</span><span class='line'>nvme0n1     259:0    0 238.5G  0 disk
</span><span class='line'>├─nvme0n1p1 259:1    0   600M  0 part /boot/efi
</span><span class='line'>├─nvme0n1p2 259:2    0     1G  0 part /boot
</span><span class='line'>└─nvme0n1p3 259:3    0 236.9G  0 part
</span><span class='line'>  ├─cl-root 253:0    0    50G  0 lvm  /
</span><span class='line'>  ├─cl-swap 253:1    0  15.7G  0 lvm  <span class="o">[</span>SWAP<span class="o">]</span>
</span><span class='line'>  └─cl-home 253:2    0 171.2G  0 lvm  /home
</span></code></pre></td></tr></table></div></figure>


<p>如上</p>

<ul>
<li>sda 的 MOUNTPOINT对应的为空，表明并没有挂载</li>
</ul>


<h2>(可选)创建文件系统</h2>

<p>其实就是格式化新的硬盘，这一步是比较危险的，一定要确保<code>/dev/sda</code>是你那里正确的硬盘。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mkfs -t ext4 /dev/sda
</span></code></pre></td></tr></table></div></figure>


<p>这一步并非必须的，但是如果需要这样的问题<code>wrong fs type, bad option, bad superblock on /dev/sda, missing codepage or helper program, or other error</code>。则需要执行这一个步骤。</p>

<h2>创建挂载点</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mkdir /mnthhd_my
</span></code></pre></td></tr></table></div></figure>


<p>其中<code>/mnthhd_my</code>并没有限定，可以为其他路径。</p>

<h2>进行挂载</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo mount /dev/sda mnthhd_my
</span></code></pre></td></tr></table></div></figure>


<h2>验证挂载</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>➜  ~ lsblk
</span><span class='line'>NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
</span><span class='line'>sda           8:0    0 931.5G  0 disk /mnthhd_my
</span><span class='line'>nvme0n1     259:0    0 238.5G  0 disk
</span><span class='line'>├─nvme0n1p1 259:1    0   600M  0 part /boot/efi
</span><span class='line'>├─nvme0n1p2 259:2    0     1G  0 part /boot
</span><span class='line'>└─nvme0n1p3 259:3    0 236.9G  0 part
</span><span class='line'>  ├─cl-root 253:0    0    50G  0 lvm  /
</span><span class='line'>  ├─cl-swap 253:1    0  15.7G  0 lvm  <span class="o">[</span>SWAP<span class="o">]</span>
</span><span class='line'>  └─cl-home 253:2    0 171.2G  0 lvm  /home
</span></code></pre></td></tr></table></div></figure>


<p>sda对应的MOUNTPOINT的值变成了<code>/mnthhd_my</code></p>

<h2>开机自动挂载硬盘</h2>

<ul>
<li>上面的挂载只在当前系统运行期间生效。</li>
<li>想要开机自动挂载需要额外的修改。</li>
</ul>


<h3>实施步骤</h3>

<ol>
<li> 备份现有配置文件，执行<code>cp /etc/fstab /etc/fstab.backup</code></li>
<li> 打开配置文件  <code>sudo vim /etc/fstab</code></li>
<li> 文件最后添加挂载配置 <code>/dev/sda  /mnthhd_my   ext4    defaults    0 2</code></li>
<li> 保存文件</li>
<li> 使用<code>mount -a</code>验证fstab配置是否正确。</li>
<li> 重启服务器进行验证。</li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[The APK file xxxx.apk does not exist on disk问题修复]]></title>
    <link href="https://droidyue.com/blog/2020/04/11/the-apk-file-xxxx-dot-apk-does-not-exist-on-disk/"/>
    <updated>2020-04-11T15:22:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/11/the-apk-file-xxxx-dot-apk-does-not-exist-on-disk</id>
    <content type="html"><![CDATA[<p>许久之前，用Espresso写过一些测试用例，但是执行的时候总是报这种错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>The APK file aaa-debug-4.2.8-886eda0d9d-400208.apk does not exist on disk.
</span><span class='line'>Error <span class="k">while </span>Installing APK
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h2>解决方法</h2>

<p>执行<code>File -&gt; Sync Project with Gradle Files</code> 即可。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[修复Gradle因代理设置导致的超时问题]]></title>
    <link href="https://droidyue.com/blog/2020/04/11/fix-gradle-timeout-due-to-wrong-network-configuration/"/>
    <updated>2020-04-11T14:58:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/11/fix-gradle-timeout-due-to-wrong-network-configuration</id>
    <content type="html"><![CDATA[<p>之前在项目中增加了一个项目依赖，可是配置的时候，怎么也无法下载下来。中终端执行gradle得到的错误日志如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">resource</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpRequestException</span><span class="o">:</span> <span class="n">Could</span> <span class="n">not</span> <span class="n">HEAD</span> <span class="err">&#39;</span><span class="nl">https:</span><span class="c1">//jcenter.bintray.com/com/google/code/findbugs/jsr305/2.0.1/jsr305-2.0.1-sources.jar&#39;.</span>
</span><span class='line'><span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">resource</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpClientHelper</span><span class="o">.</span><span class="na">performRequest</span><span class="o">(</span><span class="n">HttpClientHelper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">96</span><span class="o">)</span>
</span><span class='line'><span class="n">at</span> <span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">resource</span><span class="o">.</span><span class="na">transport</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">HttpClientHelper</span><span class="o">.</span><span class="na">performRawHead</span><span class="o">(</span><span class="n">HttpClientHelper</span><span class="o">.</span><span class="na">java</span><span class="o">:</span><span class="mi">72</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<p>怀疑是网络的问题，先后开启了***工具都无法下载。后来摸索了一段时间，才发现了问题的所在。我在gradle.properties的代理错误设置有问题</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">systemProp</span><span class="o">.</span><span class="na">https</span><span class="o">.</span><span class="na">proxyPort</span><span class="o">=</span><span class="mi">1080</span>
</span><span class='line'><span class="n">systemProp</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">proxyHost</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
</span><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">jvmargs</span><span class="o">=-</span><span class="n">Xmx10240m</span> <span class="o">-</span><span class="n">XX</span><span class="err">\</span><span class="o">:</span><span class="n">MaxPermSize</span><span class="err">\</span><span class="o">=</span><span class="mi">4096</span><span class="n">m</span> <span class="o">-</span><span class="n">XX</span><span class="err">\</span><span class="o">:+</span><span class="n">HeapDumpOnOutOfMemoryError</span> <span class="o">-</span><span class="n">Dfile</span><span class="o">.</span><span class="na">encoding</span><span class="err">\</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
</span><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">daemon</span><span class="o">=</span><span class="kc">true</span>
</span><span class='line'><span class="n">systemProp</span><span class="o">.</span><span class="na">https</span><span class="o">.</span><span class="na">proxyHost</span><span class="o">=</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
</span><span class='line'><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">parallel</span><span class="o">=</span><span class="kc">true</span>
</span><span class='line'><span class="n">systemProp</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">proxyPort</span><span class="o">=</span><span class="mi">1080</span>
</span></code></pre></td></tr></table></div></figure>


<h2>解决方法</h2>

<ul>
<li>删除或者更正相关的http和https的host和端口，问题即可解决。</li>
</ul>


<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[未合并分支不怕丢,一个脚本快速搞定]]></title>
    <link href="https://droidyue.com/blog/2020/04/05/a-quick-script-to-view-all-unmerged-branches/"/>
    <updated>2020-04-05T21:20:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/04/05/a-quick-script-to-view-all-unmerged-branches</id>
    <content type="html"><![CDATA[<p>我们使用 git 作为 版本控制工具，极大的提高了效率，但是随着业务的增多和自身对于提交内容原子性的要求，往往会产生很多的分支，这就难免有时候，在发版的时候，某些分支被遗忘提交，造成功能丢失等问题。</p>

<p>因而如果保证分支多而且不忘记合并，是一个我们需要解决的问题。</p>

<ul>
<li>单纯靠人为挨个去看，肯定是不行的</li>
<li>如果有程序化处理就靠谱多了</li>
</ul>


<!--more-->


<p>是的，git有一个这样的功能呢，比如我们想要查看是否有分支没有合并进入develop</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git branch --no-merged develop
</span></code></pre></td></tr></table></div></figure>


<p>是的，这能解决问题，但是比如我们迁出了预发布分支(pre_release)，有的分支合并到了pre_release(但没有合并到develop), 上面的查找就不太合适了。</p>

<p>所以我们需要的是</p>

<ul>
<li>能进行基于多个分支未合并的分支去交集</li>
<li>支持自定义的忽略某些分支出现在未合并分支列表</li>
</ul>


<p>于是有了下面的脚本</p>

<h2>脚本内容</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">getUnmergedBranches</span><span class="p">(</span><span class="n">targetBranch</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="sb">`git branch --no-merged </span><span class="si">#{</span><span class="n">targetBranch</span><span class="si">}</span><span class="sb">`</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/\n+/</span><span class="p">)</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">sub</span>  <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">strip</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">branchesUnmergedToPreRelease</span> <span class="o">=</span> <span class="n">getUnmergedBranches</span><span class="p">(</span><span class="s1">&#39;origin/pre_release&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="p">(</span><span class="n">getUnmergedBranches</span><span class="p">(</span><span class="s1">&#39;origin/develop&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">branchesUnmergedToPreRelease</span><span class="p">)</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span><span class="o">|</span><span class="n">branch</span><span class="o">|</span> <span class="o">!</span><span class="n">branch</span><span class="o">.</span><span class="n">start_with?</span> <span class="s2">&quot;unmerge_ignore_&quot;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面的脚本做的是</p>

<ul>
<li>获取未合并进入<code>origin/develop</code>的分支集合 A</li>
<li>获取未合并进入<code>origin/pre_release</code>的分支集合 B</li>
<li>对于上面的 分支集合 A 和 B 取交集 得到 分支集合 C</li>
<li>在分支集合 C 中提出 自定义忽略分支（以<code>unmerge_ignore_</code>开头）</li>
</ul>


<h2>脚本使用示例</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~:/  ruby unmergedBranches.rb
</span><span class='line'>checkstyle
</span><span class='line'>error_prone
</span><span class='line'>file_chooser_webview
</span><span class='line'>image_loading
</span><span class='line'>jduan_inter_webview_messaging
</span><span class='line'>jduan_webview_client_refactor
</span><span class='line'>migration_to_androidx
</span><span class='line'>upgrade_gradle_1106
</span><span class='line'>upgrade_gradle_3.2.0
</span><span class='line'>upgrade_suppport_28.0.0
</span><span class='line'>video_preload
</span></code></pre></td></tr></table></div></figure>


<h2>忽略某个分支，不作为unmerged 分支内容</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'><span class="c1"># encoding: utf-8</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Please input the branch to unmerge-ignore&quot;</span>
</span><span class='line'><span class="n">targetBranch</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'><span class="nb">puts</span> <span class="s2">&quot;You want to ignore this branch:</span><span class="si">#{</span><span class="n">targetBranch</span><span class="si">}</span><span class="s2">, Are you sure? (input yes)&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">confirm</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">confirm</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">newBranchName</span> <span class="o">=</span> <span class="s2">&quot;unmerge_ignore_</span><span class="si">#{</span><span class="n">targetBranch</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="nb">system</span> <span class="s2">&quot;git branch -m </span><span class="si">#{</span><span class="n">targetBranch</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">newBranchName</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;changed </span><span class="si">#{</span><span class="n">targetBranch</span><span class="si">}</span><span class="s2"> into </span><span class="si">#{</span><span class="n">newBranchName</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>使用上面的脚本，就能够以命令交互的形式忽略某个分支</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>~:/ ruby ignoreBranchWhenUnmerged.rb
</span><span class='line'>Please input the branch to unmerge-ignore
</span><span class='line'>new_account_sys
</span><span class='line'>You want to ignore this branch:new_account_sys, Are you sure? <span class="o">(</span>input yes<span class="o">)</span>
</span><span class='line'>yes
</span><span class='line'>changed new_account_sys into unmerge_ignore_new_account_sys
</span></code></pre></td></tr></table></div></figure>


<p>以上.</p>

<h2>更多内容推荐</h2>

<ul>
<li><a href="https://droidyue.com/blog/categories/jiao-ben/">更多脚本高效工具</a></li>
<li><a href="https://droidyue.com/ninki/">小黑屋优质内容</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[INSTALL PARSE FAILED UNEXPECTED EXCEPTION 问题]]></title>
    <link href="https://droidyue.com/blog/2020/03/30/install-parse-failed-unexpected-exception/"/>
    <updated>2020-03-30T20:59:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/30/install-parse-failed-unexpected-exception</id>
    <content type="html"><![CDATA[<p>顺手整理一个之前记录未文字输出的老问题，使用adb install爆出的问题</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>adb install -r -d <span class="s2">&quot;2.8.5-475.apk&quot;</span>
</span><span class='line'>adb: failed to install 2.8.5-475.apk: Failure <span class="o">[</span>INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION:
</span><span class='line'>Failed to parse /data/app/vmdl981460948.tmp/base.apk: AndroidManifest.xml<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<!--more-->


<h2>原因</h2>

<p>apk在传入过程中出现错误，所以导致了该问题出现</p>

<h2>解决方案</h2>

<p>重新传输没有问题的apk包。</p>

<h2>怎么验证apk包没有问题</h2>

<ul>
<li>发送者发apk，顺带着apk的md5值</li>
<li>接收端接收apk，并校验apk的md5值是否与发送者的一致。</li>
</ul>


<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[树莓派 gitlab问题整理]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/install-gitlab-on-raspberry-pi-issues/"/>
    <updated>2020-03-29T20:15:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/install-gitlab-on-raspberry-pi-issues</id>
    <content type="html"><![CDATA[<h2>E: Unable to locate package gitlab-ce</h2>

<ul>
<li>不要使用<code>sudo curl -sS https://packages.gitlab.com/install/repositories/gitlab/raspberry-pi2/script.deb.sh | sudo bash</code></li>
<li>替换使用这个<code>sudo curl -sS https://packages.gitlab.com/install/repositories/gitlab/raspberry-pi2/script.deb.sh | sudo os=raspbian dist=jessie bash</code></li>
<li>然后执行<code>sudo apt install gitlab-ce</code></li>
</ul>


<!--more-->


<h2>E: The package gitlab-ce needs to be reinstalled, but I can&rsquo;t find an archive for it.</h2>

<ul>
<li>执行<code>sudo dpkg --remove --force-all  gitlab-ce</code></li>
</ul>


<h2>References</h2>

<ul>
<li><a href="https://gitlab.com/gitlab-org/omnibus-gitlab/issues/2767#note_54628738">https://gitlab.com/gitlab-org/omnibus-gitlab/issues/2767#note_54628738</a></li>
<li><a href="https://askubuntu.com/questions/868064/e-the-package-ubuntu-mono-needs-to-be-reinstalled-but-i-cant-find-an-archive/868227#868227">https://askubuntu.com/questions/868064/e-the-package-ubuntu-mono-needs-to-be-reinstalled-but-i-cant-find-an-archive/868227#868227</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[一些关于微信分享的建议规范]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/wechat-share-standard/"/>
    <updated>2020-03-29T19:51:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/wechat-share-standard</id>
    <content type="html"><![CDATA[<p>实话讲，微信的文档真的是差强人意，除了让人难以忍受的代码使用截图展示外，其中关于一些分享的规范也不好找。</p>

<p>还好借助Google，找到了一些规范，涉及缩略图和文字个数等。</p>

<!--more-->


<p><img src="https://asset.droidyue.com/image/2019_07/wechat_timeline_link_share.png" alt="wechat_timeline_link_share" /></p>

<p><img src="https://asset.droidyue.com/image/2019_07/wechat_session_link_share.png" alt="wechat_session_link_share" /></p>

<p>当然为了验证权威性，大家可以访问这两个地址的图片。</p>

<ul>
<li><a href="http://wximg.qq.com/wxp/wxmoment-doc/images/2-4-2.png">http://wximg.qq.com/wxp/wxmoment-doc/images/2-4-2.png</a></li>
<li><a href="http://wximg.qq.com/wxp/wxmoment-doc/images/2-4-1.png">http://wximg.qq.com/wxp/wxmoment-doc/images/2-4-1.png</a></li>
</ul>


<p>以上。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[修复ssh 首次登录树莓派失败的问题]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/ssh-raspberrypi-failure/"/>
    <updated>2020-03-29T19:46:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/ssh-raspberrypi-failure</id>
    <content type="html"><![CDATA[<p>默认情况下，树莓派不支持ssh登录，需要做一些简单的处理</p>

<p>解决方法很简单</p>

<ul>
<li>在Mac或者linux电脑上，使用终端进入<code>cd /Volumes/disk_of_raspberry</code></li>
<li>创建一个文件，叫做ssh,<code>touch ssh</code></li>
</ul>


<!--more-->


<p>完整的代码大概是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /Volumes/disk_of_raspberry
</span><span class='line'>touch ssh
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Nuc 设置断电后自动开机]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/auto-on-after-power-failure-nuc/"/>
    <updated>2020-03-29T17:18:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/auto-on-after-power-failure-nuc</id>
    <content type="html"><![CDATA[<h2>步骤</h2>

<ul>
<li>开机 看到启动界面后（多次）按 F2 进入BIOS</li>
<li>进入Power Tab  向下滑动Secondary Power Settings区域</li>
<li>找到 After Power Failure 选择Power On</li>
<li>按 F10 保存并退出即可。</li>
</ul>


<!--more-->


<p>相关图
<img src="https://asset.droidyue.com/image/2020_03/nuc_after_power_off.png" alt="https://asset.droidyue.com/image/2020_03/nuc_after_power_off.png" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KotlinTips asType 快捷转换]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/kotlintips-as-type/"/>
    <updated>2020-03-29T17:15:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/kotlintips-as-type</id>
    <content type="html"><![CDATA[<h3>作用</h3>

<ul>
<li>更加流畅地，一气呵成进行类型转换</li>
</ul>


<!--more-->


<h3>代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * 将一种类型转换为另一种类型,如果类型转换不允许，返回null</span>
</span><span class='line'><span class="cm"> * */</span>
</span><span class='line'><span class="n">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">reified</span> <span class="n">T</span><span class="p">&gt;</span> <span class="n">Any</span><span class="p">.</span><span class="n">asType</span><span class="p">():</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">if</span> <span class="p">(</span><span class="k">this</span> <span class="k">is</span> <span class="n">T</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">this</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">null</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">fun</span> <span class="nf">testAsType</span><span class="p">(</span><span class="n">charSequence</span><span class="p">:</span> <span class="n">CharSequence</span><span class="p">?)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//书写不流畅，需要回到开始出增加()</span>
</span><span class='line'>  <span class="p">(</span><span class="n">charSequence</span> <span class="k">as</span><span class="p">?</span> <span class="n">String</span><span class="p">)?.</span><span class="n">length</span>
</span><span class='line'>  <span class="c1">//一气呵成书写</span>
</span><span class='line'>  <span class="n">charSequence</span><span class="p">?.</span><span class="n">asType</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;()?.</span><span class="n">length</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>reified</h3>

<ul>
<li><a href="https://droidyue.com/blog/2019/07/28/kotlin-reified-generics/">使用Kotlin Reified 让泛型更简单安全</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KotlinTips elvis 快速返回]]></title>
    <link href="https://droidyue.com/blog/2020/03/29/kotlin-tips-elvis-return/"/>
    <updated>2020-03-29T17:11:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/29/kotlin-tips-elvis-return</id>
    <content type="html"><![CDATA[<h3>作用</h3>

<ul>
<li>在方法初始部分，对于值不符合预期，快速返回不再继续执行</li>
</ul>


<!--more-->


<h3>代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">private</span> <span class="k">fun</span> <span class="nf">testElvisReturn</span><span class="p">(</span><span class="n">commands</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;?)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//如果值不符合预期(null)，直接返回</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">firstCommand</span> <span class="p">=</span> <span class="n">commands</span><span class="p">?.</span><span class="n">firstOrNull</span><span class="p">()</span> <span class="p">?:</span> <span class="k">return</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">when</span><span class="p">(</span><span class="n">firstCommand</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&quot;ADD&quot;</span> <span class="p">-&gt;</span> <span class="s">&quot;Add something&quot;</span>
</span><span class='line'>        <span class="s">&quot;DELETE&quot;</span> <span class="p">-&gt;</span> <span class="s">&quot;Delete something&quot;</span>
</span><span class='line'>        <span class="s">&quot;UPDATE&quot;</span> <span class="p">-&gt;</span> <span class="s">&quot;Update something&quot;</span>
</span><span class='line'>        <span class="k">else</span> <span class="p">-&gt;</span> <span class="s">&quot;Find something&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[KotlinTips: getValueSafely 安全取值]]></title>
    <link href="https://droidyue.com/blog/2020/03/22/kotlin-tips-get-value-safely/"/>
    <updated>2020-03-22T18:52:00+08:00</updated>
    <id>https://droidyue.com/blog/2020/03/22/kotlin-tips-get-value-safely</id>
    <content type="html"><![CDATA[<h3>作用</h3>

<ul>
<li>安全取值，增加稳定性</li>
<li>规避繁琐的显式try-catch处理</li>
</ul>


<!--more-->


<h3>代码</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> * 安全的获取值的信息，其过程中发生异常会自动处理，返回null</span>
</span><span class='line'><span class="cm"> * getValueAction 取值操作，可能发生异常</span>
</span><span class='line'><span class="cm"> * */</span>
</span><span class='line'><span class="n">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">getValueSafely</span><span class="p">(</span><span class="n">getValueAction</span><span class="p">:</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">T</span><span class="p">?):</span> <span class="n">T</span><span class="p">?</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">getValueAction</span><span class="p">()</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">t</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">()</span>
</span><span class='line'>        <span class="k">null</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>验证一番</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="k">fun</span> <span class="nf">testGetValueSafely</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">value1</span> <span class="p">=</span> <span class="n">getValueSafely</span> <span class="p">{</span>
</span><span class='line'>        <span class="m">1</span><span class="p">/</span> <span class="m">0</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">value2</span> <span class="p">=</span> <span class="n">getValueSafely</span> <span class="p">{</span>
</span><span class='line'>        <span class="m">1</span> <span class="p">+</span> <span class="m">1</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">value1</span><span class="p">.</span><span class="n">printLog</span><span class="p">()</span>
</span><span class='line'>  <span class="n">value2</span><span class="p">.</span><span class="n">printLog</span><span class="p">()</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>执行日志</h4>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='kotlin'><span class='line'><span class="m">03</span><span class="p">-</span><span class="m">21</span> <span class="m">16</span><span class="p">:</span><span class="m">55</span><span class="p">:</span><span class="m">05.649</span>  <span class="m">5072</span>  <span class="m">5072</span> <span class="n">I</span> <span class="n">KotlinTips</span><span class="p">:</span> <span class="k">null</span>
</span><span class='line'><span class="m">03</span><span class="p">-</span><span class="m">21</span> <span class="m">16</span><span class="p">:</span><span class="m">55</span><span class="p">:</span><span class="m">05.649</span>  <span class="m">5072</span>  <span class="m">5072</span> <span class="n">I</span> <span class="n">KotlinTips</span><span class="p">:</span> <span class="m">2</span>
</span></code></pre></td></tr></table></div></figure>


<h2>关于 KotlinTips</h2>

<p>KotlinTips是一个关于Kotlin编码技巧的一个系列，希望通过轻量简单的形式介绍能对大家有帮助。</p>
]]></content>
  </entry>
  
</feed>
